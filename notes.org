#+TITLE: My Notes
#+OPTIONS: H:4
#+STARTUP: overview
#+STARTUP: align
#+TODO: TODO IN-PROGRESS WAITING DONE

* DONE learn emacs org mode
* TODO QUnit
* TODO Learn Bootstrap CSS framework

* TODO Learn Continuous Integration "Pantheon Build Drupal with Composer on Travis"

* TODO Learn SPF and whitelabel

* Emacs
** Install & Configuration
Download for Windows https://ftp.gnu.org/pub/gnu/emacs/windows/
This version: emacs-24.5-bin-i686-mingw32.zip
Extract it to C:\emacs, so you will have C:\emacs\emacs-24.5-bin-i686-mingw32\
Make a shortcut of this file /bin/runemacs.exe and copy to your notes folder say C:\c\notes\
Then right click, select Properties of the shortcut and change the ~Start In~ to =C:\c\notes= 
Set a HOME user environment variable in Windows as ~C:\c\notes~
Include a file ~.emacs~ in ~C:\c\notes~ 
Your home folder in Emacs is ~C:\c\notes~
~/.emacs 
~(setq org-catch-invisible-edits 'smart)~

*** M-x
| customize-themes | Load a theme |
|                  |              |

** Basics
#+NAME: tab:emacs-basics
| Help             |                                               |
|------------------+-----------------------------------------------|
| C-h f            | Search by command, get shortcut               |
| C-h v            | Get variable value                            |
|                  |                                               |
| File             |                                               |
|------------------+-----------------------------------------------|
| C-x C-s          | Save                                          |
| C-x C-c          | quit emacs                                    |
| C-x C-f          | Open file, Create file                        |
|                  |                                               |
| Editing          |                                               |
|------------------+-----------------------------------------------|
| _underlined_     |                                               |
| ~verbatim~       |                                               |
| =verbatim=       |                                               |
| +strike_through+ |                                               |
| /Italics/        |                                               |
| C-c .            | Insert timestamp                              |
|                  |                                               |
| C-k              | Remove line, Delete Line                      |
| C-x u            | Undo                                          |
| C-a              | Beginning of line                             |
| C-e              | End of line                                   |
| C-h k            | Explain what key-combo will do                |
| C-S-Bksp         | Kill whole line                               |
| C-x u            | undo                                          |
|                  |                                               |
| <q               | =#+BEGIN_QUOTE=                               |
| <H               | =#+BEGIN_HTML=                                |
| <c               | =#+BEGIN_CENTER=                              |
| <e               | =#+BEGIN_EXAMPLE=                             |
| c-c ;            | =#+BEGIN_COMMENT=                             |
|                  |                                               |
| Headline         |                                               |
|------------------+-----------------------------------------------|
| TAB              | Local tree fold/unfold                        |
| C-u TAB          | Global tree fold/unfold                       |
| C-u C-u C-u TAB  | Show all                                      |
|                  |                                               |
| Table            | <<<emacs:table>>>                             |
|------------------+-----------------------------------------------|
| C-c -            | Insert a horizontal line below                |
| M-S-<down>       | Insert a new row above                        |
| C-c <RET>        | Insert horizontal line and a new row below    |
| M-S-<up>         | Delete a current row                          |
|                  |                                               |
| M-S-<right>      | Insert new column on the right                |
| M-S-<left>       | Delete current column                         |
|                  |                                               |
| C-c <SPC>        | Blank current field                           |
| C-c `            | Edit current field                            |
|                  |                                               |
| S-<TAB>          | Move to previous field                        |
| M-<up>/<down>    | Move a row                                    |
| M-<left>/<right> | Move a column                                 |
|                  |                                               |
| C-c \vert{}      | After text is selected, convert to table      |
|                  |                                               |
| Moving           |                                               |
|------------------+-----------------------------------------------|
| C-l              | Scroll current line to center                 |
| C-x b            | switch to another buffer                      |
| M-<              | Move to beginning of buffer                   |
| M->              | Move to end of buffer                         |
| M-g M-g          | Go to a line                                  |
| C-c C-j          | org-goto. Search in headlines only            |
|                  |                                               |
| Windows          |                                               |
|------------------+-----------------------------------------------|
| C-x 0            | remove current window                         |
| C-x 1            | Close all other windows; Or close help window |
| C-x 2            | Split horizontally                            |
| C-x 3            | split vertically                              |
| C-x o            | move to other window                          |
|                  |                                               |
| Regions          | (selection)                                   |
|------------------+-----------------------------------------------|
| C-space          | Start region, then move cursor to select      |
| C-x h            | Copy all in buffer                            |
| C-g              | deactive mark                                 |
|                  |                                               |
| Kill & Copy      |                                               |
|------------------+-----------------------------------------------|
| C-w              | kill region (cut)                             |
| M-w              | copy to kill-ring (shared with other buffers) |
| C-y              | yank                                          |
|                  |                                               |
| Search           |                                               |
|------------------+-----------------------------------------------|
| C-s, C-r         | search string, forward/backward               |
| Return           | quit searching                                |
| M-C-s            | forward regex search                          |
| M-C-r            | backward regex search                         |
|                  |                                               |

** Headline <<<emacs:headline>>>
| C-u TAB          | Global tree fold/unfold             |
| C-u C-u C-u TAB  | Show all                            |
|                  |                                     |
| C-c C-n          | Next heading                        |
| C-c C-p          | Previous heading                    |
| C-c C-f          | Next heading same level             |
| C-c C-b          | Previous heading same level         |
|                  |                                     |
| C-c C-u          | Backward to higher level heading    |
|                  |                                     |
| M-S-<right>      | Increase heading level of an item   |
|                  | and its child items                 |
| M-S-<left>       | Same as above but decrease          |
|                  |                                     |
| M-<right>/<left> | Decrease/increase level of a        |
|                  | parent item only                    |
|                  |                                     |
| S-<TAB>          | In table, go to previous cell       |
|                  | In other places, global fold/unfold |
|                  |                                     |

C-x n s :: Work on one section
C-x n w :: Back to outline

C-c C-j :: jump to different heading. C-g to exit. up/down to move headline, ~/~ sparse-tree search

M-<RET> or C-<RET> :: insert heading

*** Drawer
C-c C-x d :: Create a drawer

:MYDRAWER: 
This is inside the drawer

:END:

** Symbol and Escape <<<emacs:escape>>>

#+BEGIN_EXAMPLE
\vert{}
which escapes |
#+END_EXAMPLE

[[http://orgmode.org/worg/org-symbols.html][Table of Symbols]]

** =TODO=
#+BEGIN_EXAMPLE
=** TODO=
#+END_EXAMPLE
S-left/right :: Cycle through *TODO*, *DONE* and empty.

** Sparse Tree, Search
C-c / r :: Search regex, C-c C-c to quit.
M-g M-n :: Next match
M-g M-p :: Previous match

** Link <<<emacs:link>>>
[[http://orgmode.org/manual/Link-format.html#Link-format][Here's description of the link]]

| C-c C-l | add or modify link                             |
|         | Or cusor to the right of end and hit BACKSPACE |
|---------+------------------------------------------------|
| C-c &   | Go back to previous position                   |
| C-c C-c | Update radio targets                           |

#+BEGIN_EXAMPLE
=[[My Target]]= 
By defalt, it leads to a text search
#+END_EXAMPLE

#+BEGIN_EXAMPLE
[[Link]] "Link" matches an exact headline
#+END_EXAMPLE

#+BEGIN_EXAMPLE
Something is referred to later in the file <<internal target>>
[[internal target]] will go to the target
#+END_EXAMPLE

#+NAME: Table One
| a  | table      |
|----+------------|
| of | four cells |
|----+------------|

#+BEGIN_EXAMPLE
Go to a named section [[Table One]]
#+END_EXAMPLE

<<<emacs:radio>>>
#+BEGIN_EXAMPLE
<<<Radio target>>>
This causes each occurence of 'Radio target' in normal text to become activated as a link
Emacs only update radio targets when the file is first loaded. To manual update, C-c C-c
#+END_EXAMPLE

* PHP
** Array
*** array_merge, array_merge_recursive
array_merge
- only merge on the first level
- If key is the same, value at later array will overwrite the first array's value.

array_merge_recursive
- If key is the same, values will be appended as array
- Very different from array_merge
** Heredoc and Nowdoc
#+BEGIN_EXAMPLE
$html = <<<HTML
<span>{$obj->name[1]}</span>
HTML;
#+END_EXAMPLE

Nowdoc can't expand variables
#+BEGIN_EXAMPLE
echo <<<'EOT'
<span>{$obj->name[1]}</span>
EOT;
#+END_EXAMPLE

** Apply XSLT on XML
#+BEGIN_EXAMPLE
$xml = new DOMDocument;
$xml->load('cdcatalog.xml');

$xsl = new DOMDocument;
$xsl->load('cdcatalog.xsl');

$proc = new XSLTProcessor;
$proc->importStyleSheet($xsl);

echo $proc->transformToXML($xml);
#+END_EXAMPLE

** Block Referral Traffic
#+BEGIN_EXAMPLE
if ( isset( $_SERVER['HTTP_REFERER'] ) ) {
  $_referer_domain = array(
    "~timebie\.com~i",
    "~ana-white\.com~i",
    "~mlizcochico\.com~i",
    "~adishofdailylife\.com~i",
    "~techvibes\.com~i",
    "~sociableblog\.com~i",
    "~laurenconrad\.com~i",
    "~gingerhotels\.com~i",
    "~grammarist\.com~i",
    "~dobbersports\.com~i",
    "~netsidebar\.com~i",
    "~myhomeideas\.com~i",
    "~fhm\.com~i",
    "~gamezebo\.com~i"
  );

  foreach ( $_referer_domain as $_referer ) {
    if ( preg_match( $_referer, $_SERVER['HTTP_REFERER'] ) ) {
      exit;
    }
  }

  $_referrer = parse_url($_SERVER['HTTP_REFERER']);
  if ($_referrer !== false && !is_null($_referrer['host'])
      && preg_match( "~oralhealthgroup\.com~i", $_referrer['host'] )) {
    $_p = (isset($_GET['p'])) ? $_GET['p'] : '';
    $_subid = (isset($_GET['subid'])) ? $_GET['subid'] : '';
    $_uid = (isset($_GET['uid'])) ? $_GET['uid'] : '';
    if ($_p !== '' && $_subid !== '' && $_uid !== '') {
      exit;
    }
  }
}
#+END_EXAMPLE

* Drupal
** Update Module
- Read module README first
- Usually just remove the module directory and put the new one in
- And run update.php

** Module
*** Feed Import

#+BEGIN_EXAMPLE
$feed_obj = feeds_source($feed_id,$feed->feed_nid);
$feed_obj->existing()->import(); // Use this so no jobs are inserted in batch

// Sequence
$this = feeds_source;
hook_feeds_before_import($this)
hook_feeds_after_parse($this, $parser_result)
FeedsProcessor.inc->process parser_result
releaseLock()
hook_feeds_after_import($this)
#+END_EXAMPLE

Import drush command runtime can be long. Output something every 5 minutes to prevent drush command timeout
Do this in one of the hooks: 
- hook_feeds_before_update
- hook_feeds_presave 
- hook_feeds_after_save

#+BEGIN_EXAMPLE
function lili_feeds_presave(FeedsSource $source, $entity, $item) {

 $request_time = lili_custom_cache('timecounter');
 $interval = 60 * 5;
 if (!is_null($request_time)) {
  $row_counter = lili_custom_cache('rowcounter');
  lili_custom_cache('rowcounter',++$row_counter);
  $current_time = time();
  $seconds = $current_time - $request_time;
  if (floor($seconds/$interval) > 0) {
   lili_custom_cache('timecounter', $current_time);
   print "Presave row #$row_counter. $seconds seconds have passed.\n";
  } 
 }
 else {
  lili_custom_cache('timecounter', REQUEST_TIME);
  lili_custom_cache('rowcounter', 1);
 }

}
#+END_EXAMPLE

**** New Feed Tamper Plugin
The plugin does this: Drupal download file with real file extension

#+BEGIN_EXAMPLE
// Implements hook_ctools_plugin_directory()
function lili_ctools_plugin_directory($module, $plugin) {
 if ($module == 'feeds_tamper') {
  return 'plugins'; // path_to_lili_module/plugins/lili_*.inc
 }
}

// lili_change_image_extension.inc
// You can refer to path_to_feeds_tamper_module/plugins/explode.inc
$plugin = array(
  'form' => 'lili_image_extension_form',
  'callback' => 'lili_image_extension_callback',
  'validate' => 'lili_image_extension_validate', // optional
  'name' => 'Convert Image URL Extension',
  'category' => 'T and T', // group name
  'multi' => 'direct',
  // If multiple values are injected to the plugin,
  // 'direct' will pass the whole array as $field to callback
  // while 'loop' will loop over and pass each value to callback
);

function lili_image_extension_form($importer, $element_key, $settings) {
  $form = array();
  $form['info'] = array(
    '#markup' => t('Converts source image URLs that don\'t have regular image extension: jpg, png, etc.'),
  );

  // Extra variables to pass to $settings in callback
  $form['importer_name'] = array(
      '#type' => 'hidden',
      '#title' => t('Importer machine name'),
      '#default_value' => isset($settings['importer_name']) ? $settings['importer_name'] : $importer->id,
  );

  return $form;
}

function lili_image_extension_validate(&$settings) {
  // Validate $settings.
}

function lili_image_extension_callback($result, $item_key, $element_key, &$field, $settings, $source) {
  //settings has the importer name
  //$settings['importer_name']
  //$field has the importing field text value
  if (!is_array($field)) {
    $field = array($field);
  }

  $val = array();

  foreach ($field as $f) {
    $val[] = _lili_save_file_with_extension($f);
  }
  $field = $val;
}
#+END_EXAMPLE

**** XPath
Children nodes Photo under Images node.
Simply Images/Photo, the result is already array
Concate multiple nodes
=concat(photo1,';',photo2)= then explode

*** XML Sitemap
/admin/config/search/xmlsitemap/settings
Uncheck /Prefetch URL aliases during sitemap generation/

** Debug
=watchdog('LOG_TYPE','message');=

If error or warning messages are printed using drupal_set_message, 
modify the `drupal_set_message` function so that it prints debug_backtrace
#+BEGIN_EXAMPLE
if ($type == 'error') {
  $message .= ' '. print_r(debug_backtrace(DEBUG_BACKTRACE_PROVIDE_OBJECT,3),1);
}
#+END_EXAMPLE

You can throw an Exception
#+BEGIN_EXAMPLE
throw new Exception(print_r($val));
#+END_EXAMPLE

** URL Alias
Setup pattern for each node type
Configuration > Search and metadata > URL Aliases > Patterns
** Link
Empty link
=l('Link Text', '', array('fragment'=>' ', 'html'=>TRUE, 'external'=>TRUE))=
Function l add class="active" when the path is current_path(). Use url() instead.

=url($path = NULL, $options = array())=
Get URL alias
url() just returns a url. $options are the same as l().
url('taxonomy/term/1');

** Theme
*** System Theme
Default theme file is located at 
=sites/all/modules/mod_path/modname/templates/theme-name.tpl.php=

- template.php
- html.tpl.php
- page.tpl.php
- region.tpl.php
- block.tpl.php
- node.tpl.php
- comment-wrapper.tpl.php
- comment.tpl.php

d7:View_Theming

*** Form Theme
$form['#theme'][] = 'lili_form';
If no custom theme function, d7:hook_theme d7:theme_*, is defined, then the default template file is
/sites/all/themes/your_theme/templates/form/lili_form.tpl.php

*** Custom Theme Function
Module theme: =theme('modname_theme-name',$data)=
<<<d7:hook_theme>>> <<<d7:theme_*>>>
#+BEGIN_EXAMPLE
function lili_theme( $existing, $type, $theme, $path ) {
  return array(
    'lili_flair' => array(
      'variables' => array(
        'text' => NULL,
      ),
    ),
  );
}

function theme_lili_flair( $variables ) {
  if ( ! empty( $variables['text'] ) ) {
    return '<span class="li-tag li-tag-pill li-tag-color">' . $variables['text'] . '</span>';
  } else {
    return '';
  }
}

echo theme('lili_flair',array('text'=>'hi'));
#+END_EXAMPLE

** Drush
*** Debug =-vd=
*** Alias
=drush sa= list all aliases

*** User
drush user-login yourusername

*** Module
=drush dl devel= Download a module
=drush en devel= Enable a module
=drush dis devel= Disable a module
=drush pmu devel= Uninstall a module
=drush up <modulename> -y= Update a module. Don't need to visit update.php

#+BEGIN_EXAMPLE
drush up <modulename> = drush upc <modulename> + drush updb
#+END_EXAMPLE

*** Custom Drush
drupal_set_message()
- stdout. No logging. Can be used multiple times in a drush command. 
- =[status]= at the end of each line
- not print out immediately

Use the following every 3 minutes to prevent drush command timeout
#+BEGIN_EXAMPLE
print "hello\n"; // print out immediately
drush_print(); // drush_print uses print
drush_print_r($array);
#+END_EXAMPLE

*** Pantheon Drush

** Database
*** Close Comment for Existing Nodes
0 = No, 1 = Closed (read only), 2 = Open (Read/Write)
#+BEGIN_EXAMPLE
UPDATE node, node_revision
SET node.comment = 1, node_revision.comment = 1
WHERE node_revision.nid = node AND node.type = 'article'
#+END_EXAMPLE

** Views
*** UI 
**** Contextual filter with term name not term id
Choose =Content: Has taxonomy term ID=
Check =Specify validation criteria=
Validator =Taxonomy Term=, Filter value type =Term name converted to Term ID=
Check =Transform dashes in URL to spaces in term name filter values=
**** Path vs Link
Content: Path with Rewrite Result option "Use absolute link" is the raw path.
**** Field value is taxonomy ID not taxonomy name
Use Rewrite Result "[field_name-tid]" 
*** View Object
Hooks use $view object.
**** Properties
args :: array(
 0 => '37',
)
name :: 'tt_taxonomy'
current_display :: 'page'
**** Methods
$v->get_items_per_page(); // Return nothong in hook_views_pre_build
$v->set_items_per_page(10); // hook_views_pre_build

*** hook_views_pre_build
*** hook_views_pre_render
**** Change Global Custom Text
Change the field value with tokens in Views UI
#+BEGIN_EXAMPLE
function lili_views_pre_render(&$view) {
	if ($view->name == 'lili_view' && $view->current_display == 'page') {

		// Change value for specific rows
		foreach ($view->result as $k => $r) {
			if ($f = &$r->field_field_flag) {
				$o = $f[0]['rendered']['#markup'];
				$o = theme('lili_theme_flair', array('text'=>$o));
				$f[0]['rendered']['#markup'] = $o;
			}

			// Taxonomy field
			if ($f = &$r->field_field_category) {
				$exclude_tids = array(1,2,3);
				foreach ($f as $k => $v) {
					if (!in_array($v['raw']['tid'], $exclude_tids)) {
						// Remove from display
						unset($f[$k]);
					}
				}
			}
			
		}

		// Only change global custom text for a subset of contextual filter value
		// The first context filter value
		if ($view->args[0] == 'filter_value') {
			// Check View UI Theme Information to get the Global Custom Text field ID
			if (isset($view->field['field_thumbnail']->options['exclude'])) {
				// Exclude display
				$view->field['field_thumbnail']->options['exclude'] = 1;
			}
			if (isset($view->field['nothing']->options['alter']['text'])) {
				// Change a field's CSS Class setting for all records
				$view->field['nothing']->options['element_class'] = '';
				$o = $view->field['nothing']->options['alter']['text'];
				$view->field['nothing']->options['alter']['text'] = 'hello'.$o;
			}
		}
	}
}
#+END_EXAMPLE

*** Better Exposed Filters
better_exposed_filters. Require views and ctools
If you want checkboxes or radio buttons instead of the Views Basic Exposed Form which is dropdown select.

Change BEF form hook_form_views_exposed_form_alter
#+BEGIN_EXAMPLE
function lili_form_views_exposed_form_alter(&$form, &$form_state) {
}
#+END_EXAMPLE

*** Embed View
views_embed_view('view_name','display_id');
$arg1 = $arg2 = '123';
views_embed_view('view_name','display_id',$arg1,$arg2);

*** View Theming
<<<d7:View_Theming>>>

View, named foobar. Style: unformatted. Row styel: Fields. Display: Page.

- views-view-foobar--page.tpl.php
- views-view-page.tpl.php
- views-view--foobar.tpl.php
- views-view.tpl.php

- views-view-unformatted--foobar--page.tpl.php
- views-view-unformatted--page.tpl.php
- views-view-unformatted--foobar.tpl.php
- views-view-unformatted.tpl.php

- views-view-fields--foobar--page.tpl.php
- views-view-fields--page.tpl.php
- views-view-fields--foorbar.tpl.php
- views-view-fields.tpl.php

** Form
*** Form alter hooks
=hook_form_alter= 
=hook_form_BASE_FORM_ID_alter=, Refer BASE_FORM_ID to =$form_state['build_info']['base_form_id']=
=hook_form_FORM_ID_alter=. Refer FORM_ID to =$form['#id']=

Set default value and hide a form from display or filling
#+BEGIN_EXAMPLE
// Entity reference form field
$form['field_dealer'][LANGUAGE_NONE][0]['target_id']['#default_value'] = 123;
$form['field_dealer'][LANGUAGE_NONE][0]['#printed'] = TRUE;
#+END_EXAMPLE

*** Form IDs of system forms
=node= :: node new/edit
=user_profile= :: page/user/<uid>

lili_node_form_alter

#+BEGIN_EXAMPLE

#+END_EXAMPLE

*** Confirm Form
e.g. Confirm before delete
#+BEGIN_EXAMPLE
// Menu
$items['dealer_user/%/delete'] = array(
	'title' => 'Delete a user',
	'page callback' => 'drupal_get_form',
	'page arguments' => array('lili_delete_dealer_user_confirm',1),
	'access callback' => 'lili_user_has_delete_right',
	'access arguments' => array(1, array('Dealer Admin')),
	'type' => MENU_LOCAL_TASK,
);

function lili_delete_dealer_user_confirm($form, &$form_state, $id) {
	$form['delete'] = array(
		'#type' => 'value',
		'#value' => $id,
	);
	return confirm_form($form,
		t('Are you sure you want to delete this user?'), // Question
		'dealer_manage_users',  // Path to go to if No
		t('This action cannot be undone.'), // Description
		t('Delete Button'), // Yes: text
		t('Cancel Button') // No: text
		//, $name default 'confirm': internal name used to refer to the confirmation item.
	);
}

function lili_delete_dealer_user_confirm_submit($form, &$form_state) {
	if ($uid = $form_state['values']['delete']) {
		$u = user_load($uid);
		user_cancel();
		drupal_set_message(t('The user account has been deleted!'));
	}
	$form_state['redirect'] = 'dealer_manager_users';
}

function lili_user_has_delete_right($uid = 0, array $roles) {
	global $user;
	// If user is anonymous
	if (user_is_anonymous()) {
		return FALSE;
	}
	if (in_array('administrator', $user->roles)) {
		return TRUE;
	}
	if (array_intersect($roles, $user->roles)) {
		return TRUE;
	}
}
#+END_EXAMPLE

** Entity
Node, user, taxonomy are all entities.

*** EntityFieldQuery
Use this to get entities of one type that have certain:
- entity properties (propertyCondition: status, changed, etc)
- field values (fieldCondition)
- entity meta data (entityCondition: bundle, entity_type, entity_id and revision_id)

#+BEGIN_EXAMPLE
$_q = new EntityFieldQuery();
$_r = $_q
->entityCondition('entity_type', 'node') // taxonomy_term, user
->entityCondition('bundle', 'newsletter') // node type or content type
->fieldCondition('field_active','value',1,'=') // boolean field
->fieldConditin('field_dealer', 'target_id', 12345, '=') // field Entity Reference, single value
->fieldConditin('field_contacts', 'target_id', 12345) // field Entity Reference, multiple values have one 12345
// 12345 not in mutlipel target_id: you have to do one query to show all and do one with 'IN' and 
// Get the difference
$_r_all = (!empty($_r_all['node'])) ? $_r_all['node'] : array();
$_r_in_12345 = (!empty($_r_in_12345['node'])) ? $_r_in12345['node'] : array();
$_r = array_diff_key($_r_all, $_r_in_12345);

->propertyCondition('status',1) 
// status, type, nid, uid, rui, type, created
// search for "Implements hook_entity_info()" will show all entity properties

// Operators
// Default '='
// <>, >, >=, <, <=
// STARTS_WITH, CONTAINS
// IN, NOT IN (does not work)
// BETWEEN :: propertyCondtion('created', array($start, $end), 'BETWEEN')

->execute();

/* array(
 'node' => // follow the entity_type: e.g. node, taxonomy_term, user 
 array(
  28912 => obj(nid => 28912) // could be uid, nid, tid
  ...
 )
)
*/

if (!empty($_r['node'])) {
  $nodes = node_load_multiple(array_keys($_r['node']));
}
#+END_EXAMPLE

** Entityform
D7 uses entityform module. D8 is called EForm.
Load an entityform
#+BEGIN_EXAMPLE
// Load the module file. Optional
// module_load_include('inc', 'entityform', 'entityform-admin');
$_contact_form = entityform_empty_load('entityform_id');
$mode = 'submit'; 
// Default. Other: 'edit'
$form_context = 'page'; 
// Default. Ohter: 'embedded'
$_renderable_form = entityform_form_wrapper($_contact_form, $mode, $form_context );
#+END_EXAMPLE

Try to prefill entityform in hook_form_FORM_ID_alter(). Say the entityform is named dealer_contact
The hook is lili_form_dealer_contact_entityform_edit_form_alter

** Menu
*** Embed a View Page
#+BEGIN_EXAMPLE
function lili_menu() {
  $items['path-different-from-view/%'] = array(
    'title' => t('page title');
    'page callback' => 'views_embed_view',
    'page arguments' => array('view_id', 'dispaly_id', 1),
    'type' => MENU_CALLBACK,
    'access callback' => TRUE,
  );
  return $items;
}
#+END_EXAMPLE
 
** Taxonomy
#+BEGIN_EXAMPLE
// Get taxonomy terms of a node, ready for display with language
$categories = field_get_items('node', $node, 'field_category');
/* array(
0 => array(
  'tid' => 17,
  'taxonomy_term' => obj
),
...
)
*/


// Get multiple terms
$tids = array(1,2,3); // Default:array()
$conditions = array(); // Default
taxonomy_term_load_multiple($tids, $conditions);
/* array(
17 => obj(
  tid => '17',
  ...
)
...
)
*/

// Get term by name
$_limit_to_vocab = 'vocab_name'; // Default NULL.
$term_is_parent = taxonomy_get_term_by_name('video', $_limit_to_vocab);

// Get the first item in array
$term_is_parent = reset($term_is_parent);
echo $term_is_parent->tid; // Term id
// Get all children of a term
$children = taxonomy_get_children($term-tid);
$children_tids = array_keys($children);

// Get a vocabulary by name
$_vocab = taxonomy_vocabulary_machine_name_load('vocab_name');

// Get all terms of a vocabulary without extra fields
$_terms = taxonomy_get_tree($_vocab->vid);

// Get term ids only of all terms under a vocabulary
$_q = new EntityFieldQuery();
$_term_ids = $_q 
->entityCondition('entity_type', 'taxonomy_term')
->propertyCondition('vid', $_vocab->vid)
->execute();
foreach ($_term_ids['taxonomy_term'] as $term) {
  $term->id;
}

// Get all fields of all terms under a vocabulary
$_terms_with_all_fields = entity_load('taxonomy_term', FALSE, array('vid' => $_vocab->vid));
/* array(
17 => obj(
 tid => '17',
 ...
),
...
)
*/

// Or
$parent = 0; // Default
$max_depth = NULL; // Default
$load_entities = TRUE; // Default:False
$_terms_with_all_fields = taxonomy_get_tree($_vocab->vid, $parent, $max_depth= NULL, $load_entities);
/* array(
0 => obj(
  tid => '17',
  ...
)
...
)
*/

#+END_EXAMPLE

** Cache
Same page request
#+BEGIN_EXAMPLE
function lili_cache($field, $set = NULL) {
  $custom_cache = &drupal_static(__FUNCTION__);
  if (!isset($custom_cache)) {
    $custom_cache = array();
  }
  if ($set !== NULL && $field !== NULL ) {
    // $set_field_value = lili_cache('field_name', 123);
    $custom_cache[$field] = $set;
  } 
  elseif ($field !==  NULL && $set == NULL &&
      ( !isset($custom_cache[$field]) || $custom_cache[$field] == NULL ) 
     ) {
    // Set default
    // $set_field_value = lili_cache('field_name');
    switch ($field) {
      case "field_name":
        // complicated
        $custom_cache[$field] = '';
        break;
    } 
  }
 
  if (!isset($custom_cache[$field])) {
    $custom_cache[$field] = NULL;
  }

  return $custom_cache[$field];
}

// Set
lili_cache('current_node',$node);
// Get lili_cache('current_node');
#+END_EXAMPLE

** File
Read local or remote file to an object of strings
#+BEGIN_EXAMPLE
$result = drupal_http_request($url);
/*
obj(
 code // int 200
 headers
)
*/

$path = 'public://afolder/';
$replace = FILE_EXISTS_RENAME; // Default
// FILE_EXISTS_REPLACE, FILE_EXISTS_ERROR
file_unmanaged_save_data($result->data, $path, $replace);
#+END_EXAMPLE

<<<file_unmanaged_save_data>>>($data, $destination, $replace)
#+BEGIN_EXAMPLE
// $destination is folder path not folder path + filename
$temp_name = 'temporary://auniquefilename'
file_put_contents($temp_name,$data); // return number of bytes or false
file_unmanaged_move($temp_name,$destination, $replace); // rename
#+END_EXAMPLE

<<<Drupal download file with real file extension>>>
#+BEGIN_EXAMPLE
/**
 * Download external file to temporary filesystem
 * with correct file extension based on content-type in http response header
 *
 * @param $url string Full external URL of a file
 *
 * @return string Local file path with correct file extension
 */
function _lili_save_file_with_extension( $url ) {
  $filename  = $url;
  $extension = '';
  $result    = drupal_http_request( $url );

  if ( $result->code == 200 && isset( $result->headers['content-type'] ) ) {
    $mime_type_extension = array(
      'image/jpeg'  => 'jpg',
      'image/jpg'   => 'jpg',
      'image/png'   => 'png',
      'image/x-png' => 'png',
      'image/gif'   => 'gif'
    );

    foreach ( $mime_type_extension as $k => $v ) {
      if ( strcasecmp( $k, $result->headers['content-type'] ) == 0 ) {
        $extension = $v;
        break;
      }
    }

    if ( $extension !== '' ) {
      // Save file with correct file extension
      $filename = 'temporary://import_' . str_replace( ".", "_", microtime( TRUE ) ) . "." . $extension;
      file_put_contents( $filename, $result->data );
    }
  }

  return $filename;
}
#+END_EXAMPLE

** Basic Ajax
#+BEGIN_EXAMPLE
// Create a menu to receive ajax
$items['newsletter/builder_entry/%'] = array(
    'title' => "",
    'page callback' => '_lili_add_session_handler',
    'page arguments' => array(2),
    'access callback' => 'user_access',
    'access arguments' => array('newsletter builder access'),
    'type' => MENU_CALLBACK,
);

function _lili_add_session_handler($command) {
if (!isset($_POST['ids'])) {
    return drupal_not_found();
  }

  if ($command === "manage") {
    // Add to the session variable detailing what items are added
    $_SESSION['session_name'] = array();

    $ids = json_decode($_POST['ids']);
    foreach ($ids as $id) {
      $id = trim($id);
      $_SESSION['session_name']["item_" . $id] = $id;
    }
  }
  else {
    return drupal_not_found();
  }
}

// Javascript
$.ajax({
 type: "POST",
 url: '?q=newsletter/builder_entry/manage',
 data: "ids=" + 'some string',
 success: function(e) {
   // do something
 },
 dataType: "json"
});
#+END_EXAMPLE

** Email
Define an email template using hook_mail()
#+BEGIN_EXAMPLE
function lili_mail($key, &$message, $params) {
 $message['headers']['Content-Type'] = 'text/html; charset=UTF-8; format=flowed';
 // $message['from'] is initially set by $from from drupal_mail(). 
 // If not provided, will use sidewide setting
 // $param['keys'] prefill $message['keys']

 switch ($key) {
  case 'template_1':
    // Don't need to do this: $message['subject'] = $params['subject'];
    $message['body'][] = 'Extra';
    $message['headers']['Bcc'] = 'bcc@abc.com';
    break;
 } 
}

// Send email
$module = 'lili'; // module name that the template is defined hook_mail
$to = 'to@abc.com';
$from = 'from@abc.com'; // Default Null
$language = language_default();
$send = TRUE; // Default TRUE 
// hook_mail_alter can change to false so that it doesn't get sent out
drupal_mail($module, 'template_1', $to, $language, $params, $from, $send);
#+END_EXAMPLE

* Wordpress
** CLI
[[https://wp-cli.org/commands][Wordpress CLI Commands]]
WP CLI Pantheon

*** Global Parameters
- --debug
- --quiet
- --user=<id|login|email>
- --require=<path> :: Load PHP file, can be used multiple times

*** User
#+BEGIN_EXAMPLE
List users
terminus wp 'user list' --site=<site> --env=<env>=

Add a user
wp user create lili li@newcom.ca --user_pass=letterandnumbers --role=administrator

Update password
wp user update lili --user_pass=lettersandnumbers

Give role
wp user add-role lili administrator
#+END_EXAMPLE

*** Plugin
[[https://wordpress.org/plugins][Wordpress Official Plugin Directory]]

wp plugin install fly-dynamic-image-resizer

Options
- --activate :: activate after installation
** Template Tags
wp-includes/xxx-template.php
*** post-thumbnail <<<wp:t:thumbnail>>>
get_post_thumbnail_id($post = null);

get_the_post_thumbnail_* :: can specify which post
the_post_thumbnail_* :: has to be current post

You can wp:f:add_image_size
Image size :: $size
NOTICE: If the thumbnail has no physical file that has corresponding size, the_post_thumbnail_url will 
get the original image file, the_post_thumbnail will use the original file with in src and apply width/height attributes
in HTML to achieve the purpose.
- 'post-thumbnail' :: default
- array(100, 100) :: Grab the biggest size in width and height image file possible.
- array(100, 9999) :: Grab the biggest size in width and height image file possible.

You can resize an image file on the fly using fly-dynamic-image-resizer

the_post_thumbnail($size, $attr='') :: echo
the_post_thumbnail_url($size) :: echo

*** post <<<wp:t:post>>>
*** category <<<wp:t:category>>>
*** general <<<wp:t:general>>>
** Functions
*** get_the_ID() - ID of current item or false
*** wp_get_post_terms($post_id, $tax, $args)
Get the slugs of the terms under taxonomy publication
=wp_get_post_terms($post_id, 'publication', ['field' => 'slugs'])=
*** Translate
echo __($text, 'textdomain'); // return
'textdomain' is optional but it has to be a string not a variable! Default it's 'default'

_e() is the same as __() but it echoes

*** add_image_size
<<<wp:f:add_image_size>>>
Use wp:action:after_setup_theme
Every newly uploaded image will have image files with all defined image sizes.

#+BEGIN_EXAMPLE
function lili_theme_setup() {
 add_image_size('lili-w700', 700, 9999); // fixed width, unlimited height
 add_image_size('lili-w700h600', 700, 600, true); // crop in exact dimension 
}
#+END_EXAMPLE

*** add_management_page
wp:action:admin_menu
Add sub menu to Tools admin menu

add_management_page(
 'Page title', // string
 'Menu title', // string
 'manage_options', // string. Capability that is required.
 'menu_slug', // string
 'callbackFunct', // string or array($this, 'options_page')
);

*** register_post_type
wp:action:init
wp:action:pre_get_posts
wp:plugin:acf

register_post_type( $post_type, $args );
https://codex.wordpress.org/Function_Reference/register_post_type

- $post_type :: string. < 20 characters. All lowercase and no space
- $args :: array of arguments

#+BEGIN_EXAMPLE
add_action('init', 'lili_custom_post_type');
function lili_custom_post_type() {
  $labels = [
    // array, wp:register_post_type:labels
  ];

  $args = [
    'label' => 'Plural Name', // string
    'labels' => $labels,
    'description' => '', // string, optional
    'public' => false,
    /* Default. bool.
     *       exclude_from_search, publicly_queryable, show_in_nav_menus, show_ui
     * true:               false,               true,              true, true
     * false:               true,              false,             false, false
     */
    'exclude_from_search' => false, // default. optional. 'site/?s=search-term'
    'publicly_queryable' => true, // optional. take 'public' value.
    /* ?post_type={post_type_key},
     * ?{post_type_key}={single_post_slug},
     * ?{post_type_query_var}={single_post_slug}
     */
    'show_ui' => true, // optional. bool. default take 'public' value.
    'show_in_nav_menus' => true, // optional. bool. inherits 'public' value.
    'show_in_menu' => true, // optional, bool or string. default inherits show_ui
    // false :: do not display in admin menu
    // true :: display as a top level menu
    // 'some string' :: display as a submenu of a menu 'some string'
    'show_in_admin_bar' => true, // optional, bool, default inherits show_in_menu
    'supports' => ['title', 'editor'], // optional. array/bool. wp:f:add_post_type_support
	  //  Don't have to add 'custom-fields' in order to use wp:plugin:acf

  ];

  register_post_type('movies', $args);

}

add_action( 'pre_get_posts', 'lili_pre_get_posts' );
// Should not call this in template because in template the $query is already run
function lili_pre_get_posts( $query ) {
  if ( ! is_page() && ! is_home() && $query->is_main_query() ) {
    $query->set( 'post_type', array( 'post', 'movies' ) );
  }
  // this function should return nothing.
}
#+END_EXAMPLE

**** labels
<<<wp:register_post_type:labels>>>

*** add_post_type_support
<<<wp:f:add_post_type_support>>>

add_post_type_support($post_type, $supports);

- $post_type :: string
- $supports :: string/array
  - title
  - editor :: content
  - author
  - thumbnail :: current theme must support Post Thumbnails
  - excerpt
  - trackbacks
  - custom-fields :: wp:Custom_Fields. Don't have to add 'custom-fields' in order to use wp:plugin:acf
  - comments
  - revisions
  - page-attributes :: menu order, hierarchical must be true
  - post-formats :: add post formats

add_action('init', 'lili_custom_post_type');
function lili_custom_post_type() {
  $labels = [
    // array, wp:register_post_type:labels
  ];

  $args = [
    'label' => 'Plural Name', // string
    'labels' => $labels,
    'description' => '', // string, optional
    'public' => false,
    /* Default. bool.
     *       exclude_from_search, publicly_queryable, show_in_nav_menus, show_ui
     * true:               false,               true,              true, true
     * false:               true,              false,             false, false
     */
    'exclude_from_search' => false, // default. optional. 'site/?s=search-term'
    'publicly_queryable' => true, // optional. take 'public' value.
    /* ?post_type={post_type_key},
     * ?{post_type_key}={single_post_slug},
     * ?{post_type_query_var}={single_post_slug}
     */
    'show_ui' => true, // optional. bool. default take 'public' value.
    'show_in_nav_menus' => true, // optional. bool. inherits 'public' value.
    'show_in_menu' => true, // optional, bool or string. default inherits show_ui
    // false :: do not display in admin menu
    // true :: display as a top level menu
    // 'some string' :: display as a submenu of a menu 'some string'
    'show_in_admin_bar' => true, // optional, bool, default inherits show_in_menu
    'supports' => ['title', 'editor'], // optional. array/bool. wp:f:add_post_type_support

  ];

  register_post_type('movies', $args);

}

Use wp:action:pre_get_posts to enable query for this new post type

*** remove_meta_box
<<<wp:f:remove_meta_box>>>

remove_meta_box( $id, $page, $context);
- Return 
- $id :: string
  - authordiv
  - categorydiv
  - comemntstatusdiv
  - commentsdiv
  - formatdiv
  - pageparentdiv
  - postcustom
  - postexcerpt
  - postimagediv
  - revisionsdiv
  - slugdiv
  - submitdiv
  - tagsdiv-post_tag
  - tagsdiv-{$tax-name}
  - {$tax-name}div
  - trackbacksdiv
  - ...
- $page :: string. Type of screen
  - post
  - page
  - attachment
  - link
  - dashboard
  - any custom post type e.g. 'my-product'
- $context :: string. 'normal', 'advanced', or 'side'
  - Post edit screen :: normal, side and advanced
  - Comments screen :: normal and side
  - Menu meta boxes :: side
- Return nothing

** WP Custom Fields
<<<wp:Custom_Fields>>>
*** Get Custom Fields
Normal
#+BEGIN_EXAMPLE
<?php 
print_r(get_post_custom_keys()); // Get all keys as an array
print_r(get_post_custom()); // Get keys and values as an array
print_r(get_post_custom_values('fieldkey')); // Get values as an array
?>
#+END_EXAMPLE

Plugin is different :: wp:plugin:types

*** Custom Fields in WP_Meta_Query
Custom fields created by wp:plugin:acf can use WP_Meta_Query as normal.

Custome fields creasted by wp:plugin:types, like a set of checkboxes, in WP_Query, you should use the LIKE operator. 
Refer to WP Types Custom Field Checkbox and WP Meta Query

*** Create Custom Fields for Custom Post Type
Use wp:plugin:acf

** Wordpress The Loop
<<<wp:The_Loop>>>
*** Syntax

#+BEGIN_EXAMPLE
<?php 
 $query = new WP_Query('cat=-3,-8'); 
 // Use query_posts($query_array | $string) instead of creating a new WP_Query then you don't have to prefix $query for methods
 // But query_posts change the global $wp_query 
?>

<?php if ( $query->have_posts() ) : while ( $query->have_posts() ) : $query->the_post(); ?>
 <?php //  set the global $post to individual one in $query ?>
 <div><?php the_content(); ?></div>

 <?php if ( has_post_thumbnail() ): ?>
  <img src="<?php the_post_thumbnail_url('large'); ?>">
  <?php the_post_thumbnail(); ?>
 <?php endif; ?>

<?php endwhile; ?>
<?php wp_reset_postdata(); // set back global $post to original ?>
<?php endif; ?>

<?php $query->rewind_posts(); // in order to loop $query again ?>

#+END_EXAMPLE

*** <<<WP_Query>>>
Generator: https://generatewp.com/wp_query/

Used: WP_Meta_Query, WP Tax Query, WP Order and Orderby
Used filters: wp:filter:post_limits or pre_option_posts_per_rss wp:filter:pre_option
Used actions: wp:action:pre_get_posts

#+BEGIN_EXAMPLE
$args = array(
 'post_type' => array('editorial', 'blog'), // blog or editorial
 'post_status' => array('publish'),
 'posts_per_page' => -1, // int. -1 shows all posts. Doesn't work in feed (Default 10). Use wp:filter:post_limits
 'meta_query' => $meta_query, // $meta_query is a nested array parsed by WP_Meta_Query
 'tax_query' => $tax_query,
 'order' => 'DESC', // default, 'ASC'
 'orderby' => 'date', // default, which is post_date
);

$query = new WP_Query($args);
#+END_EXAMPLE

*** <<<WP_Meta_Query>>>
**** Nesting
Nested: key1=value1 OR (key2=value2 AND key3=value3)

#+BEGIN_EXAMPLE
$meta_args = array(
 'relation' => 'OR', // Optional.
 array(
   'key' => 'key1',
   'value' => 'value1',
   'compare' => '=', //default
 ),

 array(
   'relation' => 'AND',
   array(
     'key' => 'key2',
     'value' => 'value2',
     'compare' => '=',
   ),
   array(
     'key' => 'key3',
     'value' => 'value3',
     'compare' => '=',
   ),
 ),
  
);

$meta_query = new WP_Meta_Query($meta_args); // parse args array

#+END_EXAMPLE

**** Operators
compare
- =, !=
- >, >=, <, <=
- LIKE, NOT LIKE
- IN, NOT IN
- BETWEEN, NOT BETWEEN
- EXISTS, NOT EXISTS
- REGEXP, NOT REGEXP :: MySQL REGEX
- RLIKE (synonym of REGEXP) 

type 
In MySQL, it means CAST(the field, to a type)
- NUMERIC
- BINARY
- CHAR
- DATE :: works with 'compare' value BETWEEN only if the date is stored as YYYY-MM-DD
- DATETIME
- DECIMAL
- SIGNED, UNSIGNED :: MySQL Integer
- TIME :: MySQL Date and Time

<<<WP Types Custom Field Checkbox and WP Meta Query>>>
Say the wpcf-newsletters custom field created by WP Types has 2 checkboxes are selected: enligne and pw.
The following 2 strings will appear in the serialized json string as value in WP_Meta_Query
#+BEGIN_EXAMPLE
a:1:{i:0;s:7:"enligne";}
a:1:{i:0;s:2:"pw";}
#+END_EXAMPLE 

Select the posts that have checkbox enligne checked.
#+BEGIN_EXAMPLE
$meta_query = array(
 array(
  'key' => 'wpcf-newsletters',
  'value' => 'a:1:{i:0;s:7:"enligne";}',
  'compare' => 'LIKE',
 ),
);
#+END_EXAMPLE

*** <<<WP Tax Query>>>
#+BEGIN_EXAMPLE
$tax_query = array(
 'relation' => 'AND', // Optional 
 array(),
 array(
   'taxonomy' => '',
   'field' => 'term_id', // string :: term_id (default), name, slug or term_taxonomy_id
   'terms' => 'bob', // int/string/array :: multiple terms
   'operator' => 'IN', // string :: IN (default), NOT IN, AND, EXISTS, NOT EXISTS
 ),
);
#+END_EXAMPLE

*** <<<WP Order and Orderby>>>
2 parameters: order and orderby. They are strings not arrays.

**** orde
- DESC :: default
- ASC

**** orderby
- date :: default, which is post_date
- modified :: modified date
- ID :: post id
- parent :: parent id
- rand :: random order
- comment_count
- author
- title
- name :: post name post slug
- type :: post type
List goes on...

** RSS

<<<get_template_part>>> calls a template in child theme

#+BEGIN_EXAMPLE
function lili_RSS() {
 add_feed('lili-editorial', 'lili_editorial_RSS');
}
add_action('init', 'lili_editorial_RSS');
function lili_editorial_RSS() {
 get_template_part('rss','feedname');
 // rss is slug and feedname is an extra name
 // Search in order
 // /themes/child/rss-feedname.php
 // /themes/parent/rss-feedname.php
 // /themes/child/rss.php
 // /themes/parent/rss.php

 // the feed url is http://you.com/feed/lili-editorial which is the feed name defined in add_feed
}
#+END_EXAMPLE

Default template /wp-includes/feed-rss2.php
Functions to use in The Loop: /wp-includes/feed.php

#+BEGIN_EXAMPLE
<?php
$args = array(
	'post_type' => array('blog'), // e.g. any
	'tag' => 'editors-choice',
	'orderby' => 'date', // Default. e.g. title
	'order' => 'DESC', // Default. e.g. ASC
);
?>
query_posts($args);
<?php while (have_posts()) : the_post(); ?>
<item>
  <title><?php the_title_rss(); ?></title>
  <?php if (has_post_thumbnail($post->ID)) : ?>
  <?php
    $image = wp_get_attachment_image_src(
    get_post_thumbnail_id( $post->ID ),
    'thumbnail'
    );
  ?>
  <feature_image><?php echo $image[0]; ?></feature_image>
  <?php endif; ?>
  <pubDate><?php echo mysql2date('D, d M Y H:i:s +0000',
				get_post_time('Y-m-d H:i:s', true),
				false); ?></pubDate>
  <?php // Text Version ?>
  <excerpt><![CDATA[<<?php echo get_the_exerpt(); ?>]]></excerpt>
  <excerpt_html><![CDATA[<<?php echo the_exerpt_rss(); ?>]]></excerpt_html>
  <?php echo the_category_rss('rss2'); // categories and tags ?>
</item>  
<?php endwhile; ?>
#+END_EXAMPLE

** add_filter
*** Syntax, remove_filter
Modify internal data / function returned

For example, WP_Query gets internal settings for building a query.
You can temporary add_filter to change the internal settings, then build a WP_Query, later remove_filter 
so that you only change the internal setting for that query building without affecting other usage.  

add_filter( 
 'tagname', 
 'lili_funct',
  10, // int. Priority, lower number sooner
  1, // int. Accepted args, default is 1! Be careful
)

apply_filters('tagname', $result, $var1);

// callback should take 2 variables
function lili_funct($result, $var1) {
 return $result;
}
*** post_limits
<<<wp:filter:post_limits>>>
For feed, use pre_option_posts_per_rss wp:filter:pre_option

function lili_f_post_limits($limit, $query) {
 return 'LIMIT 0, 25';
 return $limit;
}

*** pre_option_(option_name)
<<<wp:filter:pre_option>>>
Temporarily alter an option without changing in database.

** add_action, do_action, do_action_ref_array
*** Basic
Event based
add_action( string $tag,
string $function_name,
int $priority = 10,
int $accepted_args = 1 // number of args the function accepts
)

add_action( 'atag' is called by do_action( 'atag' or do_action_ref_array( 'atag'

*** wp_head, wp_footer
Refer to Wordpress Theme > Functions used in template

*** wp_enqueue_scripts
Can use wp_enqueue_style and wp_enqueue_script. Priority might be needed to change to greater 10
to load after default theme/style.css
#+BEGIN_EXAMPLE
function lili_scripts() {
 wp_enqueue_style('lili-custom-styles', get_stylesheet_directory_uri().'/css/style.css');
}
add_action( 'wp_enqueue_scripts', 'lili_scripts', 20);
#+END_EXAMPLE

*** init
<<<wp:action:init>>>
Fires after Wordpress has finished loading but before any headers are sent.
User is already authenticated.
Useful for intercepting $_GET or $_POST

*** after_setup_theme
<<<wp:action:after_setup_theme>>>
Called each page load after the theme is initialized. 
Do basic setup, registration and init actions for a theme

*** pre_get_posts
<<<wp:action:pre_get_posts>>>
Provide a chance to modify $query object (or do something else) before it's run.
Do not use this to alter query for single Page requests.

add_action( 'pre_get_posts', 'lili_pre_get_posts' );
// Should not call this in template because in template the $query is already run
function lili_pre_get_posts( $query ) {
  if ( ! is_page() && ! is_home() && $query->is_main_query() ) {
    $query->set( 'post_type', array( 'post', 'movies' ) );
  }
  // this function should return nothing.
}

*** admin_menu
<<<wp:action:admin_menu>>>

*** add_meta_boxes, add_meta_boxes_{post_type}
lili_add_meta_boxes($post_type, $post) takes 2 arguments, no return. 
lili_add_meta_boxes_{post_type}($post) takes 1 argument, no return.

Use wp:f:add_meta_box, wp:f:remove_meta_box or modify global $wp_meta_boxes;

$wp_meta_boxes['post-type']['normal']['core']['postexcerpt']['title'] = 'Your title';

You can change the title, callback (complete change to another function) and different context. 
The callback most likely outputs a label, form field and some description.

You can either completely change the callback or use wp:filter:gettext to change the translation

** Options, Settings
<<<WP All Options>>>
/wp-admin/options.php

[[https://codex.wordpress.org/Option_Reference][Option Reference]]

** Wordpress Theme
*** Template Files
[[https://codex.wordpress.org/Theme_Development#Template_Files][All Template Files]]
single.php
single-{post-type}.php

*** Functions used in template
#+BEGIN_EXAMPLE
// In template
<?php wp_head(); ?>

// In plugin
add_action('wp_head', 'lili_wphead_dfp');
function lili_wphead_dfp() {
 // add inline script to header
 $o = "<script>...</script>";
 echo $o;
}

// Load with dependancy (jQuery is loaded)
function lili_wphead_dfp() {
 if ( wp_script_is( 'jquery', 'done' ) ) {
?>
<script type="text/javascript">
// jQuery code 
</script>
<?php
 }
}
#+END_EXAMPLE

*** Good themes
[[https://themeforest.net/item/newspapaer/5489609][Newspaper]]

** Transient API
WordPress cache API in database.
=DELETE FROM wp_options WHERE option_name LIKE ('%\_transient\_%')=

** Plugins
*** Resize image on the fly
<<<fly-dynamic-image-resizer>>>

$image = fly_get_attachment_image_src(
 get_post_thumbnail_id(),
 array(160, 9999),
 false // true to crop to exact dimension
);

$image :: array(
 'src',
 'width',
 'height'
);

fly_add_image_size('lili-w600', 600, 9999, true);
$image = fly_get_attachment_image($post->id, 'lili-w600'); // HTML
*** Advanced Custom Fields - ACF
<<<wp:plugin:acf>>>
https://wordpress.org/plugins/advanced-custom-fields/

Add a field group and then add custom fields under the group.
Use Location to define rules to assign the field group to a custom post type.
You can hide the default post fields (Content editor, comments, categories, etc.)
Make custom fields required

In wp:The_Loop, to display a custom field :: the_field('field_name')
To get the value :: get_field('field_name'); 
*** Toolset Types
<<<wp:plugin:types>>>

WP Types is different! Use <<<types_render_field>>>

#+BEGIN_EXAMPLE
$newsletters = types_render_field('newsletters', array('output'=>'raw'));
// the real field name is actually wpcf-newsletters
// For single line (text) field, use 'output'=>'raw'
// For WYSIWYG field, use 'output'=>'html'. 'raw' might be plain text
// For Image field

$_image = types_render_field('field-image', array('output'=>'raw'));
// Output original full image url
// If 'output' => 'raw', 'size' and 'resize' will be ignored

// use 'url' => 'true' to output the url of the resized image.
$args = array('output'=>'normal', 'url'=>'true', 'width'=> 300, 'resize'=>'proportional');
// Output image url of a fixed width and dynamic height

$args = array('output'=>'normal', 'url'=>'true', 'size'=>'medium', 'resize'=>'proportional' );
// Output image url of a max width and height
// if 'size' is set, 'width' and 'height' will be ignored

/* 
 * 'size' => 'custom_image_size' | 'full' | 'large' | 'medium' | 'thumbnail'
 * Set 'size' and also 'resize' => 'crop' | 'proportional' | 'stretch' | 'pad'
 * If resize is necessary, set 'output' => 'normal'
 * 'padding_color' => 'transparent' | hex when resize=>pad
 */
// For Image field.
#+END_EXAMPLE

Refer to WP Types Custom Field Checkbox and WP Meta Query

* CSS
** Position, box-sizing
Default position is static. left, right, top, bottom have not effect
relative is relative to default static position, use left, right, top and bottom

Other elements adjacent to position:relative element will no be adjusted to fit into
any gap left by the element (treat the relative element as static)

position:fixed is relative to viewport

A "positioned" element is one whose position is anything except static.

postion:absolute is positioned relative to the nearest positioned ancestor.
If there's no positioned ancestors, document body is used.

When elements are positioned, they can overlap other elements.

box-sizing: border-box | padding-box | content-box (default); 

** Transform, Transition
css:animation

*** Transition
transition: /transition-property/ /transition-duration/ /transition-timing-function/ /transition-delay/

- transition-property :: can be 'all'
- transition-timing-function :: default linear
  - ease-in :: slow start
  - ease-out :: slow end
  - e.g. use ease-in for div:hover and ease-out in div

- transition-delay :: delay n seconds before the current transition starts.

#+BEGIN_EXAMPLE
div {
  width: 100px;
  height: 100px;
  background: red;
  transition: width 2s linear 3s, height 2s linear 3s, transform 2s linear 3s;
}
#+END_EXAMPLE

*** Transform

#+BEGIN_EXAMPLE
div:hover {
  width: 300px;
  height: 300px;
  transform: 
    rotate(180deg) 
    translate(-20px, 0)
    scale(0.9, 2)
    skew(30deg, 20deg);
}
/* You can turn off all transform */
/* transform: none; */
#+END_EXAMPLE

** Link
#+BEGIN_EXAMPLE
// In order
a:link {} /* Unvisited and normal */
a:visited {}
a:hover {}
a:active {}
#+END_EXAMPLE

** Text
*** Ellipsis
#+BEGIN_EXAMPLE
div.test {
 white-space: nowrap;
 width: 200px; // width has to be defined
 overflow: hidden; // needed
 text-overflow: ellipsis; // change to inherit when hover then the clipped text will show
}
#+END_EXAMPLE

*** Long Word
#+BEGIN_EXAMPLE
word-wrap: break-word; // allow to break a long word
#+END_EXAMPLE

*** Font size, line-height
font-size in child elements inherit parent element
em uses the current element's font-size or its closest parent element which has font-size defined
rem is always relative to the <html> element
vw and vh are the viewport width and height. 1vw is 1% of vw

Google recommends line-height is at least 1.2

line-height is normal means to use user agent style. Most likely default is 1 not 1.2

** CSS Selectors
<<<CSS Selectors>>>

div > p :: select p elements where the direct parent is div
div + p :: select p elements that are placed immediately after div (div's children)
p ~ ul :: select ul elements that are preceded by a p element
#+BEGIN_EXAMPLE
<p></p>
<ul></ul>
#+END_EXAMPLE

a[target] :: <a>'s with target attribute
a[target=_blank]
a[title~=flower] :: containing a word or followed by a hypen (not match flowers)
a[lang|=en] :: starting with a word or followed by a hyphen (en, en-us)
div[class^="test"] :: starting with (anything)
div[class$="test"] :: ending with (anything)
a[href*="w3schools"] :: containing

a:active
a:hover
a:link
a:visited

p::after
p::before
p::first-letter
p::first-line
p::selection
div::selection -- the selected portion of an element (e.g. select text)

input:checked
input[type="text"]:disabled
input:enabled
input:focus
input:invalid
input:valid
input:optional
input:required
 
p:empty -- has no children including text nodes

div:not(p) -- all children elements except <p>'s

p:first-child -- <p>'s are the first child of any elements
p:last-child
p:nth-child(2)
p:nth-child(7n-1)
tr:nth-child(even)
tr:nth-child(odd)
p:nth-last-child(2)
p:only-child -- <p>'s are the only child of any elements

div p:first-of-type -- <div> has 4 children <p>'s and first child is <a>. Select 1st of <p> children.
div p:last-of-type
div p:nth-of-type(2)
div p:only-of-type

=#news:target= -- anchor name id=news matches the URL hash

** Specificity
(a, b, c, d) start with (0, 0 , 0 ,0)
a - inline add 1
b - each id add 1
c - class, pseudo-class and attribute add 1
d - element add 1

Pseudo-class :not is not considered as pesudo-class in specificity calculation.
But anything inside it counts.

** Functions
*** attr(data-attr-1)
#+BEGIN_EXAMPLE
a::after {
 content: " (" attr(href) ")";
}
#+END_EXAMPLE

*** calc()
#+BEGIN_EXAMPLE
<div>Some Text...</div>

// Always leave 50px on both sides for space
// and take all that is left for width

div {
 width: calc(100% - 100px); /* calculate */
 margin-left: 50px;
}
#+END_EXAMPLE

*** counter
#+BEGIN_EXAMPLE
body {
 counter-reset: section;
}
h1 {
 counter-reset: subsection;
}
h1::before {
 counter-increment: section,
 content: "Section " counter(section) ". ";
}
h2::before {
 counter-increment: subsection;
 content: counter(section) "." counter(subsection) " ";
}
#+END_EXAMPLE

** border-image
border-image: source slice width outset repeat|initial|inherit;
border-image: none   100%   1     0     stretch

** background
background: bg-color bg-image position/bg-size bg-repeat bg-origin bg-clip bg-attachment initial|inherit;

#+BEGIN_EXAMPLE
background: url(img_flwr.gif) right bottom no-repeat, url(paper.gif) left top repeat;
#+END_EXAMPLE

*** background-size
background-size: 20px auto;
background-size: 50% auto; // sets the width of the bg image in percent of the parent element.
background-size: contain; // bg image might not cover all content area
background-size: cover; // content area might not see the whole bg image

*** background-clip, background-origin
background-clip: border-box; // default. largest area
// padding-box, content-box

// For background image
background-origin: border-box; // default. largest area
// padding-box, content-box

** Color
*** <<<CSS inherit color>>>
You can grab the parent `color` css property and use it in any color properties in child element
#+BEGIN_EXAMPLE
<div class="parent">
 <div class="child">
 </div>
</div>

.parent {
 color: red;
 background-color: blue;
}
.child {
 background-color: currentColor; /* take the parent color: red */
 color: currentColor; /* Take the parent color: red */
}
#+END_EXAMPLE

*** rgb(), rgba()
<<<CSS rgba>>>
#+BEGIN_EXAMPLE
#f03
#ff0033
#FF0033
rgb(255, 0, 51) // no fraction all integers
rgb(100%, 0%, 20%) // all % no integer

#f030     // 0% opaque red
#ff003300 // 0% opaque red
#FF003388 // 50% opaque red
rgba(255,0,0,0.7) // 70% opaque red

#+END_EXAMPLE

*** hsl(), hsla()
Hue :: integer, angle degree of the color circle. Red is 0, Green is 120, Blue is 240
Saturation :: percentage. 0% is grey
Lightness :: 100% is white, 0% is black, 50% is normal

#+BEGIN_EXAMPLE
hsla(240, 100%, 50%, 0.05) // 5% opaque blue
#+END_EXAMPLE

** Gradient
Both CSS gradient and CSS repeat gradient can be stacked in background-image

<<<CSS gradient>>>

#+BEGIN_EXAMPLE
linear-gradient(45deg, blue, red);
// to bottom, to top
// to right, to left
// to bottom right, to top left
linear-gradient(to bottom, blue, white 80%, orange);
// blue at 0%, white at 80%, orange at 100%
linear-gradient(to right, red, orange, yellow, green, blue);
// evenly distributed

background: linear-gradient(to right, rgba(255,255,255,0), rgba(255,255,255,1))
           ,url(/bg.jpg);
// Use it with background image

radial-gradient(red, yellow, rgb(30, 144, 255)); // evenly spaced
radial-gradient(red 5%, yellow 25%, #1E90FF 50%);
radial-gradient(
 circle, 
 // Shape can circle or ellipse
 // Default farthest-side
 // Fade from the center point to the ___
 // closest-corner, closest-side, farthest-corner, farthest-side
 yellow, #f06d06
);
// Change from center point to corner
radial-gradient(
 circle farthest-corner at top right,
 yellow, #f06d06
);
#+END_EXAMPLE

<<<CSS repeat gradient>>>

#+BEGIN_EXAMPLE
// On top of percentage, px can be used in repeat gradient
repeating-linear-gradient(-45deg, red, red 5px, white 5px, white 10px);
#+END_EXAMPLE

** opacity
0, 0.3, 1. The lower the value the more transparent
Child elements inherits the parent opacity value
If you don't want to carry opacity to children, define rgba color in parent elements
CSS rgba

** Shadow
Shadows can be stacked
#+BEGIN_EXAMPLE
box-shadow: h-shadow v-shadow blur spread color |inset|initial|inherit;
text-shadow: h-shadow v-shadow blur-radius color|none|initial|inherit;
#+END_EXAMPLE

** @font-face
Most widely accepted font format is WOFF then TTF and OTF.
Only IE supports EOT

#+BEGIN_EXAMPLE
@font-face {
 font-family: myFirstFont;
 src: url(sansation_light.woff);
}

// Another for bold
@font-face {
 font-family: myFirstFont;
 src: url(sansation_bold.woff);
 font-weight: bold;
/*
 font-stretch: normal | condensed | semi condensed | extra condensed | ultra condensed | expanded | ...;
 font-style: normal | italic | oblique 
*/
}
#+END_EXAMPLE

** @media
@media not|only /mediatype/ and (/media feature/) {}
<link rel="stylesheet" media="mediatype and|not|only (media feature)" href="style.css">

*** Syntax
not /mediatype/
only /mediatype/

Each media feature, key:value or key, must be wrapped in ()
Some media feature doesn't have a value.

=not /mediatype/= and =only /mediatype/= can be chained with OR (separated by comma) but not =and=
#+BEGIN_EXAMPLE
// This works
@media screen and (min-width:200px), not print and (min-width:300px) {}

// This syntax is wrong
@media screen and (min-width:200px) and not print and (min-width:300px) {}
#+END_EXAMPLE

Note :: =not /mediatype/= is different from =not(/mediafeature/)=

Nested media queries (@media inside another @media) is supported on all browsers except IE11 and below.

*** Testing
#+BEGIN_EXAMPLE
var mql = window.matchMedia("(orientation: portrait)");
// window.addListener(handlerOrientationChange);
handlerOrientationChange(mql);

function handlerOrientationChange(mql) {
 if (mql.mathces) {
  console.log('media query matches');
 }
 else {
  console.log('media query does not match');
 }
}
#+END_EXAMPLE

*** Media Types
all, print, screen, speech

#+BEGIN_EXAMPLE
@media screen and (max-width: 1000px) and (min-width: 700px) {}
// Use comma for OR
@media screen and (max-width: 699px) and (min-width: 520px), (min-width: 1151px) {}
#+END_EXAMPLE

<<<meta viewport>>>
#+BEGIN_EXAMPLE
<meta name="viewport" content="width=device-width, initial-scale=1.0">
// Set the width of the page to follow the screen-width of the device
// Initial zoom level 1.0

// Prevent zoom: add maximum-scale=1.0, user-scalable=0
#+END_EXAMPLE

*** Features
| Key           | Min/Max? | value                                                       |
| orientation   | no       | landscape, portrait. Not reliable when soft keyboard opens  |
| color         | yes      | int, number of colors. (color) for color device             |
| aspect-ratio  | yes      | int1/int2                                                   |
| grid          | no       | 0, 1 or (grid). The last suggests it's a device with 1 font |
| width, height | yes      | viewport                                                    |
| monochrome    | yes      | 0 (not mono) or int                                         |
| resolution    | yes      | 300dpi or 2dppx                                             |
|               |          |                                                             |

*** Responsive Design
**** Basic
#+BEGIN_EXAMPLE
/* {
 box-sizing: border-box;
}
.row:after {
 content: "";
 clear:both;
 display:block;
}
[class*="col-"] {
 float: left;
 padding: 15px;
 width: 100%;
}
@media only screen and (min-width: 600px) {
    .col-s-1 {width: 8.33%;}
    .col-s-2 {width: 16.66%;}
    .col-s-3 {width: 25%;}
    .col-s-4 {width: 33.33%;}
    .col-s-5 {width: 41.66%;}
    .col-s-6 {width: 50%;}
    .col-s-7 {width: 58.33%;}
    .col-s-8 {width: 66.66%;}
    .col-s-9 {width: 75%;}
    .col-s-10 {width: 83.33%;}
    .col-s-11 {width: 91.66%;}
    .col-s-12 {width: 100%;}
}
@media only screen and (min-width: 768px) {
    .col-1 {width: 8.33%;}
    .col-2 {width: 16.66%;}
    .col-3 {width: 25%;}
    .col-4 {width: 33.33%;}
    .col-5 {width: 41.66%;}
    .col-6 {width: 50%;}
    .col-7 {width: 58.33%;}
    .col-8 {width: 66.66%;}
    .col-9 {width: 75%;}
    .col-10 {width: 83.33%;}
    .col-11 {width: 91.66%;}
    .col-12 {width: 100%;}
}

<div class="row">
 <div class="col-3 col-s-3 menu">
  <ul>
   <li>Menu 1</li>
   <li>Menu 2</li>
   <li>Menu 3</li>
 </div>
 
 <div class="col-6 col-s-9">
  long content...
 </div>

 <div class="col-3 col-s-12">
  right sidebar...
 </div>
</div>
#+END_EXAMPLE

**** Bootstrap

#+BEGIN_EXAMPLE
<div class="container">
  <div class="row">
    <div class="col-*-*"></div>
  </div>
  <div class="row">
    <div class="col-*-*"></div>
    <div class="col-*-*"></div>
    <div class="col-*-*"></div>
  </div>
  <div class="row">
    ...
  </div>
</div>
#+END_EXAMPLE

For all sizes, 15px on each side of a column
.container has a fixed width based on different viewports.
Change it to .container-fluid then the container takes the full width

|           | <768px    | >=768px  | >=992px  | >=1200px |
| Class     | .col-xs-  | .col-sm- | .col-md- | .col-lg- |
| container | none/auto | 750px    | 970px    | 1170px   |
|           |           |          |          |          |

col-lg-9 :: non large size will have 100% width
col-md-7 col-lg-9 :: small size and extra small will have 100% width
col-xs-9 col-md-7 :: large size will have 7 columns, small size will have 9 columns

div.clearfix to prevent strange wrapping with uneven content

Offset Columns
col-md-offset-* :: increase the left margin of a column by n columns

Change Column Ordering
col-sm-push-*, col-sm-pull-* :: col-sm-push-8, col-sm-pull-4

class="img-circle" // border-radius: 50%
#+BEGIN_EXAMPLE
<a href="#" class="btn btn-default btn-lg">
 <span class="glyphicon glyphicon-search"></span> Button Large
</a>

<!-- block, max-width: 100%; height: auto; -->
<img src="" class="img-responsive">

<!-- center an image -->
<img src="" class="img-responsive img-circle" style="display:inline">

<!-- Nav Bar -->
<nav class="navbar navbar-default">
 <div class="container">

  <div class="navbar-header">
   <!-- 3 bars in the toggle button -->
   <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
    <span class="icon-bar"></span>
    <span class="icon-bar"></span>
    <span class="icon-bar"></span>    
   </button>
   <a class="navbar-brand" href="">Me</a>
  </div>

  <!-- .collapse is display: none; -->
  <div class="collapse navbar-collapse" id="myNavbar">
   <ul class="nav navbar-nav navbar-right">
    <li><a href="#">Submenu 1</a></li>
    <li><a href="#">Submenu 2</a></li>
    <li><a href="#">Submenu 3</a></li>
   </ul>
  </div>

 </div>
</nav>

<!-- Form fields -->
<form class="form-inline">
 <!-- all controls in this form are in one line -->
 <input type="email" class="form-control" size="50">
 <!-- form-control sets width:100% and other styles -->
 <button type="button" class="btn btn-danger">Subscribe</button>
</form>

#+END_EXAMPLE

*** Viewport sizes of device
http://viewportsizes.com/

** @keyframes

<<<css:animation>>>

animation: /name/ /duration/ /timing-function/ /delay/ /iteration-count/ /direction/ /fill-mode/ /play-state/;

#+BEGIN_EXAMPLE
@keyframes fa-spin {
 0%   { transform: rotate(0deg); }
 100% { transform: rotate(359deg); } 
}
.fa-spin {
 animation: fa-spin 2s linear 3s infinite alternate;
/* 
  2s - duration
  3s - delay
  infinite - animation-iteration-count
  alternate - animation-direction

  animation-fill-mode:
    none (default, after animation ends, styles go back to before start) | 
    forwards (after animation ends, styles got applied) | 
    backwards (before animation starts and during delay, apply styles defined in the 1 iteration, e.g. from and to ) | 
    both;
*/
}
.fa-repeat:before {
  content: "\f01e";
}
<i class="fa fa-repeat fa-spin"></i>
// Spinner made in FontAwesome 
#+END_EXAMPLE

Javascript starts keyframes animation
#+BEGIN_EXAMPLE
<div id="myDIV" onclick="startAnimation()">Click to start animation</div>
var x = document.getElementById("myDIV");
function startAnimation() {
 x.style.animation = "fa-spin 2s liner 3s infinite alternate"; // Standard
}
#+END_EXAMPLE 

Javascript animation event listners
#+BEGIN_EXAMPLE
x.addEventListner("animationstart", func1);
x.addEventListner("animationiteration", func2);
x.addEventListner("animationend", func3);
#+END_EXAMPLE

** @import

#+BEGIN_EXAMPLE
/* @import should appear before any css styles defined in a css file */
@import "mystyle.css";
@import url("mystyle.css");
@import "mystyle.css" print;
/* only media types not media features */
#+END_EXAMPLE

** @viewport
WD. Only Edge. Same as meta viewport.

#+BEGIN_EXAMPLE
@media screen and (max-width: 400px) {
 @-ms-viewport { width: 320px; }
 /* Define the viewport size */
}
#+END_EXAMPLE

** @supports

#+BEGIN_EXAMPLE
@supports not (display:flex) {}
@supports (display: flex) or 
          (display: -ms-flexbox) or
          (display: -moz-box) {}

@supports (transition-property: color) or 
          ( (animation-name: myAnimation) and (transform: rotate(225deg) )
          ) {}
#+END_EXAMPLE

** Flexbox
Container could be display:flex or display:inline-flex
Flexbox is good for aligning child elements with irregular or unknown or inconsistent width and height
And the number of child elements are unknown
Good for vertical and horizontal center a child element inside a container (parent)

#+BEGIN_EXAMPLE
.container {
 display: flex;
 /* flex-flow: <flex-direction> <flex-wrap> */
 
 /* flex-direction: row | row-reverse | column | column-reverse; */
 /* main axis is by default horizontally left to right 
  * main axis is changed by direcion css property (say change it ot rtl, right to left)
  * row is left to right , column is top to bottom
  *
  */
 /* flex-wrap: nowrap | wrap | wrap-reverse; */
    flex-flow: row wrap;
    
 /* justify-content: flex-start | flex-end | center | space-between | space-around; */
 /* e.g. you can change from flex-end to space-around for menu nav with @media queries */
    justify-content: space-around;   
 
 /* align-items: flex-start | flex-end | center | baseline | stretch; */
 /* This is for aligning items on one line (default x axis) on cross axis (y axis) */
 /* relative to the same line. e.g. you have 3 lines of items and each line holds 3 items. 
  * how do the 3 items align on the y axis on each line?
  * default is stretch
  */ 

 /* align-content: stretch | flex-start | flex-end | center | space-between | space-around;
  * This is for space between multiple lines
  * e.g. There're 3 lines of items and each line has 3 items 
  * How do the 3 lines align on the y axis on each line?
  * default is stretch
  * It only works when there are multiple lines and the container height is larger than total children height
  */
}

.item {
 /* order: <integer>; // optional */

 /* flex: none | <flex-grow> <flex-shrink> <flex-basis> */

 /* flex-grow: 0 | <number>; */
 /* 0 is default and means do not enlarge item in width (default x axis) */

 /* flex-shrink: 1 | <number> */
 /* 1 is default and means do not shrink item in width (default x axis) */
 
 /* flex-basis: auto | <length>; */
 /* auto is default. if it's 0, extra space will not be factored in. Always use auto */
 
 /* Override align-items in container */
 /* align-self: auto | flex-start | flex-end | center | baseline | stretch; */

}

.item_1 {
 /* Set margin:auto in an item will absorb all space of the current line in current direction
 margin-right: auto;
 /* all other items to the right of item_1 will not have extra space */
}
#+END_EXAMPLE

Insert a line break in flex items. Might not be easy..
#+BEGIN_EXAMPLE
.line-break {width: 100%}

<div class="container">
 <div class="item">1</div>
 <div class="item">2</div>
 <div class="line-break"></div>
 <div class="item">3</div>
 <div class="item">4</div>
</div>
#+END_EXAMPLE

** Grid
Not yet supported. Only IE and Edge.

*** container: grid-template-columns, grid-template-rows
#+BEGIN_EXAMPLE
<div class="container">
 <!-- .item are direct descendants -->
 <div class="item item-1"></div>
 <div class="item item-2"></div>
 <div class="item item-3"></div>
</div>

.container {
 display: grid | inline-grid | subgrid;
 /* subgrid to indicate the grid container is a grid item of another grid container and 
    it should take the parent's sizes of rows/columns  
 */
 /* Don't use column, float, clear and vertical-align in grid container as they have no effect */

 grid-template-columns: 40px 50px auto 50px 40px; /* 5 columns */
 grid-template-rows: 25% 100px auto; /* 3 rows */
 
 /* Add line names
 grid-template-columns: [first] 40px [line2] 50px [line3] auto [col4-start] 50px [five] 40px [end];
 grid-template-rows: [row1-start] 25% [row1-end row2-start] 100px [third-line] auto [last-line];

 /* Any row or column line can have multiple names: [row1-end row-start] */
 /* Any row or column line can have the same name */
 grid-template-columns: repeat(3, 20px [col-start]) 5%;
 /* equivalent to */
 grid-template-columns: 20px [col-start] 20px [col-start] 20px [col-start] 5%;
 
 /* Free space is defined as total space minus any fixed size items */
 grid-template-columns: 1fr 50px 1fr 1fr;
}
#+END_EXAMPLE

*** <<<container: grid-template-areas>>>, items: grid-area

#+BEGIN_EXAMPLE
.item-a{
  grid-area: header;
}
.item-b{
  grid-area: main;
}
.item-c{
  grid-area: sidebar;
}
.item-d{
  grid-area: footer;
}

.container{
  grid-template-columns: 50px 50px 50px 50px;
  grid-template-rows: auto;
  grid-template-areas: "header header header header"
                       "main main . sidebar"
                       "footer footer footer footer"
}
/* . means that single cell is empty. You can have multiple dots without space ".." */
/*
The first row line and column line of footer area have the same name "footer-start"
The last row line and column line of footer aree have the same name "footer-end"
*/
#+END_EXAMPLE

*** container: grid-gap
Gutter size: space inbetween 2 row lines or column lines. But start and end space is always 0.

#+BEGIN_EXAMPLE
grid-grap: <grid-column-gap> <grid-row-gap>;
#+END_EXAMPLE

*** container: justify-items, items: justify-self
#+BEGIN_EXAMPLE
justify-items: start | end | center | stretch (default);
/* Adjust content in cell 
   start: align to left column line
*/
.item {
 justify-self: /* To overwrite .container: justify-items */
}
#+END_EXAMPLE

*** container: align-items, items: align-self
#+BEGIN_EXAMPLE
align-items: start | end | center | stretch (default);
/* Adjust content in cell 
   start: align to top of row line
*/
#+END_EXAMPLE

*** container: justify-content
Total width of all grids is less than width of its grid container.
start: align all grids to the left of the grid container
#+BEGIN_EXAMPLE
justify-content: start | end | center | stretch | space-around | space-between | space-evenly
#+END_EXAMPLE

*** container: align-content
Total height of all grids is less than height of its grid container.
start: align all grids to the top of the grid container
#+BEGIN_EXAMPLE
align-content: start | end | center | stretch | space-around | space-between | space-evenly
#+END_EXAMPLE

*** container: grid-auto-columns, grid-auto-rows
Implicit grid tracks are created when items have positioned or resized (items: grid-column, grid-row) outside of the defined grid (container: grid-template-areas).
Implicit grid tracks will have 0 width by default until it's set.
Implicit grid tracks of 2 columns and 2 rows are set.
#+BEGIN_EXAMPLE
grid-template-columns: 60px 60px;
grid-tempalte-rows: 90px 90px;
/* 2x2 grids are created */
/* but item-b is out of bound */
.item-b {
 grid-column: 5 / 6;
 grid-row: 2 / 3;
}
/* It's 5x2 grids now. The implicit grid tracks are 2x2 */
grid-auto-columns: 60px 60px;
grid-auto-rows: auto;
#+END_EXAMPLE

*** container: grid-auto-flow
For items that are not positioned (items: grid-column, grid-row) nor 
put in a named area (items: grid-area) which is later used by container: grid-template-areas,
these items are "not explicitly placed on the grid".
Use this to control the auto placement
#+BEGIN_EXAMPLE
grid-auto-flow: row | column | row dense | column dense
/* row : fill rows first (default)
   dense : fill smaller items first (order of items might change!)
*/
#+END_EXAMPLE

*** <<<items: grid-column, grid-row>>>
Position and resize an item
#+BEGIN_EXAMPLE
grid-column: <start-line> / <end-line> | <start-line> / span <value>;
grid-row: <start-line> / <end-line> | <start-line> / span <value>;

/* grid-column-start, grid-column-end, grid-row-start, grid-row-end can be 
   <number> | <name> | span <number> | span <name> | auto
*/ 
#+END_EXAMPLE

*** <<<items: grid-area>>>
#+BEGIN_EXAMPLE
grid-area: <name> | <row-start> / <column-start> / <row-end> / <column-end>
#+END_EXAMPLE

** Horizontal and Vertical Center
If both the parent and child are blocks, use flexbox.
For text
#+BEGIN_EXAMPLE
.center {
 height:200px;
 position:relative;
}
.center p {
 margin:0;
 position:absolute;
 top:50%;
 left:50%;
 transform: translate(-50%, 50%);
}
#+END_EXAMPLE

** Column for text

#+BEGIN_EXAMPLE
<div>
 <h2>Title takes 2 columsn</h2>
 long text..
</div>
div {
 column-count: 3;
 column-gap: 40px;
 column-rule-style: solid; /* just like border */
 column-rule-width: 1px;
 column-rule-color: lightblue;
 column-rule: 1px solid lightblue;
}
div h2 {
 column-span: 2;
}

div.fixedWidth {
 columns: 200px; /* column-count will be auto */
 overflow-x: scroll;
 height: 600px; /* So that scrollbar shows on x axis */
}

#+END_EXAMPLE

** Shape
At the end of 2016, only Chrome, Safari, iOS and Android browswers support shape.

#+BEGIN_EXAMPLE
<div class="conainer">
  <img id="image" src="a.jpg">
  <p id="content">Long text</p>
</div>

img {
 display: block;
 float:left;
 width: 100%;
 height: auto;
 shape-outside: url(shape.png); /* polygon can be used */
 /* png has areas that are partially or completely transparent */
 shape-image-threshold: 0.9; /* The shape is any areas that have opacity greater than 0.9 */
 shape-margin: 20px; 
}

#+END_EXAMPLE

** CSS Framework
** SVG
*** Make SVG, Optimize SVG
Exported from AI and [[http://petercollingridge.appspot.com/svg-optimiser][optimize it]]

*** SVG as background image dynamic size
You can only control size in this method
#+BEGIN_EXAMPLE
.logo {
 background: url(logo.svg) no-repeat top left;
 background-size: contain;
 width: 100px;
 height: 82px;
}
#+END_EXAMPLE

*** <<<CSS in SVG>>>

Inline CSS
#+BEGIN_EXAMPLE
<svg xmlns="http://www.w3.org/2000/svg"
    xmlns:xlink="http://www.w3.org/1999/xlink">

    <style type="text/css" >
      <![CDATA[

        circle.myGreen {
           stroke: #006600;
           fill:   #00cc00;
        }
       circle.myRed {
          stroke: #660000;
          fill:   #cc0000;
       }

      ]]>
    </style>

    <circle  class="myGreen" cx="40" cy="40"  r="24"/>
    <circle  class="myRed"   cx="40" cy="100" r="24"/>
</svg>
#+END_EXAMPLE

External CSS

#+BEGIN_EXAMPLE
<?xml-stylesheet type="text/css" href="svg-stylesheet.css" ?>
<svg xmlns="http://www.w3.org/2000/svg"
    xmlns:xlink="http://www.w3.org/1999/xlink">
    <circle cx="40" cy="40" r="24"
       style="stroke:#006600; fill:#00cc00"/>
</svg>
#+END_EXAMPLE

Embedded CSS in SVG only affects the SVG not other elements in the global HTML if svg is not inline with global HTML.

*** SVG Zoom and Pan

#+BEGIN_EXAMPLE
<g id="parentGraphic">
 <rect />
 <text></text>
</g>

<!-- use copy an element -->
<use href="#parentGraphic" transform="translate(40, 30) scale(0.9)"></use>
#+END_EXAMPLE

#+BEGIN_EXAMPLE
<!-- Original -->
<svg currentScale="1" width="300px" height="200px" viewbox="0 0 300 200">
<!-- Don't use currentScale to zoom -->

<!-- Move down 200/200*25=25px and move right 300/300=50 px -->
<svg width="300px" height="200px" viewbox="-50 -25 300 200">

<!-- Enlarge 50% -->
<svg width="300px" height="200px" viewbox="0 0 150 100">

<!-- Enlarge 50%, move down 200/100*25=50px and move right 300/150*50=100px -->
<svg width="300px" height="200px" viewbox="-50 -25 150 100">

#+END_EXAMPLE

** Use Cases
*** Fix parent height less than total children height
#+BEGIN_EXAMPLE
<div class="clearfix">
  <div style="">Div 1 doesn't float</div>
  <div style="float: left;">Div 2</div>
</div>

/* Solution 1 */
.clearfix:after {
 content: " ";
 display:block;
 clear:both;
 height:0;
}

/* Solution 2 */
.clearfix {
 display:inline-block;
 width:100%;
}
#+END_EXAMPLE
*** Transparent Image
#+BEGIN_EXAMPLE
<img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"
 width="100" height="100">
#+END_EXAMPLE

*** Button Hover Double Quotes
#+BEGIN_EXAMPLE
<button class="button" style=""><span>Hover </span></button>
.button {
 display: inline-block;
 border-radius: 4px;
 background-color: #f4511e;
 border: none;
 color: #FFFFFF;
 text-align: center;
 font-size: 28px;
 padding: 20px;
 width: 200px;
 transition: all 0.5s;
 cursor: pointer;
 margin: 5px;
}
.button span {
 cursor: pointer;
 position: absolute;
 opacity: 0;
 top: 0;
 right: -20px;
 transition: 0.5s;
}
.button:hover span {
  padding-right: 25px; 
/*
push button text to left and create padding
for double quotes to push to the right of padding
*/
}
.button:hover span:after {
 opacity: 1;
 right: 0;
}
#+END_EXAMPLE

*** Button with icon on the left
#+BEGIN_EXAMPLE
// No space in button
<button class="li-button has-icon"><span><a href="">Youtube</a></span></button>

<style>
	.li-button {
		display:inline-block;
		padding:0 8px 0 5.5px;
		border:solid 1px transparent;
		border-radius:.25em;
		background-color:#0072BC;
		color:#ffffff;
		vertical-align:middle;
		/* Overwrite default button styles */
		outline:0;
		text-decoration:none;
		cursor:none;
	}
	.li-button.has-icon::before {
		margin-right:6px;
		background:url(icon.svg) no-repeat;
		background-size:16px 12px;
		width:16px;
		height:12px;
		content:'';
		display:inline-block;
		vertical-align:middle;
	}
	.li-button span {
		vertical-align:middle;
		font-size:12px;
	}
</style>
#+END_EXAMPLE

* HTML
** DOM
*** Document Object
[[https://developer.mozilla.org/en/docs/Web/API/Document][Document properties and methods]]

| document.methodName() or     | Notes                                                    | Use in       |
| document.propertyName        |                                                          | Element Obj? |
|------------------------------+----------------------------------------------------------+--------------|
| createElement("p")           | appendChild                                              | no           |
| createTextNode("text node"); | appendChild                                              | no           |
| createAttribute('data-id')   | appendChild                                              | no           |
|                              |                                                          |              |
| getElementById("id")         | null or element object                                   | no           |
| getElementsByClassName       | NodeList                                                 | yes          |
| getElementsByTagName("p")    | NodeList                                                 | yes          |
| querySelector('#id')         | 1st matched element. null or exception or element object | yes          |
| querySelectorAll('#id')      | Static NodeList or exception                             | yes          |
|                              |                                                          |              |
| normalize()                  | remove empty text nodes and join adjacent text nodes     | yes          |
|                              |                                                          |              |

*** NodeList Object
<<<NodeList>>>
NodeList Object appears like an array (loop like an array) but cannot use Array Methods such as valueOf(), join(), forEach().

<<<Static NodeList>>> means changes to DOM have no effect.

All NodeList objects are live objects meaning changes
that are made in other code places reflect on all NodeList objects that were previously found.

var myNodeList = document.getElementsByTagName("P");
console.log(myNodeList.length); 
var firstP = myNodeList[0];
var firstP = myNodeList.item(0); // same as above, return null if not exists
var firstP = document.getElementsByTagName("p")[0]; // same as above

console.log(firstP.innerHTML);
firstP.style.backgroundColor = "red";

for (var i=0; i < myNodeList.length; i++) {
 myNodeList[i].style.backgroundColor = "red";
} 

Another way to loop NodeList

#+BEGIN_EXAMPLE
Array.prototype.forEach.call(
 aNodeListArray,
 function(item) {
  console.log(item.id);
 }
);
#+END_EXAMPLE

*** <<<Element Object>>>
[[https://developer.mozilla.org/en-US/docs/Web/API/Element][Element Properties and Methods]]

| element.methodName() or        | Notes                                           | Use in   |
| element.propertyName           |                                                 | Document |
|                                |                                                 | Object?  |
|--------------------------------+-------------------------------------------------+----------|
| accessKey                      | get/set accessKey                               |          |
| addEventListerner()            | refer to event attributes without 'on'          | yes      |
|                                | e.addEventListerner("click", myFunction,false ) |          |
|                                | false for bubbling, true for capturing          |          |
| removeEventListener()          | anonymous function will not work                | yes      |
|                                |                                                 |          |
| click()                        | simulate a click on an element                  | no       |
| blur()                         |                                                 | no       |
| focus()                        |                                                 | no       |
|                                |                                                 |          |
| innerHTML                      | get/set                                         | no       |
|                                |                                                 |          |
| appendChild(newChildNode)      | move element to the end of another element      | no       |
|                                | <<<appendChild>>>                               |          |
| removeChild(childNode)         |                                                 | no       |
| list.insertBefore(newnode,     |                                                 |          |
| list.childNodes[0])            |                                                 |          |
|                                |                                                 |          |
| <<<parentNode>>>               | read only                                       | no       |
| <<<parentElement>>>            | read only                                       | no       |
|                                |                                                 |          |
| .cloneNode()                   |                                                 |          |
|                                |                                                 |          |
| attributes                     | read only. NamedNodeMap                         | no       |
| getAttribute("class")          | attribute value in string                       | no       |
| getAttributeNode("class")      | Attr object                                     | no       |
|                                |                                                 |          |
| .childElementCount             | the number of child element nodes not text      |          |
|                                | and comment nodes                               |          |
| .childNodes                    | NodeList object. .childNodes.length             |          |
|                                | var c = e.childNodes[0].text                    |          |
| .children                      | exclude text and comment nodes.                 |          |
|                                | HTMLCollection object.                          |          |
| classList                      | read only. DOMTokenList                         | no       |
| className                      | get/set                                         | no       |
|                                |                                                 |          |
| clientHeight                   | height + padding, no border and scrollbar       | no       |
| clientWidth                    |                                                 | no       |
| clientTop                      | Top border width                                | no       |
| clientLeft                     | Left border width                               | no       |
| offsetWidth                    | width+padding+border+scrollbar but no margin    | no       |
| offsetHeight                   |                                                 | no       |
| .offsetLeft, offsetTop         | relative to offsetParent                        |          |
| .scrollHeight, .scrollWidth    | width+padding only                              |          |
| .scrollLeft, .scrollTop        | pixels are scrolled                             |          |
|                                |                                                 |          |
| e1.compareDocumentPosition(e2) | compare positions of elements                   |          |
| e1.contains(e2)                | if e2 is a descendant of e1                     |          |
| .contentEditable               |                                                 |          |
|                                |                                                 |          |
| .firstChild                    | child node                                      |          |
| .firstElementChild             | child element node                              |          |
| .nextSibling                   |                                                 |          |
| .nextElementSibling            |                                                 |          |
|                                |                                                 |          |
| .hasAttribute("onclick")       |                                                 |          |
| .hasAttributes()               | has any attributes?                             |          |
| .hasChildNodes()               | has any child nodes                             |          |
|                                |                                                 |          |
| .isEqualNode(e1,e2)            |                                                 |          |
|                                |                                                 |          |
| .nodeName                      | tag name                                        |          |
| .tagName                       | tag name in upppercase                          |          |
| .nodeValue                     |                                                 |          |
|                                |                                                 |          |

*** Event Object
Property
| type             | event name. e.g. mousedown                                 |
| timeStamp        | event occured                                              |
| bubbles          | true or false                                              |
| defaultPrevented | if method preventDefault() was called                      |
| currentTarget    | the element event happens on                               |
| target           | the (child) element event happens on                       |
| view             | get reference of the Window object where the event occured |
|                  |                                                            |

Method
| preventDefault()           | stop defeault event action                                            |
| stopImmediatePropagation() | stop other listerns of the same event (e.g. click) on the same target |
| stopPropagation()          | stop bubbling                                                         |

**** MouseEvent Object
| altKey        | whether ALT key was pressed                                                      |
| shiftKey      | whether Shift key was pressed                                                    |
| ctrlKey       | whether Ctrl key was pressed                                                     |
| button        | 0 left click, 1 middle, 2 right                                                  |
| which         | button + 1: 0: no button, 1 left, 2 middle, 3 right                              |
| buttons       | one or more buttons. More button such as browse back button.Safari not supported |
| clientX       | relative to current window (viewport).                                           |
| clientY       |                                                                                  |
| pageX         | relative to the fully rendered content area. Height might be larger than         |
| pageY         | viewport height.                                                                 |
| screenX       | relative to the screen. e.g. number of monitors and monitor screen               |
| screenY       |                                                                                  |
| relatedTarget | use with mouseover event to find the element the cursor jsut exited or           |
|               | with the mouseout event to find the element the cursor just entered              |

**** KeyboardEvent Object
Keyboard code (KC) - actual key on keyboard (always lowercase)
Unicode Character code (UCC) - result Unicode character (Shift + w = W, return the character code of W)

| altKey   | whether alt is pressed                         |
| ctrlKey  |                                                |
| shiftKey |                                                |
| metaKey  | whether meta is pressed. Windows key           |
| key      | key name on keyboard (F1,Enter..)              |
| keyCode  | keypress-0, keydown,keyup-UCC. All browsers.   |
| charCode | keypress-UCC, keydown,keyup-0. All browsers.   |
| which    | keypress-UCC, keydown,keyup-UCC. All browsers. |
| location | 4 numbers 0 - standard,1 - left,               |
|          | 2 - right (CTRL), 3 - numpad                   |
|          |                                                |

If you want to return UCC for all events cross all browsers use this:
var x = event.charCode || event.keyCode;

**** HashChangeEvent Object
newURL :: the URL after the hash has been changed
oldURL

**** PageTransitionEvent
For events: onpageshow and onpagehide
persisted :: whether the page was cached

**** FocusEvent Object
relatedTarget :: the element related to the element that triggered the event
event.relatedTarget.tagName;

**** AnimationEvent Object
animationName :: keyframe name
elapsedTime :: number of seconds the transition has been running

*** <<<DOMTokenList>>> Object
A collection of space-separated tokens.

| DOMTokenList.methodName() | Notes                                                            |
| or                        |                                                                  |
| DOMTokenList.propertyName |                                                                  |
|---------------------------+------------------------------------------------------------------|
| length                    | read only                                                        |
| add("class2Name")         |                                                                  |
| remove("class2Name")      |                                                                  |
| replace("old","new")      |                                                                  |
| toggle('class2Name')      | if exists, removes and return false. If not, add and return true |
| contains("class2Name")    |                                                                  |

*** <<<NamedNodeMap>>> Object
A collection of Attr object 's. Loopable like an Array but no Array methods.

*** <<<Attr Object>>>
An attribute node.

| name  |   |
| value |   |

** Global Attributes
Can be applied to any element
| accesskey       | Add shortcut. M-accesskey         |
| download        | filename. force download          |
| contenteditable | true or false. Become editable    |
| contextmenu     | right click menu. Only in Firefox |
| dir             | ltr, rtl or auto. text direction. |
| hidden          |                                   |
| spellcheck      | true or false                     |
| tabindex        | Tab button. 1 is first            |
| title           | tool tip                          |
|                 |                                   |

Drag-and-Drop

#+BEGIN_EXAMPLE
// ondropover allows this tag to receive dropped elements.
// ondrop defines what to do with the traferred data
<div id="div1" ondrop="drop(e)" ondragover="allowDrop(e)"></div>
// Make a tag draggable: draggable="true"
// <a> and <img> are by default draggable
// ondragstart defines what data to pass to ondrop
<img id="drag1" src="http://placehold.it/300x250" draggable="true" ondragstart="drag(e)">

<script>
function drag(e) {
  // Pass the dragged element id
  ev.dataTransfer.setData("text", ev.target.id);
}

function allowDrop(e) {
  e.preventDefault();
} 

function drop(e) {
  e.preventDefault();
  var data = e.dataTransfer.getData("text");
  e.target.appendChild(document.getElementById(data));
}
</script>
#+END_EXAMPLE

** Event Attributes
Capturing phrase: DOM heirarchy up
Bubbling phrase (default): DOM heirarchy down

These objects have implemented EventTarget interface which can receive events and may have listeners:
- element, document, window
- XMLHttpRequest, AudioNode, AudioContext and others

*** Windows Event in body tag
| onafterprint, onbeforeprint | only IE and FF                                |
| onbeforeunload              | before page is closed/refreshed               |
| onunload                    | after page is closed/refreshed                |
| onhashchange                | when URL hash is changed                      |
| onload                      | when an object is loaded:                     |
|                             | body, frame, frameset, iframe,                |
|                             | img, link, script, style                      |
|                             | Not run when it's loaded from cache           |
| onpageshow                  | similar to onload but always triggers         |
| onpagehide                  | similar to onunload but onunload event causes |
|                             | the page to not be cached.                    |
| onresize                    |                                               |
|                             |                                               |

*** Form Event Attributes
Also can be applied on almost all elements.

| oncontextmenu | right click to bring context menu                           |
| onreset       |                                                             |
| onsearch      | <input type="search" onsearch="">. IE and FF not supported  |
| onselect      | when text is selected in <input type="text"> or <textarea>  |
| onblur        | leave a form field. opposite of onfocus                     |
| onfocus       | opposite of onblur                                          |
| onfocusin     | similar to onfocus but bubbles. FF not supported            |
| onfocusout    | similar to onblur but bubbles.FF not supported              |
| onchange      | oninput and lose focus. also works on <select> and <keygen> |
| oninput       | not working on <select> and <keygen>                        |
|               |                                                             |

*** Mouse Events, Clipboard Events, Keyboard Events
| ondblclick   | double click                                      |
|              |                                                   |
| ondragstart  |                                                   |
| ondrag       | being dragged                                     |
| ondragend    |                                                   |
|              |                                                   |
| ondragenter  | when dragged element enters the drop target       |
| ondragover   | over the drop target                              |
| ondragleave  | leave the drop target                             |
| ondrop       | is dropped on the drop target                     |
|              |                                                   |
| onscroll     |                                                   |
| onwheel      | only Chrome and FF                                |
|              |                                                   |
| oncopy       |                                                   |
| oncut        |                                                   |
| onpaste      |                                                   |
|              |                                                   |
| onmousedown  |                                                   |
| onmouseenter | when move into child element                      |
| onmouseleave | when moving out of the element (not its children) |
| onmousemove  | when moving inside an element                     |
| onmouseover  | when onto this element                            |
| onmouseout   | when moving out of the element and its children   |
|              |                                                   |
| onkeydown    | evens are in order. works for all keys            |
| onkeypress   | Some keys are not fired: C, A, S, ESC, etc.       |
| onkeyup      | when releasing a key                              |

*** Media Events
Elements: audio, img, embed, object, video
Events in order:

| onloadstart      |   |
| ondurationchange |   |
| onloadedmetadata |   |
| onloadeddata     |   |
| onprogress       |   |
| oncanplay        |   |
| oncanplaytrhough |   |
|                  |   |

*** Animation Events
Refer to CSS @keyframes.
animationstart
animationend
animationiteration :: when animaiton repeats

*** Transition Event
transitionend

*** Misc events
| onerror | when an error occurs while loading an external file: <img> |

** Canvas
** Tags, HTML5 Elements
*** HTML Tags
| Tag      | Usage                             | Notes                                            |
|----------+-----------------------------------+--------------------------------------------------|
| a        | download="filename"               | force download                                   |
| abbr     | title="World Health Organization" | abbreviation WHO                                 |
| address  |                                   | author or owner (not just address) of a document |
|          |                                   | or an article. display:block, italic author      |
| base     | href,target                       | base url and target for <a> tags                 |
|          |                                   |                                                  |
| article  |                                   | affect outline                                   |
| aside    |                                   |                                                  |
| section  | headline tag is required          | affect outline                                   |
| main     | Use it once                       | not descendant of other tags                     |
| nav      |                                   | affect outline                                   |
|          |                                   |                                                  |
| cite     | <cite>U of T Professor</cite>     | wrap a person's title                            |
| dfn      | <dfn>HTML</dfn> is ...            | A term to be defined                             |
| mark     | highlight text                    | background yellow and text in black              |
| s        |                                   | text-decoration: line-through                    |
| q        | <q cite="abc.com">Build</q>       | Double quotes                                    |
| ruby     | <ruby>a <rt>sound</rt></ruby>     |                                                  |
| wbr      | <wbr>alongword</wbr>              | the word will not be broken for line break       |
|          |                                   |                                                  |
| meter    | min,max,high,low,optimum          | value                                            |
| progress | max, value                        |                                                  |
|          |                                   |                                                  |
|          |                                   |                                                  |
| colgrup, | specify styles and span for       |                                                  |
| col      | columns in a table                |                                                  |
|          |                                   |                                                  |
| iframe   | srcdoc=""                         | repalce double quote with &quot;                 |
|          | sandbox=""                        | empty to apply all restrictions                  |
|          |                                   | e.g. allow-forms allow-same-origin               |
| input    | autocomplete="on or off"          | default on. turn off for a specific field        |
|          | autofocus=""                      |                                                  |
|          | formmethod="get or post"          | overwrite <form> type="submit, image"            |
|          | formaction="another.php"          | overwrite <form> type="submit, image"            |
|          | formenctype="multipart/form-data" | overwrite <form> type="submit, image"            |
|          | formtarget="_blank"               | overwrite <form> type="submit, image"            |
|          | min="1" max="1979-12-31"          | for type="date" or type="number"                 |
|          | multiple                          | for type="file"                                  |
|          | pattern="regex"                   | for type=text,date,search,url,tel,email,password |
|          |                                   | escape " in regex with \x22                      |
|          | placeholder="hint"                |                                                  |
|          | step="3"                          | -3,0,3,6 can be accepted. type="number"          |
|          | type=email, url                   |                                                  |
|          | required                          | no in IE                                         |
|          | type="range" min max              | slide control                                    |
|          | type="search"                     |                                                  |
|          | disabled="disabled"               | not selectable, editable and not submitted       |
|          | readonly="readonly"               | selectable, not editable and get submitted       |
| samp     | sample computer output            |                                                  |
| code     | monospace                         |                                                  |
| kbd      | monospace                         |                                                  |
| var      | variable name                     |                                                  |
|          |                                   |                                                  |
| li       | value="100"                       | increment by 1                                   |
|          |                                   |                                                  |

*** Picture tag
#+BEGIN_EXAMPLE
<picture>
 <source srcset="a.jpg" media="(min-width: 600px)">
 <source srcset="b.jpg" media="(min-width: 500px)"> 
 <source srcset="fallback.jpg">
 <img src="fallback.jpg">
</picture>
#+END_EXAMPLE

*** Term/name in a list
#+BEGIN_EXAMPLE
<dl>
  <dt>Term #1</dt>
  <dd>Description of Term #1</dd>
  <dt>Term #2</dt>
  <dd>Description of Term #2</dd>
</dl>
#+END_EXAMPLE

** Meta
*** Meta Refresh (redirect)
#+BEGIN_EXAMPLE
<meta http-equiv="refresh" content="0;URL='http://abc.com'" />
// "0" means zero second.
#+END_EXAMPLE

** Email

[[https://www.campaignmonitor.com/dev-resources/guides/mobile][Campaign Monitor Mobile Design Guide]]

| Element   | Note                                                        |
|-----------+-------------------------------------------------------------|
| table     | always assign align, width,border, cellpadding, cellspacing |
| tr        | <tr style="padding:0;margin:0;line-height:0;" height="15">  |
|           | <td>&nbsp;</td>                                             |
|           | </tr> // empty row with height                              |
|           |                                                             |
| td        | Wrap text in td                                             |
|           |                                                             |
| Attribute |                                                             |
|-----------+-------------------------------------------------------------|
| style     | use =display: none!important;=                              |
|           |                                                             |

#+BEGIN_EXAMPLE
<style>
.sectionContainer {
  background-color: #ffffff;
  padding-right:10px !important;
  padding-left:10px !important;
}
.sectionTable {
  background-color: #ffffff;
}
@media only screen and (max-width:640px) {
.sectionTable {
  max-width:640px !important;
  width:100% !important;
}
}
@media only screen and (max-width:480px) {
.sectionTable {
  max-width:480px !important;
  width:100% !important;
}
.sectionContent .s480-w0 {
  display:none !important;
}
} 
</style>

<table>
  <tr>
    <td class="sectionContainer">
      <table border="0" cellpadding="0" cellspacing="0" width="640" class="sectionTable">
        <tr style="padding:0;margin:0;line-height:0;" height="15"><td>&nbsp;</td></tr>
        <tr>
          <td align="center" valign="middle" style="background-color:#004663;color:#ffffff;margin:0;font-size:24px;font-family:Georgia;font-weight:normal;">
            Section #1  
          </td>
        </tr>
        <tr style="padding:0;margin:0;line-height:0;" height="10"><td>&nbsp;</td></tr>
        <tr>
          <td align="center" valign="top">
            
          </td>
        </tr>
      </table>
    <td>
  </tr>
</table>

#+END_EXAMPLE

** Icons for Mobile Devices
Default 60x60
#+BEGIN_EXAMPLE
<link rel="apple-touch-icon" href="touch-icon-iphone.png">
<link rel="apple-touch-icon" sizes="76x76" href="touch-icon-ipad.png">
<link rel="apple-touch-icon" sizes="120x120" href="touch-icon-iphone-retina.png">
<link rel="apple-touch-icon" sizes="152x152" href="touch-icon-ipad-retina.png">
#+END_EXAMPLE

Startup Image
Size: 320x480
=<link rel="apple-touch-startup-image" href="/startup.png">=

Hide Safari UI (URL address bar)
=<meta name="apple-mobile-web-app-capable" content="yes">=

Even though UI is hidden, there's a status bar. Style it:
=<meta name="apple-mobile-web-app-status-bar-style" content="black">=

** Geolocation
Chrome v50+ only supports geolocation for https
*** .getCurrentPosition
#+BEGIN_EXAMPLE
<button onclick="getLocation()">Get Location</button>
<p id="demo"></p>
<script>
var x = document.getElementById("demo");
function getLocation() {
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(showPosition, showError);
  }
  else {
    x.innerHTML = "Not supported";
  }
}

function showPosition(position) {
 x.innerHTML = "Latitiude" + position.coords.latitude +
               "Longitude: " + position.coords.longitude;
}

function showError(e) {
  switch (e.code) {
    case: e.PERMISSION_DENIED:
     break;
    case: e.POSITION_UNAVAILABLE;
    case: e.TIMEOUT:
    case: e.UNKNOWN_ERROR:
  }
}
</script>
#+END_EXAMPLE

*** watchPosition
Same as getCurrentPosition but continuous track.

** Storage
#+BEGIN_EXAMPLE
if (typeof(Storage) !== "undefined") {
  // Use localStorage or sessionStorage
  // Store. value is always string
  localStorage.setItem("key","value");
  console.log(localStorage.getItem("key"));
  localStorage.clickcount = Number(localStorage.clickcount) + 1;
  console.log(localStorage.key);
} 
else {
  // Not supported
}
#+END_EXAMPLE
** Application Cache
~<html manifest="demo.appcache"~
.appcache file should be served in =text/cache-manifest= media type
#+BEGIN_EXAMPLE
CACHE MANIFEST
# Above should be first line
# Files that should be cached
/theme.css
NETWORK
# Files will not be cached
login.asp
# An asterisk indicates all other files require an internet connection
*
FALLBACK
/html/ /offline.html
# offline.html should be served in place of all files in /html/ directory
# if internet is not available

# Change the manifest file to update cache
#+END_EXAMPLE
** Worker
Workers are in external files, they don't have access to
- window object
- document obj
- parent obj
#+BEGIN_EXAMPLE
var w;
if (typeof(Worker) !== "undefined") {
  if (typeof(w) == "undefined") {
    w = new Worker("demo_workers.js");
  }
  w.onmessage = function(e) {
    console.log(e.data);
  }
}
else {
  // Worker not supported
}

// demo_workers.js
var i=0;
function timedCount() {
  i= i +1;
  postMessage(i);
  setTimeout("timedCount()", 500);
}
timedCount();
#+END_EXAMPLE

* Javascript
** Loading Sequence
<script> tags without any attributes are downloaded together and executed immediately in order

- defer :: Works when src is defined. Download together, execute in order just before DOMContentLoaded
- async :: Works when src is defined. Download together, execute in any order they're downloaded
- async="false" :: Works when src is defined. Download together, execute in order as soon as all are downloaded

By default, all dynamically added scripts are async.

For example, if you want to load 2 javascript files and execute them in order but after they are all downloaded:
async="false" is needed.

#+BEGIN_EXAMPLE
[ '1.js',
  '2.js'
].forEach(function(src) {
  var script = document.createElement('script');
  script.src = src;
  script.async = false;
  document.head.appendChild(script);
});
#+END_EXAMPLE

** Initialization
<<<js:Initialization>>>
Always initialize variables at the top including vars in loops
var myObj = {},
    myString = "",
    myArray = [],
    myBoolean = false,
    myRegex = /()/,
    myNumber = 0;

These values are considered as false

** Variable Scope
*** Hoisting
<<<js:hoisting>>>. Refer to js:Function
Variables defined outside of any functions are Global.
Only function can create local scope. Without using var to declare variables, those variables are global.

#+BEGIN_EXAMPLE
myFunction();

function myFunction() {
  carName = "Volvo";
  // carName is actually global
  var carName2 = "Freightliner";
  // carName2 is not global
  // Local var takes precedence when it's used inside a function
  // the inner var shadows the outer.
}
// Alternative way to get global var
console.log(window.carName);
#+END_EXAMPLE

#+BEGIN_EXAMPLE
// function and variable declaration are moved to the top of their
// scope (global or local). It's called hoisting
// which allows you to use them before they are declared
// Functions are hoisted first and then variables
// Function declarations have priority over variable declarations, but not variable assignments

showState("one", {}, 2, 0.98); // output: Ready

// function declaration
// Pros :: Can be used before function is declared
// Cons :: Can't conditionally declare a function
function showState() {
  console.log("Ready");
  // arguments[0] is "one"
} 

// function expression/definition/assignment
// Pros :: Can conditionally define a function
// Cons :: Can't be used before it is defined 
var showState = function() {
  console.log("Idle");
};

showState(); // output: Idle

// The function that is assigned to a variable doesn't have to anonymous.

really.long.external.scoped.name = function shortcut(n) {
 // regression
 shortcut(n-1);
 // Pass it self as a callback
 someFunction(shortcut);
}

#+END_EXAMPLE

*** let, const, var
A variable is defined by var then this variable is available to the closest function scope.

Always js:Initialization for variables declared by var

let and const are /block-scoped/

let declares a variable which is available to the block it is enclosed in.
A block can be a switch, for, or if statement which has one pair of {}
You can only 'let' declare the same variable once in the same block.
The same variable can be let declaired inside a subblock and it will have new scope but not overwrite the upper scope variable.
let declared variable must be declared before it is used or referenced.
 
const is the same as let but it's read only. Uppercase naming.
The same const variable name can be redeclared to different value in sub block.
If const is an array or object, its child element or key/value is not protected by default.
Which means you can push to const arry or modify key/value.
const in the same block cannot be changed or redeclared or redeclared by let or var.

** Closure, Javascript Singleton
*** Syntax, When to use closure?

- When you don't want to change the variables in outer scope where the closure is in.
The outer scope can be global or any place where the closure is in.
- When you want to run the function later
- When you want to run the function later by providing just reference to other function
- When you want to run the function later by providing initial state
- When you want to do regression, don't want to affect outer scope and need more debugging

#+BEGIN_EXAMPLE
(function() {
  // Codes here runs immediately
})();
#+END_EXAMPLE

#+BEGIN_EXAMPLE
(function($) {
  // Use jQuery with the shortcut
  console.log($.browser);
  $(document).ready(function($) {
    // document ready
   }
  );
}(jQuery));

// Another form
jQuery(document).ready(function($) {
  // Use $ now
});
#+END_EXAMPLE

*** Singleton
<<<Javascript Singleton>>>

#+BEGIN_EXAMPLE
var Managers = {}; //namespace
// Singleton object CssManager
// Managers and singleton object CssManager has to be defined before they are used

Managers.CssManager = (function() {

// Private space in which all variables and methods are protected from the global scope
// Initialization of properties but it can't be instantialized.

var doc = document;
var setAttributes = function(element, attributes) {
  for (attribute in attributes) {
    element[attribute] = attributes[attribute];
  }
}
// Private space.

return {
  // Public members 
  addStyleSheet: function(id, url) {
    var newStyleSheet = document.createElement("link");
    setAttributes(newStyleSheet, {
      rel : "stylesheet",
      type: "text/css",
      id : id,
      href: url
    });
    document.getElementByTagName("head")[0].appendChild(newStyleSheet);
  },
  removeStyleSheet: function(id) {
    var currentStyleSheet = document.getElementById(id);
    if (currentStyleSheet) {
      currentStyleSheet.parentNode.removeChild(currentStyleSheet);
    }
  },
  swapStyleSheet: function(id, url) {
    this.removeStyleSheet(id);
    this.addStyleSheet(id, url);
  }
  // Public members
}
// return ends.

})();

#+END_EXAMPLE

*** Regression
This provides you more debugging info

#+BEGIN_EXAMPLE
var charsInBody = (function counter(elm) {
  // Notice :: this is not an anonymous function as we see before in a closure!
  if (elm.nodeType == 3) {
    return elm.nodeValue.length;
  }
  var count = 0;
  for (var i = 0, child; child = elm.childNodes[i]; i++) {
    count += counter(child);
  }
  return count;
})(document.body);
#+END_EXAMPLE

** Types, typeof, constructor
*** All types, typeof, constructor
| String    | js:String                                  |
| Number    | NaN is number. js:Number                   |
| Boolean   | true or false. Not FALSE/TRUE              |
| Object    | js:Array, js:Date, Object, null, js:RegExp |
|           | js:Math, js:Error                          |
| Function  | a special type of object js:Function       |
| Symbol    | new in Edition 6                           |
|           |                                            |
| undefined | undefined or has not been assigned a value |
| null      | a special type of object                   |

varname.constructor returns the constructor function.
*** Number
<<<js:Number>>>
Used: js:Math

*** String
<<<js:String>>>
s.length
s.charAt(s.length-1)
s.charCodeAt(s.length-1) :: UTF-16 code unit value
var myString = String.fromCharCode(65,66,67); // 'ABC'
s.indexOf("Paul"); // Case sensitive. Starts from the beginning
s.lastIndexOf("Paul"); // Case sensitive. Starts from the end
s.substr(0,4); // From start to 4th index
s.substring(0,4); // From start and take 4 characters
s.toLowerCase() s.toUpperCase();

*** Array
**** Basics
<<<JS:Array>>>
var a = new Array();
a[0] = "Paul";
a = ["P", "C", "S"]; // never put comma at the end of array
a[a.length-1] // last element
a[a.length]= "Z"; // append to last

**** If variable is array
#+BEGIN_EXAMPLE
console.log(Array.isArray(fruits)); // true or false
console.log(fruits instanceof Array) // true or false
#+END_EXAMPLE

**** array.pop(), array.shift(), array.push(), array.unshift()
a.pop(); // remove last element
a.shift(); // remove fist element
a.push("Z"); // add to the end of array. return new length
a[a.length]="Z"; // also append to last

a.unshift("Z"); // add to the beginning of array. return new length

**** array.concat()
var a = new Array("P", "C", "S");
var b = new Array(31,29,34);
a = a.concat(b); // Join arrays P, C, S, 31, 29, 34

**** array.slice()
var slice = a.slice(1,2); // C, S

**** array.splice(), remove a value from array if exists
var removed = a.splice(0,1,"Z","B"); // ["P"]
// First delete 1 element at index 0 and then add element Z and B 
// return the ones that are removed

Remove a value from array if it exists
var index = myArray.indexOf(item);
if (index !== -1) {
 myArray.splice(index, 1);
}

**** array.join(), array.toString(), array.valueOf()
var join = a.join(","); // "P,C,S"
a.toString() // also "P,C,S"
a.valueOf(); // also "P,C,S". Convert to primitive

**** array.sort(), array.reverse()
var sort = a.sort(); // sort as strings. case sensitive: C, P, S
function numericSort(anArray) {
 anArray.sort(function(a,b) {
  return a - b; // ascending order
  // return a.year - b.year; if it's an obj
});
 return anArray;
}

function randomSort(anArray) {
 anArray.sort(function(a, b) {return 0.5 - Math.random();});
 return anArray;
}

var reverse = a.reverse(); // S, C, P

**** array loop: for, array.forEach() 
for (var i = 0; i < fruits.length; i++) {
 fruits[i];
}

js:forEach
fruits.forEach(function(i) {
 console.log(i);
});

**** array.map(), array.filter() 
Do something while each item is iterated, join returned values into an array.
var result = a.map(function(i) { return i.toUpperCase(); }); // result is an array
console.log(a); // a is not affected!

a = a.filter(function(i) { 
   if ( true then remove condition ) { 
    return false; 
   }
   else {
    return true; // keep
   }
});

**** array.every(), array.some()
a.every(function(i) { return i[0] === "a"; }); // return true only if all returns are true
a.some(function(i)  { return i[0] === "a"; }); // return true if at least one return is true

**** array.reduce()
var sum = [0, 1, 2, 3].reduce(
 function(a,b) { return a=b; },
 0
);
// sum is integer 6

#+BEGIN_EXAMPLE
var flattened = [[0, 1], [2, 3], [4, 5]].reduce(
 function(a,b) { return a.concat(b); },
 []
);
// [0, 1, 2, 3, 4, 5]
#+END_EXAMPLE

array.reduce(callback[, initialValue])

If initialValue is provided, it will start at index 0. 
If not provided, it will start at index 1 and previousValue is the value at index 0 in the array.

callback has 4 arguments
- previousValue
- currentValue
- currentIndex
- array :: the input array was called upon

*** Date
<<<js:Date>>>
var date1 = new Date();
var date2 = new Date(77978); // milliseconds since 1970 01 01 GMT
var date3 = new Date(2017,0,31,15,35,20,20); // 2017 Jan 1 at 15:35:20 at 20 ms
var date4 = new Date("31 January 2016"); // "31 Jan 2016" "Jan 31 2016" "01-31-2016"

var dayofmonth = date4.getDate(); // setDate
var dayofweek = date4.getDau(); // int, Sunday as 0. You can't set day
var month = date4.getMonth(); // int, January as 0. setMonth
var fullyear = date4.getFullYear(); // 4 digits. setFullYear
var datestring = date4.toDateString(); // Current time zone. "Wed 31 Dec 2003"

var currentDay = date4.getDate();
date4.setDate(currentDay + 28 ); // Plus 28 days

getHours(), getMinutes(), getSeconds(), getMilliseconds(), toTimeString()
setHours(), setMinutes(), setSeconds(), setMilliseconds()

*** Math
<<<js:Math>>>
Math.PI
Math.abs(-101);
Math.ceil(101.01); // 102
Math.floor(101.01); // 101
Math.round(101.01);
Math.pow(10, 2); // 100
parseInt("10"); // 10

var itemCost = 9.99 * 1.075; // 10.73925
itemCost.toFixed(2); // 10.74
*** RegExp 
**** search(), replace(), match()
#+BEGIN_EXAMPLE
var s = "Visit W3Schools!";
var n = s.search("W3Schools"); // 6. -1 if not found
var all = s.match("i"); // return all matches
var res = s.replace(/w3schools/i, "Microsoft");
var res = s.replace("W3Schools", "Microsoft");
#+END_EXAMPLE

**** RegExp
***** Ways to define regex
<<<js:RegExp>>>
#+BEGIN_EXAMPLE
var n = s.search(/w3schools/i); // Use forward slash. Return the first matched index
var pattern = /w3schools/i; // Define a pattern in a variable

// Need to escape \ with \\
var patternobj = new RegExp('w3schools','i'); // Define a pattern as a RegExp object 
var patternobj = new RegExp(/w3schools/,'i');

// Test a pattern
pattern.test("Perform a test on this string"); // true or false

// Return the first found text
pattern.exec("Perform an exec on this string"); // null if not found.

// Index
every time pattern.exec() or pattern.test() is run, the pattern.lastIndex is advanced.
Until .lastIndex gets to 0

// Return all matches
s.match(pattern);
#+END_EXAMPLE
***** Pattern and modifiers
=/pattern/modifiers=

Modifiers
| i | case-insensitive |
| g | find all match   |
| m | multiline        |

Brackets
| [abc]  | a character that is a, b or c      |
| [^abc] | a character that is not a, b nor c |
| [0-9]  | a digit                            |
| [^0-9] | a non-digit character              |
|        |                                    |

(x|y) one of x or y

Metacharacter
| .      | a character execpt newline or line terminator  |
| \w     | a word character including _ [A-Za-z0-9_]      |
| \W     | a non-word character. same as [$\w]            |
| \d     | a digit                                        |
| \D     | a non-digit character                          |
| \s     | whitespace                                     |
| \S     | a non-space character                          |
| \b     | word boundary                                  |
| \0     | a NUL character                                |
| \n     | a new line character                           |
| \f     | a form feed character. e.g. page/section break |
| \r     | a carriage return                              |
| \t     | a tab character                                |
| \v     | a vertical tab character                       |
| \uxxxx | a Unicode character \u0057 is w                |
| \xxx   | \127 is w                                      |
| \xdd   | \x57 is w                                      |
|        |                                                |

Quantifier
| n+     | at least one of n                |
| n*     | zero or more                     |
| n?     | zero or one                      |
| n{X}   | \d{4} a 4-digit string           |
| n{X,Y} | \d{3,4} a 3-to-4-digit string    |
| n{X,}  | \d{3,} a at-least-3-digit string |
| n$     | at the end                       |
| ^n     | at the beginning                 |
| (?=n)  | non greedy match                 |

***** Word Boundary \b and \B
#+BEGIN_EXAMPLE
var s = "Visit W3Schools";
var pattern = /\bW3/g; // return words that start with W3
pattern.exec(s); // W3
var patter = /\bVisit\b/g; // whole word
var patterB = /\BSchools/g; // return "Schools". Words that do not start or end with Schools
#+END_EXAMPLE

***** Non greedy match (?=n)
#+BEGIN_EXAMPLE
var s = 'Is this all there is';
var p = /is(?= all)/g;
s.match(p); // is
// (?= all) matches any string that is before ' all':  but the matched is not returned.
// The other way to intepret it is find any 'is' that has ' all' right behind
var p = /is(?! all)/g; // Find any 'is' that doesn't have ' all' right behind
#+END_EXAMPLE

***** Match Tags
<<<regex:match_tags>>>

Match all tags
#+BEGIN_EXAMPLE
'<[^>]*>'
#+END_EXAMPLE

Match one tag only
#+BEGIN_EXAMPLE
'<img[^>]*>'
'<(img|/?div|br)[^>]*>'
#+END_EXAMPLE

*** Function
<<<js:Function>>> Refer to js:hoisting
**** arguments
function add() {
  var sum = 0;
  for (var i = 0, j = arguments.length; i < j; i++) {
    sum += arguments[i];
  }
  return sum;
}
add(2,3,4,5);

function add() {
  var sum = 0;
  for (var i = 0, j = arguments.length; i < j; i++) {
    sum += arguments[i];
  }
  return sum;
}

// Use Spread Syntax js:spread

function add(firstValue, ...args) {
  var sum = 0;
  for (let value of args) {
    sum += value;
  }
  sum += firstValue;
  return sum;
}

add(2,3,4,5);
**** .apply(), .call()
<<<js:Function.apply>>> <<<js:Function.call>>>
.apply() :: Pass arguments as an array to a function which accepts multiple arguments
.call() :: Pass arguments as arguments to a function which accepts multiple arguments

funct.apply(thisArg, [argsArray])

thisArg :: pass thisArg into funct as this in funct
argsArray :: array or array-like object

Pass no more than 65536 arguments/elements in array.

var numbers = [5,6,2,3,7];
var max = Math.max.apply(null, numbers); // Equivalent to Math.max(5,6, ...);
var max = Math.max.call(null, 5,6,2,3,7);

.apply() and .call() are used when the number of arguments passed to a method is unknown.
They are also used to call a method on a varible (obj or array) which doesn't has that method as its property. 
- Loop arrays which don't have .forEach() such as NodeList 

*** Error
<<<js:Error>>>
#+BEGIN_EXAMPLE
try {
 throw "Too big"; // Manually throw an error
 var err = new Error("Too big");
 throw err;
}
catch(err) {
 console.log(
  err.message, // Standard
  err.description, // Microsoft.
  err.number, // Microsoft. same as linenumber
  err.linenumber, // FF and Chrome
  err.name, // Standard. Initial is Error but you can change it
  err.stack // Not standard but works in all browsers.. Stack trace.
 );
}
finally {
 // success or failure, run this
}
#+END_EXAMPLE
*** Type Conversion
Javascript conversion is automatic. 
var y = "5";
var x = + y;

General methods:
String(x) or x.toString() // convert to string
Number(x) // convert to numbers

**** Number to String
x.toString();
x.toExponential(2); // 2 decimal points: 9.66e+0
x.toFixed(2); // 2 decimal points
x.toPrecision(); // total number of digits
 
**** String to Number
parseInt("10"); // 10
parseInt("10.33"); // 10
parseInt("10.53"); // 10
parseInt("10 20 30"); // 10
parseInt("10 years"); // 10
parseInt("year 10"); // NaN

The same for parseFloat.

Always provide a base number :: parseInt("10", 10); // decimal base
** Loops and Breaks
*** for, while, do...while
#+BEGIN_EXAMPLE
var cars = ['a', 'b', 'c'];
for (i = 0, len = cars.length, text = ""; i< len; i++) {
 // Loop through all properties of Array.prototype
 // 3rd party libraries or frameworks might add methods or properties to Array.prototype
 // So this is not recommended for looping an Array
}
for (; i<len; i++)

while () {
}

do {
}
while (condition);
#+END_EXAMPLE

*** for...in
<<<js:for...in>>>
#+BEGIN_EXAMPLE
var myObj = {};
for (var prop in myObj) {
 console.log(myObj[prop]);
}
#+END_EXAMPLE

*** for...of
<<<js:for...of>>>
js:for...in interates over all enumerable properties of an object.
While for...of iterates over elements of any collection that has a [Symbo.iterator] property.

for...of interates over iterable objects :: Array, Map, Set, String, TypedArray, arguments but not objects!

for (let value of iterable) {
 console.log(value);
}

*** forEach
<<<js:forEach>>>

array.forEach(callback[, thisArg])

thisArg :: Pass a variable outside of .forEach() and change it inside .forEach() using /this/

callback :: 3 arguments
- currentValue
- index
- array

Return :: undefined. So .forEach() is not chainable

Elements appended after the call to forEach() begins will not be visited.
The value of element is changed before forEach() visits, it will reflect the change.
Elements removed before being visited will not be visited.

*** break and continue
=break= without a label reference, can only jump out of a loop or a switch
=continue= with or without a label, can only skip one loop iteration.
With a label reference, =break= can jump out of any code block.
A code block is a block of code between { and }
#+BEGIN_EXAMPLE
list: {
 text += cars[0] +  "<br>";
 text += cars[1] +  "<br>";
 break list;
 text += cars[3] +  "<br>";
}
#+END_EXAMPLE
** Enumerable
By default, all methods and properties are enumerable in js:for...in
To make a method non enumerable
#+BEGIN_EXAMPLE
// CustomerBooking class and its method setFilm is already defined
Object.defineProperty(Customerbooking.prototype,'setFilm',
{enumerable:false});
#+END_EXAMPLE

** JSONP, JSON
*** JSONP
#+BEGIN_EXAMPLE
<script type="text/javascript" src="http://b.com/returnjsondata?callback=mycallback"></script>

Where b.com/returnjsondata returns a json object. 
And the whole <script> in yourwebsite.com will become 
mycallback({foo:'bar'});
#+END_EXAMPLE

*** JSON
JSON object names require double quotes.
String are wrapped in double quotes.
Boolean is true or false.
null can be used.
MIME type: application/json

var obj = JSON.parse(jsonString); // parse a json string
** URI and URI Component Encode
#+BEGIN_EXAMPLE
var url1 = "http://abc.com";
var url2 = "http://xyz.com/test.php?url=" + encodeURIComponent(url1);
// decodeURIComponent();

// When you want a working URL as a whole with URL parameters
var uri = "http://abc.com/folder name with space/file name with space.asp?abc=has space"
var uri_en = encodeURI(uri);
// decodeURI(str)
#+END_EXAMPLE

** Class
By default, all properties and methods are enumerable in js:for...in

#+BEGIN_EXAMPLE
function CustomerBooking(bookingId, customerName, film, showDate) {
/* This is a constructor. It is not a good way to define property
 * Better to use methods to set. But here should provide initialization
*/
  this.customerName = customerName;
  this.bookingId = bookingId;
  this.showDate = showDate;
  this.film = film;
// You can also call a method which is defined later to initialize properties.
}

CustomerBooking.prototype.getCustomerName = function() {
 return this.customerName;
}

CustomerBooking.prototype.setFilm = function(film) {
 this.film = film;
}

// Instantiate
var firstBooking = new CustomerBooking(1234,
 "Arnold Palmer", "Toy Story", "27 July 2004 20:15");

var enumerated = [];
for (var prop in firstBooking) {
 enumerated[enumerated.length] = prop;
}
// ["customerName","bookingId", "showDate", "film", "getCustomerName", ..., "setFilm"]

// A cinema can hold multiple CustomerBooking instances
function cinema() {
 this.bookings = new Array();
}

cinema.prototype.addBooking = function(bookingId, customerName, film, showDate) {
 this.bookings[bookingId] = new CustomerBooking(bookingId, customerName, film, showDate);
}

// Loop through bookings of a cinema
cinema.prototype.getBookingsTable = function() {
 var booking;
 var bookingsTableHTML = "<table border=1>";
 for (booking in this.bookings) {
  bookingsTable += this.bookings[booking].getBookdingId();
  ...
 }
 bookingsTableHTML += "</table>";
 return bookingsTableHTML;
}

var londonOdeon = new cinema(); // Constructor takes no parameters
londonOdeon.addBooking(342, "First Last", "Toy Story", "15 July 2004 20:15");
#+END_EXAMPLE

** Extending Native Object
Native prototype can't be deleted or replaced
But values of its properties can be modified or created

Create a new method in Array class which removes a member after checking if the method is already defined

#+BEGIN_EXAMPLE
Array.prototype.remove = Array.prototype.remove || function(member) {
 var i = this.indexOf(member);
 if (i > -1) {
  this.splice(index,1);
 } 
 return this;
}

// If a method (remove) is created in native class, but later it was assigned as a property
// error will show 
#+END_EXAMPLE

Newly added remove method is enumerable in js:for...in
To filter out method in js:for...in
#+BEGIN_EXAMPLE
var props = [];
for (var prop in results) {
 results.hasOwnProperty(prop) && props.push(prop);
}
#+END_EXAMPLE

<<<Add "method" in Function class>>>
Then "method" exists in any function.
#+BEGIN_EXAMPLE
Function.prototype.method = function(name, func) {
 this.prototype[name] = func;
 return this;
}

// Parenizor is a custom class. Create a method called 'setValue'
Parenizor.method('setValue', function(v) {
 this.value = value;
 return this;
});
#+END_EXAMPLE

<<<Add "inherits" in Function class>>>
#+BEGIN_EXAMPLE
Function.method('inherits', function(parent) {
 // parent is a class that is already defined
 // make a new instance
 this.prototype = new parent();
 var d = {},
     p = this.prototype;
 this.prototype.constructor = parent;
 this.method('uber', function uber(name) {
  if (!(name in d)) {
   d[name] = 0;
  } 
  var f, r, t = d[name], v = parent.prototype;
  if (t) {
   while (t) {
    v = v .contructor.prototype;
    t -= 1;
   }
   f= v[name];
  }
  else {
   f = p[name];
   if (f == this[name]) {
    f = v[name];
   }
  }
  d[name] +=1;
  r = f.apply(this, Array.prototype.slice.apply(arguments, [1]));
  d[name] -=1;
  return r;
 });
 return this;
});
#+END_EXAMPLE

** Classical Inheritance, Parasitic Inheritance
Classical inheritance is about the _is-a_ relationship.
Parasitic inheritance is about the _was-a-but-now's-a_ relationship.

*** Classical inheritance
Refer to: Add "method" in Function class, Add "inherits" in Function class

#+BEGIN_EXAMPLE
function Parenizor(v) {
// enclose v with ( and )
 this.setValue(v);
}

Parenizor.prototype = {
  constructor: Parenizor, // This line is crucial as we are overwriting Parenizor.prototype rather than adding
  setValue: function(v) {
    this.value = v;
    return this;
  },
  getValue: function() {
    return this.value;
  },
  toString: function() {
    return '(' + this.getValue() + ')';
  }
};

myParenizor = new Parenizor(0); 
myString = myParenizor.toString(); // "(0)"

// Subclass inherits parent class Parenizor
function ZParenizor(v, w) {
 Parenizor.call(this, v); // call parent class parenizor constructor
 // You can also call other parent class constructor
 // OtherParenizor.call(this, v);

 // Define other properties that this subclass should have
 this.otherValue = w;
}

ZParenizor.prototype = Object.create(Parenizor.prototype); 
// Inherits parent class's all methods. 
// First create an instance of the parent class and assign it to the child class.

// Inherits other parent class's all methods
// mixin(ZParenizor.prototype, OtherParenizor.prototype);

ZParenizor.prototype.constructor = ZParenizor; 
// Set subclass constructor
// Because all ZParenizor.prototype.* were copied from Parenizor.prototype.*, 
// but ZParenizor should have its own constructor which is ZParenizor.prototype.constructor.

// Modify subclass's inherited method toString 

ZParenizor.prototype.toString = function() {
  // ...
}

var zParenizor = new ZParenizor('v', 'w');

console.log(zParenizor instanceof ZParenizor); // true
console.log(zParenizor instanceof Parenizor); // true
#+END_EXAMPLE

** Promise
Promise is now native in all browsers including Edge except IE.

#+BEGIN_EXAMPLE
function get(url) {
  // You should wrap all code into return
  return new Promise(function (resolve, reject) {
    // run resolve or reject function to resolve or reject a promise
    var req = new XMLHttpRequest();
    req.open('GET', url); // it can be set to async

    req.onload = function () {
      if (req.status == 200) {
        resolve(req.response);
      }
      else {
        reject(Error(req.statusText));
      }
    };

    req.onerror = function () {
      reject(Error("Network Error"));
    }

  });
}

get('story.json')
  .then(function (response) {
    console.log('Success!', response);
    // transform a value to the next .then
    // just return the value, you may modify it
    // The returned value has to be a non-promise
    return JSON.parse(response);
  }, function (error) {
    console.log('Failed!', error);
    return error;
  })
  .then(function (response) {
    console.log('JSON!', response);
  });

// If a 'then' just returns a value when it's resolved, use a shortform
get('story.json').then(JSON.parse).then(function(response) {
  console.log('JSON!', response);
});

// In 'then', you can return a promise
// a promise.then is a promise

function getJSON(url) {
  return get(url).then(JSON.parse);
}

getJSON('story.json').then(function(story) {
  return getJSON(story.chapterUrls[0]);
}).then(function(chapter1) {
  console.log('Got Chapter 1', chapter1);
});

// Store the result of a promise and reuse it
var storyPromise;

function getChapter(i) {
  storyPromise = storyPromise || getJSON('story.json');

  return storyPromise.then(function(story) {
    return getJSON(story.chapterUrls[i]);
  });
}

getChapter(0).then(function(chapter) {
  console.log(chapter);
  return getChapter(1);
}).then(function(chapter) {
  console.log(chapter);
});

// .catch(function(e) { ... }) equals to
// .then(undefined, function(e) { ... })

// Dynamically chained .then()
// Start with a resolved promise: Promise.resolve('initialValue')
// a reject promise: Promise.reject('initialValue')
getJSON('story.json')
  .then(function(story) {
    // addHTMLToPage(story.heading);
    return story.chapterUrls.reduce(function(sequence, chapterUrl) {
      return sequence
        .then(function() { return getJSON(chapterUrl); })
        .then(function(chapter) { /* addHtmlToPage(chapter.html); */ });
    }, Promise.resolve());
  })
  .then(function() { /* addTextToPage("All done"); */ })
  .catch(function(err) { /* addTextToPage("broken" + err.message); */ })
  .then(function() { /* document.querySelector('.spinner').style.display='none'; */ });

// Start a set of promises in parallel and create a promise that fulfils when all are fulfilled
getJSON('story.json')
  .then(function(story) {
    // addHTMLToPage(story.heading);
    return Promise.all(
      story.chapterUrls.map(getJSON)
    ); // not a callback. It's an array of Promises (not chained)
    // After promises are added to array as values, they are started already

    // Start a set of promises in parallel, chain them so that we get response in order

    return story.chapterUrls.map(getJSON)
      .reduce(function (sequence, chapterPromise) {

        return sequence
          .then(function () {
            return chapterPromise;
          })
          .then(function (chapter) {
            addHtmlToPage(chapter.html);
          });

      }, Promise.resolve());


  })
  .then(function() { /* ... */ })
  .catch(function(err) { /* ... */ })
  .then(function() { /* ... */ });
#+END_EXAMPLE

** Worker
IE 10 and above supports worker.
Workers are independent and separated from parent window. 
Don't try to access or modify parent window DOM. Do it indirectly.
#+BEGIN_EXAMPLE
var w;

if (typeof(Worker) !== "undefined") {
 if (typeof(w) == "undefined") {
  w = new Worker("demo_workers.js");
 }
 // Receive message from worker
 w.onmessage = function(event) {
  console.log(event.data);
 }
 
 w.onerror = function(error) {
  console.log(error.message, error.filename, error.lineno);
 }

 // Send message to worker
 w.postMessage(['First Name', 'Last Name']);
}

w.terminate();
w = undefined;

// demo_workers.js
var i = 0;

function timedCount() {
 i = i + 1;
 postMessage(i);
 setTimeout("timeCount()", 500);
}

close(); // Worker can close itself

// This is how worker receives a message
onmessage = function(e) {
  console.log("Message receved by worker from main window");
  var workerResult = 'Result: ' + (e.data[0] * e.data[1]);
  console.log('Posting message back to main window');
  postMessage(workerResult);
}

// Workers can spawn or create subworkers. URIs of subwokers are resolved relative to
// the parent worker's location rather than that of the owning page.

// Worker can load scripts within the same domain
// Scripts are loaded and executed in order.
importScripts('foo.js');
importScripts('foo.js','bar.js');

// Spawn a shared worker. IE doesn't support sharedWorker
// Worker Square and Worker Multiply2Numbers both use shared worker Multiply
// In sqaure.js and multiply2numbers.js

if (!!window.SharedWorker) {
 var sharedWorker = new SharedWorker("multiply.js");
 sharedWorker.port.postMessage([123,123]); // square.js
 sharedWorker.port.postMessage([123,789]); // multiply2numbers.js

 sharedWorker.port.start(); // Only needed in parent thread if onmessage is not defined
 // such as the shares worker is a callback of event listener in parent thread
 
 sharedWorker.port.onmessage = function(e) {
  //
  console.log(e.data); // receive from shared worker
 }
}

// In multiply.js shared worker
port.start(); // only needed if onmessage is not defined in parent thread

onconnect = function(e) {
 var port = e.ports[0];
 
 port.onmessage = function(e) {
  var workerResult = 'Result: ' + (e.data[0] * e.data[1]);
  port.postMessage(workerResult);
 }
}
#+END_EXAMPLE

** XMLHttpRequest
<<<XMLHttpRequest>>>
#+BEGIN_EXAMPLE
function loadDoc() {
 var xhttp = new XMLHttpRequest();

 // event handlers. Others: onloadstart, onprgress, onabort, onerror, onload, ontimeout, onloadend
 // Always use onload instead of onreadystatechange
 // onload = onreadystatechange and this.readyState ==4
 
 // XHR property: readyState
 // 0: request not initialized, 
 // 1: connection established
 // 2: request received, 
 // 3: processing request
 // 4: request finished and response is ready 
 
 xhttp.onload = function() {
  if (this.status == 200) {
   console.log(
      this.responseText // as text
    , this.responseXML // as it's XML data
    , this.statusText // "OK" or "Not Found"
   );
    
    console.log(xhttp.getAllResponseHeaders());
    xhttp.getResponseHeader("Last-Modified");

  } 
 };

 xhttp.open('GET', 'ajax_info.txt'
 , true // async
 , "username" // optional
 , "psw" // optional
 );

 xhttp.setRequestHeader(); // set request header. Especially if 'POST' form fields
 /* For POST
  * xhttp.setRequestHeader("Content-type",'application/x-www-form-urlencoded');
  */

 // For receiving a binary string
 // xhttp.overrideMimeType("text/plain; charset=x-user-defined");

 xhttp.send(); // Nothing when 'GET'
 /* For POST
  * xhttp.send("fname=Henry&lname=Ford");
  */
 
 // binary data can be sent
 /* var blob = new Blob(['abc123'], {type: 'text/plain'});
  * xhttp.send(blob);
  * var myArray = new ArrayBuffer(512);
  * var longInt8View = new Uint8Array(myArray);
  * for (var i=0; i< longInt8View.length; i++) {
  *  longInt8View[i] = i % 255;
  * }
  * xhttp.send(myArray);
  */ 
}
#+END_EXAMPLE

*** Receive binary as arraybuffer or blob
#+BEGIN_EXAMPLE
var oReq = new XMLHttpRequest();
oReq.open("GET", "/myfile.png", true);
oReq.responseType = "arraybuffer";

oReq.onload = funciton(event) {
 var arrayBuffer = oReq.response; // not .responseText
 if (arrayBuffer) {
  // Read arraybuffer
  var byteArray = new Uint8Array(arrayBuffer);
  for (var i=0; i < byteArra.byteLength; i++) {
   // do something
  }
  // Read arraybuffer.

  // Construct a blob from arraybuffer
  var blob = new Blob( [arrayBuffer], {type: "image/png"} ); 

 }
};

oReq.send();
#+END_EXAMPLE

Specify the received data is blob
#+BEGIN_EXAMPLE
var oReq = new XMLHttpRequest();
oReg.open("GET", "/myfile.png", true);
oReq.responseType = "blob";

oReq.onload = function(e) {
 var blob = oReq.response;
}

oReq.send();
#+END_EXAMPLE

** Apply XSLT on XML
#+BEGIN_EXAMPLE
function loadXMLDoc(filename) {
 var xhttp = new XMLHttpRequest();
 xhttp.open("GET", filename, false);
 try {
  xhttp.responseType = "msxml-document";
 }
 catch(err) {}
 xhttp.send();
 return xhttp.responseXML;
}

var xml = loadXMLDoc('cdcatalog.xml');
var xsl = loadXMLDoc('cdcatalog.xsl');

var xsltProcessor = new XSLTProcessor();
xsltProcesser.importStylesheet(xsl);
resultDocument = xsltProcesser.transformToFragment(xml, document);
document.getElementById("example").appendChild(resultDocument);

#+END_EXAMPLE

** Apply XPath
#+BEGIN_EXAMPLE
var x=loadXMLDoc("books.xml");
var xml = x.responseXML;
path = "/bookstore/book[1]/title";

var nodes = xml.evaluate(path, xml, 
null, // namespaceResolver
XPathResult.ANY_TYPE, // resultType
null // If an existing XPathResult object is specified, it will be reused
); // Return xpathResult object 
var result = nodes.iterateNext();

while (result) {
 console.log(result.childNodes[0].nodeValue);
 result = nodes.iterateNext();
} 

#+END_EXAMPLE

** WebSocket
#+BEGIN_EXAMPLE
var connection = new WebSocket('ws://abc.com/echo', ['soap', 'xmpp']);
// ['soap', 'xmpp'] are subprotocols

// When connection is open, send some data
connection.onopen = function() {
 connection.send('Ping'); // send string
};

// Send ArrayBuffer as binary
var img = canvas_context.getImageData(0, 0,400, 320);
var binary = new Unit8Array(img.data.length);
for (var i = 0; i < img.data.length; i++) {
 binary[i] = img.data[i];
}
connection.send(binary.buffer);

// Send file as Blob
var file = document.querySelector('input[type="file"]').files[0];
connection.send(file);


connection.onerror = function(error) {
 console.log('WebSocket Error ' + error);
};

connection.onmessage = function(e) {
 console.log(e.data);
};

// Define binary type before onmessage to receive binary
connection.binaryType = 'arraybuffer'; // or blob
connection.onmessage = function(e) {
 console.log(e.data.byteLength);
};

#+END_EXAMPLE

** Mutation Observer
<<<js:MutationObserver>>>
[[https://developer.mozilla.org/en/docs/Web/API/MutationObserver][MDN MutationObserver]]
[[https://developer.mozilla.org/en-US/docs/Web/API/MutationRecord][MDN MutationRecord]]

#+BEGIN_EXAMPLE
MutationObserver = window.MutationObserver;

// callback function has 2 arguments
// mutations: an array of objects of type MutationRecord
// observer: this MutationObserver instance
var observer = new MutationObserver(function (mutations, observer) {
  mutations.forEach(function (mutation) {

    // A MutationRecord has properties
    // Some of them might be different based on MutationObserver's options

    // Loop addedNodes
    // addedNodes return NodeList which doesn't have .forEach
    // js:Function.call
    Array.prototype.forEach.call(
      mutation.addedNodes,
      function (addedNode) {
        if (addedNode.id == "bar") {
          console.log("bar was added!");
        }
      });
  });
});

// Define the parent element
var target = document.getElementById('foo');
// Or $('#foo').get(0)

// Which event should be observed
var config = {
  attributes: true,
  attributeOldValue: true, // set to true if attributes is set to true
  attributeFilter: true, // filter out an array of attribute local names in observation
  childList: true, // add/remove child elements including text nodes
  subtree: true, // any change to the subtree including all descendants
  characterData: true, // maybe image or multimedia changes?
  characterDataOldValue: true
};

observer.observe(target, config);

// You may stop observing later
observer.disconnect();
#+END_EXAMPLE

** Testing
*** Unit Testing
QUnit

** Communication Between Children Window and Parent Window
A parent window can have multiple iframes and iframes are loaded from other domain.

#+BEGIN_EXAMPLE
// In iframe
parent.postMessage('the message');

// In parent window
function receiveMessage(event) {
 if (event.origin !== 'http://otherdomain.com') return;
 console.log(event.data);
}
window.addEventListener("message", receiveMessage, false);
#+END_EXAMPLE

** Dynamic iframe height
#+BEGIN_EXAMPLE
<iframe id="preview_iframe" style="width:100%"
        onload="resize_iframe(this)"
        srcdoc="<?php echo str_replace('"', '&quot;', $html);?>"
>
</iframe>
<script>
function resize_iframe(iframe) {
  iframe.height= iframe.contentWindow.document.body.scrollHeight + 'px';
}
</script>
#+END_EXAMPLE

** CSS Media Viewport Size
=var w = Math.max(window.innerWidth || 0, document.documentElement.clientWidth)=
=var h = Math.max(window.innerHeight || 0, document.documentElement.clientHeight)=

* jQuery
** Ajax
$.get(url[, data] [, success], [, dataType] )
$.post(url[, data] [, success], [, dataType] )
#+BEGIN_EXAMPLE
$.ajax({
 method: 'POST', // Default: GET
// Prior to 1.9.0, use type instead of method
 url: "some.php", // Default current page
 data: { name: "a", location: "Boston" } // Data send to server. Converted as URL parameters
// if data is not key/value pairs, change processData to false
 processData: true, 
// If data is not key/value pairs (object), say it's a DOMDocument, change it to false

 contentType: 'applicaton/x-www-form-urlencoded;charset=UTF-8', // Default. MIME type

 dataType: "json", // Default is not setting anything. MIME type of response
// > v1.5, this option can convert response to the MIME types you want
// "json xml" :: first it will try to convert to json. if failed, convert ot xml
// "script" :: the response is javascript, and it will be run afer it's received.

// cross domain should be automatically handled
// crossDomain: default false for same-domain requests, true for cross-domain requests

 context: document.body, // provide context for callbacks. If not set, this referrence
// in callbacks is the Ajax request settings

 cache: true, // You can only change cache for HEAD and GET requests.
 
 headers: {}, // Default. Add (or add to overwrite) request header

// Callback options
 beforeSend: function(jqXHR, settings) {
  // Modify jqXHR object before it is sent.
  // e.g. request header
  // For receiving binary string (image or any binary data)
  // jqXHR.overrideMimeType("text/plain; charset=x-user-defined");
 },
 error: function(jqXHR, textStatus, errorThrown) {
  // if request fails.
 },
 dataFilter: function( data, type) {
  // raw response data
  // dataType option
  // You should sanitize the data here so to match the dataType option
 },
 success: function( data, textStatus, jqXHR ) {
 }, 
 complete: function( jqXHR, textStatus) {}

})
/* Promise callbacks: .done, .fail, .always. In those callbacks, 
`this` reference is the `context` in the request. If `context` was not set, `this` 
will be the Ajax setting.
You can add multiple promise callbacks.
*/
.done(function(data, textStatus, jqXHRmsg) {
// .success() will be deprecated in v3.0


})
.fail(function(jqXHR, textStatus, errorThrown) {
// .error() will be deprecated in v3.0
})
.always(function(data|jqXHR, textStatus, jqXHR|errorThrown) {
// .complete() will be dprecated in v3.0

});
#+END_EXAMPLE

** <<<jQuery Selectors>>>
You can use all CSS Selectors

http://api.jquery.com/category/selectors/

** iFrame refer to parent
#+BEGIN_EXAMPLE
var parentVideoDiv = parent.jQuery('#videoplayer').parent('.the-content');
#+END_EXAMPLE

** Get parent element, sibling
#+BEGIN_EXAMPLE
var parentDiv = jQuery('#videoplayer').parent('.content');
var siblingDiv = parentDiv.prev(); // preceding sibling
#+END_EXAMPLE

** Replace class
#+BEGIN_EXAMPLE
parentDiv.removeClass('col-md-9').addClass('col-md-12');
#+END_EXAMPLE

** Find inside an element
#+BEGIN_EXAMPLE
siblingDiv.find(".panel.panel-default");
#+END_EXAMPLE

** Move element
#+BEGIN_EXAMPLE
/* Before
.siblingDiv
.parentDiv
*/
siblingDiv.insertAfter(parentDiv);
/* After
.parentDiv
.siblingDiv
*/
#+END_EXAMPLE

** Form
*** serialize
Checkboxes and radio buttons are included only if they're checked.
All seriailized form field elements must have name attribute.

#+BEGIN_EXAMPLE
$("#form_id").on("submit", function(e) {
 event.preventDefault();
 console.log($(this).serialize());
});
#+END_EXAMPLE

*** Disabled Field
Disabled fields are not editable, selectable, copyable and they are not submitted.
In order to select and copy value of a disabled field, you need to enable it when mouseover and disable it
when mouseout.

Can't register events directly on disabled fields. Events can be registered on its parent

#+BEGIN_EXAMPLE
$('.parent_container')
  .mouseover(function() { $(this).find('textarea').prop('disabled',false)})
  .mouseout(function() { $(this).find('textarea').prop('disabled',true)});
#+END_EXAMPLE

** Animate
*** Scroll
#+BEGIN_EXAMPLE
$("html,body").animate({ 
 scrollTop: $("[ng-controller=aController]").offset().top - 100 
});
#+END_EXAMPLE

* SEO
** Google Analytics
Under Admin, you can build Views. Views can have Filters. Views collect data.
Changes on Views and Filters will affect future data only.

Under Views, there're a lot of reports. Apply Segments to reports to filter out data 
without destroying Views data.
*** Too Many Self-referrals
Reporting > Acquisition > All Traffic > Referrals, you will find the website's url is the source
And the percentage is high compared to other Referral Sources.
3 reasons:
1. Users sessions idle for 30 minutes and become active. This should be < 10% of traffic
2. Cross domain (need to bring it down to 0 self-referral)
3. A lot of traffic and sessions are created by spammers to a landing page 
(most likely homepage with url parameters)  with a fake referral path as the website.

Click on the website URL (referral source), you will see Referral Path (that's From traffic)
Add secondary dimension "Full Referrer" to see the referrer's domain and full path.

Since self-referrals can be faked and real self-referrals should be small amount, you can filter out
self-referrals in GA.

Go to Admin > Account > Property > Tracking Info > Referral Exclusion List > add domain
abc.com also matches www.abc.com because domain name CONTAINS

You cannot use View Filter to filter out referral domain...

You can also create a segment without affecting the data. 
Conditions > Filter: Sessions, Exclude > Source / Medium > contains > OHG.com / referral

* Linux
** System Version, Distro

| =uanme -a=           | all info     |
| =uname -r=           | Kernal       |
|                      |              |
| =cat /etc/*-release= | Linux distro |
| =cat /etc/issue=     |              |
| =cat /proc/version=  |              |
| =lsb_release -a=     | Ubuntu only  |
|                      |              |

** User Management & Superuser
=sudo adduser corey=
=sudo deluser corey=
List all users =cut -d: -f1 /etc/passwd` or `cat /etc/passwd=
- Login username
- Password (always x)
- UID (<500 are system accounts, > 500 are users)
- Group ID (GID)
- Comment field
- Location of HOME directory
- Default shell for the user

Switch to superuser 
- Debian =sudo su=
- RedHat =sudo -=

** System 
Resource Limits
=sudoedit /etc/security/limits.conf=

System Logs
| /var/log/syslog   | general system log                         |
| /var/log/auth.log | system auth logs                           |
| /var/log/mail.log | system mail logs                           |
| /var/log/messages | general log messages                       |
| /var/log/dmesg    | kernel ring buffer msg, e.g. system bootup |
|                   |                                            |

Search a word `warthog` in .gz files
=zgrep -i warthog /var/log/*.gz= 

** Filesystem
*** /dev /mnt /media
=/dev/sd*1= :: sd for SATA or SCSI drive, numeric 1 for partition, * for a, b, etc.
=/dev/hd*1= :: hd for IDE drive, * for a, b, etc.
=/media/win1=
 - virtual directory  where files are accessed file here. 
 - Equivalent to d:\. One or more partitions can be assigned to one media

=sudo mkdir /media/win2= :: create a virtual directory is easy
=sudo mkdir /mnt/my_mount= :: also creates a virtual directory

=sudo mount -t ext4 /dev/sda1 /mnt/my_mount= :: Mount a partitioned device to a virtual directory
=sudo gedit /etc/fstab=
, =/dev/hdb1 media/win1 vfat users,rw,owner,umask=000 0 0=
, then reload =sudo mount -a=
- Permanently mount during bootime

*** /etc system configuration files
*** Disk space
| =df -h=      | Disk usage on OS                  |
|              | h for human-readable.             |
| =du -sh=     | Current folder size               |
| =du -sh ./*= | Only 1st level child folders size |
|              |                                   |

** Processes
| =ps -ef=                   | List of running processes      |
| =sudo ls -l /proc/PID/exe= | file path for command, sub PID |
|                            |                                |

*** =top=
First line: current time, system up time, number of users logged in, load average (1, 5, 15 minutes; >2 is busy). 
Second line: total processes: running, sleeping, stopped and zombie (have finished but parent process hasn't responded)

Third line: CPU utilization: us (user), sy (system), ni (nice: time running niced user processes), wa (time waiting for I/O completion), hi (time spent servicing hardware interrupts), si (software interrupts), st (stolen from this vm by the hypervisor)

Memory usage
	- Line 1 reflects physical memory: total, used, free and buffers
	- Line 2 reflects virtual memory: total, used, free and cached 

Detailed for each process
| PID  | The process ID of the process             |
| USER | The user name of the owner of the process |
| PR   | The priority of the process               |
| NI   | The nice value of the process             |
	- NI: The nice value of the process
	- VIRT: The total amount of virtual memory used by the process
	- RES: The amount of physical memory the process is using
	- SHR: The amount of memory the process is sharing with other processes
	- S: The process status (D = interruptible sleep, R = running, S = sleeping, T = traced
	- or stopped, or Z = zombie)
	- %CPU: The share of CPU time that the process is using
	- %MEM: The share of available physical memory the process is using
	- TIME+: The total CPU time the process has used since starting
	- COMMAND: The command line name of the process (program started)


Type `f` for interaction: set sort, display more fields/columns

*** Memory
Total memory: =grep MemTotal /proc/meminfo=
Memory usage: =free -ltm -s 1=
Delay 1 second: =-s 1=
=-m=: in megabyte. e.g. -g
=-t=: show Total
=-l=: show Low and High

** Network
All active NIC and IP addresses: =ifconfig=
All enabled and disabled NIC: =ifconfig -a=
View one NIC (interface): =ifconfig eth0=

Ethernet interface: eth0, eth1
Wireless network interface: wlan0, wlan1
Loopback interface for system internal communication: =lo=

*** Port
If a port is in use =telnet localhost 9000=, if it's connected, it's in use.
List all ports in use: =netstat -lp= or =netstat -nlp= to list in numeric form.
Search a port =netstat -nlp | grep 8000=
Which file is using the port =lsof | grep 9000=
Wireless network adapters =iwconfig=

*** CIDR Netmask (Network Mask)
CIDR netmask
- 10.0.75.5/24 = 10.0.75.5 AND 255.255.255.0 = 10.0.75.0 
	(10.0.75.5 is in the 10.0.75.0 subnet)
- 10.0.75.5/32 = 10.0.75.5 AND 255.255.255.255 = 10.0.75.5 (a single host)
- 10.0.75.5/16 = 10.0.75.5 AND 255.255.0.0     = 10.0.0.0
- 10.0.75.5/8  = 10.0.75.5 AND 255.0.0.0       = 10.0.0.0

Private IPv4 address spaces
- 10.0.0.0 - 10.255.255.255 = 10.0.0.0/8 (16 million number of addresses)
- 172.16.0.0 - 172.31.255.255 = 172.16.0.0/12 (255.240.0.0) (1 million number of addresses)
- 192.168.0.0 - 192.168.255.255 = 192.168.0.0/16 (65,536 number of addresses)

** Hardware
PCI devices: =lspci=
USB devices: =lsusb=
Most of devices: =lshal=

** Package & Repository
=cat /etc/apt/sources.list=

Repositories
- Main
- Universe: maintained by Ubuntu community
- Backports: newest version of pkg
- Multiverse: not free pkg
- Restricted: hardware drivers etc.

*** Package Management
**** =dpkg= lowest level
List installed packages: =dpkg -l= 
How to read dpkg output
- First 3 columns show Desired action, Package status and Error flags
- Desired action
  - unknown (u), install (i), hold (h), remove ( r ), purge (p)
- Package Status
  - Not-installed	`n`
  - Config-files	`c`
  - Half-installed	H
  - Unpacked	U
  - Half-configured	F
  - Triggers-awaiting	W
  - Triggers-pending	`t`
  - Installed	`i`
- Error flags
  - <empty> = (none), R = Reinst-required

If a package is installed: =dpkg -l wget=
Search if a package is installed: =dpkg -l | grep wget= or ~dpkg -l 'wget*'~

List files owned by a package =dpkg -L cron=

Find which package owns a file =dpkg -S /etc/crontab=

**** =apt-get= =apt-cache=
Search package by name or title and read installation status: =apt-cache search php=
- Before each package name, if you see `i` the package is installed
- `v` the package is virtual (installed)
- `c` the package is deleted but not configuration files
- `p`, no trace at all or `v`, it's not installed.
- There might be a second character which indicates the action to be performed on the package.

Find out dependencies: =apt-cache showpkg php5-xmlrpc=
- Other packages must be installed before php5-xmlrpc (under Dependencies)
- Other packages depend on php5-xmlrpc (under Reverse Depends)
- Different versions of this package you can install (under Provides)

**** =aptitude= Highest Level
It removes orphan packages automatically

** Input and Output
*** File Descriptors
File descriptors. First 3 are reserved.
| 0 | STDIN  | Standard input         |
| 1 | STDOUT | Standard output (echo) |
| 2 | STDERR | Standard error         |

#+BEGIN_EXAMPLE
# Redirect stdout, creates if not exist or overwrites a file
ls -al goodfile > stdoutlogfile
# same as 2>, 3> etc.

# Redirect stdout, creates if not exist or appends to a file
ls -al goodfile >> stdoutlogfile
# same as &>>, 2>>, 3>> etc.

# Redirect stderr
ls -al badfile 2> errorlogfile

# Redirect stdout and stderr to different files
ls -al goodfile badfile 2> errorlogfile 1> normalOutput

# Redirect stdout and stderr to the same file
ls -al goodfile badfile &> errorAndOutput
#+END_EXAMPLE

<<<bash:tee>>>

#+BEGIN_EXAMPLE
# Redirect stdout of a commannd to a file and display stdout
date | tee testfile

# Redirect stdout to a file and pass stdout to another command as stdin
date | tee testfile | less

# Capture stdout of a command to a variable
output=$(date)

# Capture stdout and stderr of a command to a variable
output=$(command_which_has_stdout_and_stderr 2>&1)

# Redirect stdout of a command to one or multiple files and save stdout to a variable
# a file must be behind a tee command
# By default tee overwrites the file. Use -a to append to the end
$output = $(date | tee testfile1 testfile2)

# Redirect stdout to a variable and display to terminal in real time (not to stdout!)
# Works on Ubuntu and RedHat
$output = $(date | tee /dev/tty)

# Redirect one file descriptor (M, default 1) to another file descriptor (N) M>&N
# Redirect a manually made error 
echo "This is an error" >&2

# Change a file descriptor to a file
exec 2>errorLogFile
echo "This is STDOUT and STDOUT is not changed to a file yet"
exec 1>stdOutFile
echo "This doesn't display as STDOUT is redirected to a file"
echo "This is an error and in errorLogFile" >&2
#+END_EXAMPLE

Up to 9 open file descriptors can be used at a time.
#+BEGIN_EXAMPLE
# Open a custom file descriptor to a file
exec 3>customLog
echo "This goes to file descriptor 3" >&3
# Open a custom file descriptor and redirects to STDOUT
exec 4>&1

# If you want to change the reserved file descriptors. Always backup and change back
exec 5>&1
exec 6>&2

# Backup STDIN is a little different
exec 7<&0
#+END_EXAMPLE

*** Array
#+BEGIN_EXAMPLE
# define empty array
myarray=()

# define array with values
myarray=( one two three four five )

# define array with strings
myarray=( 'Hello World' 'Another item' )

# Get at index 0
echo ${myarray[0]}

# print array as a whole delimited by space
echo ${myarray[@]}

# print array as a whole delimited by newline
printf "%s\n" "${myarray[@]}"

# Convert an array to string variable delimited by newline
printf -v stringvar "%s\n" "${myarray[@]}"

# Remove the final newline
stringvar=${stringvar%?}

# Append to array
myarray+=('foo')
myarray+=("$line")

# Append only if it's new
containsElement() {
 local e
 for e in "${@:2}"; do [[ "$e" == "$1" ]] && return 0; done
 return 1 
}
if ! containElement "$line" "${myarray[@]}"; then
 myarray+=("$line")
fi

# Length
echo Number of elements in array: ${#myarray[@]}

# Loop array
for i in "${myarray[@]}"; do
  echo "$i"
done

#+END_EXAMPLE

*** echo and print
#+BEGIN_EXAMPLE
echo -e "Hello\nWorld"; 
# echo newline -e to use \n etc
# always wrap variable in double quotes to preserve newline character
echo "$output"
#+END_EXAMPLE

*** printf
Print multilines
#+BEGIN_EXAMPLE
printf '%s\n%s\n' "$line1" "$line2"
#+END_EXAMPLE

*** Read command output line by line
#+BEGIN_EXAMPLE
multiple_commands_output=""
output=$(drush command output contains multiple lines);
count=1
while IFS=$'\n' read -r line; do
  echo "Line number $count: $line"
  count=$[ $count + 1 ] 
done <<< "$output"

multiple_commands_output="$multiple_commands_output""$output"$'\n'

# You don't have to change back IFS as it only affects the while loop
# newline character is \n
# read -r :: to ignore all backslashes
#+END_EXAMPLE

*** String Operators
#+BEGIN_EXAMPLE
# A string is delimited by :
# Get the last element
foo=1:2:3:4:5
echo ${foo##*:}

# '##' means greedy front trim
# * matches any character
# until the last ':'
# also work for space as delimiter
# ${foo##* }

# Concatenate string variables
z=""
a="Hello\n"
b="World\n"
c="!"

z="$z""$a"
z="$z""$b"

# insert a newline
z="$z""$c"$'\n'

#+END_EXAMPLE

*** String comparison
#+BEGIN_EXAMPLE
# Start with 'node'
if [[ $a == node* ]]; then

# Start with a string 'Hello World'
[[ $a == "Hello World"* ]]
#+END_EXAMPLE

*** Numeric comparison
Not floating-point values
| Equal            | $n1 -eq $n2 |
| greater or equal | $n1 -ge $n2 |
|                  | $n1 -gt $n2 |
|                  | $n1 -le $n2 |
|                  | $n1 -lt $n2 |
| not equal        | $n1 -ne $n2 |
|                  |             |

*** <<<Bash if>>>
#+BEGIN_EXAMPLE
 if [ conditions ]; then
  # commands
 elif [ conditions ]; then
  # more commands
 elif [ conditions ]; then
  # more commands
 else
  # more commands
 fi
#+END_EXAMPLE

** curl wget
*** curl
**** Basic
#+BEGIN_EXAMPLE
dlDir=/home/lili/download/
dlFileName = ${dlDir}123.xml
curl "http://abc.com/123.xml" -L -o ${dlFileName}
#+END_EXAMPLE

**** Return HTTP response header only
=curl -m 120 -IL "http://url.com" >> /path/to/log.log=
e.g Drupal Cron URL response status
#+BEGIN_EXAMPLE
#!/bin/bash
curl -sL -o /dev/null -w "%{http_code}\n" "http://drupalcronurl" >> /path/to/your/cronlog
#+END_EXAMPLE

**** Download with HTTPS or HTTP authentication
Popup form or server authentication
=curl https://a.com/b.aspx -u user:password -L -o /path/to/xml.xml=

**** <<<cURL download only after or before a date>>>
Works for ftp and Http
#+BEGIN_EXAMPLE
fileLocalTime=$(date -r "$localfile")
curl $remote_file_path -u $user:$password -o $localfile -R -z "${fileLocalTime}"
# default is "after"
# add a dash before date string will result in "before".
fileLocalTimeNew=$(date -r "$localfile")
if [ "$fileLocalTime" == "$fileLocalTimeNew" ]; then
 echo "the same"
else
 echo $fileLocalTime
 echo $fileLocalTimeNew
fi
#+END_EXAMPLE

**** Options

| L          | Follow through all redirects                                  |
| o          | redirect STDOUT to a file                                     |
| O          | save file using same file name in current folder              |
| I          | get header response only                                      |
| m          | timeout in seconds                                            |
| H          | request header. =-H "Accept-Charset: ISO-8859-1,utf-8;q=0.7"= |
| limit-rate | limit download speed: --limit-rate=200k. use k, m or g        |
| s          | suppress STDOUT                                               |
| w          | rewrite STDOUT                                                |
| R          | Keep remote file timestamp. --remote-time                     |
| z          | cURL download only after or before a date                     |
|            |                                                               |
 
** Commands
*** Run Sequentially
=lspci; lsusb=
If the first command not successful, 2nd command will not run: =lspci && lspci=

*** =man=
=man -k processes= Search `processes` in command names and description
=man -f ls= Search in command names and title

*** =cd -= Navigate to previous directory (back)
*** =wc=
| =-l= | Line Count      | =ps -ef \vert wc -l= |
| =-w= | Word Count      |                      |
| =-c= | Byte Count      |                      |
| =-m= | Character Count |                      |
|      |                 |                      |

*** Replace String  =sed= 
Replace all (g) Nick with John
=cat report.txt | sed 's/Nick/John/g' > report_new.txt=

** Interesting Commands
*** sudo
Install sudo =apt-get update && apt-get install -y sudo less=
Run sudo interactive =sudo -i=

*** byobu
Create multiple terminals and switch between.
=apt-get install byobu=

** Ubuntu Unity

| C-M t   | open Terminal          |
| M-<F2>  | run command/open app   |
| Super-T | Open Trash             |
| Super-F | Open Files             |
| Alt-`   | Switch between windows |
|         | of the current app     |
|         |                        |

** Ubuntu Personal Package Archive PPA
Add a LibreOffice package from PPA to Software Sources
=sudo add-apt-repository ppa:libreoffice/ppa=, then =sudo apt-get update=
Remove the package source
=sudo add-apt-repository --remove ppa:libreoffice/ppa=, =apt-get update=

Remove it and downgrade back to previous version before using PPA
=sudo apt-get install ppa-purge=, =sudo ppa-purge ppa:libreoffice/ppa=

* Windows
** Win 7
Install KB3138612 and KB3145739 to boost Windows Update

* Docker
** Docker Compose
=docker-compose --version=
=docker-compose up -d=
=docker-compose up -d --force-recreate= Force restart or recreate containers
=docker-compose down -v= remove containers and volumes

* Git
** Stash, Reset, Clean
=git reset --hard=
=git clean -dfn=
=git stash= Save and remove working directory changes
=git stash list= List all stashes
=git stash apply= Apply latest stash
=git stash apply stash@{2}= Apply 2nd latest stash
=git stash drop stash@{0}= Remove latest stash

** Branch
*** Duplicate current branch and switch to it 
#+BEGIN_EXAMPLE
git checkout -b newbranch
#+END_EXAMPLE

*** Duplicate current branch to a commit and switch 
git checkout -b newbranch <SHA1>
*** Delete branch
git branch -d branchname= or =-D=

*** Commit difference between 2 branches 
=git log master..li=

*** File difference between 2 branches 
=git diff --name-status master..origin/master= or 
=git diff --stat --color master..origin/master=
| Missing file or line in remote branch | D or - |
| New file or line in remote branch     | A or + |
| Both are modified                     | M      |

** Merge
*** Abort merge
git merge --abort

** Remove tracking for commited files
A file is commited but you don't want to track it anymore in the future.
Remember the file will still be in Git but future clone won't grab the file.
=git update-index --assume-unchanged path/to/file.txt=

If you change your mind and want to track it again:
=git update-index --no-assume-unchanged path/to/file.txt=

Don't track a folder of files which are already commited
First try to run this because this will work with file names with space
=git ls-files -z myFolderToIgnore/ | xargs -0 git update-index --assume-unchanged=

Path is relative.

If you encounter error =xargs: git: bad file number=, run this
=git ls-files -- myFolderToIgnore/ | xargs -l git update-index --assume-unchanged=

List all assumed unchanged files
#+BEGIN_EXAMPLE
git ls-files -v | grep '[[:lower:]]'
#+END_EXAMPLE

** Remove a commited file from file but leave in filesystem
This delete a file from Git (top of the current branch) but leave the file in filesystem
The file becomes Untracked File
=git rm --cached file.txt=

Remove a folder
=git rm -r --cached .emacs.d/=

Add file to local or global ignore so that the file won't appear as Untracked File and prevent 
from staging the file when =git add .=

** Commit History
=git log --graph=
=git log -3= Last 3 commits
=git log --grep=<pattern>= Search commit message

** Line Feed
Always don't do any conversion when files are added to local index or codes are checked out to local filesystem.
=git config --global core.autocrlf false=
Do git clone again.

** Long Path
You may encouter =file name too long= or =pathname too long= error.
Change the git setting
=git config --system core.longpaths true=

** Local Ignore
Add file or directory paths to
- .git/info/exclude/ (will not be committed)
- .gitignore file (will be commited)

Just =touch .gitignore= in order to create a file with just the extension

** Global Ignore
Add global ignore file `~\.gitignore_global` 
and run `git config --global core.excludesfile ~/.gitignore_global`

** GUI gitk
** Multiple Github accounts and https
You manage 2 Github accounts.
git clone does not require credentials for https
When you push to the remote which is under Github account A, Windows asks you for credentials
After that, your credentials for account A is stored under Windows Credential Store Panel (WCSP).
You can add account A to an account B's repository as a collaborator.
Any push will be made by account A.

You have to delete 2 Github credentials from WCSP and then push commits to account B's repository 
and then use account B's credential if you want to completely switch account.

If you want to switch between multiple Github accounts frequently, use SSH instead of https

SSH might be blocked in public internet networks though.

Git has upgraded credential helper from manager to wincred.
git config --global crendential.helper wincred

* Pantheon
** Deploy
#+BEGIN_EXAMPLE
terminus site deploy --site=<s> --env=<e> --sync-content --cc
#+END_EXAMPLE

** Drush
<<<Pantheon Drush>>>
#+BEGIN_EXAMPLE
terminus drush "<drush command> <drush args>" --site=<> --env=<> 
#+END_EXAMPLE

** WP CLI
<<<WP CLI Pantheon>>>
terminus wp 'option get home' --site=<site> --env=dev

** Determin Environment
#+BEGIN_EXAMPLE
if (defined('PANTHEON_ENVIRONMENT') && PANTHEON_ENVIRONMENT == 'dev') {} 
#+END_EXAMPLE

Not including Drush and on dev web environment
#+BEGIN_EXAMPLE
if (isset($_SERVER['PANTHEON_ENVIRONMENT'])) {
 // Web only excluding Drush 
 if ($_SERVER['PANTHEON_ENVIRONMENT'] == 'dev') {
  // Web only excluding Drush and on dev
 }
}
#+END_EXAMPLE

** Disable Newrelic
https://pantheon.io/docs/new-relic

Newrelic may inject javascript in pages.. Disable it

Drupal (sites/default/settings.php)
#+BEGIN_EXAMPLE
if (function_exists('newrelic_ignore_transaction')) {
 newrelic_ignore_transaction();
}
#+END_EXAMPLE

* Database
** MySQL
*** Data Types
<<<MySQL Integer>>>
SIGNED :: contains negative, 0 and positive
UNSIGNED :: contains 0 and positive
- TINYINT
- SMALLINT
- MEDIUMINT
- INT
- BIGINT

<<<MySQL Date and Time>>>
- TIME :: format 'HH:MM:SS' from '-838:59:59.000' to '838:59:59.000'

*** REGEXP
<<<MySQL REGEX>>>

Unless the field is binary, REGEXP is case-insensitive.

#+BEGIN_EXAMPLE
WHERE aut_name REGEXP "^w"
WHERE aut_name REGEXP "^I am \"Great!\""
// escape double quotes
#+END_EXAMPLE

*** Update Fields in Multiple Tables
#+BEGIN_EXAMPLE
UPDATE node, node_revision
SET node.comment=1,
    node_revision.comment = 1
WHERE node_revision.nid = node.nid AND node.type <> 'blog'
#+END_EXAMPLE

Update Joined Tables
#+BEGIN_EXAMPLE
UPDATE tableA a
JOIN tableB b ON a.a_id = b.a_id
JOIN tableC c ON b.b_id = c.b_id
SET b.val = a.val+c.val,
a.val2 = 'new'
WHERE a.val > 10 AND c.val > 10
#+END_EXAMPLE

** MSSQL
*** Modify column values if exist (CASE WHEN)
#+BEGIN_EXAMPLE
SELECT colOne,
varColTwo = 
CASE colTwo
 WHEN 1 THEN 1
 WHEN 0 THEN 3
END,
varImage = 
CASE
 WHEN len(colImage) > 0 THEN 'http://abc.com/images/' + colImage
 ELSE ''
END
FROM aTable
ORDER BY varColTwo DESC,
CASE 
 WHEN colFour = 1 THEN colFive
 WHEN colFour = 2 THEN colSix
END ASC      
#+END_EXAMPLE

*** Concatenate Multiple Columns to Single Column as String
A doc has multiple categories. Concatenate the categories delimited by commas.

#+BEGIN_EXAMPLE
SELECT doc.intDocID
      ,doc.varTitle
      ,STUFF(
          (SELECT ',' + CAST( t2.catID AS varchar(10) )
           FROM tblDocCat t2
           WHERE t2.intDocID = doc.intDocID
           FOR XML PATH('')
          ),
          1,
          1,
          ''
       ) AS docCats
#+END_EXAMPLE

**** STUFF
This deletes the first letter of a column and returns the rest.
STUFF first deletes a substring from aCol at start:1 and length_to_delete:1
and then insert a string at the start position
#+BEGIN_EXAMPLE
STUFF(aCol, 1,1, '')
#+END_EXAMPLE

*** Export as CSV - BCP
bcp.exe is in =C:\Program Files\Microsoft SQL Server\90\Tools\Binn\=

#+BEGIN_EXAMPLE
bcp "Select * from fullDatabasename.dbo.tableName" queryout "c:\aFolder\aFile.csv" -c -t"\",\"" -r"\"\n\"" -T
#+END_EXAMPLE

Table name in full :: DEDP225.[dev.todaystrucking].dbo.[tblDocument]

| c | Ascii                    |
| t | field terminator. Comma  |
| r | row terminator. New line |
| T | trusted connection       |

**** Escape % if bcp is in batch file
#+BEGIN_EXAMPLE
bcp "SELECT * FROM aTable WHERE email LIKE '%%@%%.%%'"
#+END_EXAMPLE

**** Save long query in Global Temporary table (GTT)
#+BEGIN_EXAMPLE
SELECT *
INTO ##myglobaltemptable
FROM tableA
#+END_EXAMPLE

Drop the GTT after bcp: =DROP TABLE ##myglobaltemptable=

#+BEGIN_EXAMPLE
bcp ##myglobaltemptable out "c:\folder\file.csv" -c -t"\",\"" -r"\"\n\"" -T
#+END_EXAMPLE

**** Get all columns
#+BEGIN_EXAMPLE
DECLARE @colnames VARCHAR(max);
SELECT @colnames = COALESCE(@colnames + ',', '') + char(39)+ column_name +char(39) 
FROM INFORMATION_SCHEMA.COLUMNS where TABLE_NAME='%yourtablename%'; 
SELECT @colnames
#+END_EXAMPLE

It returns ='col1','col2',...,'colLast'=

Export to header.csv
=bcp "SELECT 'col1','col2',...,'colLast'" queryout "c:\header.csv" -c -t"\",\"" -r"\"\n\"" -T=

**** Last step
Both header and data files need to be fixed.
Insert a double quote at the beginning of the file and delete the last double quote at the end of it.
Insert a new line at the end of the header file.

Combine 2 files
=copy /b c:\header.csv+c:\folder\file.csv c:\export.csv=

*** Export as XML
By default, it's UTF-8 encoded. datetime will be automatically converted to XML format.
If value is NULL, the xml node will not be generated.
By default, MSSQL will add =<CR><LF>= into the Unicode XML data stream every 2033 characters.
Use bcp with option -r to add no new line.

**** Query
#+BEGIN_EXAMPLE
SELECT CustomerID as "@id",
CompanyName,
Address as "address/street",
City as "address/city",
Region as "address/region",
PostalCode as "address/zip",
Country as "address/country",
ContactName as "contact/name",
ContactTitle as "contact/title",
NULLIF(Phone,'') as "contact/phone",
-- If value is NULL, the xml node will not be generated
Fax as "contact/fax"
FROM Customers
FOR XML PATH('Customer'), ROOT('doc')
#+END_EXAMPLE

Result
#+BEGIN_EXAMPLE
<doc>
  <Customer id="ALFKI">
    <CompanyName>Alfreds Futterkiste</CompanyName>
    <address>
      <street>Obere Str. 57</street>
      <city>Berlin</city>
      <zip>12209</zip>
      <country>Germany</country>
    </address>
    <contact>
      <name>Maria Anders</name>
      <title>Sales Representative</title>
      <phone>030-0074321</phone>
      <fax>030-0076545</fax>
    </contact>
  </Customer>
  ...
</doc>
#+END_EXAMPLE

INNER JOIN Multiple records
#+BEGIN_EXAMPLE
SELECT d.docID
,(
SELECT c.category AS category
FROM tblDocCats dc
 INNER JOIN tblCategory c ON c.catID = dc.catID
WHERE dc.docID = d.docID
FOR XML PATH(''), TYPE
) AS categories
FROM doc d
FOR XML PATH('item'), ROOT('items')
#+END_EXAMPLE

Result
#+BEGIN_EXAMPLE
<items>
 <item>
  <docID></docID>
  <categories>
   <category></category>
   ...
  <categories>
 <item>
</items>
#+END_EXAMPLE

This
#+BEGIN_EXAMPLE
,(
SELECT c.category AS name, c.catID as ID
FROM tblDocCats dc
 INNER JOIN tblCategory c ON c.catID = dc.catID
WHERE dc.docID = d.docID
FOR XML PATH('category'), TYPE
)
#+END_EXAMPLE
will result as
#+BEGIN_EXAMPLE
<items>
 <item>
  <docID></docID>
  <category>
   <name></name>
   <id></id>
  <category>
  <category>
   <name></name>
   <id></id>
  </category>
  ...
 <item>
</items>
#+END_EXAMPLE

**** Different modes
FOR XML AUTO
#+BEGIN_EXAMPLE
<servername.dbo.Customers ID="C11" Name="..." Address="..." />
#+END_EXAMPLE

FOR XML RAW
#+BEGIN_EXAMPLE
<row ID="C11" Name="..." Address="..." />
#+END_EXAMPLE

FOR XML PATH
#+BEGIN_EXAMPLE
<row>
  <ID></ID>
  <Name></Name>
  <Address></Address>
</row>
#+END_EXAMPLE

**** bcp
#+BEGIN_EXAMPLE
bcp "query..." queryout C:\file.xml -T -w -r
#+END_EXAMPLE

| r | no value means don't add any newline character for every 2033 characters or new row |
| w | Use Unicode characters                                                              |

Save long query as stored procedure. You can't save FOR XML in Global Temporary Table.
dev.todaystrucking is the database name. Inside the real SELECT, you can refer to table as
dbo.tablename not DEDP225.[dev.todaystrucking].dbo.tablename
#+BEGIN_EXAMPLE
USE [dev.todaystrucking]
GO

IF OBJECT_ID('dbo.usp_exporttr') IS NOT NULL DROP PROC dbo.usp_exporttr
GO

CREATE PROC dbo.usp_exporttr AS

SET NOCOUNT ON

SELECT ...
FOR XML PATH('item'), ROOT('items')

RETURN
GO
#+END_EXAMPLE

Then creat another query in MS SQL Server Management Studio and run
#+BEGIN_EXAMPLE
EXEC xp_cmdshell 'bcp "EXEC [dev.todaystrucking].dbo.usp_exporttr" queryout "c:\a.xml" -S (local) -T -w -r'
#+END_EXAMPLE

You may receive "SQL Server blocked access to procedure 'sys.xp_cmdshell' of component 'xp_cmdshell' because this component is turned off as part of the security configuration"

Just go to bcp folder and run as a command line
#+BEGIN_EXAMPLE
bcp "EXEC [dev.todaystrucking].dbo.usp_exporttr" queryout "c:\a.xml" -S (local) -T -w -r
#+END_EXAMPLE

The exported xml file will have UCS-2 encoding which is a preceding version of UTF-16.
This encoding is in BOM.

You will have to open other text editor to change the encoding to UTF-8.

*** Backup
Export database to bak file.
SQL Management Studio Tool > right click on a database and
Tasks > Backup > Use Full backup, specify a destination (path to bak).
Use overwrite settings in Options.
Then click on Script > Script to file. You will get a .sql:
#+BEGIN_EXAMPLE
BACKUP DATABASE [aDatabase] TO DISK ='N'C:\afile.bak' WITH NOFORMAT, INIT, 
NAME = N'aDatabase-Full Database Backup', 
SKIP, NOREWIND, NOUNLOAD,  STATS = 10
GO
#+END_EXAMPLE

Make filename dynamic (remove spaces if necessary):
#+BEGIN_EXAMPLE
DECLARE @filename nvarchar(200) = ''
SELECT @filename = 'C:\test-' + convert(varchar(23), getdate(), 126) + '.bak'
BACKUP DATABASE [aDatabase] TO
 DISK =  @filename WITH NOFORMAT, INIT,  
 NAME = N'aDatabase-Full Database Backup', SKIP, NOREWIND, NOUNLOAD,  STATS = 10
GO
#+END_EXAMPLE

Run this .sql file:
#+BEGIN_EXAMPLE
sqlcmd -S sqlservername -i C:\sqlFileName.sql
#+END_EXAMPLE

* DFP
** Key-Value Targeting
Slot-level targeting is recommended
#+BEGIN_EXAMPLE
googletag.defineSlot('/123/travel/asia/food', [728, 90], "div-id")
         .addService(googletag.pubads())
         .setTargeting("interests", ["sports", "music"]);
#+END_EXAMPLE

Page-level targeting
#+BEGIN_EXAMPLE
googltag.pubads().setTargeting("topic", "basketball");
#+END_EXAMPLE

** DFP in email
[[https://support.google.com/dfp_premium/answer/2623168?hl=en][Simplified URL tags on DFP Help]]

#+BEGIN_EXAMPLE
<a href="http://my.com/ad/ad_unit_name/728x90/">
 <img width="728" height="90" alt=""
  src="http://pubads.g.doubleclick.net/gampad/ad?iu=/networkid/ad_unit_name&sz=728x90&c=[todays_date][account]" />
</a>
#+END_EXAMPLE

Base URL :: http://pubads.g.doubleclick.net/gampad/[request-type]?[parameters]

Request Type
| ad   | simple image creative                               |
| jump | log click and redirect to destination URL           |
| adx  | return raw code of creative                         |
| clk  | only log click but no redirect. Only in DFP Premium |
|      |                                                     |

Parameters
| iu       | for all request types                                                   |
| sz       | for ad, jump and adx                                                    |
| t        | for ad, jump and adx. key-value pairs                                   |
| excl_cat | competitive exclusions                                                  |
| c        | for ad, jump and adx. cache buster. only number                         |
| m        | for adx. Specify file type to return. m=text/html                       |
| submodel | for all request types. Mobile device name                               |
| u_w      | for all request types. Mobile device screen height.                     |
| title    | required if mutliple ad tags use the same ad unit code on the same page |
| mob      | Indicaste it's a mobile request.                                        |

#+BEGIN_EXAMPLE
<script src="//code.jquery.com/jquery-1.10.2.js"></script>
<script>
	var ad_unit = 'ad_unit_name';
	var ad_unit_size = '728x90';
	var rnd=Math.floor(Math.random() * (999999 - 10 +1)) + 10;
	var theUrl='http://pubads.g.doubleclick.net/gampad/adx?iu=/' + ad_unit 
	+ '&sz=' + ad_unit_size + '&c=' + rnd;
	var xmlHttp = null;
	xmlHttp = new XMLHttpRequest();
	xmlHttp.open( "GET", theUrl );
	xmlHttp.send();
	xmlHttp.onreadystatechange=function() {
	if (xmlHttp.readyState==4 && xmlHttp.status==200) {
	  xmlDoc = $.parseHTML( xmlHttp.response );
         adlink = $(xmlDoc).find('a').attr('href');
         if (typeof adlink == "undefined") adlink = "http://www.example.com";
          window.location = adlink;
       }
    }
</script>
#+END_EXAMPLE

** Responsive
Add a size to the ad unit /networkid/adunitname
You can specify one or more sizes for a line item that uses this ad unit.
And upload each creative and specify the size. You can have creative bigger than the size you specify.

#+BEGIN_EXAMPLE
googletag.cmd.push(function() {
  var leaderboard_mapping = googletag.sizeMapping()
  .addSize([1280, 800], [[970, 250], [970, 90], [728, 90]])
  .addSize([600, 800], [468, 60]) // viewport size is width and height both > 600 and 800
  .addSize([0, 0], [[320, 50], [320, 100]]) // Map any viewport size
/* This will only display the ad if it's mobile or tablet viewport size
  .addSize([0, 0], []) // [] means don't try to call an ad
  .addSize([320, 700], [300, 250]) // Mobile or tablet
  .addSize([1050, 200], [])
*/
  .build();
  
  googletag.defineSlot('/networkid/adunitname'
           , [728, 90] // If there is an error in the mapping or if the browser size can't be determined
                       // the size specified here in .defineSlot will be used. 
           , 'div-id')
           .defineSizeMapping(leaderboard_mapping)
           .addService(googletag.pubads());
});
#+END_EXAMPLE

* XML
** XML DOM
Everything is a node
nodeType :: 1 - element, 2 - attribute, 3 - text, 4 - comment, 5 - document
nodeName :: read-only, text node name is #text, document node name is #document
nodeValue :: element node value is undefined

var elements = xmlDoc.getElementByTagName("title");
console.log(elements.length);
var element = elements[0];
var elementToRemove = xmlDoc.getElementsByTagName('book')[0];
xmlDoc.documentElement.removeChild(y);
element.parentNode.removeChild(element); // remove myself

xde = xmlDoc.documentElement; 
newNode = xmlDoc.createElement('book'); // create element node
newTitle = xmlDoc.createElement('title');
newText = xmlDoc.createTextNode('A Notebook'); // create text node
newTitle.appendChild(newText); // add text node to element node
newNode.appendChild(newTitle); // add element node to element node

y = xmlDoc.getElementsByTagName('book')[0];
xde.replaceChild(newNode, y); // replace an element node
aTextNode.replaceData(0,8,"Easy"); // replace data of text node (from start to 8 in length)
// Use nodeValue, it's easier

var attributes = element.attributes;
var attribute = element.getAttribute('lang');
var attributeNode = element.getAttributeNode('lang');
attributeNode.nodeValue;
attributeNode.nodeValue = "new attribute value";
element.setAttribute('category', 'food');

element.removeAttributeNode(attributeNode); // remove an attribute node
element.removeChild("category"); // remove an attribute node by name
// remove multiple attribute nodes, you will have to loop all

var x = element.childNodes[0].nodeName;

*** Navigate
var fc = element.firstChild;
var lc = element.lastChild;
fc.parentNode;
var nc = fc.nextSibling;
nc.previousSibling;

function get_nextSibling(n) {
 // Bypass empty text node while traversing
 var y = n.nextSibling;
 while (y.nodeType != 1) {
  y = y.nextSibling;
 }
 return y;
}

** Do not parse < and &
#+BEGIN_EXAMPLE
<![CDATA
]]>
#+END_EXAMPLE

** Comment
#+BEGIN_EXAMPLE
<!-- Same as HTML but double -- is not allowed -->
#+END_EXAMPLE

** XML newline is always LF
** XML Element node name can contain -, _ and . but not space
** Attribute value should be HTML entity encoded
Mainly enocde the double quotes " to &quot;
> &gt;
< &lt;

** <<<XML namespace>>>
#+BEGIN_EXAMPLE
<root 
xmlns:h="http://www.w3.org/TR/html4/"
xmlns:f="http://www.w3schools.com/furniture">

<h:table>
  <h:tr>
    <h:td>Apples</h:td>
    <h:td>Bananas</h:td>
  </h:tr>
</h:table>

<f:table>
  <f:name>African Coffee Table</f:name>
  <f:width>80</f:width>
  <f:length>120</f:length>
</f:table>

</root>
#+END_EXAMPLE

** XSLT
XSLT stands for XSL (Extensible Stylesheet Language) Transformations
XSLT uses XPath to navigate through elements.

XSLT code
#+BEGIN_EXAMPLE
<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
<xsl:template match="/">
<!-- Associate the template with the root of the XML source document -->
<!-- A template contains rules to apply when a specified node is match -->
  <h2>My CD Collection</h2>
    <table border="1">
      <tr bgcolor="#9acd32">
        <th style="text-align:left">Title</th>
        <th style="text-align:left">Artist</th>
      </tr>
      <xsl:for-each select="catalog/cd">
<!-- for-each loop, select contains XPath expression -->
<!-- select="catelog/cd[artist='Bob Dylan']" -->
<!-- =, !-, &lt;, &gt; -->
     <xsl:sort select="artist" />
<!-- sort -->
      <tr>
        <td><xsl:value-of select="title"/></td>
        <td><xsl:value-of select="artist"/></td>
        <xsl:if test="price &gt; 10">
        <td><xsl:value-of select="price"/></td>
        </xsl:if>
<!-- choose, when, otherwise -->
       <xsl:choose>
        <xsl:when test="price &lt; 10">
         <td bgcolor=""><xsl:value-of select="price"/></td>
        </xsl:when>
        <!-- Multiple when's -->
        <xsl:otherwise>
         <td><xsl:value-of select="price"/></td>
        </xsl:otherwise>
       </xsl:choose>
<!-- choose, when, otherwise. -->
      </tr>
      </xsl:for-each>
<!-- Close a loop -->
    </table>
</xsl:template>
</xsl:stylesheet>
#+END_EXAMPLE

XML file
#+BEGIN_EXAMPLE
<?xml version="1.0" encoding="UTF-8"?>
<catalog>
  <cd>
    <title>Empire Burlesque</title>
    <artist>Bob Dylan</artist>
    <country>USA</country>
    <company>Columbia</company>
    <price>10.90</price>
    <year>1985</year>
  </cd>
  <cd>...</cd>
  ...
</catalog>
#+END_EXAMPLE

Template and subtemplates
#+BEGIN_EXAMPLE
<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
<xsl:template match="/">
 <html>
 <body>
  <xsl:apply-templates/>
 </body>
 </html>
</xsl:template>

<xsl:template match="cd">
 <p>
 <xsl:apply-templates select="title"/>
 <xsl:apply-templates select="artist"/>
 </p>
</xsl:template>

<xsl:template match="title">
 Title: <xsl:value-of select="."/>
 <br />
</xsl:template>

<xsl:template match="title">
 Artist: <xsl:value-of select="."/>
 <br />
</xsl:template>
</xsl:stylesheet>
#+END_EXAMPLE

** Invalid character &#x1F
change to version 1.1
#+BEGIN_EXAMPLE
<?xml version="1.1" encoding="UTF-8" ?>
#+END_EXAMPLE

* Tools
** phpStorm
Help > Default Keymap Reference
*** Installation and 64 bit
Just install the new version and it will guide you to uninstall and keep the settings.
For activation, choose License server, address is http://idea.lanyus.com/ 
(last time http://idea.qinxi1992.cn/)

Install Java SE Development Kit (JDK) 64 bit
Open C:\Program Files (x86)\JetBrains\PhpStorm 10.0.3\bin\PhpStorm64.exe
Help > About, you should see
JRE: amd64
JVM: 64-bit
If not, set environment variable `JAVA_HOME` to C:\Program Files\Java\jdk1.8.0_101 and restart PhpStorm64.exe
Inside PhpStorm, Help > Edit Custom VM Options 
and change `-Xms` and `-Xmx` to	`-Xms4g` and `-Xmx4g`
Restart PhpStorm64.exe and open multiple projects to test RAM.
Finally, edit the shortcut to use PhpStorm64.exe

*** Open big file
Ensure phpStorm is running in 64bit.

*** HTML (CSS and Javascript)
**** Show Applied Styles
Right click on element and select _Show Applied Sytles for Tag_

**** CSS vendor prefix
e.g. all vendor prefixes for box-sizing. Type -box-sizing and hit tab.
 
*** XPath
You need to make the xml file part of a project to use Evaluate XPath... (right click) 

*** Emmet
**** How it works
snippets.json store something like "m": "margin:|;"
**** CSS
***** margin (m), color (c), border (bd)
m10 TAB for margin: 10px;
m10-20 TAB for margin: 10px 20px;
m-10--20 TAB for margin: -10px -20px;
m1.5 TAB for margin: 1.5em;
m1.5rem TAB for margin: 1.5rem;
m10p30e5x TAB for margin: 10% 30em 5ex;

p :: percentage
e :: em
x :: ex

/Color/
c#fc0

/border/
border
bd5#0s

s :: solid 

** Chrome
*** Get all events of an element in Console
getEventListeners($0);

*** Inject CSS file in Console
=jQuery(document.head).append('<link rel="stylesheet" href="path_to_my_css">');=

*** Flash Couldn't Load Plugin
Properites > Security, give Full Control for Everyone in this folder
C:\Users\you\AppData\Local\Google\Chrome\User Data\PepperFlash\some.version.number

*** Allow XMLHttpRequest for local files
#+BEGIN_EXAMPLE
chrome.exe --allow-file-access-from-files
#+END_EXAMPLE

*** XPath <<<XPath>>>
[[http://www.freeformatter.com/xpath-tester.html][xPath Online tools]]
| /nodename/               | select all nodes with name                                                        |
| ~/~                      | select from the root node                                                         |
| //                       | select nodes from the current node that match the select no matter where they are |
| .                        | select the current node                                                           |
| ..                       | select the parent of the current node                                             |
| @                        | select attribute                                                                  |
|                          |                                                                                   |
| store/book[1]            | first book element                                                                |
| store/book[last()]       | last book element                                                                 |
| store/book[last()-1]     |                                                                                   |
| store/book[position()<3] | first 2 book elements                                                             |
| store/book[price>35.00]  | all book elements that have price element with a value greater than 35.00         |
| store/book/title[@lang]  | lang attributes of all title elements in book elements                            |
|                          |                                                                                   |
| ~*~                      | match any element node                                                            |
| @*                       | match any attribute node. Have at least one attribute                             |
|                          |                                                                                   |

Select multiple paths
//book/title | //book/price

**** Axis Syntax
axisname::nodetest[predicate]

axisname is the relationship name
- self
- child
etc.

nodetest is a node name to test

| child::book     | book nodes that are children of the current node |
| attribute::lang | lang attribute of the current node               |
| child::*        | children elements of the current node            |
| child::text()   | text node of the current node                    |
| child::node()   |                                                  |

**** XPath Operators
+ - * div
mod (division remainder) :: 5 mod 2 
=|= combine 2 node-sets
= != < <= > >=
or :: price=9.8 or price=9.7
and

** Firefox
*** Make all new windows open in Private Mode
- Visit about:config and click "Yes, I'll be careful"
- Search for =browser.privatebrowsing.autostart=
- Change value to True

** Windows
*** Windows Credential Store Panel
<<<Windows Credential Store Panel>>>
User Accounts > Your Account > Manage your credentials
Or Credential Manager
Instead of Web Credentials, choose Windows Credentials

*** Meter an Ethernet Connection
Run regedit: HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\NetworkList\DefaultMediaCost
Right click on the key > Permissions > Advanced > ~Change~ next to Owner on the top 
Type ~Administrators~ and Check Names
Check the box next to *Replace owner on subcontainers and objects* and click *OK*
Back in the *Permissions for DefaultMediaCost* window, click *Administrators* to select the group
Assign *Full Control Allow*, then *OK*
Right click /DefaultMediaCost > Ethernet/ and /Modify/
Change from 1 to 2 for metered (DWORD 32-bit, Base Hexadecimal)
 
** SharePoint
Site collection can have multiple subsites.
Each site collection must have one top-level site.
Defautl site collection and top-level site: yourcompany.sharepoint.com
The default Team Site (yourcompany.sharepoint.com/TeamSite) is a top-site of the defautl site collection 

See all site collections, Sharepoint admin center > site collections

Manage subsites and top-level site, go to one of the subsites and then click on Site Settings
or go to the top-level site then Site Settings

*** Site Permissions
3 core default SharePoint permission groups: Owners, Members, Visitors.

You can add "Everyone except external" to a group. 

Site Settings > People and Groups > Select the desired group > New

** Office 2016
*** Outlook
**** Export Contacts as CSV and Reimport to Outlook 
There's no option in Outlook for Mac to export contacts as CSV. OWA exports contacts without Company field.
First, go to Outlook for Mac, select all contacts and drag them to a folder as VCF files.
Open cmd on Windows, go to the folder with VCF files and run =copy /B *.vcf all_in_one.vcf=
Use vCard to [[http://labs.brotherli.ch/vcfconvert][LDIF/CSV Converter]] to convert all_in_one.vcf to CSV
Open the csv in Excel and Save as CSV so that file uses CR+LF
Go to OWA, delete all contacts
Always use PC Outlook to import CSV. OWA barely functions.

**** Import Contacts
Import from .pst file handles the field mapping automatically.
Import from .csv you would need to Clear Map and Default Map.

**** Rules: Multiple Senders
Create a new contact folder and put contacts with emails.
Create a rule which can be triggered when anyone in the contact folder belongs to "From"
The rule is called "Sender is in specified Address Book"

*** Troubleshooting
**** Outlook CSV Import 
A file error has occured in the Comma Separated Values translator while initializing a translator to build a field map.
That's because the CSV file does not use CR+LF. Open it in Excel and Save As

** Image
   Sample Image: http://placehold.it/350x150
** Google
*** Google Public DNS
8.8.8.8
8.8.4.4
*** Google Material Icons
https://material.io/icons/

Use it as font:
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<i class="material-icons md-18">face</i>
// font-size: 18px
// md-dark, md-light
// md-inactive

It has svg!

** Email
*** SendGrid
You can create website specific users who can use to authenticate SMTP and API.
Sign to main account and go to Settings > Credentials

Add a header X-SMTPAPI as JSON to assign category shown on SendGrid.com Stats and Activity
Drupal way =$message['header']['X-SMTPAPI'] = '{"category": ["fromwebsiteA"]}' =


- Drupal
Use the SMTP Authentication Support module (smtp) and go to /admin/config/system/smtp to config
Install Options - turn this module on
SMTP server: smtp.sendgrid.net
SMTP port: 465
Use encripted protocol: Use SSL
- Wordpress
Install plugin [[https://wordpress.org/plugins/sendgrid-email-delivery-simplifiedd][SendGrid]]

** W3C
<<<W3C>>>
- Working Draft
- Last Call
- Candidate Recommenation (CR, Standard)
- Proposed Recommendation (PR)
- Recommendation (REC)

** Training
*** Microsoft Virtual Academy MVA
Free https://mva.microsoft.com
Put in the Exam code, e.g. 70-480 to get free training resources
*** Microsoft Certification exam list
https://www.microsoft.com/en-us/learning/exam-list.aspx

*** Microsoft Certification List and Study Group
[[https://borntolearn.mslearn.net/certification][A list of certifications and exams required for each certification]]
[[https://borntolearn.mslearn.net/certification/developer][Study group for each exam and certification]]

*** Microsoft Online Proctored Exams
https://www.microsoft.com/en-us/learning/online-proctored-exams.aspx
Install the software and do a hardware test.
Sign in http://microsoft.com/learning to take an exam half an hour early
Click "Your benefits & exams" then "Start a previously scheduled online proctored exam"

** Work Ethics
*** Remove Credentials
- Windows Credential Store Panel
- Chrome
