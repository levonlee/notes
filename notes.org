#+TITLE: My Notes
#+OPTIONS: H:4
#+STARTUP: overview
#+STARTUP: align
#+TODO: TODO IN-PROGRESS WAITING DONE

* Emacs
** Install & Configuration
Download for Windows https://ftp.gnu.org/pub/gnu/emacs/windows/
This version: emacs-24.5-bin-i686-mingw32.zip
Extract it to C:\emacs, so you will have C:\emacs\emacs-24.5-bin-i686-mingw32\
Make a shortcut of this file /bin/runemacs.exe and copy to your notes folder say C:\c\notes\
Then right click, select Properties of the shortcut and change the ~Start In~ to =C:\c\notes= 
Set a HOME user environment variable in Windows as ~C:\c\notes~
Include a file ~.emacs~ in ~C:\c\notes~ 
Your home folder in Emacs is ~C:\c\notes~
~/.emacs 
~(setq org-catch-invisible-edits 'smart)~

*** M-x
| customize-themes | Load a theme |
|                  |              |

** Basics
#+NAME: tab:emacs-basics
| Help             |                                               |
|------------------+-----------------------------------------------|
| C-h f            | Search by command, get shortcut               |
| C-h v            | Get variable value                            |
|                  |                                               |
| File             |                                               |
|------------------+-----------------------------------------------|
| C-x C-s          | Save                                          |
| C-x C-c          | quit emacs                                    |
| C-x C-f          | Open file, Create file                        |
|                  |                                               |
| Editing          |                                               |
|------------------+-----------------------------------------------|
| _underlined_     |                                               |
| ~verbatim~       |                                               |
| =verbatim=       |                                               |
| +strike_through+ |                                               |
| /Italics/        |                                               |
| C-c .            | Insert timestamp                              |
|                  |                                               |
| C-k              | Remove line, Delete Line                      |
| C-x u            | Undo                                          |
| C-a              | Beginning of line                             |
| C-e              | End of line                                   |
| C-h k            | Explain what key-combo will do                |
| C-S-Bksp         | Kill whole line                               |
| C-x u            | undo                                          |
|                  |                                               |
| <q               | =#+BEGIN_QUOTE=                               |
| <H               | =#+BEGIN_HTML=                                |
| <c               | =#+BEGIN_CENTER=                              |
| <e               | =#+BEGIN_EXAMPLE=                             |
| c-c ;            | =#+BEGIN_COMMENT=                             |
|                  |                                               |
| Headline         |                                               |
|------------------+-----------------------------------------------|
| TAB              | Local tree fold/unfold                        |
| C-u TAB          | Global tree fold/unfold                       |
| C-u C-u C-u TAB  | Show all                                      |
|                  |                                               |
| Table            | <<<emacs:table>>>                             |
|------------------+-----------------------------------------------|
| C-c -            | Insert a horizontal line below                |
| M-S-<down>       | Insert a new row above                        |
| C-c <RET>        | Insert horizontal line and a new row below    |
| M-S-<up>         | Delete a current row                          |
|                  |                                               |
| M-S-<right>      | Insert new column on the right                |
| M-S-<left>       | Delete current column                         |
|                  |                                               |
| C-c <SPC>        | Blank current field                           |
| C-c `            | Edit current field                            |
|                  |                                               |
| S-<TAB>          | Move to previous field                        |
| M-<up>/<down>    | Move a row                                    |
| M-<left>/<right> | Move a column                                 |
|                  |                                               |
| C-c \vert{}      | After text is selected, convert to table      |
|                  |                                               |
| Moving           |                                               |
|------------------+-----------------------------------------------|
| C-l              | Scroll current line to center                 |
| C-x b            | switch to another buffer                      |
| M-<              | Move to beginning of buffer                   |
| M->              | Move to end of buffer                         |
| M-g M-g          | Go to a line                                  |
| C-c C-j          | org-goto. Search in headlines only            |
|                  |                                               |
| Windows          |                                               |
|------------------+-----------------------------------------------|
| C-x 0            | remove current window                         |
| C-x 1            | Close all other windows; Or close help window |
| C-x 2            | Split horizontally                            |
| C-x 3            | split vertically                              |
| C-x o            | move to other window                          |
|                  |                                               |
| Regions          | (selection)                                   |
|------------------+-----------------------------------------------|
| C-space          | Start region, then move cursor to select      |
| C-x h            | Copy all in buffer                            |
| C-g              | deactive mark                                 |
|                  |                                               |
| Kill & Copy      |                                               |
|------------------+-----------------------------------------------|
| C-w              | kill region (cut)                             |
| M-w              | copy to kill-ring (shared with other buffers) |
| C-y              | yank                                          |
|                  |                                               |
| Search           |                                               |
|------------------+-----------------------------------------------|
| C-s, C-r         | search string, forward/backward               |
| Return           | quit searching                                |
| M-C-s            | forward regex search                          |
| M-C-r            | backward regex search                         |
|                  |                                               |

** Headline <<<emacs:headline>>>
| C-u TAB          | Global tree fold/unfold             |
| C-u C-u C-u TAB  | Show all                            |
|                  |                                     |
| C-c C-n          | Next heading                        |
| C-c C-p          | Previous heading                    |
| C-c C-f          | Next heading same level             |
| C-c C-b          | Previous heading same level         |
|                  |                                     |
| C-c C-u          | Backward to higher level heading    |
|                  |                                     |
| M-S-<right>      | Increase heading level of an item   |
|                  | and its child items                 |
| M-S-<left>       | Same as above but decrease          |
|                  |                                     |
| M-<right>/<left> | Decrease/increase level of a        |
|                  | parent item only                    |
|                  |                                     |
| S-<TAB>          | In table, go to previous cell       |
|                  | In other places, global fold/unfold |
|                  |                                     |

C-x n s :: Work on one section
C-x n w :: Back to outline

C-c C-j :: jump to different heading. C-g to exit. up/down to move headline, ~/~ sparse-tree search

M-<RET> or C-<RET> :: insert heading

*** Drawer
C-c C-x d :: Create a drawer

:MYDRAWER: 
This is inside the drawer

:END:

** Symbol and Escape <<<emacs:escape>>>

#+BEGIN_EXAMPLE
\vert{}
which escapes |
#+END_EXAMPLE

[[http://orgmode.org/worg/org-symbols.html][Table of Symbols]]

** =TODO=
#+BEGIN_EXAMPLE
=** TODO=
#+END_EXAMPLE
S-left/right :: Cycle through *TODO*, *DONE* and empty.

** Sparse Tree, Search
C-c / r :: Search regex, C-c C-c to quit.
M-g M-n :: Next match
M-g M-p :: Previous match

** Link <<<emacs:link>>>
[[http://orgmode.org/manual/Link-format.html#Link-format][Here's description of the link]]

| C-c C-l | add or modify link                             |
|         | Or cusor to the right of end and hit BACKSPACE |
|---------+------------------------------------------------|
| C-c &   | Go back to previous position                   |
| C-c C-c | Update radio targets                           |

#+BEGIN_EXAMPLE
=[[My Target]]= 
By defalt, it leads to a text search
#+END_EXAMPLE

#+BEGIN_EXAMPLE
[[Link]] "Link" matches an exact headline
#+END_EXAMPLE

#+BEGIN_EXAMPLE
Something is referred to later in the file <<internal target>>
[[internal target]] will go to the target
#+END_EXAMPLE

#+NAME: Table One
| a  | table      |
|----+------------|
| of | four cells |
|----+------------|

#+BEGIN_EXAMPLE
Go to a named section [[Table One]]
#+END_EXAMPLE

<<<emacs:radio>>>
#+BEGIN_EXAMPLE
<<<Radio target>>>
This causes each occurence of 'Radio target' in normal text to become activated as a link
Emacs only update radio targets when the file is first loaded. To manual update, C-c C-c
#+END_EXAMPLE

* PHP
** Locale
In Linux, you can run =locale -a= to get a list of codes
Linux return multi-letter codes. You can use 3-letter or 2-letter codes as a backup.
[[https://www.w3.org/WAI/ER/IG/ert/iso639.htm][ISO 639 3-letter codes]]

** Date
*** Create a custom date
**** mktime return Unix timestamp
$_u_time = mktime(11,0,0,11,22,2016); // hour, min, sec, month, day, year, $is_dst(daylight saving, 0 or 1)

**** String to Time
$_u_time = strtotime('2016-11-01');

*** Date in Other Languages (Locale)
$_u_time = mktime (11, 0, 0, 11, 22, 2016);
setlocale(LC_TIME, 'fr_FR.utf8','fra'); // try fr_FR.utf8 first, if fail, try fra
$_fr_time = array();
$_fr_time[] = strftime('%A', $_u_time); // format a date/time according to locale settings
$_fr_time[] = trim(strftime('%e', $_u_time)); // day of month, single digit with leading space if it's single digit..
$_fr_time[] = strftime('%B', $_u_time);
$_fr_time[] = strftime('%Y', $_u_time);
$_fr_time = ucwords(implode(' ', $_fr_time));
echo $_fr_time;

** Multibyte
*** Remove 4 byte characters
<<<php:4byte>>>
PHP UTF-8 character range is wider than MySQL utf8. MySQL's true UTF-8 is utf8mb4 but sometimes it's hard change.
mysql:charset d7:mysql:charset 

Here's how to remove any 4 byte character.

#+BEGIN_EXAMPLE
function replace4byte( $string ) {
  return preg_replace( '%(?:
          \xF0[\x90-\xBF][\x80-\xBF]{2}      # planes 1-3
        | [\xF1-\xF3][\x80-\xBF]{3}          # planes 4-15
        | \xF4[\x80-\x8F][\x80-\xBF]{2}      # plane 16
    )%xs', '', $string );
}

var_dump( 
  replace4byte( 'd' ), 
  replace4byte( 'd_Emoji_d' ) 
);
#+END_EXAMPLE

** Array
*** array_merge, array_merge_recursive
array_merge
- only merge on the first level
- If key is the same, value at later array will overwrite the first array's value.

array_merge_recursive
- If key is the same, values will be appended as array
- Very different from array_merge

*** Last element
$_last = end($target_array);
reset($target_array);

*** Search Value and Return Key
Case insensitive search
#+BEGIN_EXAMPLE
$a= array(
'k1'=> 'one',
'k2' => 'one1',
'k3' => 'three',
);

print_r( preg_grep( "/ONe$/i" , $a ) );
// Array ( [k1] => one )
#+END_EXAMPLE

Use ~in_array('string', $a)~ for case sensitive search

*** Change Case for All Keys
#+BEGIN_EXAMPLE
$_lower_GET = array_change_key_case($_GET, CASE_LOWER);
// Or CASE_UPPER
#+END_EXAMPLE

*** Get values of a column in a multidimensional array
You have this array
#+BEGIN_EXAMPLE
$records = array(
    array(
        'id' => 2135,
        'first_name' => 'John',
        'last_name' => 'Doe'
    ),
    array(
        'id' => 3245,
        'first_name' => 'Sally',
        'last_name' => 'Smith'
    ),
    array(
        'id' => 5342,
        'first_name' => 'Jane',
        // Notice! there's no last_name     
    ),
    array(
        'id' => 5623,
        'first_name' => 'Peter',
        'last_name' => 'Doe'
    )
);
#+END_EXAMPLE

array_column($records, 'last_name') is
#+BEGIN_EXAMPLE
['Doe', 'Smith', 'Doe']
#+END_EXAMPLE

array_column($records, 'last_name', 'id') is
#+BEGIN_EXAMPLE
[ 2135 => 'Doe', 3245 => 'Smith', 5623=>'Doe']
#+END_EXAMPLE

Require PHP 5.5+

*** Remove values
Single dimension
#+BEGIN_EXAMPLE
$arr = ['nice_item', 'remove_me', 'another_liked_item', 'remove_me', 'remove_me_also'];
$arr = array_diff($arr, ['remove_me', 'remove_me_also']);
#+END_EXAMPLE

** Random Integer Number
There're several ways

#+BEGIN_EXAMPLE
$numbers = range(0,12); // 0, 1, 2, ..., 12
shuffle($numbers);
echo $numbers[0];
#+END_EXAMPLE

#+BEGIN_EXAMPLE
echo(mt_rand(10,100)); // min: 0, max: 100
#+END_EXAMPLE

** Heredoc, Nowdoc
Heredoc result is a double-quoted string
#+BEGIN_EXAMPLE
$html = <<<HTML
<span>{$obj->name[1]}</span>
HTML;
#+END_EXAMPLE

Nowdoc can't expand variables and the result is single quoted string
#+BEGIN_EXAMPLE
echo <<<'EOT'
<span>{$obj->name[1]}</span>
EOT;
#+END_EXAMPLE

** Apply XSLT on XML
#+BEGIN_EXAMPLE
$xml = new DOMDocument;
$xml->load('cdcatalog.xml');

$xsl = new DOMDocument;
$xsl->load('cdcatalog.xsl');

$proc = new XSLTProcessor;
$proc->importStyleSheet($xsl);

echo $proc->transformToXML($xml);
#+END_EXAMPLE

** Block Referral Traffic
#+BEGIN_EXAMPLE
if ( isset( $_SERVER['HTTP_REFERER'] ) ) {
  $_referer_domain = array(
    "~timebie\.com~i",
    "~ana-white\.com~i",
    "~mlizcochico\.com~i",
    "~adishofdailylife\.com~i",
    "~techvibes\.com~i",
    "~sociableblog\.com~i",
    "~laurenconrad\.com~i",
    "~gingerhotels\.com~i",
    "~grammarist\.com~i",
    "~dobbersports\.com~i",
    "~netsidebar\.com~i",
    "~myhomeideas\.com~i",
    "~fhm\.com~i",
    "~gamezebo\.com~i"
  );

  foreach ( $_referer_domain as $_referer ) {
    if ( preg_match( $_referer, $_SERVER['HTTP_REFERER'] ) ) {
      exit;
    }
  }
  // php:parse_url
  $_referrer = parse_url($_SERVER['HTTP_REFERER']);
  if ($_referrer !== false && !is_null($_referrer['host'])
      && preg_match( "~oralhealthgroup\.com~i", $_referrer['host'] )) {
    $_p = (isset($_GET['p'])) ? $_GET['p'] : '';
    $_subid = (isset($_GET['subid'])) ? $_GET['subid'] : '';
    $_uid = (isset($_GET['uid'])) ? $_GET['uid'] : '';
    if ($_p !== '' && $_subid !== '' && $_uid !== '') {
      exit;
    }
  }
}
#+END_EXAMPLE

** PHPDoc
https://www.drupal.org/coding-standards/docs
The docblock has to be immediately above the code.

#+BEGIN_EXAMPLE
/**
 * One-line summary, ending in a period (.).
 *
 * Additional paragraph of explanation.
 * Additional paragraph of explanation.
 *
 * @since 3.1.0
 * @param string $mail
 *   The email address. The description can be longer if necessary, and if so,
 *   you can wrap it to another line. Indented by 2 spaces
 * @param string $from
 *   (optional) The email address to send the mail from, if different from
 *   the site-wide address.
 * @param string $bcc One line description.
 * @return int One line description.
 */
#+END_EXAMPLE

** OOP

#+BEGIN_EXAMPLE
$rest = new RestJson('12345', 'trucks', 'new');
class RestJson {
  public $lwp_options, $listings; // can be different for each instance
  public static $filterables;

  // singleton. same for every instance.
  // Can only be updated by static function/method
  
  public function __construct($did, $industry, $condition)  {
    // Call a static function
    $this->lwp_options = self::getLwpOptions();
    // Call a instance function
    $this->listings = $this->getListings();
   
  }

  public static getLwpOptions() {
    // A static function can return a value
    // can change a static property
    // self::$filterables[] = '123';
    // But can't access the instance $this
    // Can't modify instance value $this->aPropertyName
    // Can't call instance method $this->aMethod();
  }
}
#+END_EXAMPLE

** Troubleshooting
*** Parse error: syntax error, unexpected end of file
Or ~Parse error: syntax error, unexpected 'endwhile' (t_endwhile)~

Check if php ~short_open_tag~ is enabled. Default is not enabled. 
Then search ~<? ~ with a space and replace them with ~<?php~

* Drupal
** Update Core
pantheon:drupal:core

** Update Module
- Read module README first
- Usually just remove the module directory and put the new one in
- And run update.php

** Module
*** Feed Import

#+BEGIN_EXAMPLE
$feed_obj = feeds_source($feed_id,$feed->feed_nid);
$feed_obj->existing()->import(); // Use this so no jobs are inserted in batch

// Sequence
$this = feeds_source;
hook_feeds_before_import($this)
hook_feeds_after_parse($this, $parser_result)
FeedsProcessor.inc->process parser_result
releaseLock()
hook_feeds_after_import($this)
#+END_EXAMPLE

Import drush command runtime can be long. Output something every 5 minutes to prevent drush command timeout
Do this in one of the hooks: 
- hook_feeds_before_update
- hook_feeds_presave 
- hook_feeds_after_save

#+BEGIN_EXAMPLE
function lili_feeds_presave(FeedsSource $source, $entity, $item) {

 $request_time = lili_custom_cache('timecounter');
 $interval = 60 * 5;
 if (!is_null($request_time)) {
  $row_counter = lili_custom_cache('rowcounter');
  lili_custom_cache('rowcounter',++$row_counter);
  $current_time = time();
  $seconds = $current_time - $request_time;
  if (floor($seconds/$interval) > 0) {
   lili_custom_cache('timecounter', $current_time);
   print "Presave row #$row_counter. $seconds seconds have passed.\n";
  } 
 }
 else {
  lili_custom_cache('timecounter', REQUEST_TIME);
  lili_custom_cache('rowcounter', 1);
 }

}
#+END_EXAMPLE

**** New Feed Tamper Plugin
The plugin does this: Drupal download file with real file extension

#+BEGIN_EXAMPLE
// Implements hook_ctools_plugin_directory()
function lili_ctools_plugin_directory($module, $plugin) {
 if ($module == 'feeds_tamper') {
  return 'plugins'; // path_to_lili_module/plugins/lili_*.inc
 }
}

// lili_change_image_extension.inc
// You can refer to path_to_feeds_tamper_module/plugins/explode.inc
$plugin = array(
  'form' => 'lili_image_extension_form',
  'callback' => 'lili_image_extension_callback',
  'validate' => 'lili_image_extension_validate', // optional
  'name' => 'Convert Image URL Extension',
  'category' => 'T and T', // group name
  'multi' => 'direct',
  // If multiple values are injected to the plugin,
  // 'direct' will pass the whole array as $field to callback
  // while 'loop' will loop over and pass each value to callback
);

function lili_image_extension_form($importer, $element_key, $settings) {
  $form = array();
  $form['info'] = array(
    '#markup' => t('Converts source image URLs that don\'t have regular image extension: jpg, png, etc.'),
  );

  // Extra variables to pass to $settings in callback
  $form['importer_name'] = array(
      '#type' => 'hidden',
      '#title' => t('Importer machine name'),
      '#default_value' => isset($settings['importer_name']) ? $settings['importer_name'] : $importer->id,
  );

  return $form;
}

function lili_image_extension_validate(&$settings) {
  // Validate $settings.
}

function lili_image_extension_callback($result, $item_key, $element_key, &$field, $settings, $source) {
  //settings has the importer name
  //$settings['importer_name']
  //$field has the importing field text value
  if (!is_array($field)) {
    $field = array($field);
  }

  $val = array();

  foreach ($field as $f) {
    $val[] = _lili_save_file_with_extension($f);
  }
  $field = $val;
}
#+END_EXAMPLE

**** XPath
Children nodes Photo under Images node.
Simply Images/Photo, the result is already array
Concate multiple nodes
=concat(photo1,';',photo2)= then explode

*** XML Sitemap
/admin/config/search/xmlsitemap/settings
Uncheck /Prefetch URL aliases during sitemap generation/

*** ThemeKey
<<<d7:module:themekey>>>

You can switch to a different based on some rules!
If you are not clear about some rules, you can just search in code. e.g. search 'system:query_string'

** Debug
watchdog('LOG_TYPE','message');
watchdog('LOG_TYPE', $message, array(), WATCHDOG_ERROR);
array() is to t() $message. Don't forget to put empty array otherwise you will have to manually
clean up the watchdog table!

If error or warning messages are printed using drupal_set_message, 
modify the `drupal_set_message` function so that it prints debug_backtrace
#+BEGIN_EXAMPLE
if ($type == 'error') {
  $message .= ' '. print_r(debug_backtrace(DEBUG_BACKTRACE_PROVIDE_OBJECT,3),1);
}
#+END_EXAMPLE

You can throw an Exception
#+BEGIN_EXAMPLE
throw new Exception(print_r($val));
#+END_EXAMPLE

** Configuration, Setting
Override configuration and setting based on the current dev environment
settings.php
$conf['admin_theme'] = 'seven';
pantheon:environment

For assigning permissions to roles, e.g. enable anonymous for Devel, you have to do it manually  

[[https://www.drupal.org/node/1525472][Variable name and its default value]]
- admin_theme :: 'seven'
- preprocess_css :: "1"/"0", aggregate.
- preprocess_js :: "1"/"0", aggregate.
- cache :: "1"/"0", cache pages for anonymous users
- block_cache :: "1"/"0", cache blocks
- cache_lifetime :: "0", none. Minimum cache lifetime
- error_level :: "0"/"1"/"2", none/error and warnings/all messages. Logging and errors.

If setting is an array, you have to override the whole array. Can't override a key value.

<<<d7:mysql:charset>>>
Since Drupal 7.50, Drupal now supports 4 byte UTF-8 with MySQL.
You will first need to run a custom drush command provided by a [[https://www.drupal.org/project/utf8mb4_convert][utf8mb4_convert module]] to convert
all Drupal database, tables and fields to charset utf8mb4 and collation utf8mb4_general_ci
Then change the database connection settings in settings.php
[[https://www.drupal.org/node/2754539][Drupal Doc]]

The utf8mb4_convert module requires inno_large_prefix=true when MySQL server is bootup.
Otherwise a test (->utf8mb4IsSupported) can't pass before any actions.
To bypass the test, re-create any string index columns varchar(255) to varchar(191)
For example:
ALTER TABLE cache_block CHANGE cid cid VARCHAR(191) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;

Do this for any problematic column the module returns.

For new website, changing the database connectio settings in settings.php is good enough.

If MySQL server doesn't bootup with inno_large_prefix=true, all indexed columns will have max varchar(191)

As a quick workaround, you can remove all php:4byte characters.

Refer to mysql:charset for important info

** URL Alias
Setup pattern for each node type
Configuration > Search and metadata > URL Aliases > Patterns
** Link, Module Path, Theme Path
*** Link
Empty link
#+BEGIN_EXAMPLE
l($text, 
  '', 
  array('fragment'=>' ', 
        'html'=>TRUE, // if $text is HTML, set this to true
        'external'=>TRUE,
  //    'attributes' => array('target'=> '_blank'),
  )
);
#+END_EXAMPLE

Function l add class="active" when the path is current_path(). Use url() instead.

#+BEGIN_EXAMPLE
url($path = NULL, $options = array())
#+END_EXAMPLE
Get URL alias
url() just returns a url. $options are the same as l().
url('taxonomy/term/1');

To embed a url directly to HTML href, you should check_url($url)

*** Module Path, Theme Path
global $base_url;
$mod_path =  $base_url.base_path().drupal_get_path('module', 'lili_mod_name');
$theme_pat = $base_url.base_path().drupal_get_path('theme', 'lili_theme_name');

Both have no trailing slash

*** global $base_url
No trailing slash
http://abc.com

** Translate
*** t()
$text = t("This is !name's website", array('!name' => $username));
$text = t("This is @name's website", array('@name' => $username));
$text = t("This is %name's website", array('%name' => $username));
$text = t(check_plain($text));
$link = l(t("Link text"), "node/123");
$link = t('Visit the <a href="@url">settings</a> page', array('@url' => url('admin')));

// `%` and `@` use `check_plain()`
// `%` adds `<em class="placehoder"></em>`
// `!` straight output.

** Global Variables
https://api.drupal.org/api/drupal/globals/7.x

- $base_url :: 'http://www.yoursite.com' wihtout trailing slash 

https://www.drupal.org/node/2537572

[[https://www.drupal.org/node/2537572][Drupal Properties]]
$_SERVER['*']
- QUERY_STRING :: query string without q e.g. 'foo=bar&koo=hoo'

** Common Functions
<<<d7:functions>>>

*** drupal_add_html_head
drupal_add_html_head($tag, 'unique-name');
// $head in html.tpl.php
$tag = array(
  '#tag'        => 'meta',
  '#attributes' => array(
    'property' => 'og:url',
    'content'  => $base_url,
  ),
);
drupal_add_html_head( $meta_og, 'lili_og_url' );

*** drupal_set_title
drupal_set_title($title = NULL, $output = CHECK_PLAIN);
- $title :: if NULL, leave the current unchanged

*** drupal_goto
drupal_goto($path = '', array $options= array(), $http_response_code= 302)

- $path :: a drupal path 'node/123' or a full url
- $options :: URL optoins to pass to url()

Redirect to homepage
drupal_goto('<front>'); 

*** drupal_valid_path($path, $dynamic_allow= TRUE)
$_path = current_path();

if (drupal_valid_path($_path)) {
  // Current user has access to this path/page
}

** Theme
*** System Theme
Default theme file is located at 
=sites/all/modules/mod_path/modname/templates/theme-name.tpl.php=

- template.php
- html.tpl.php
- page.tpl.php
- region.tpl.php
- block.tpl.php
- node.tpl.php
- comment-wrapper.tpl.php
- comment.tpl.php

d7:View_Theming

**** Fast detect if it's a node page
if (arg(0)=='node') {
  $node_id = arg(1);
} 

**** Include file in *.tpl.php
include(drupal_get_path('theme', 'theme_name').'/example-file-template.tpl.php');

If the file is in the same folder
<?php include 'abc.php'; ?>

**** html.tpl.php
Get node if it's a node page
$node = menu_get_object();
if (isset($node->type)) { ... }

**** page.tpl.php
Get node if it's a node page
hook_preprocess_page(&$variables) {
  if (!empty($variables['node']) && $variables['node']->type == 'NODETYPE') {
    $variables['greeting'] = 'Custom Greeting';
  }
}

*** Form Theme
$form['#theme'][] = 'lili_form';
If no custom theme function, d7:hook_theme d7:theme_*, is defined, then the default template file is
/sites/all/themes/your_theme/templates/form/lili_form.tpl.php

*** Custom Theme Function
Module theme: =theme('modname_theme-name',$data)=
<<<d7:hook_theme>>> 
- $existing :: array. existing themes
- $type :: string. Whether a theme, module, etc. is being processed. e.g. Is it a parent theme?
- $theme :: the name of theme, module, etc. is being processed
- $path :: the directory path of theme or module

Return an array
- variables :: 
- path :: Use with 'template'
  - If theme_* function is used, you don't need to specify 'path' and 'template'
  - if hook_theme is defined in template.php, the default path is sites/all/themes/your_theme/templates/
  - if hook_theme is defined in a module, the default path is sites/all/modules/mod_path/modname/templates
  - if path is not defined but template is defined (theme/template_file_name), then
    - hook_theme defined in template.php :: path_to_theme/theme/template_file_name
    - hook_theme defined in a module :: path_to_module/theme/template_file_name
 
- template ::
  - Assuming the theme function name is theme_lili_flair
  - Default file name is lili_flair and the actual file is lili_flair.tpl.php

<<<d7:theme_*>>>

#+BEGIN_EXAMPLE
function lili_theme( $existing, $type, $theme, $path ) {
  return array(
    'lili_flair' => array(
      'variables' => array(
        'text' => NULL,
      ),
    ),
  );
}

function theme_lili_flair( $variables ) {
  if ( ! empty( $variables['text'] ) ) {
    return '<span class="li-tag li-tag-pill li-tag-color">' . $variables['text'] . '</span>';
  } else {
    return '';
  }
}

echo theme('lili_flair',array('text'=>'hi'));
#+END_EXAMPLE

** Drush
*** Debug =-vd=
*** Alias
=drush sa= list all aliases
pantheon:drupal:alias

*** User
drush user-login yourusername

*** Module
=drush dl devel= Download a module
=drush en devel= Enable a module
=drush dis devel= Disable a module
=drush pmu devel= Uninstall a module
=drush up <modulename> -y= Update a module. Don't need to visit update.php

#+BEGIN_EXAMPLE
drush up <modulename> = drush upc <modulename> + drush updb
#+END_EXAMPLE

*** Detect if it's drush
#+BEGIN_EXAMPLE
if (drupal_is_cli() && function_exists('drush_main')) return true;
return false;
#+END_EXAMPLE

*** Watchdog
**** Delete
#+BEGIN_EXAMPLE
# delete all logs
drush wd-del all

drush wd-del --type=cron

drush wd-del --severity=notice
#+END_EXAMPLE

**** Tail Recent Log Messages
#+BEGIN_EXAMPLE
drush watchdog-show --tail --full --count=50
#+END_EXAMPLE

*** Drupal Cache
Clear all Drupal Cache
#+BEGIN_EXAMPLE
drush cc all
#+END_EXAMPLE

*** Custom Drush
hook_drush_command() and drush_hook_your_command() in hook.drush.inc

#+BEGIN_EXAMPLE
function li_drush_command() {
  $items['feeds-import-tnt']=[
    'description' => '...',
    'options' => [
      'feed-id' => ['description' => dt('Feed ID to import') ]
    ],
  ];
  return $items;
}

function drush_li_feeds_import_tnt() {
  //
}
// drush feeds-import-tnt --feed-id=123
#+END_EXAMPLE

drupal_set_message()
- stdout. No logging. Can be used multiple times in a drush command. 
- =[status]= at the end of each line
- not print out immediately

Use the following every 3 minutes to prevent drush command timeout
#+BEGIN_EXAMPLE
print "hello\n"; // print out immediately
drush_print(); // drush_print uses print
drush_print_r($array);
#+END_EXAMPLE

*** Pantheon Drush

** Views
*** UI 
**** Contextual filter with term name not term id
Choose =Content: Has taxonomy term ID=
Check =Specify validation criteria=
Validator =Taxonomy Term=, Filter value type =Term name converted to Term ID=
Check =Transform dashes in URL to spaces in term name filter values=
**** Path vs Link
Content: Path with Rewrite Result option "Use absolute link" is the raw path.
**** Field value is taxonomy ID not taxonomy name
Use Rewrite Result "[field_name-tid]" 
*** View Object
Hooks use $view object.
**** Properties
args :: array(
 0 => '37',
)
name :: 'tt_taxonomy'
current_display :: 'page'
**** Methods
$v->get_items_per_page(); // Return nothong in hook_views_pre_build
$v->set_items_per_page(10); // hook_views_pre_build

*** hook_views_pre_build
*** hook_views_pre_render
**** Change Global Custom Text
Change the field value with tokens in Views UI
#+BEGIN_EXAMPLE
function lili_views_pre_render(&$view) {
	if ($view->name == 'lili_view' && $view->current_display == 'page') {

		// Change value for specific rows
		foreach ($view->result as $k => $r) {
			if ($f = &$r->field_field_flag) {
				$o = $f[0]['rendered']['#markup'];
				$o = theme('lili_theme_flair', array('text'=>$o));
				$f[0]['rendered']['#markup'] = $o;
			}

			// Taxonomy field
			if ($f = &$r->field_field_category) {
				$exclude_tids = array(1,2,3);
				foreach ($f as $k => $v) {
					if (!in_array($v['raw']['tid'], $exclude_tids)) {
						// Remove from display
						unset($f[$k]);
					}
				}
			}
			
		}

		// Only change global custom text for a subset of contextual filter value
		// The first context filter value
		if ($view->args[0] == 'filter_value') {
			// Check View UI Theme Information to get the Global Custom Text field ID
			if (isset($view->field['field_thumbnail']->options['exclude'])) {
				// Exclude display
				$view->field['field_thumbnail']->options['exclude'] = 1;
			}
			if (isset($view->field['nothing']->options['alter']['text'])) {
				// Change a field's CSS Class setting for all records
				$view->field['nothing']->options['element_class'] = '';
				$o = $view->field['nothing']->options['alter']['text'];
				$view->field['nothing']->options['alter']['text'] = 'hello'.$o;
			}
		}
	}
}
#+END_EXAMPLE

*** Better Exposed Filters
better_exposed_filters. Require views and ctools
If you want checkboxes or radio buttons instead of the Views Basic Exposed Form which is dropdown select.

Change BEF form hook_form_views_exposed_form_alter
#+BEGIN_EXAMPLE
function lili_form_views_exposed_form_alter(&$form, &$form_state) {
}
#+END_EXAMPLE

*** Embed View
views_embed_view('view_name','display_id');
$arg1 = $arg2 = '123';
views_embed_view('view_name','display_id',$arg1,$arg2);

*** View Theming
<<<d7:View_Theming>>>

View, named foobar. Style: unformatted. Row styel: Fields. Display: Page.

- views-view-foobar--page.tpl.php
- views-view-page.tpl.php
- views-view--foobar.tpl.php
- views-view.tpl.php

- views-view-unformatted--foobar--page.tpl.php
- views-view-unformatted--page.tpl.php
- views-view-unformatted--foobar.tpl.php
- views-view-unformatted.tpl.php

- views-view-fields--foobar--page.tpl.php
- views-view-fields--page.tpl.php
- views-view-fields--foorbar.tpl.php
- views-view-fields.tpl.php

** Form
*** Form alter hooks
=hook_form_alter= 
=hook_form_BASE_FORM_ID_alter=, Refer BASE_FORM_ID to =$form_state['build_info']['base_form_id']=
=hook_form_FORM_ID_alter=. Refer FORM_ID to =$form['#id']=

Set default value and hide a form from display or filling
#+BEGIN_EXAMPLE
// Entity reference form field
$form['field_dealer'][LANGUAGE_NONE][0]['target_id']['#default_value'] = 123;
$form['field_dealer'][LANGUAGE_NONE][0]['#printed'] = TRUE;
#+END_EXAMPLE

*** Form IDs of system forms
=node= :: node new/edit
=user_profile= :: page/user/<uid>

lili_node_form_alter

node type (content type) ad_listing, that node's new/edit form is
lili_form_ad_listing_node_form_alter using hook_form_FORM_ID_alter hook

#+BEGIN_EXAMPLE

#+END_EXAMPLE

*** Confirm Form
e.g. Confirm before delete
#+BEGIN_EXAMPLE
// Menu
$items['dealer_user/%/delete'] = array(
	'title' => 'Delete a user',
	'page callback' => 'drupal_get_form',
	'page arguments' => array('lili_delete_dealer_user_confirm',1),
	'access callback' => 'lili_user_has_delete_right',
	'access arguments' => array(1, array('Dealer Admin')),
	'type' => MENU_LOCAL_TASK,
);

function lili_delete_dealer_user_confirm($form, &$form_state, $id) {
	$form['delete'] = array(
		'#type' => 'value',
		'#value' => $id,
	);
	return confirm_form($form,
		t('Are you sure you want to delete this user?'), // Question
		'dealer_manage_users',  // Path to go to if No
		t('This action cannot be undone.'), // Description
		t('Delete Button'), // Yes: text
		t('Cancel Button') // No: text
		//, $name default 'confirm': internal name used to refer to the confirmation item.
	);
}

function lili_delete_dealer_user_confirm_submit($form, &$form_state) {
	if ($uid = $form_state['values']['delete']) {
		$u = user_load($uid);
		user_cancel();
		drupal_set_message(t('The user account has been deleted!'));
	}
	$form_state['redirect'] = 'dealer_manager_users';
}

function lili_user_has_delete_right($uid = 0, array $roles) {
	global $user;
	// If user is anonymous
	if (user_is_anonymous()) {
		return FALSE;
	}
	if (in_array('administrator', $user->roles)) {
		return TRUE;
	}
	if (array_intersect($roles, $user->roles)) {
		return TRUE;
	}
}
#+END_EXAMPLE

** Action
hook_info_action
return ['action_name' => $an_action];

$an_action :: array
- 'permissions' :: this is specific for View Bulk Operations (VBO). e.g. array('switch users')
- 'behavior' :: array. VBO uses one of views_property, changes_property, creates_property, deletes_property

[[https://www.drupal.org/node/2052067#permissions][VBO Permissions]]

** Database
*** Close Comment for Existing Nodes
0 = No, 1 = Closed (read only), 2 = Open (Read/Write)
#+BEGIN_EXAMPLE
UPDATE node, node_revision
SET node.comment = 1, node_revision.comment = 1
WHERE node_revision.nid = node AND node.type = 'article'
#+END_EXAMPLE

*** Structure
**** node
nid* :: INT
type :: string, e.g. article, 
title

**** field_data_body
entity_type* :: string, e.g. node
deleted* :: int, 0 not deleted
entity_id* :: int, e.g. node id
language* :: string
delta* :: int, multiple values, start as 0
bundle :: string, e.g. node type article
revision_id :: int

body_value :: longtext
body_summary :: longtext

**** field_data_field_custom_term_reference
field_custom_term_referecen_tid :: int

**** taxonomy_term_data
tid* :: int
name :: string, term name

**** field_data_field_contributor (entity reference)
field_contributor_target_id :: int

**** url_alias
pid* :: int, path id
source :: string, e.g. node/2, taxonomy/term/11
alias :: string
language :: string, e.g. und

**** Raw Query
#+BEGIN_EXAMPLE
SELECT n.title,
  b.body_value,
  GROUP_CONCAT(t.name SEPARATOR ', ') AS Category,
  IFNULL(na.title,'') AS author,
  CONCAT('http://domain.com/',u.alias) as url,
  FROM_UNIXTIME(n.created) as post_date

FROM node AS n
  INNER JOIN field_data_body b ON b.entity_id=n.nid AND b.delta=0
  INNER JOIN field_data_field_category c ON c.entity_id=n.nid AND c.deleted=0
  LEFT JOIN taxonomy_term_data t ON t.tid = c.field_category_tid
  INNER JOIN field_data_field_contributor a ON a.entity_id=n.nid AND a.deleted=0
  LEFT JOIN node as na ON na.nid=a.field_contributor_target_id
  INNER JOIN url_alias u ON u.source = concat('node/',n.nid)

WHERE FROM_UNIXTIME(n.created)
      BETWEEN '2014-01-01 00:00:00' AND '2014-12-31 23:59:59'
  AND n.type ='article'
GROUP BY n.title, b.body_value,na.title, u.alias, n.created
ORDER BY n.created DESC
#+END_EXAMPLE

** Query
Use db_query as much as possible. db_select is slow because it calls alter hooks.
Both can only be looped once using foreach

Use db_query or db_select to get all nids, load all nodes at once and then manipulate fields.

#+BEGIN_EXAMPLE
$q = db_select( 'node', 'n' );
$q->join( 'field_data_body', 'b', 'n.nid=b.entity_id AND b.delta=0' );
$q->innerJoin( 'field_data_field_category', 'nc'
  , 'n.nid=nc.entity_id AND nc.deleted=0' );
$q->innerJoin( 'taxonomy_term_hierarchy', 'tH', 'tH.tid=nc.field_category_tid' );

if ( ! is_null( $termID ) ) {
  $articleCats = array( $termID );
}

$q->fields( 'n', array( 'nid', 'title', 'created' ) )
  ->fields( 'b', array( 'body_summary', 'body_value' ) )
  ->condition( 'n.status', 1 )// Published.
  ->condition( 'n.type', 'article' )// article not page.
  ->condition(
    db_or()
      ->condition( 'nc.field_category_tid', $articleCats, 'IN' )
      ->condition( 'tH.parent', $articleCats, 'IN' )
  )
  ->range( $i_start, $i_length )
  ->groupBy( 'n.nid' )
  ->orderBy( 'created', 'DESC' );
$r = $q->execute();

$nids = [ ];
foreach ( $result as $n ) {
  $nids[] = $n->nid;
}
$nodes = node_load_multiple( $nids );

foreach ( $nodes as $node ) {
  $nodeID    = $node->nid;
  $nodeTitle = $node->title;
  $nodeBody  = lili_getFieldSafe( $node, 'body' );
  $nodeURL   = url( "node/" . $node->nid );

  $nodeSplashObj = field_get_items( 'node', $node, 'field_splash_image' );

  if ( is_array( $nodeSplashObj ) ) {
    // $nodeSplashObj['#item']['uri'];
    // $nodeSplashObj['#item']['width'];
    // $nodeSplashObj['#item']['height'];
  }

  // Entity Reference
  $nodeFlag = field_get_items('node',$nodeObj,'field_flag');
  if ($nodeFlag) {
    $nodeFlag = field_view_value('node', $node, 'field_flag', $nodeFlag[0]);
    $nodeFlag = $nodeFlag['#markup'];
    $nodeFlag = theme_infscroll_flair(array('text'=>$nodeFlag));
  }
  else {
    $nodeFlag = '';
  }

}

function lili_getFieldSafe( $node, $field ) {
  $s = field_get_items( 'node', $node, $field );
  if ( $s ) {
    $s = ( $s[0]['safe_value'] ) ? $s[0]['safe_value'] : '';
  } else {
    $s = '';
  }

  return $s;
}
#+END_EXAMPLE

** Entity
Node, user, taxonomy are all entities.

*** EntityFieldQuery
Use this to get entities of one type that have certain:
- entity properties (propertyCondition: status, changed, etc)
- field values (fieldCondition)
- entity meta data (entityCondition: bundle, entity_type, entity_id and revision_id)
- It's essentially db_select except EFQ can't do joins
- It's a lot slower
- But it provides simple syntax
- It's good for quick filtering entities by basic field values and return entity ids
- Preferred over db_select
- EFQ can return any type of entities including nodes of various types
- EFQ can only return essential fields such as node nid, vid and type
- Use EFQ result nids and node_load_multiple or entity_load
- Use EFQ result nids and get values of a field for all nodes (load only one field for all nodes)
- If you want custom fields and node->title, better to use node_load_multiple or entity_load
- By default without addMetaData, EFQ requires permissions of all the fields!

#+BEGIN_EXAMPLE
$_q = new EntityFieldQuery();
$_r = $_q
->entityCondition('entity_type', 'node') // taxonomy_term, user
->entityCondition('bundle', 'newsletter') // node type or content type
->fieldCondition('field_active','value',1,'=') // boolean field, only 1 or 0
->fieldCondition('field_news_publishdate', 'value', $year . '%', 'like') // Text LIKE
->fieldOrderBy('field_ns_newsletter_unique_id', 'value', 'DESC') // Sort
->fieldCondition('field_a_term_reference_field', 'tid', 123) // field Term Reference
->fieldCondition('field_dealer', 'target_id', 12345, '=') // field Entity Reference, single value
->fieldCondition('field_contacts', 'target_id', 12345) // field Entity Reference, multiple values have one 12345
/* NOT IN
12345 not in mutliple target_id: you have to do one query to show all and do one with 'IN' and 
get the difference
$_r_all = (!empty($_r_all['node'])) ? $_r_all['node'] : array();
$_r_in_12345 = (!empty($_r_in_12345['node'])) ? $_r_in12345['node'] : array();
$_r = array_diff_key($_r_all, $_r_in_12345);
*/

->propertyCondition('status',1) 
// status, type, nid, uid, rui, type, created
// search for "Implements hook_entity_info()" will show all entity properties

// Operators
// Default '='
// <>, >, >=, <, <=
// STARTS_WITH, CONTAINS
// IN, NOT IN (does not work)
// BETWEEN :: propertyCondtion('created', array($start, $end), 'BETWEEN')

->range(0,10)
// Random order. hook_query_TAG_alter
->addTag('random')

/* If you run EFQ in Drupal Cron, by default the user is anonymous
   You should run EFQ as a user
*/
->addMetaData('account', user_load(1))
->execute();

/* array(
 'node' => // follow the entity_type: e.g. node, taxonomy_term, user 
 array(
  28912 => obj(nid => 28912) // could be uid, nid, tid
  ...
 )
)
*/

if (!empty($_r['node'])) {
  $nodes = node_load_multiple(array_keys($_r['node']));
  // If you just want to load a handful of fields, you don't have to load the whole nodes
  // $stories = $_r['node'];
  // Get all fields of the entity type first
  // $fields = field_info_instances('node', 'story'); // node type is story
  // Get the field id
  // $field_id = $fields['field_story_image']['field_id'];
  // Attach the field to the entities loaded by EFQ
  // field_attach_load('node', $stories, FIELD_LOAD_CURRRENT,
  //  array('field_id' => $field_id));
  // All the values of field_story_image of all nodes
  // $output = field_get_items('node', $stories, 'field_story_image');
}
#+END_EXAMPLE

*** Update a field of an entity only

node_save could invoke other hooks and hence cause errors in saving a field value
#+BEGIN_EXAMPLE
$node = node_load($nid);
$node->field_fieldname[LANGUAGE_NONE][0]['value'] = 'some value';
node_save($node);
#+END_EXAMPLE

Use field_attach_update() instead
#+BEGIN_EXAMPLE
$node = node_load($nid);
$node->field_fieldname[LANGUAGE_NONE][0]['value'] = 'some value';

unset($node->field_unwanted_1); // remove unwanted fields
field_attach_update('node', $node);
#+END_EXAMPLE

Without node_load
#+BEGIN_EXAMPLE
$node = new stdClass();
$node->id = $id_value; // node id
$node->type = $content_type; // aka content type

$node->field_fieldname[LANGUAGE_NONE][0]['value'] = 'some value';
field_attach_update('node', $node);
#+END_EXAMPLE

May be better to call field_attach_presave which node_save does
#+BEGIN_EXAMPLE
field_attach_presave('node', $node);
field_attach_update('node', $node);
#+END_EXAMPLE

*** entity_metadata_wrapper

Get a field value of an entity (node). Add a wrapper first `$_wrapper=entity_metadata_wrapper('node',$node);`.
$node can be a node/entity object or the node/entity id. Entity API module is needed.
Then list all fields using `$_wrapper->getPropertyInfo();`
Then get a specific field `$_wrapper->field_name->value();` or `->raw();`
// Unified way of getting $node->title, $user->name, ...
$wrapper->label(); or $wrapper->title->value();
// Unified way of getting $node->nid, $user->uid, ...
$wrapper->getIdentifier();
// Unified way of getting $node->type, ...
$wrapper->getBundle();

// Text field
$old_value = $wrapper->field_my_text->value();
if (isset($old_value)) {
  // non-null, could be empty or 0
}
$wrapper->field_my_text = 'new value';

// Longtext
$wrapper->body->value(); // Array of: value, safe_value, format, and optionally summary + safe_summary.
$wrapper->body->value->value(); // Filtered value.
$wrapper->body->value->raw(); // Unfiltered value.
$wrapper->body->format->value(); // The selected text format.
$wrapper->body->value = 'new value';

// Link
$wrapper->field_my_link->value(); // Array of: url, title, attributes.
$wrapper->field_my_link->url->value(); // Hyperlink destination.
$wrapper->field_my_link->title->value(); // Hyperlink text.
$wrapper->field_my_link->attributes->value(); // Array of: target, title, etc.
$wrapper->field_my_link->url = 'http://mediacurrent.com';
$wrapper->field_my_link->title = 'Do Drupal Right';

// Radio and Checkbox
$v = $wrapper->field_my_radio->value(); // on = 1, off = 0
$info = field_info_field('field_my_radio'); // on = New, off = Used
$allowed_values = $info['settings']['allowed_values'];
$label = $allowed_values[$v]; // on = New, off = Used

// Delete a value
$wrapper->field_foobar = NULL;

// Save
$wrapper->save();

// Select list of taxonomy or entity reference, General Usage
Append index
`$term = $_wrapper->field_taxonomy_a[0]->value();`
If only one value is allowed, it doesn't have index.
Loop
foreach ($_wrapper->field_list_of_values as $item) {
//  do something
}

// Taxonomy in select list
For taxonomy term field which can be multiple values, you still need to specify the index
`$term = $_wrapper->field_taxonomy_a[0]->value();` // this might be wrong..

Multiple Tax Terms
#+BEGIN_EXAMPLE
$a = $wrapper->$field->value();
if (isset($a)) {
  echo $a[0]->name;
  echo $a[0]->tid;
}
#+END_EXAMPLE

Single Tax Term
#+BEGIN_EXAMPLE
$a = $wrapper->$field->value();
if (isset($a)) {
  echo $a->name;
  echo $a->tid;
}
#+END_EXAMPLE

Multiple Files
#+BEGIN_EXAMPLE
$a = $wrapper->$field->value();
if (isset($a)) {
  $r=$a;
  foreach ($r as $k => $v) {
    $r[$k]['url'] = file_create_url($r[$k]['uri']);
    // convert URI to public URL
    // Drupal doesn't provide public 'url'
  }
  echo $r[0]['uri'];
  echo $r[1]['uri'];
}
#+END_EXAMPLE

Term id of the first value of a multiple value field
`$tid = $_wrapper->field_taxonomy_a[0]->raw();`
For taxonomy term field which can only have one value:
Term ID: `$_wrapper->field_tax_1->raw();`
Check empty `if (isset($tid))`

Term name: `$_wrapper->field_tax_1->name->value();`
Or in a multi value list `$v = $_wrapper->field_tax_1[0]->value(); echo $v->name;`

Add a term or entity reference: `$_w->field_tax_1[] = 42; $_w->save();`
Set as a whole `$_w->field_tax_1->set(array(42,43)); $_w->save();`

Loop
#+BEGIN_EXAMPLE
foreach ($_wrapper->field_industry as $taxonomy_wrapper) {
  $industry = $taxonomy_wrapper->tid->value();
}
#+END_EXAMPLE

A list of text
#+BEGIN_EXAMPLE
// All values in a list text as an array
$wrapper->field_list_text->value();

foreach ($wrapper->field_taxonomy_terms->getIterator() as $delta => $term_wrapper) {
  // $term_wrapper may now be accessed as a taxonomy term wrapper.
  $label = $term_wrapper->name->value();
  // list text, delta is 0, 1
  // List text value $term_wrapper->value();
}
#+END_EXAMPLE

If the list of text field only allows one value, then the value is
~$w->field_list_text->value();~ The same as getting a text field

// Entity reference in select list
Single value. Tid is $tid = $wrapper->field_list_entity->raw();
Check empty `if (isset($tid)) { echo $wrapper->field_list_entity->value()->title}`
Multiple values.

https://www.drupal.org/documentation/entity-metadata-wrappers
http://www.mediacurrent.com/blog/entity-metadata-wrapper

** Entityform
D7 uses entityform module. D8 is called EForm.
Load an entityform
#+BEGIN_EXAMPLE
// Load the module file. Optional
// module_load_include('inc', 'entityform', 'entityform-admin');
$_contact_form = entityform_empty_load('entityform_id');
$mode = 'submit'; 
// Default. Other: 'edit'
$form_context = 'page'; 
// Default. Ohter: 'embedded'
$_renderable_form = entityform_form_wrapper($_contact_form, $mode, $form_context );
#+END_EXAMPLE

Try to prefill entityform in hook_form_FORM_ID_alter(). Say the entityform is named dealer_contact
The hook is lili_form_dealer_contact_entityform_edit_form_alter

Use modal in CTools, you will need t:
- [[https://www.drupal.org/project/entityform][Entityform]]
- [[https://www.drupal.org/project/modal][Modal operations]]
- [[https://www.drupal.org/project/modal_forms][Modal forms (with ctools)]]
- Enable the Modal entityforms module
- Create a link (e.g. in View)
#+BEGIN_EXAMPLE
<a href="/modal/entityform/YOUR_FORM_IDENTIFIER/nojs/0" 
   class="ctools-use-modal ctools-modal-modal-popup-small">Open Entity Form in Popup!</a>
#+END_EXAMPLE

** User
*** user_access
<<<d7:user_access>>>
user_access($string, $account = NULL)
$account
- NULL. current logged in user

** Menu
*** hook_menu: 'page callback'
You can print or echo some rendered HTML and then drupal_exit() or exit().
drupal_exit() prevents hoo_exit() from running.
Or print and echo some HTML and return NULL;
No header or footer will be added. The page is pure what you output here.

Or you can return a renderable array. Header and footer will be included.
- return $form. You may theme the form by $form['#theme'][] = 'custom_theme_name'; and return $form
- return theme('custom_theme_name', ['vars'=>...]);

In page callback function, you can manipulate some variables used in html.tpl.php and page.tpl.php
Such as change the page title drupal_set_title
Refer to d7:functions

*** hook_menu: 'file'
You can local the page callback function in a different file. e.g. 'lili.pages.inc'
The path is the current module path

*** hook_menu: 'type'
- MENU_CALLBACK :: A hidden internal callback. Best for return plain text in API calls.
- MENU_LOCAL_ACTION :: An action specific to the parent, usually rendered as a link
- MENU_LOCAL_TASK :: A task specific to the parent item, usually rendered as a tab.
- MENU_NORMAL_ITEM :: Shown in menu and breadcrumbs
- MENU_SUGGESTED_ITEM :: A normal menu item, hidden until enabled by an administrator

*** hook_menu: 'access callback', 'access arguments'
access callback
- default is 'user_access' d7:user_access
- custom callback must return boolean
- Often used callbacks: user_is_logged_in

access arguments
- e.g. array('administer nodes')

*** Embed a View Page
#+BEGIN_EXAMPLE
function lili_menu() {
  $items['path-different-from-view/%'] = array(
    'title' => t('page title');
    'page callback' => 'views_embed_view',
    'page arguments' => array('view_id', 'dispaly_id', 1),
    'type' => MENU_CALLBACK,
    'access callback' => TRUE,
  );
  return $items;
}
#+END_EXAMPLE
 
*** Array to CSV
page callback
drupal_add_http_header('Content-Type', 'text/csv; utf-8');
drupal_add_http_header('Content-Disposition', 'attachment;filename=csvfile.csv');

$fp = fopen('php://output', 'w');
fputcsv($fp, [$year. ' Ranking of Top 100 Carriers']);
$_columns = '#,Company,Web Site,Total,Trucks,Tractors,Trailers,O/OS,Employees';
$_columns = explode(',',$_columns);
fputcsv($fp, $_columns);

foreach ($data as $d) {
  $line   = [ ];
  $line[] = $d->this_rank;
  $line[] = $d->company_name;
  $line[] = $d->web_address;
  $line[] = $d->total_vehicles;
  $line[] = $d->trucks;
  $line[] = $d->tractors;
  $line[] = $d->trailers;
  $line[] = $d->owner_operators;
  $line[] = $d->full_time_employees;

  fputcsv( $fp, $line );
}

fclose($fp);
drupal_exit();

*** Json

#+BEGIN_EXAMPLE
function lili_menu() {
  $items['newsletter/archive/%/%'] = array(
    'title' => "",
    'page callback' => '_lili_archive_by_newsletter_json',
    'page arguments' => array(2,3),
    'access callback' => TRUE,
    'type' => MENU_CALLBACK,
  );

  return $items;
}

function _lili_archive_by_newsletter_json($pub_id,$newsletter_name, $page = 1, $items = 20) {
  drupal_add_http_header('Access-Control-Allow-Origin','*'); // CORS		
  $_result['total'] = '...';
  $_result['items'] = array('...');

  drupal_json_output($_result);
  //return 'hello';
}
#+END_EXAMPLE

** Taxonomy
#+BEGIN_EXAMPLE
// Get taxonomy terms of a node, ready for display with language
$categories = field_get_items('node', $node, 'field_category');
/* array(
0 => array(
  'tid' => 17,
  'taxonomy_term' => obj
),
...
)
*/


// Get multiple terms
$tids = array(1,2,3); // Default:array()
$conditions = array(); // Default
taxonomy_term_load_multiple($tids, $conditions);
/* array(
17 => obj(
  tid => '17',
  ...
)
...
)
*/

// Get term by name
$_limit_to_vocab = 'vocab_name'; // Default NULL.
$term_is_parent = taxonomy_get_term_by_name('video', $_limit_to_vocab);

// Get the first item in array
$term_is_parent = reset($term_is_parent);
echo $term_is_parent->tid; // Term id
// Get all children of a term
$children = taxonomy_get_children($term-tid);
$children_tids = array_keys($children);

// Get a vocabulary by name
$_vocab = taxonomy_vocabulary_machine_name_load('vocab_name');

// Get all terms of a vocabulary without extra fields
$_terms = taxonomy_get_tree($_vocab->vid);

// Get term ids only of all terms under a vocabulary
$_q = new EntityFieldQuery();
$_term_ids = $_q 
->entityCondition('entity_type', 'taxonomy_term')
->propertyCondition('vid', $_vocab->vid)
->execute();
foreach ($_term_ids['taxonomy_term'] as $term) {
  $term->id;
}

// Get all fields of all terms under a vocabulary
$_terms_with_all_fields = entity_load('taxonomy_term', FALSE, array('vid' => $_vocab->vid));
/* array(
17 => obj(
 tid => '17',
 ...
),
...
)
*/

// Or
$parent = 0; // Default
$max_depth = NULL; // Default
$load_entities = TRUE; // Default:False
$_terms_with_all_fields = taxonomy_get_tree($_vocab->vid, $parent, $max_depth= NULL, $load_entities);
/* array(
0 => obj(
  tid => '17',
  ...
)
...
)
*/

#+END_EXAMPLE

** Cache
Same page request
#+BEGIN_EXAMPLE
function lili_cache($field, $set = NULL) {
  $custom_cache = &drupal_static(__FUNCTION__);
  if (!isset($custom_cache)) {
    $custom_cache = array();
  }
  if ($set !== NULL && $field !== NULL ) {
    // $set_field_value = lili_cache('field_name', 123);
    $custom_cache[$field] = $set;
  } 
  elseif ($field !==  NULL && $set == NULL &&
      ( !isset($custom_cache[$field]) || $custom_cache[$field] == NULL ) 
     ) {
    // Set default
    // $set_field_value = lili_cache('field_name');
    switch ($field) {
      case "field_name":
        // complicated
        $custom_cache[$field] = '';
        break;
    } 
  }
 
  if (!isset($custom_cache[$field])) {
    $custom_cache[$field] = NULL;
  }

  return $custom_cache[$field];
}

// Set
lili_cache('current_node',$node);
// Get lili_cache('current_node');
#+END_EXAMPLE

** File
Read local or remote file to an object of strings
#+BEGIN_EXAMPLE
$result = drupal_http_request($url);
/*
obj(
 code // int 200
 headers
)
*/

$path = 'public://afolder/';
$replace = FILE_EXISTS_RENAME; // Default
// FILE_EXISTS_REPLACE, FILE_EXISTS_ERROR
file_unmanaged_save_data($result->data, $path, $replace);
#+END_EXAMPLE

<<<file_unmanaged_save_data>>>($data, $destination, $replace)
#+BEGIN_EXAMPLE
// $destination is folder path not folder path + filename
$temp_name = 'temporary://auniquefilename'
file_put_contents($temp_name,$data); // return number of bytes or false
file_unmanaged_move($temp_name,$destination, $replace); // rename
#+END_EXAMPLE

<<<Drupal download file with real file extension>>>
#+BEGIN_EXAMPLE
/**
 * Download external file to temporary filesystem
 * with correct file extension based on content-type in http response header
 *
 * @param $url string Full external URL of a file
 *
 * @return string Local file path with correct file extension
 */
function _lili_save_file_with_extension( $url ) {
  $filename  = $url;
  $extension = '';
  $result    = drupal_http_request( $url );

  if ( $result->code == 200 && isset( $result->headers['content-type'] ) ) {
    $mime_type_extension = array(
      'image/jpeg'  => 'jpg',
      'image/jpg'   => 'jpg',
      'image/png'   => 'png',
      'image/x-png' => 'png',
      'image/gif'   => 'gif'
    );

    foreach ( $mime_type_extension as $k => $v ) {
      if ( strcasecmp( $k, $result->headers['content-type'] ) == 0 ) {
        $extension = $v;
        break;
      }
    }

    if ( $extension !== '' ) {
      // Save file with correct file extension
      $filename = 'temporary://import_' . str_replace( ".", "_", microtime( TRUE ) ) . "." . $extension;
      file_put_contents( $filename, $result->data );
    }
  }

  return $filename;
}
#+END_EXAMPLE

** Image Handling (Core)
*** Setting
Define Image Styles ~/admin/config/media/image-style~
Use it in image field display or in code.
Image toolkit ~/admin/config/media/image-toolkit~ reduces the JPEG quality if Image Styles is applied.

Both Image Styles and Image toolkit don't modify the original images but instead create new images in real time.

*** Code
An image is a file. Get a image field:
#+BEGIN_EXAMPLE
$w = entity_metadata_wrapper('node', $node);
$images = $w->field_images->value();
if (isset($images)) {
  // If the image field is set to only hold one image, then
  // $images is ['uri'=>'...']
  foreach ($r as $k => $v) {
    $r[$k]['url'] = file_create_url($v['uri']);
    // convert internal URI to public URL. Drupal doens't provide public url by default.
    // This step doesn't create a file, just create a link
    // Get the image style public url
    $r[$k]['thumbnail'] = image_style_url('thumbnail', $v['uri']);
    // It creates an image styled link in db, when requesting the public url, the image will be created
  }
}
#+END_EXAMPLE

** Basic Ajax
#+BEGIN_EXAMPLE
// Create a menu to receive ajax
$items['newsletter/builder_entry/%'] = array(
    'title' => "",
    'page callback' => '_lili_add_session_handler',
    'page arguments' => array(2),
    'access callback' => 'user_access',
    'access arguments' => array('newsletter builder access'),
    'type' => MENU_CALLBACK,
);

function _lili_add_session_handler($command) {
if (!isset($_POST['ids'])) {
    return drupal_not_found();
  }

  if ($command === "manage") {
    // Add to the session variable detailing what items are added
    $_SESSION['session_name'] = array();

    $ids = json_decode($_POST['ids']);
    foreach ($ids as $id) {
      $id = trim($id);
      $_SESSION['session_name']["item_" . $id] = $id;
    }
  }
  else {
    return drupal_not_found();
  }
}

// Javascript
$.ajax({
 type: "POST",
 url: '?q=newsletter/builder_entry/manage',
 data: "ids=" + 'some string',
 success: function(e) {
   // do something
 },
 dataType: "json"
});
#+END_EXAMPLE

** Javascript API
[[https://www.drupal.org/docs/7/api/javascript-api/javascript-api-overview][Javascript API Overview]]

{
 'settings': {},
 'behaviors': {},
 'themes': {},
 'locale': {}
}

*** Settings
Pass PHP variable to javascript

PHP. Use camelCasing.
#+BEGIN_EXAMPLE
$my_settings = array(
  'basePath' => $base_path,
  'animationEffect' => variable_get('effect', 'none')
);
drupal_add_js(array('myModule'=>$my_settings), 'setting');
#+END_EXAMPLE

Javascript
#+BEGIN_EXAMPLE
var basePath = Drupal.settings.myModule.basePath;
var effect = Drupal.settings.myModule.animationEffect;
#+END_EXAMPLE

*** Behaviors
https://www.lullabot.com/articles/understanding-javascript-behaviors-in-drupal
https://www.amazeelabs.com/en/blog/drupal-behaviors-quick-how
https://www.drupal.org/node/756722

Any property defined in Drupal.behaviors will get called when DOM is ready or when Drupal.attachBehaviors() runs.
Drupal.attachBehaviors(); means attach all behaviors. When DOM is ready, Drupal runs:

#+BEGIN_EXAMPLE
// Attach all behaviors.
$(function () {
  Drupal.attachBehaviors(document, Drupal.settings);
});

// Syntax: Drupal.attachBehanviors(context, settings);
// When context is not defined, it's the document object in javascript
// when settings is not defined, Drupal.settings is used
// So Drupal.attachBehaviors(); is the same as Drupal.attachBehaviors(document, Drupal.settings);
#+END_EXAMPLE

Other modules might run multiple Drupal.attachBehaviors(); or Drupal.attachBehaviors(custom_context, custom_settings);

All properties defined in Drupal.behaviors will get called when Drupa.attachBehaviors(..., ...); runs! Some common situations:

- After an admin overlay has been loaded into the page.
- After AJAX Form API has submitted a form
- When an AJAX request returns a command that modifies HTML, such as ajax_command_replace()
- CTools calls it after a modal has been loaded
- Media calls it after media browser has been loaded
- Panels calls it after in-place editing has been completed
- Views calls it after loading a new page that uses AJAX
- Views Load More calls it after loading the next chunk of items
- Javascript from custom modules may call Drupal.attahcBehaviors() when they add or change parts of the page.
  - Such as drupal_add_js('jQuery(document).ready(function () { Drupal.attachBehaviors(); });', 'inline'); 

So you need to attach any event once using $('',context).once() !

This is mymod_path/js/drupal.behaviors.js
#+BEGIN_EXAMPLE
(function ($) {
  Drupal.behaviors.MODULENAME = {
    attach: function (context, settings) {
      console.log('This runs every time Drupal.attachBehaviors(); is called');
      // Run something only once (e.g. set jQuery event)
      $('.nav-flyout', context).once('remove-modals', function () {
        // After this is run, all elements selected will have a new class 'remove-modals-processed'
        $(document).keyup(function (e) {
          if (e.keyCode == 27) {
            $('.nav-flyout', context).removeClass('js-flyout-active');
          }
        });
      });
    }
  }
}(jQuery));
#+END_EXAMPLE

In Drupal
#+BEGIN_EXAMPLE
function hook_preprocess_page(&$vars) {
  // Append a property in Drupal.settings only. And before a behavior is attached and it will be run e.g. when DOM is ready
  drupal_add_js(array('MODULENAME' => array('php_var_1' => variable_get('php_var_1', ''))), 'setting');
  drupal_add_js(drupal_get_path('module', 'MODULENAME') . '/js/drupal.behaviors.js');
}
#+END_EXAMPLE

** Email
Define an email template using hook_mail()
#+BEGIN_EXAMPLE
function lili_mail($key, &$message, $params) {
 // Need to overwrite headers content type if email is html
 $message['headers']['Content-Type'] = 'text/html; charset=UTF-8; format=flowed';

 // $message['from'] is initially set by $from from drupal_mail(). 
 // If not provided, will use sidewide setting
 // $message['to'] and 'language' are set by $to from drupal_mail().

 switch ($key) {
  case 'template_1':
    // Use $params
    $message['subject'] = 'This is subject';
    $message['body'][] = 'Extra';
    $message['headers']['Bcc'] = 'bcc@abc.com';
    break;
 } 
}

// Send email
$module = 'lili'; // module name that the template is defined hook_mail
$to = 'to@abc.com';
$from = 'from@abc.com'; // Default Null
$language = language_default();
$send = TRUE; // Default TRUE 
$params = array(); // Extra params to pass to hook_mail() as $params
// hook_mail_alter can change to false so that it doesn't get sent out
$result = drupal_mail($module, 'template_1', $to, $language, $params, $from, $send);
/*
$result => array(
 'result' => NULL (cancelled by hook_mail_alter())
            or $system->mail($message) (!$result['result'] is true means fail)
)
*/
#+END_EXAMPLE

* Wordpress
** CLI
[[https://wp-cli.org/commands][Wordpress CLI Commands]]
WP CLI Pantheon

*** WP CLI Install, Upgrade

#+BEGIN_EXAMPLE
# Assuming you are at ~ folder
curl -O https://raw.githubusercontent.com/wp-cli/builds/gh-pages/phar/wp-cli.phar
# Check phar
php wp-cli.phar --info
chmod +x wp-cli.phar
# GoDaddy Shared Hosting doesn't allow sudo. Ignore this for GoDaddy
# sudo mv wp-cli.phar /usr/local/bin/wp
alias wp='~/wp-cli.phar'
echo "alias wp='~/wp-cli.phar'" >> .bashrc
source .bashrc
#+END_EXAMPLE

Set Global parameters in wp-cli.yml under Wordpress root folder http://wp-cli.org/config/
Use -- in front for wp command
#+BEGIN_EXAMPLE
# Very important. To avoid error: $_SERVER['HTTP_HOST'] 
url: http://www.yourwebsite.com
#+END_EXAMPLE

Use --skip-plugins to avoid errors while loading plugins that cause this kind of error
Fatal error: Uncaught Error: Call to a member function xxx on null

Check wp-cli installation
~wp --info~, ~wp plugin list --debug~ or ~wp plugin list --skip-plugins --debug~

If you see this error, time to upgrade WP CLI
Fatal error: Class 'WP_Post_Type' not found in /Applications/MAMP/htdocs/wp-includes/post.php on line 1031

~sudo wp cli update~

*** Global Parameters
- --debug
- --quiet
- --user=<id|login|email>
- --require=<path> :: Load PHP file, can be used multiple times

*** User
#+BEGIN_EXAMPLE
List users
terminus wp 'user list' --site=<site> --env=<env>=

Add a user
wp user create lili li@xxx.ca --user_pass=letterandnumbers --role=administrator

Update password
wp user update lili --user_pass=lettersandnumbers

Give role
wp user add-role lili administrator
#+END_EXAMPLE

*** Core
wp core version
wp core update

*** Plugin
[[https://wordpress.org/plugins][Wordpress Official Plugin Directory]]

wp plugin install fly-dynamic-image-resizer

Options
- --activate :: activate after installation

wp plugin status
wp plugin update akismet
wp plugin activate plugin_name
wp plugin uninstall Plugin_name

*** Theme
wp theme status

** Template Tags
wp-includes/xxx-template.php
*** post-thumbnail <<<wp:t:thumbnail>>>
get_post_thumbnail_id($post = null);

get_the_post_thumbnail_* :: can specify which post
the_post_thumbnail_* :: has to be current post

You can wp:f:add_image_size
Image size :: $size
NOTICE: If the thumbnail has no physical file that has corresponding size, the_post_thumbnail_url will 
get the original image file, the_post_thumbnail will use the original file with in src and apply width/height attributes
in HTML to achieve the purpose.
- 'post-thumbnail' :: default
- array(100, 100) :: Grab the biggest size in width and height image file possible.
- array(100, 9999) :: Grab the biggest size in width and height image file possible.

You can resize an image file on the fly using fly-dynamic-image-resizer

the_post_thumbnail($size, $attr='') :: echo
the_post_thumbnail_url($size) :: echo

*** post <<<wp:t:post>>>
*** category <<<wp:t:category>>>
*** general <<<wp:t:general>>>
** Functions
*** get_the_ID() - ID of current item or false
*** wp_get_post_terms($post_id, $tax, $args)
Get the slugs of the terms under taxonomy publication
=wp_get_post_terms($post_id, 'publication', ['field' => 'slugs'])=
*** Translate
Use tool:Poedit

**** Translate Functions
$text can't be a variable. And use single quotes instead of "".

Use sprintf() and printf for subsitutions. The msgid is "You have chosen the %s theme"
#+BEGIN_EXAMPLE
echo sprintf( __( 'You have chosen the %s theme.' ) , the_color() );
printf( __( 'You have chosen the %s theme.' ) , the_color() );
#+END_EXAMPLE

echo __('some text', 'textdomain'); // return
'textdomain' is optional but it has to be a string not a variable! Default it's 'default'

_e() is the same as __() but echoes

Plural or single
echo _n('There is a comment', 'There are comments', get_comments_number());

Context
echo _x('post a link', 'A link to the post');
'A link to the post' matches msgctxt "A link to the post" in .po file.

_ex is the same as _x but echoes
echo _ex('post link', 'Submit a link');

**** Setup, .po and .mo files
Load textdomain in child theme which overwrites the textdomain defined in parent theme
Do this in theme functions.php
#+BEGIN_EXAMPLE
function smart_mag_child_theme_locale() {
  $_r = load_child_theme_textdomain( 'textdomain-name', get_stylesheet_directory() . '/languages' );
  // textdomain-name can be defined in parent theme or a new textdomain
  // if textdomain-name has been defined earlier, then this will overwrite

  // Check if textdomain inclusion is successful
  //if ( $_r ) var_dump( 'success!' );

  if ( is_admin() ) {
    // load another textdomain
  }
}
add_action( 'after_setup_theme', 'smart_mag_child_theme_locale' );
#+END_EXAMPLE

Usually translate-ready theme will provide a .pot file which is a template file for .po and .mo files.
Open .pot in tool:Poedit, generate a new translation. What Poedit saves is 2 files: .po and .mo.

Open .po file later, make changes and save to overwrite .po and .mo files. File .pot is no longer needed.

Catalog > Properties > Translation properties
Specifiy the language
Plural Forms by default is
#+BEGIN_EXAMPLE
nplurals=2; plural=n != 1;
#+END_EXAMPLE

Might need to specify the path in code for .po file. '.' means the current path.
#+BEGIN_EXAMPLE
"X-Poedit-SearchPath-0: .\n"
#+END_EXAMPLE

Catalog > Properties > Sources keywords contain all the Wordpress translation functions

#+BEGIN_EXAMPLE
__
_e
_n:1,2
_x:1,2c
_ex:1,2c
#+END_EXAMPLE

=:1,2= indicates the function has 2 parts. =2c= means the 2nd argument is a context/comment.

tool:Poedit can help you change most of the fields except that it can't specify context msgctxt.

For those situations, directly edit .po and open .po in Poedit and save to get the .mo file.

Some examples

Comments and reference
#+BEGIN_EXAMPLE
This is a reference
#: woocommerce/loop/orderby.php:23
This is a comment
#. Author of the plugin/theme
#+END_EXAMPLE

Concatenate multiple lines
#+BEGIN_EXAMPLE
#: 404.php:18
msgid ""
"We're sorry, but we can't find the page you were looking for. It's probably "
"some thing we've done wrong but now we know about it and we'll try to fix "
"it. In the meantime, try one of these options:"
msgstr ""
#+END_EXAMPLE

sprintf and printf subsitutions
#+BEGIN_EXAMPLE
#: archive.php:101
msgid "Yearly Archives: %s"
msgstr ""
#+END_EXAMPLE

Context
#+BEGIN_EXAMPLE
#: bbpress/auth-modal.php:69
msgctxt "bbPress"
msgid "Favorites"
msgstr ""
#+END_EXAMPLE

Complex context
#+BEGIN_EXAMPLE
#: comments.php:53
msgid ""
"Logged in as <a href=\"%1$s\">%2$s</a>. <a href=\"%3$s\" title=\"Log out of "
"this account\">Log out?</a>"
msgstr ""
#+END_EXAMPLE

Poedit save fr_CA.po and fr_CA.mo files. Copy and place them into the right place and then on Wordpress
Settings > General > Site Lanuage to match fr_CA

*** add_image_size
<<<wp:f:add_image_size>>>
Use wp:action:after_setup_theme
Every newly uploaded image will have image files with all defined image sizes.

#+BEGIN_EXAMPLE
function lili_theme_setup() {
 add_image_size('lili-w700', 700, 9999); // fixed width, unlimited height
 add_image_size('lili-w700h600', 700, 600, true); // crop in exact dimension 
}
#+END_EXAMPLE

*** add_management_page
wp:action:admin_menu
Add sub menu to Tools admin menu

add_management_page(
 'Page title', // string
 'Menu title', // string
 'manage_options', // string. Capability that is required.
 'menu_slug', // string
 'callbackFunct', // string or array($this, 'options_page')
);

*** register_post_type
wp:action:init
wp:action:pre_get_posts
wp:plugin:acf

register_post_type( $post_type, $args );
https://codex.wordpress.org/Function_Reference/register_post_type

- $post_type :: string. < 20 characters. All lowercase and no space
- $args :: array of arguments

#+BEGIN_EXAMPLE
add_action('init', 'lili_custom_post_type');
function lili_custom_post_type() {
  $labels = [
    // array, wp:register_post_type:labels
  ];

  $args = [
    'label' => 'Plural Name', // string
    'labels' => $labels,
    'description' => '', // string, optional
    'public' => false,
    /* Default. bool.
     *       exclude_from_search, publicly_queryable, show_in_nav_menus, show_ui
     * true:               false,               true,              true, true
     * false:               true,              false,             false, false
     */
    'exclude_from_search' => false, // default. optional. 'site/?s=search-term'
    'publicly_queryable' => true, // optional. take 'public' value.
    /* ?post_type={post_type_key},
     * ?{post_type_key}={single_post_slug},
     * ?{post_type_query_var}={single_post_slug}
     */
    'show_ui' => true, // optional. bool. default take 'public' value.
    'show_in_nav_menus' => true, // optional. bool. inherits 'public' value.
    'show_in_menu' => true, // optional, bool or string. default inherits show_ui
    // false :: do not display in admin menu
    // true :: display as a top level menu
    // 'some string' :: display as a submenu of a menu 'some string'
    'show_in_admin_bar' => true, // optional, bool, default inherits show_in_menu
    'supports' => ['title', 'editor'], // optional. array/bool. wp:f:add_post_type_support
	  //  Don't have to add 'custom-fields' in order to use wp:plugin:acf

  ];

  register_post_type('movies', $args);

}

add_action( 'pre_get_posts', 'lili_pre_get_posts' );
// Should not call this in template because in template the $query is already run
function lili_pre_get_posts( $query ) {
  if ( ! is_page() && ! is_home() && $query->is_main_query() ) {
    $query->set( 'post_type', array( 'post', 'movies' ) );
  }
  // this function should return nothing.
}
#+END_EXAMPLE

**** labels
<<<wp:register_post_type:labels>>>

*** add_post_type_support
<<<wp:f:add_post_type_support>>>

add_post_type_support($post_type, $supports);

- $post_type :: string
- $supports :: string/array
  - title
  - editor :: content
  - author
  - thumbnail :: current theme must support Post Thumbnails
  - excerpt
  - trackbacks
  - custom-fields :: wp:Custom_Fields. Don't have to add 'custom-fields' in order to use wp:plugin:acf
  - comments
  - revisions
  - page-attributes :: menu order, hierarchical must be true
  - post-formats :: add post formats

add_action('init', 'lili_custom_post_type');
function lili_custom_post_type() {
  $labels = [
    // array, wp:register_post_type:labels
  ];

  $args = [
    'label' => 'Plural Name', // string
    'labels' => $labels,
    'description' => '', // string, optional
    'public' => false,
    /* Default. bool.
     *       exclude_from_search, publicly_queryable, show_in_nav_menus, show_ui
     * true:               false,               true,              true, true
     * false:               true,              false,             false, false
     */
    'exclude_from_search' => false, // default. optional. 'site/?s=search-term'
    'publicly_queryable' => true, // optional. take 'public' value.
    /* ?post_type={post_type_key},
     * ?{post_type_key}={single_post_slug},
     * ?{post_type_query_var}={single_post_slug}
     */
    'show_ui' => true, // optional. bool. default take 'public' value.
    'show_in_nav_menus' => true, // optional. bool. inherits 'public' value.
    'show_in_menu' => true, // optional, bool or string. default inherits show_ui
    // false :: do not display in admin menu
    // true :: display as a top level menu
    // 'some string' :: display as a submenu of a menu 'some string'
    'show_in_admin_bar' => true, // optional, bool, default inherits show_in_menu
    'supports' => ['title', 'editor'], // optional. array/bool. wp:f:add_post_type_support

  ];

  register_post_type('movies', $args);

}

Use wp:action:pre_get_posts to enable query for this new post type

*** remove_meta_box
<<<wp:f:remove_meta_box>>>

remove_meta_box( $id, $page, $context);
- Return 
- $id :: string
  - authordiv
  - categorydiv
  - comemntstatusdiv
  - commentsdiv
  - formatdiv
  - pageparentdiv
  - postcustom
  - postexcerpt
  - postimagediv
  - revisionsdiv
  - slugdiv
  - submitdiv
  - tagsdiv-post_tag
  - tagsdiv-{$tax-name}
  - {$tax-name}div
  - trackbacksdiv
  - ...
- $page :: string. Type of screen
  - post
  - page
  - attachment
  - link
  - dashboard
  - any custom post type e.g. 'my-product'
- $context :: string. 'normal', 'advanced', or 'side'
  - Post edit screen :: normal, side and advanced
  - Comments screen :: normal and side
  - Menu meta boxes :: side
- Return nothing

*** get_template_part
wp:f:get_template_part

** Current URL
Current URL on your website
<<<php:parse_url>>>
#+BEGIN_EXAMPLE
global $wp;
$current_url = home_url(add_query_arg(array(), $wp->request)); 
// echo esc_url($current_url);

$url = 'http://username:password@hostname:9090/path?arg=value#anchor';
$_url_array = parse_url($url); 
// keys are scheme, host, port, user, pass, path, query (after ?), fragment (after #)

if ($_url_array !== false && !is_null($_url_array['host']) {}
#+END_EXAMPLE

** WP Custom Fields
<<<wp:Custom_Fields>>>
*** Get Custom Fields
Normal
#+BEGIN_EXAMPLE
<?php 
print_r(get_post_custom_keys()); // Get all keys as an array
print_r(get_post_custom()); // Get keys and values as an array
print_r(get_post_custom_values('fieldkey')); // Get values as an array
?>
#+END_EXAMPLE

Plugin is different :: wp:plugin:types

*** Custom Fields in WP_Meta_Query
Custom fields created by wp:plugin:acf can use WP_Meta_Query as normal.

Custome fields creasted by wp:plugin:types, like a set of checkboxes, in WP_Query, you should use the LIKE operator. 
Refer to WP Types Custom Field Checkbox and WP Meta Query

*** Create Custom Fields for Custom Post Type
Use wp:plugin:acf

** Wordpress The Loop
<<<wp:The_Loop>>>
*** Syntax

#+BEGIN_EXAMPLE
<?php 
 $query = new WP_Query('cat=-3,-8'); 
 // Use query_posts($query_array | $string) instead of creating a new WP_Query then you don't have to prefix $query for methods
 // But query_posts change the global $wp_query 
?>

<?php if ( $query->have_posts() ) : while ( $query->have_posts() ) : $query->the_post(); ?>
 <?php //  set the global $post to individual one in $query ?>
 <div><?php the_content(); ?></div>

 <?php if ( has_post_thumbnail() ): ?>
  <img src="<?php the_post_thumbnail_url('large'); ?>">
  <?php the_post_thumbnail(); ?>
 <?php endif; ?>

<?php endwhile; ?>
<?php wp_reset_postdata(); // set back global $post to original ?>
<?php endif; ?>

<?php $query->rewind_posts(); // in order to loop $query again ?>

#+END_EXAMPLE

*** <<<WP_Query>>>
Generator: https://generatewp.com/wp_query/

Use: WP_Meta_Query, WP Tax Query, WP Order and Orderby
Use filters: 
- wp:filter:post_limits
- pre_option_posts_per_rss wp:filter:pre_option
- wp:filter:posts_clauses
Use actions: wp:action:pre_get_posts

#+BEGIN_EXAMPLE
$args = array(
 'post_type' => array('editorial', 'blog'), // blog or editorial
 'post_status' => array('publish'),
 'posts_per_page' => -1, // int. -1 shows all posts. Doesn't work in feed (Default 10). Use wp:filter:post_limits
 'meta_query' => $meta_query, // $meta_query is a nested array parsed by WP_Meta_Query
 'tax_query' => $tax_query,
 'order' => 'DESC', // default, 'ASC'
 'orderby' => 'date', // default, which is post_date
);

$query = new WP_Query($args);
#+END_EXAMPLE

*** <<<WP_Meta_Query>>>
**** Nesting
Nested: key1=value1 OR (key2=value2 AND key3=value3)

#+BEGIN_EXAMPLE
$meta_args = array(
 'relation' => 'OR', // Optional.
 array(
   'key' => 'key1',
   'value' => 'value1',
   'compare' => '=', //default
 ),

 array(
   'relation' => 'AND',
   array(
     'key' => 'key2',
     'value' => 'value2',
     'compare' => '=',
   ),
   array(
     'key' => 'key3',
     'value' => 'value3',
     'compare' => '=',
   ),
 ),
  
);

$meta_query = new WP_Meta_Query($meta_args); // parse args array

#+END_EXAMPLE

**** Operators
compare
- =, !=
- >, >=, <, <=
- LIKE, NOT LIKE
- IN, NOT IN
- BETWEEN, NOT BETWEEN
- EXISTS, NOT EXISTS
- REGEXP, NOT REGEXP :: MySQL REGEX
- RLIKE (synonym of REGEXP) 

type 
In MySQL, it means CAST(the field, to a type)
- NUMERIC
- BINARY
- CHAR
- DATE :: works with 'compare' value BETWEEN only if the date is stored as YYYY-MM-DD
- DATETIME
- DECIMAL
- SIGNED, UNSIGNED :: MySQL Integer
- TIME :: MySQL Date and Time

<<<WP Types Custom Field Checkbox and WP Meta Query>>>
Say the wpcf-newsletters custom field created by WP Types has 2 checkboxes are selected: enligne and pw.
The following 2 strings will appear in the serialized json string as value in WP_Meta_Query
#+BEGIN_EXAMPLE
a:1:{i:0;s:7:"enligne";}
a:1:{i:0;s:2:"pw";}
#+END_EXAMPLE 

Select the posts that have checkbox enligne checked.
#+BEGIN_EXAMPLE
$meta_query = array(
 array(
  'key' => 'wpcf-newsletters',
  'value' => 'a:1:{i:0;s:7:"enligne";}',
  'compare' => 'LIKE',
 ),
);
#+END_EXAMPLE

*** <<<WP Tax Query>>>
#+BEGIN_EXAMPLE
$tax_query = array(
 'relation' => 'AND', // Optional 
 array(),
 array(
   'taxonomy' => '',
   'field' => 'term_id', // string :: term_id (default), name, slug or term_taxonomy_id
   'terms' => 'bob', // int/string/array :: multiple terms
   'operator' => 'IN', // string :: IN (default), NOT IN, AND, EXISTS, NOT EXISTS
 ),
);
#+END_EXAMPLE

*** <<<WP Order and Orderby>>>
2 parameters: order and orderby. They are strings not arrays.

**** orde
- DESC :: default
- ASC

**** orderby
- date :: default, which is post_date
- modified :: modified date
- ID :: post id
- parent :: parent id
- rand :: random order
- comment_count
- author
- title
- name :: post name post slug
- type :: post type
List goes on...

** RSS

<<<wp:f:get_template_part>>> includes any template in child theme

#+BEGIN_EXAMPLE
function lili_RSS() {
 add_feed('lili-editorial', 'lili_editorial_RSS');
}
add_action('init', 'lili_editorial_RSS');
function lili_editorial_RSS() {
 get_template_part('rss','feedname');
 // rss is slug and feedname is an extra name
 // Search in order
 // /themes/child/rss-feedname.php
 // /themes/parent/rss-feedname.php
 // /themes/child/rss.php
 // /themes/parent/rss.php

 // the feed url is http://you.com/feed/lili-editorial which is the feed name defined in add_feed
}
#+END_EXAMPLE

Default template /wp-includes/feed-rss2.php
Functions to use in The Loop: /wp-includes/feed.php

#+BEGIN_EXAMPLE
<?php
$args = array(
	'post_type' => array('blog'), // e.g. any
	'tag' => 'editors-choice',
	'orderby' => 'date', // Default. e.g. title
	'order' => 'DESC', // Default. e.g. ASC
);
?>
query_posts($args);
<?php while (have_posts()) : the_post(); ?>
<item>
  <title><?php the_title_rss(); ?></title>
  <?php if (has_post_thumbnail($post->ID)) : ?>
  <?php
    $image = wp_get_attachment_image_src(
    get_post_thumbnail_id( $post->ID ),
    'thumbnail'
    );
  ?>
  <feature_image><?php echo $image[0]; ?></feature_image>
  <?php endif; ?>
  <pubDate><?php echo mysql2date('D, d M Y H:i:s +0000',
				get_post_time('Y-m-d H:i:s', true),
				false); ?></pubDate>
  <?php // Text Version ?>
  <excerpt><![CDATA[<<?php echo get_the_exerpt(); ?>]]></excerpt>
  <excerpt_html><![CDATA[<<?php echo the_exerpt_rss(); ?>]]></excerpt_html>
  <?php echo the_category_rss('rss2'); // categories and tags ?>
</item>  
<?php endwhile; ?>
#+END_EXAMPLE

** add_filter
*** Syntax, remove_filter
Modify internal data / function returned

For example, WP_Query gets internal settings for building a query.
You can temporary add_filter to change the internal settings, then build a WP_Query, later remove_filter 
so that you only change the internal setting for that query building without affecting other usage.  

add_filter( 
 'tagname', 
 'lili_funct',
  10, // int. Priority, lower number sooner
  1, // int. Accepted args, default is 1! Be careful
)

apply_filters('tagname', $result, $var1);

// callback should take 2 variables
function lili_funct($result, $var1) {
 return $result;
}
*** post_limits
<<<wp:filter:post_limits>>>
For feed, use pre_option_posts_per_rss wp:filter:pre_option

function lili_f_post_limits($limit, $query) {
 return 'LIMIT 0, 25';
 return $limit;
}

*** posts_clauses
<<<wp:filter:posts_clauses>>>
Modify WP_Query object before it runs
#+BEGIN_EXAMPLE
function lili_posts_clauses($clauses, $query) {
  /*
  $clauses => [
    'where' => '...',
    'groupby' => '',
    'join' => '',
    'orderby' => 'wp_posts.post_date DESC',
    'distinct' => '',
    'fields' => 'wp_posts.*',
    'limits' => 'LIMIT 0, 20',
  ]
  $query is WP_Query object
  */
  // Identify a certain WP_Query
  $_s = lili_request_cache('trigger_posts_clauses');
  if ($_s == 'situationA') {
    $_old = $clauses['where'];
    $clauses['orderby'] = '';
    $_limit = explode(",",$clauses['limits']);
    $clauses['limits']='';
    $_limit_feature = end($_limit) - 3;
    reset($_limit);
    $_features_and_news = <<<SQL
SELECT * FROM
(SELECT p2.ID
FROM wp_posts p2
WHERE p2.post_type IN ('en-vedette')
ORDER BY p2.post_date DESC
LIMIT {$_limit_feature}
) AS sq1

UNION

SELECT * FROM
(SELECT p2.ID
FROM wp_posts p2
INNER JOIN wp_term_relationships tr ON tr.object_id = p2.ID
INNER JOIN wp_terms t ON t.term_id = tr.term_taxonomy_id
WHERE p2.post_type = 'nouvelles' AND t.slug = 'homepage-3-squares'
ORDER BY p2.post_date DESC
LIMIT 3) AS sq2
SQL;
    $clauses['where'] = $_old." AND wp_posts.ID IN ($_features_and_news)";
    // reset cache
    lili_request_cache('trigger_posts_clauses', '');
  }

  return $clauses;
}
#+END_EXAMPLE

*** pre_option_(option_name)
<<<wp:filter:pre_option>>>
Temporarily alter an option without changing in database.

** add_action, do_action, do_action_ref_array
*** Basic
Event based
add_action( string $tag,
string $function_name,
int $priority = 10,
int $accepted_args = 1 // number of args the function accepts
)

add_action( 'atag' is called by do_action( 'atag' or do_action_ref_array( 'atag'

*** wp_head, wp_footer
Refer to Wordpress Theme > Functions used in template

*** wp_enqueue_scripts
Can use wp_enqueue_style and wp_enqueue_script. Priority might be needed to change to greater 10
to load after default theme/style.css
#+BEGIN_EXAMPLE
function lili_scripts() {
 wp_enqueue_style('lili-custom-styles', get_stylesheet_directory_uri().'/css/style.css');
}
add_action( 'wp_enqueue_scripts', 'lili_scripts', 20);
#+END_EXAMPLE

*** init
<<<wp:action:init>>>
Fires after Wordpress has finished loading but before any headers are sent.
User is already authenticated.
Useful for intercepting $_GET or $_POST

*** after_setup_theme
<<<wp:action:after_setup_theme>>>
Called each page load after the theme is initialized. 
Do basic setup, registration and init actions for a theme

*** pre_get_posts
<<<wp:action:pre_get_posts>>>
Provide a chance to modify $query object (or do something else) before it's run.
Do not use this to alter query for single Page requests.

add_action( 'pre_get_posts', 'lili_pre_get_posts' );
// Should not call this in template because in template the $query is already run
function lili_pre_get_posts( $query ) {
  if ( ! is_page() && ! is_home() && $query->is_main_query() ) {
    $query->set( 'post_type', array( 'post', 'movies' ) );
  }
  // this function should return nothing.
}

*** admin_menu
<<<wp:action:admin_menu>>>

*** add_meta_boxes, add_meta_boxes_{post_type}
lili_add_meta_boxes($post_type, $post) takes 2 arguments, no return. 
lili_add_meta_boxes_{post_type}($post) takes 1 argument, no return.

Use wp:f:add_meta_box, wp:f:remove_meta_box or modify global $wp_meta_boxes;

$wp_meta_boxes['post-type']['normal']['core']['postexcerpt']['title'] = 'Your title';

You can change the title, callback (complete change to another function) and different context. 
The callback most likely outputs a label, form field and some description.

You can either completely change the callback or use wp:filter:gettext to change the translation

** add_shortcode

#+BEGIN_EXAMPLE
// [bartag foo="foo-value"]
// Use underscore instead of hyphen e.g. bar_tag
function bartag_func( $atts, $content, $tag ) {
  $a = shortcode_atts( array(
    'class' => 'something', // default value
    'attr_2' => 'something else', // 2nd attribute
  ), $atts );

  // Use return not echo
  return '<span class="'.esc_attr($a['class']).'">'
         .$content
         // or
         // .do_shortcode($content)
         ."foo = {$a['foo']}"
         .'</span>';

/*
ob_start();
?> <HTML> <here> ... <?php
return ob_get_clean();
*/

}
add_shortcode( 'bartag', 'bartag_func' );
#+END_EXAMPLE

** Options, Settings
<<<WP All Options>>>
/wp-admin/options.php

[[https://codex.wordpress.org/Option_Reference][Option Reference]]

** Wordpress Theme
*** Template Files
[[https://codex.wordpress.org/Theme_Development#Template_Files][All Template Files]]
single.php
single-{post-type}.php

*** Functions used in template
#+BEGIN_EXAMPLE
// In template
<?php wp_head(); ?>

// In plugin
add_action('wp_head', 'lili_wphead_dfp');
function lili_wphead_dfp() {
 // add inline script to header
 $o = "<script>...</script>";
 echo $o;
}

// Load with dependancy (jQuery is loaded)
function lili_wphead_dfp() {
 if ( wp_script_is( 'jquery', 'done' ) ) {
?>
<script type="text/javascript">
// jQuery code 
</script>
<?php
 }
}
#+END_EXAMPLE

*** Good themes
[[https://themeforest.net/item/newspapaer/5489609][Newspaper]]

** Transient API
WordPress cache API in database.
=DELETE FROM wp_options WHERE option_name LIKE ('%\_transient\_%')=

** Custom Cache
Same page request custom cache

#+BEGIN_EXAMPLE
function lili_request_cache($field, $set = NULL) {
  static $custom_cache;
  if (!isset($custom_cache)) {
    $custom_cache = [];
  }
  if ($set !== NULL && $field !== NULL ) {
    // $set_field_value = _f('field_name', 123);
    $custom_cache[$field] = $set;
  }
  elseif ($field !==  NULL && $set == NULL &&
          ( !isset($custom_cache[$field]) || $custom_cache[$field] == NULL )
  ) {
    // Set default
    // $set_field_value = _f('field_name');
    switch ($field) {
      case "trigger_posts_clauses":
        $custom_cache[$field] = '';
        break;
    }
  }

  if (!isset($custom_cache[$field])) {
    $custom_cache[$field] = NULL;
  }

  return $custom_cache[$field];
}
#+END_EXAMPLE

** Database
[[https://codex.wordpress.org/Database_Description][Database Description]]

*** wp_posts
ID :: int
post_type :: varchar(20), 'post'
post_status :: varchar(20), 'publish'

*** wp_terms, wp_term_relationships
- wp_terms
term_id :: int, auto_increment
name :: varchar(200)
slug :: varchar(200)
term_group :: int

- wp_term_relationships
object_id :: int, (e.g. ID in wp_posts), 0
term_taxonomy_id :: int, 0
term_order :: int, 0

** Plugins
*** Custom Plugin
https://codex.wordpress.org/Plugin_Resources
https://codex.wordpress.org/Writing_a_Plugin
https://developer.wordpress.org/plugins/the-basics/#getting-started

Use hyphen for plugin name and folder `wp_content/plugins/li-custom/li-custom.php` 

*** Resize image on the fly
<<<fly-dynamic-image-resizer>>>

$image = fly_get_attachment_image_src(
 get_post_thumbnail_id(),
 array(160, 9999),
 false // true to crop to exact dimension
);

$image :: array(
 'src',
 'width',
 'height'
);

fly_add_image_size('lili-w600', 600, 9999, true);
$image = fly_get_attachment_image($post->id, 'lili-w600'); // HTML
*** Advanced Custom Fields - ACF
<<<wp:plugin:acf>>>
https://wordpress.org/plugins/advanced-custom-fields/

Add a field group and then add custom fields under the group.
Use Location to define rules to assign the field group to a custom post type.
You can hide the default post fields (Content editor, comments, categories, etc.)
Make custom fields required

In wp:The_Loop, to display a custom field :: the_field('field_name')
To get the value :: get_field('field_name'); 
*** Toolset Types
<<<wp:plugin:types>>>

WP Types is different! Use <<<types_render_field>>>

#+BEGIN_EXAMPLE
$newsletters = types_render_field('newsletters', array('output'=>'raw'));
// the real field name is actually wpcf-newsletters
// For single line (text) field, use 'output'=>'raw'
// For WYSIWYG field, use 'output'=>'html'. 'raw' might be plain text
// For Image field

$_image = types_render_field('field-image', array('output'=>'raw'));
// Output original full image url
// If 'output' => 'raw', 'size' and 'resize' will be ignored

// use 'url' => 'true' to output the url of the resized image.
$args = array('output'=>'normal', 'url'=>'true', 'width'=> 300, 'resize'=>'proportional');
// Output image url of a fixed width and dynamic height

$args = array('output'=>'normal', 'url'=>'true', 'size'=>'medium', 'resize'=>'proportional' );
// Output image url of a max width and height
// if 'size' is set, 'width' and 'height' will be ignored

/* 
 * 'size' => 'custom_image_size' | 'full' | 'large' | 'medium' | 'thumbnail'
 * Set 'size' and also 'resize' => 'crop' | 'proportional' | 'stretch' | 'pad'
 * If resize is necessary, set 'output' => 'normal'
 * 'padding_color' => 'transparent' | hex when resize=>pad
 */
// For Image field.
#+END_EXAMPLE

Refer to WP Types Custom Field Checkbox and WP Meta Query

*** Super Cache (SuperCache)
Warning: include(/var/www/html/wp-content/plugins/wp-super-cache/wp-cache-base.php): failed to open stream

If you encounter this problem, your WP_CACHE cache folder is not set properly. Check `wp-config.php`. You should see 

#+BEGIN_EXAMPLE
define('WP_CACHE',true);
define('WPCACHEHOME', ABSPATH. 'wp-content/plugins/wp-super-cache/');
#+END_EXAMPLE

There's another place where the cache folder is defined: `$cache_path` in `wp-content/wp-cache-config.php` 

Uninstall
To manually uninstall:

	• Turn off caching on the plugin settings page and clear the cache.
	• Deactivate the plugin on the plugins page.
	• Remove the WP_CACHE define from wp-config.php. It looks like define( 'WP_CACHE', true );
	• Remove the Super Cache mod_rewrite rules from your .htaccess file.
	• Remove the files wp-content/advanced-cache.php and wp-content/wp-cache-config.php
	• Remove the directory wp-content/cache/
	• Remove the directory wp-super-cache from your plugins directory.

If all else fails and your site is broken
	• Remove the WP_CACHE define from wp-config.php. It looks like define( 'WP_CACHE', true );
	• Remove the rules (see above) that the plugin wrote to the .htaccess file in your root directory.
	• Delete the wp-super-cache folder in the plugins folder.
	• Optionally delete advanced-cache.php, wp-cache-config.php and the cache folder in wp-content/.

*** Yoast SEO (wordpress-seo)
**** Open Graph
Use at least 200x200 pixels image for `og:image`
You need to resave the post/article on WP first (to prevent WP Super Cache as FB crawler gets to the page differently) and then run Facebook Open Graph Object Debugger

*** Disqus
If you receive a lot of errors about dsq_sync_forum in Apache logs, it is caused by Disqus tries to sync with WP comments so frequently.

First in WP Disqus setting, check "Disable automated comment importing"

Empty all cron rows in wp-options table `UPDATE wp_options SET option_value='' WHERE option_name='cron';"`

https://wordpress.org/support/topic/high-server-load-and-dsq_sync_forum-problem?replies=6

** Installation Language
Download additional language packs from [[https://make.wordpress.org/polyglots/teams/][here]]
Upload thme to wp-content/languages
Then change the language in each User Profile.

* CSS
** Position, box-sizing
Default position is static. left, right, top, bottom have not effect
relative is relative to default static position, use left, right, top and bottom

Other elements adjacent to position:relative element will no be adjusted to fit into
any gap left by the element (treat the relative element as static)

position:fixed is relative to viewport

A "positioned" element is one whose position is anything except static.

postion:absolute is positioned relative to the nearest positioned ancestor.
If there's no positioned ancestors, document body is used.

When elements are positioned, they can overlap other elements.

box-sizing: border-box | padding-box | content-box (default); 

** Horizontal Center Absolute
The absolute element is positioned related to the first position:relative parent

Center that abosulte element in relate to that parent

Notice: any parents will not expand in width and height according to that absolute child element 
#+BEGIN_EXAMPLE
.grandchild {
  position: absolute;
  margin-left: auto;
  margin-right: auto;
  left: 0;
  right: 0;
}
#+END_EXAMPLE

** Transform, Transition
css:animation

*** Transition
transition: /transition-property/ /transition-duration/ /transition-timing-function/ /transition-delay/

- transition-property :: can be 'all'
- transition-timing-function :: default linear
  - ease-in :: slow start
  - ease-out :: slow end
  - e.g. use ease-in for div:hover and ease-out in div

- transition-delay :: delay n seconds before the current transition starts.

#+BEGIN_EXAMPLE
div {
  width: 100px;
  height: 100px;
  background: red;
  transition: width 2s linear 3s, height 2s linear 3s, transform 2s linear 3s;
}
#+END_EXAMPLE

*** Transform

#+BEGIN_EXAMPLE
div:hover {
  width: 300px;
  height: 300px;
  transform: 
    rotate(180deg) 
    translate(-20px, 0)
    scale(0.9, 2)
    skew(30deg, 20deg);
}
/* You can turn off all transform */
/* transform: none; */
#+END_EXAMPLE

** Link
#+BEGIN_EXAMPLE
// In order
a:link {} /* Unvisited and normal */
a:visited {}
a:hover {}
a:active {}
#+END_EXAMPLE

** Text
*** Ellipsis
Single Line
#+BEGIN_EXAMPLE
div.test {
 white-space: nowrap;
 width: 200px; // width has to be defined
 overflow: hidden; // needed
 text-overflow: ellipsis; // change to inherit when hover then the clipped text will show
}
#+END_EXAMPLE

Multiple Lines (IE and Edge will not show 3 dots)

#+BEGIN_EXAMPLE
.excerpt {
  display: block;
  display: -webkit-box;
  font-weight: normal;
  font-size: 15px;
  line-height: 1.4;
  -webkit-line-clamp: 9;
  -webkit-box-orient: vertical;
  overflow: hidden;
  text-overflow: ellipsis;
  height: 189px; /* 15*1.4*9 */
}
#+END_EXAMPLE

*** Long Word
#+BEGIN_EXAMPLE
word-wrap: break-word; // allow to break a long word
#+END_EXAMPLE

*** Font size, line-height
font-size in child elements inherit parent element
em uses the current element's font-size or its closest parent element which has font-size defined
rem is always relative to the <html> element
vw and vh are the viewport width and height. 1vw is 1% of vw

Google recommends line-height is at least 1.2

line-height is normal means to use user agent style. Most likely default is 1 not 1.2

** CSS Selectors
<<<CSS Selectors>>>

div > p :: select p elements where the direct parent is div
div + p :: select p elements that are placed immediately after div (div's children)
p ~ ul :: select ul elements that are preceded by a p element
#+BEGIN_EXAMPLE
<p></p>
<ul></ul>
#+END_EXAMPLE

a[target] :: <a>'s with target attribute
a[target=_blank]
a[title~=flower] :: containing a word or followed by a hypen (not match flowers)
a[lang|=en] :: starting with a word or followed by a hyphen (en, en-us)
div[class^="test"] :: starting with (anything)
div[class$="test"] :: ending with (anything)
a[href*="w3schools"] :: containing

a:active
a:hover
a:link
a:visited

p::after
p::before
p::first-letter
p::first-line
p::selection
div::selection -- the selected portion of an element (e.g. select text)

input:checked
input[type="text"]:disabled
input:enabled
input:focus
input:invalid
input:valid
input:optional
input:required
 
p:empty -- has no children including text nodes

div:not(p) -- all children elements except <p>'s
div:not(.aClass) :: all div elements except the ones with class aClass

p:first-child -- <p>'s are the first child of any elements
p:last-child
p:nth-child(2)
p:nth-child(7n-1)
tr:nth-child(even)
tr:nth-child(odd)
p:nth-last-child(2)
p:only-child -- <p>'s are the only child of any elements

div p:first-of-type -- <div> has 4 children <p>'s and first child is <a>. Select 1st of <p> children.
div p:last-of-type
div p:nth-of-type(2)
div p:only-of-type

=#news:target= -- anchor name id=news matches the URL hash

** Specificity
(a, b, c, d) start with (0, 0 , 0 ,0)
a - inline add 1
b - each id add 1
c - class, pseudo-class and attribute add 1
d - element add 1

Pseudo-class :not is not considered as pesudo-class in specificity calculation.
But anything inside it counts.

** Functions
*** attr(data-attr-1)
#+BEGIN_EXAMPLE
a::after {
 content: " (" attr(href) ")";
}
#+END_EXAMPLE

*** calc()
#+BEGIN_EXAMPLE
<div>Some Text...</div>

// Always leave 50px on both sides for space
// and take all that is left for width

div {
 width: calc(100% - 100px); /* calculate */
 margin-left: 50px;
}
#+END_EXAMPLE

*** counter
#+BEGIN_EXAMPLE
body {
 counter-reset: section;
}
h1 {
 counter-reset: subsection;
}
h1::before {
 counter-increment: section,
 content: "Section " counter(section) ". ";
}
h2::before {
 counter-increment: subsection;
 content: counter(section) "." counter(subsection) " ";
}
#+END_EXAMPLE

** border-image
border-image: source slice width outset repeat|initial|inherit;
border-image: none   100%   1     0     stretch

** background
background: bg-color bg-image position/bg-size bg-repeat bg-origin bg-clip bg-attachment initial|inherit;

#+BEGIN_EXAMPLE
background: url(img_flwr.gif) right bottom no-repeat, url(paper.gif) left top repeat;
#+END_EXAMPLE

*** background-size
background-size: 20px auto;
background-size: 50% auto; // sets the width of the bg image in percent of the parent element.
background-size: contain; // bg image might not cover all content area
background-size: cover; // content area might not see the whole bg image

Stretch on y-axis and repeat on x-axis
background: url() center repeat-x;
background-size: auto 100%;

*** background-clip, background-origin
background-clip: border-box; // default. largest area
// padding-box, content-box

// For background image
background-origin: border-box; // default. largest area
// padding-box, content-box

** Color
*** <<<CSS inherit color>>>
You can grab the parent `color` css property and use it in any color properties in child element
#+BEGIN_EXAMPLE
<div class="parent">
 <div class="child">
 </div>
</div>

.parent {
 color: red;
 background-color: blue;
}
.child {
 background-color: currentColor; /* take the parent color: red */
 color: currentColor; /* Take the parent color: red */
}
#+END_EXAMPLE

*** rgb(), rgba()
<<<CSS rgba>>>
#+BEGIN_EXAMPLE
#f03
#ff0033
#FF0033
rgb(255, 0, 51) // no fraction all integers
rgb(100%, 0%, 20%) // all % no integer

#f030     // 0% opaque red
#ff003300 // 0% opaque red
#FF003388 // 50% opaque red
rgba(255,0,0,0.7) // 70% opaque red

#+END_EXAMPLE

*** hsl(), hsla()
Hue :: integer, angle degree of the color circle. Red is 0, Green is 120, Blue is 240
Saturation :: percentage. 0% is grey
Lightness :: 100% is white, 0% is black, 50% is normal

#+BEGIN_EXAMPLE
hsla(240, 100%, 50%, 0.05) // 5% opaque blue
#+END_EXAMPLE

** Gradient
Both CSS gradient and CSS repeat gradient can be stacked in background-image

<<<CSS gradient>>>

#+BEGIN_EXAMPLE
linear-gradient(45deg, blue, red);
// to bottom, to top
// to right, to left
// to bottom right, to top left
linear-gradient(to bottom, blue, white 80%, orange);
// blue at 0%, white at 80%, orange at 100%
linear-gradient(to right, red, orange, yellow, green, blue);
// evenly distributed

background: linear-gradient(to right, rgba(255,255,255,0), rgba(255,255,255,1))
           ,url(/bg.jpg);
// Use it with background image

radial-gradient(red, yellow, rgb(30, 144, 255)); // evenly spaced
radial-gradient(red 5%, yellow 25%, #1E90FF 50%);
radial-gradient(
 circle, 
 // Shape can circle or ellipse
 // Default farthest-side
 // Fade from the center point to the ___
 // closest-corner, closest-side, farthest-corner, farthest-side
 yellow, #f06d06
);
// Change from center point to corner
radial-gradient(
 circle farthest-corner at top right,
 yellow, #f06d06
);
#+END_EXAMPLE

<<<CSS repeat gradient>>>

#+BEGIN_EXAMPLE
// On top of percentage, px can be used in repeat gradient
repeating-linear-gradient(-45deg, red, red 5px, white 5px, white 10px);
#+END_EXAMPLE

** opacity
0, 0.3, 1. The lower the value the more transparent
Child elements inherits the parent opacity value
If you don't want to carry opacity to children, define rgba color in parent elements
CSS rgba

** Shadow
Shadows can be stacked
#+BEGIN_EXAMPLE
box-shadow: h-shadow v-shadow blur spread color |inset|initial|inherit;
text-shadow: h-shadow v-shadow blur-radius color|none|initial|inherit;
#+END_EXAMPLE

** @font-face
Most widely accepted font format is WOFF then TTF and OTF.
Only IE supports EOT

#+BEGIN_EXAMPLE
@font-face {
 font-family: myFirstFont;
 src: url(sansation_light.woff);
}

// Another for bold
@font-face {
 font-family: myFirstFont;
 src: url(sansation_bold.woff);
 font-weight: bold;
/*
 font-stretch: normal | condensed | semi condensed | extra condensed | ultra condensed | expanded | ...;
 font-style: normal | italic | oblique 
*/
}
#+END_EXAMPLE

Web Safe Fonts
- Arial, Arial Black
- Comic Sans MS
- Courier New
- Georgia
- Impact / Charcoal
- Lucida Sans / Lucida Grande
- Tahoma / Geneva
- Times New Roman
- Trebuchet MS
- Verdana

[[http://www.cssfontstack.com/][Web Safe Fonts in PC and Mac]]

** @media
@media not|only /mediatype/ and (/media feature/) {}
<link rel="stylesheet" media="mediatype and|not|only (media feature)" href="style.css">

*** Syntax
not /mediatype/
only /mediatype/

Each media feature, key:value or key, must be wrapped in ()
Some media feature doesn't have a value.

=not /mediatype/= and =only /mediatype/= can be chained with OR (separated by comma) but not =and=
#+BEGIN_EXAMPLE
// This works
@media screen and (min-width:200px), not print and (min-width:300px) {}

// This syntax is wrong
@media screen and (min-width:200px) and not print and (min-width:300px) {}
#+END_EXAMPLE

Note :: =not /mediatype/= is different from =not(/mediafeature/)=

Nested media queries (@media inside another @media) is supported on all browsers except IE11 and below.

*** Testing
#+BEGIN_EXAMPLE
var mql = window.matchMedia("(orientation: portrait)");
// window.addListener(handlerOrientationChange);
handlerOrientationChange(mql);

function handlerOrientationChange(mql) {
 if (mql.mathces) {
  console.log('media query matches');
 }
 else {
  console.log('media query does not match');
 }
}
#+END_EXAMPLE

*** Media Types
all, print, screen, speech

#+BEGIN_EXAMPLE
@media screen and (max-width: 1000px) and (min-width: 700px) {}
// Use comma for OR
@media screen and (max-width: 699px) and (min-width: 520px), (min-width: 1151px) {}
#+END_EXAMPLE

<<<meta viewport>>>
#+BEGIN_EXAMPLE
<meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
// Set the width of the page to follow the screen-width of the device
// Initial zoom level 1.0

// Prevent zoom: add maximum-scale=1.0, user-scalable=0
#+END_EXAMPLE

*** Features
| Key           | Min/Max? | value                                                       |
| orientation   | no       | landscape, portrait. Not reliable when soft keyboard opens  |
| color         | yes      | int, number of colors. (color) for color device             |
| aspect-ratio  | yes      | int1/int2                                                   |
| grid          | no       | 0, 1 or (grid). The last suggests it's a device with 1 font |
| width, height | yes      | viewport                                                    |
| monochrome    | yes      | 0 (not mono) or int                                         |
| resolution    | yes      | 300dpi or 2dppx                                             |
|               |          |                                                             |

*** Responsive Design

Progressive Method :: start from mobile layout, add content to bigger screen size
Graceful Method :: start from desktop layout, remove content to smaller screen size

#+BEGIN_EXAMPLE
/* {
 box-sizing: border-box;
}
.row:after {
 content: "";
 clear:both;
 display:block;
}
[class*="col-"] {
 float: left;
 padding: 15px;
 width: 100%;
}
@media only screen and (min-width: 600px) {
    .col-s-1 {width: 8.33%;}
    .col-s-2 {width: 16.66%;}
    .col-s-3 {width: 25%;}
    .col-s-4 {width: 33.33%;}
    .col-s-5 {width: 41.66%;}
    .col-s-6 {width: 50%;}
    .col-s-7 {width: 58.33%;}
    .col-s-8 {width: 66.66%;}
    .col-s-9 {width: 75%;}
    .col-s-10 {width: 83.33%;}
    .col-s-11 {width: 91.66%;}
    .col-s-12 {width: 100%;}
}
@media only screen and (min-width: 768px) {
    .col-1 {width: 8.33%;}
    .col-2 {width: 16.66%;}
    .col-3 {width: 25%;}
    .col-4 {width: 33.33%;}
    .col-5 {width: 41.66%;}
    .col-6 {width: 50%;}
    .col-7 {width: 58.33%;}
    .col-8 {width: 66.66%;}
    .col-9 {width: 75%;}
    .col-10 {width: 83.33%;}
    .col-11 {width: 91.66%;}
    .col-12 {width: 100%;}
}

<div class="row">
 <div class="col-3 col-s-3 menu">
  <ul>
   <li>Menu 1</li>
   <li>Menu 2</li>
   <li>Menu 3</li>
 </div>
 
 <div class="col-6 col-s-9">
  long content...
 </div>

 <div class="col-3 col-s-12">
  right sidebar...
 </div>
</div>
#+END_EXAMPLE

*** Viewport sizes of device
http://viewportsizes.com/

** @keyframes

<<<css:animation>>>

animation: /name/ /duration/ /timing-function/ /delay/ /iteration-count/ /direction/ /fill-mode/ /play-state/;

#+BEGIN_EXAMPLE
@keyframes fa-spin {
 0%   { transform: rotate(0deg); }
 100% { transform: rotate(359deg); } 
}
.fa-spin {
 animation: fa-spin 2s linear 3s infinite alternate;
/* 
  2s - duration
  3s - delay
  infinite - animation-iteration-count
  alternate - animation-direction

  animation-fill-mode:
    none (default, after animation ends, styles go back to before start) | 
    forwards (after animation ends, styles got applied) | 
    backwards (before animation starts and during delay, apply styles defined in the 1 iteration, e.g. from and to ) | 
    both;
*/
}
.fa-repeat:before {
  content: "\f01e";
}
<i class="fa fa-repeat fa-spin"></i>
// Spinner made in FontAwesome 
#+END_EXAMPLE

Javascript starts keyframes animation
#+BEGIN_EXAMPLE
<div id="myDIV" onclick="startAnimation()">Click to start animation</div>
var x = document.getElementById("myDIV");
function startAnimation() {
 x.style.animation = "fa-spin 2s liner 3s infinite alternate"; // Standard
}
#+END_EXAMPLE 

Javascript animation event listners
#+BEGIN_EXAMPLE
x.addEventListner("animationstart", func1);
x.addEventListner("animationiteration", func2);
x.addEventListner("animationend", func3);
#+END_EXAMPLE

** @import

#+BEGIN_EXAMPLE
/* @import should appear before any css styles defined in a css file */
@import "mystyle.css";
@import url("mystyle.css");
@import "mystyle.css" print;
/* only media types not media features */
#+END_EXAMPLE

** @viewport
WD. Only Edge. Same as meta viewport.

#+BEGIN_EXAMPLE
@media screen and (max-width: 400px) {
 @-ms-viewport { width: 320px; }
 /* Define the viewport size */
}
#+END_EXAMPLE

** @supports

#+BEGIN_EXAMPLE
@supports not (display:flex) {}
@supports (display: flex) or 
          (display: -ms-flexbox) or
          (display: -moz-box) {}

@supports (transition-property: color) or 
          ( (animation-name: myAnimation) and (transform: rotate(225deg) )
          ) {}
#+END_EXAMPLE

** Flexbox
Container could be display:flex or display:inline-flex
Flexbox is good for aligning child elements with irregular or unknown or inconsistent width and height
And the number of child elements are unknown
Good for vertical and horizontal center a child element inside a container (parent)

#+BEGIN_EXAMPLE
.container {
 display: flex;
 /* flex-flow: <flex-direction> <flex-wrap> */
 
 /* flex-direction: row | row-reverse | column | column-reverse; */
 /* main axis is by default horizontally left to right 
  * main axis is changed by direcion css property (say change it ot rtl, right to left)
  * row is left to right , column is top to bottom
  *
  */
 /* flex-wrap: nowrap | wrap | wrap-reverse; */
    flex-flow: row wrap;
    
 /* justify-content: flex-start | flex-end | center | space-between | space-around; */
 /* e.g. you can change from flex-end to space-around for menu nav with @media queries */
    justify-content: space-around;   
 
 /* align-items: flex-start | flex-end | center | baseline | stretch; */
 /* This is for aligning items on one line (default x axis) on cross axis (y axis) */
 /* relative to the same line. e.g. you have 3 lines of items and each line holds 3 items. 
  * how do the 3 items align on the y axis on each line?
  * default is stretch
  */ 

 /* align-content: stretch | flex-start | flex-end | center | space-between | space-around;
  * This is for space between multiple lines
  * e.g. There're 3 lines of items and each line has 3 items 
  * How do the 3 lines align on the y axis on each line?
  * default is stretch
  * It only works when there are multiple lines and the container height is larger than total children height
  */
}

.item {
 /* order: <integer>; // optional */

 /* flex: none | <flex-grow> <flex-shrink> <flex-basis> */

 /* flex-grow: 0 | <number>; */
 /* 0 is default and means do not enlarge item in width (default x axis) */

 /* flex-shrink: 1 | <number> */
 /* 1 is default and means do not shrink item in width (default x axis) */
 
 /* flex-basis: auto | <length>; */
 /* auto is default. if it's 0, extra space will not be factored in. Always use auto */
 
 /* Override align-items in container */
 /* align-self: auto | flex-start | flex-end | center | baseline | stretch; */

}

.item_1 {
 /* Set margin:auto in an item will absorb all space of the current line in current direction
 margin-right: auto;
 /* all other items to the right of item_1 will not have extra space */
}
#+END_EXAMPLE

Insert a line break in flex items. Might not be easy..
#+BEGIN_EXAMPLE
.line-break {width: 100%}

<div class="container">
 <div class="item">1</div>
 <div class="item">2</div>
 <div class="line-break"></div>
 <div class="item">3</div>
 <div class="item">4</div>
</div>
#+END_EXAMPLE

Flex is so powerful.

You can flex-grow a child's width or height (depending on the flex-direction of the container),
so that the child takes up the remaining width or height of the container.
Just remember to set the width or height for the container.

Combine with Bootstrap div.container and div.row, you can set a specific row to take the rest of the container height.
You don't have to get height of any other rows.

#+BEGIN_EXAMPLE
.container.flex-column {
  display:flex;
  flex-direction:column;
  height: 100%; /* Make sure the container has a height */
  /* This is to take the height of the parent of the container */
}

.row.cover-row {
  flex-grow:1;
}
#+END_EXAMPLE

** Grid
Not yet supported. Only IE and Edge.

*** container: grid-template-columns, grid-template-rows
#+BEGIN_EXAMPLE
<div class="container">
 <!-- .item are direct descendants -->
 <div class="item item-1"></div>
 <div class="item item-2"></div>
 <div class="item item-3"></div>
</div>

.container {
 display: grid | inline-grid | subgrid;
 /* subgrid to indicate the grid container is a grid item of another grid container and 
    it should take the parent's sizes of rows/columns  
 */
 /* Don't use column, float, clear and vertical-align in grid container as they have no effect */

 grid-template-columns: 40px 50px auto 50px 40px; /* 5 columns */
 grid-template-rows: 25% 100px auto; /* 3 rows */
 
 /* Add line names
 grid-template-columns: [first] 40px [line2] 50px [line3] auto [col4-start] 50px [five] 40px [end];
 grid-template-rows: [row1-start] 25% [row1-end row2-start] 100px [third-line] auto [last-line];

 /* Any row or column line can have multiple names: [row1-end row-start] */
 /* Any row or column line can have the same name */
 grid-template-columns: repeat(3, 20px [col-start]) 5%;
 /* equivalent to */
 grid-template-columns: 20px [col-start] 20px [col-start] 20px [col-start] 5%;
 
 /* Free space is defined as total space minus any fixed size items */
 grid-template-columns: 1fr 50px 1fr 1fr;
}
#+END_EXAMPLE

*** <<<container: grid-template-areas>>>, items: grid-area

#+BEGIN_EXAMPLE
.item-a{
  grid-area: header;
}
.item-b{
  grid-area: main;
}
.item-c{
  grid-area: sidebar;
}
.item-d{
  grid-area: footer;
}

.container{
  grid-template-columns: 50px 50px 50px 50px;
  grid-template-rows: auto;
  grid-template-areas: "header header header header"
                       "main main . sidebar"
                       "footer footer footer footer"
}
/* . means that single cell is empty. You can have multiple dots without space ".." */
/*
The first row line and column line of footer area have the same name "footer-start"
The last row line and column line of footer aree have the same name "footer-end"
*/
#+END_EXAMPLE

*** container: grid-gap
Gutter size: space inbetween 2 row lines or column lines. But start and end space is always 0.

#+BEGIN_EXAMPLE
grid-grap: <grid-column-gap> <grid-row-gap>;
#+END_EXAMPLE

*** container: justify-items, items: justify-self
#+BEGIN_EXAMPLE
justify-items: start | end | center | stretch (default);
/* Adjust content in cell 
   start: align to left column line
*/
.item {
 justify-self: /* To overwrite .container: justify-items */
}
#+END_EXAMPLE

*** container: align-items, items: align-self
#+BEGIN_EXAMPLE
align-items: start | end | center | stretch (default);
/* Adjust content in cell 
   start: align to top of row line
*/
#+END_EXAMPLE

*** container: justify-content
Total width of all grids is less than width of its grid container.
start: align all grids to the left of the grid container
#+BEGIN_EXAMPLE
justify-content: start | end | center | stretch | space-around | space-between | space-evenly
#+END_EXAMPLE

*** container: align-content
Total height of all grids is less than height of its grid container.
start: align all grids to the top of the grid container
#+BEGIN_EXAMPLE
align-content: start | end | center | stretch | space-around | space-between | space-evenly
#+END_EXAMPLE

*** container: grid-auto-columns, grid-auto-rows
Implicit grid tracks are created when items have positioned or resized (items: grid-column, grid-row) outside of the defined grid (container: grid-template-areas).
Implicit grid tracks will have 0 width by default until it's set.
Implicit grid tracks of 2 columns and 2 rows are set.
#+BEGIN_EXAMPLE
grid-template-columns: 60px 60px;
grid-tempalte-rows: 90px 90px;
/* 2x2 grids are created */
/* but item-b is out of bound */
.item-b {
 grid-column: 5 / 6;
 grid-row: 2 / 3;
}
/* It's 5x2 grids now. The implicit grid tracks are 2x2 */
grid-auto-columns: 60px 60px;
grid-auto-rows: auto;
#+END_EXAMPLE

*** container: grid-auto-flow
For items that are not positioned (items: grid-column, grid-row) nor 
put in a named area (items: grid-area) which is later used by container: grid-template-areas,
these items are "not explicitly placed on the grid".
Use this to control the auto placement
#+BEGIN_EXAMPLE
grid-auto-flow: row | column | row dense | column dense
/* row : fill rows first (default)
   dense : fill smaller items first (order of items might change!)
*/
#+END_EXAMPLE

*** <<<items: grid-column, grid-row>>>
Position and resize an item
#+BEGIN_EXAMPLE
grid-column: <start-line> / <end-line> | <start-line> / span <value>;
grid-row: <start-line> / <end-line> | <start-line> / span <value>;

/* grid-column-start, grid-column-end, grid-row-start, grid-row-end can be 
   <number> | <name> | span <number> | span <name> | auto
*/ 
#+END_EXAMPLE

*** <<<items: grid-area>>>
#+BEGIN_EXAMPLE
grid-area: <name> | <row-start> / <column-start> / <row-end> / <column-end>
#+END_EXAMPLE
** Horizontal and Vertical Center
If both the parent and child are blocks, use flexbox.
For text
#+BEGIN_EXAMPLE
.center {
 height:200px;
 position:relative;
}
.center p {
 margin:0;
 position:absolute;
 top:50%;
 left:50%;
 transform: translate(-50%, 50%);
}
#+END_EXAMPLE

bs:Center Tags Vertically center span inside h1

** Column for text

#+BEGIN_EXAMPLE
<div>
 <h2>Title takes 2 columsn</h2>
 long text..
</div>
div {
 column-count: 3;
 column-gap: 40px;
 column-rule-style: solid; /* just like border */
 column-rule-width: 1px;
 column-rule-color: lightblue;
 column-rule: 1px solid lightblue;
}
div h2 {
 column-span: 2;
}

div.fixedWidth {
 columns: 200px; /* column-count will be auto */
 overflow-x: scroll;
 height: 600px; /* So that scrollbar shows on x axis */
}

#+END_EXAMPLE

** Shape
At the end of 2016, only Chrome, Safari, iOS and Android browswers support shape.

#+BEGIN_EXAMPLE
<div class="conainer">
  <img id="image" src="a.jpg">
  <p id="content">Long text</p>
</div>

img {
 display: block;
 float:left;
 width: 100%;
 height: auto;
 shape-outside: url(shape.png); /* polygon can be used */
 /* png has areas that are partially or completely transparent */
 shape-image-threshold: 0.9; /* The shape is any areas that have opacity greater than 0.9 */
 shape-margin: 20px; 
}

#+END_EXAMPLE

** SVG
*** Make SVG, Optimize SVG
Exported from AI and [[http://petercollingridge.appspot.com/svg-optimiser][optimize it]]

*** SVG as background image dynamic size
You can only control size in this method
#+BEGIN_EXAMPLE
.logo {
 background: url(logo.svg) no-repeat top left;
 background-size: contain;
 width: 100px;
 height: 82px;
}
#+END_EXAMPLE

*** <<<CSS in SVG>>>

Inline CSS
#+BEGIN_EXAMPLE
<svg xmlns="http://www.w3.org/2000/svg"
    xmlns:xlink="http://www.w3.org/1999/xlink">

    <style type="text/css" >
      <![CDATA[

        circle.myGreen {
           stroke: #006600;
           fill:   #00cc00;
        }
       circle.myRed {
          stroke: #660000;
          fill:   #cc0000;
       }

      ]]>
    </style>

    <circle  class="myGreen" cx="40" cy="40"  r="24"/>
    <circle  class="myRed"   cx="40" cy="100" r="24"/>
</svg>
#+END_EXAMPLE

External CSS

#+BEGIN_EXAMPLE
<?xml-stylesheet type="text/css" href="svg-stylesheet.css" ?>
<svg xmlns="http://www.w3.org/2000/svg"
    xmlns:xlink="http://www.w3.org/1999/xlink">
    <circle cx="40" cy="40" r="24"
       style="stroke:#006600; fill:#00cc00"/>
</svg>
#+END_EXAMPLE

Embedded CSS in SVG only affects the SVG not other elements in the global HTML if svg is not inline with global HTML.

*** SVG Zoom and Pan

#+BEGIN_EXAMPLE
<g id="parentGraphic">
 <rect />
 <text></text>
</g>

<!-- use copy an element -->
<use href="#parentGraphic" transform="translate(40, 30) scale(0.9)"></use>
#+END_EXAMPLE

#+BEGIN_EXAMPLE
<!-- Original -->
<svg currentScale="1" width="300px" height="200px" viewbox="0 0 300 200">
<!-- Don't use currentScale to zoom -->

<!-- Move down 200/200*25=25px and move right 300/300=50 px -->
<svg width="300px" height="200px" viewbox="-50 -25 300 200">

<!-- Enlarge 50% -->
<svg width="300px" height="200px" viewbox="0 0 150 100">

<!-- Enlarge 50%, move down 200/100*25=50px and move right 300/150*50=100px -->
<svg width="300px" height="200px" viewbox="-50 -25 150 100">

#+END_EXAMPLE

** Use Cases
*** Fix parent height less than total children height
#+BEGIN_EXAMPLE
<div class="clearfix">
  <div style="">Div 1 doesn't float</div>
  <div style="float: left;">Div 2</div>
</div>

/* Solution 1 */
.clearfix:after {
 content: " ";
 display:block;
 clear:both;
 height:0;
}

/* Solution 2 */
.clearfix {
 display:inline-block;
 width:100%;
}
#+END_EXAMPLE
*** Transparent Image
#+BEGIN_EXAMPLE
<img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"
 width="100" height="100">
#+END_EXAMPLE

*** Button Hover Double Quotes
#+BEGIN_EXAMPLE
<button class="button" style=""><span>Hover </span></button>
.button {
 display: inline-block;
 border-radius: 4px;
 background-color: #f4511e;
 border: none;
 color: #FFFFFF;
 text-align: center;
 font-size: 28px;
 padding: 20px;
 width: 200px;
 transition: all 0.5s;
 cursor: pointer;
 margin: 5px;
}
.button span {
 cursor: pointer;
 position: absolute;
 opacity: 0;
 top: 0;
 right: -20px;
 transition: 0.5s;
}
.button:hover span {
  padding-right: 25px; 
/*
push button text to left and create padding
for double quotes to push to the right of padding
*/
}
.button:hover span:after {
 opacity: 1;
 right: 0;
}
#+END_EXAMPLE

*** Text Label
Flair is a fixed font-size squared tag.

<span class="li-tag li-tag-color">Flair</span>
.li-tag{
  display:inline-block;
  margin-right: .5em;
  padding: 0 2px;
  border:1px solid;
  border-radius: 2px;
  font-size:x-small;
  white-space:nowrap;
  vertical-align:middle;
}
.li-tag-color{
  background-color:#f5f5f5;
  color: #555;
  border-color: #ddd;
}
.li-tag-red{
  background-color:#d9534f;
  color: #ffffff;
  border-color: #d9534f;
}

Vertical align inside h1, h2
h1 .li-tag, h2 .li-tag, h3 .li-tag {
  margin-top: -0.5em;
}

h1, h2 must have font-size defined

*** Button with icon on the left
#+BEGIN_EXAMPLE
// No space in button
<button class="li-button has-icon"><span><a href="">Youtube</a></span></button>

<style>
.li-button {
  display:inline-block;
  padding:0 8px 0 5.5px;
  border:solid 1px transparent;
  border-radius:.25em;
  background-color:#0072BC;
  color:#ffffff;
  vertical-align:middle;
  /* Overwrite default button styles */
  outline:0;
  text-decoration:none;
  cursor:none;
}
.li-button.has-icon::before {
  margin-right:6px;
  background:url(icon.svg) no-repeat;
  background-size:16px 12px;
  width:16px;
  height:12px;
  content:'';
  display:inline-block;
  vertical-align:middle;
}
.li-button span {
  vertical-align:middle;
  font-size:12px;
}
</style>
#+END_EXAMPLE

*** Vertical Line Separator in <li>

#+BEGIN_EXAMPLE
<ul class="ul">
  <li><a href="">1</a></li>
  <li><a href="">2</a></li>
</ul>

.ul li:last-child {
  margin-right: 5px;
}
.ul li:not(:first-child):before {
  content: "|";
  padding:0 5px;
}
#+END_EXAMPLE

*** Wrap h1 around a div on the right, float right sequence
#+BEGIN_EXAMPLE
<div class="div">
  <a href=""><img></a>
</div>
<h1>Long text...</h1>
.div {
  display:block;
  float:right;
}
h1 {
  clear: none; /* default is none */
}

/* Make it take the whole width */
@media (max-width: 425px) {
    .div {
        display:block;
        text-align: center;
        width:100%;
    }
}
#+END_EXAMPLE

#+BEGIN_EXAMPLE
<div id="div1" style="float:right"></div>
<div id="div2" style="float:right"></div>
<h1>...</h1>
<!-- Sequence: h1, div2, div1 -->
#+END_EXAMPLE

* Bootstrap
** Mobile Meta Setup
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
// Put this as close to the <head> as possible
// To use the latest IE, chrome=1 is optional
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
// shrink-to-fit is for Safari
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
// Bootstrap css and js files are about 170kb
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" 
  integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" 
  crossorigin="anonymous">
</head>
<body>
<!-- HTML Code -->
<script
  src="https://code.jquery.com/jquery-1.12.4.min.js"
  integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ="
  crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" 
  integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" 
  crossorigin="anonymous"></script>
</body>
</html>

** Global
- box-sizing is border-box including *:before and *:after
- font-size 16px is declared on <html> and font-size:1rem on <body>
- BS3 default font-size is 14px
- <body> also sets global font-family and line-height
- <body> has background-color #fff
- bootstrap.js requries jQuery
- By default, flexbox is not enabled
- If flexbox is enabled:
  - entire grid system switches from float to flex
  - input groups move from table to flex
  - media components move from table to flex
  - After flex is enabled, you might have problems with IE9 and IE10

[[https://v4-alpha.getbootstrap.com/migration/][BS4 vs BS3]]

[[http://www.bootply.com][Hands on different versions of Bootstrap]]

** Content
*** Native font stack 
Switched from Helvetica Neue, Helvetica and Arial to:
- -apply-system (Safari for OS X and iOS)
- BlinkMacSystemFont (Chrome for OS X)
- Segoe UI (Windows)
- Robot (Android)
- Helvetica Neue, Arial, sans-serif !default;

*** h1, h2 heading elements
- heading elements :: margin-bottom: .5rem, no margin-top
- .h1 .h2 :: to imitate heading display without margins 
- Add .display-1, ..., .display-4 to change the size and display for <h1>, <h2>, etc.
- Add <small class="text-muted">secondary heading text</small> to <h1>
  - inline with text in <h1>, light color

*** <p>
- margin-bottom: 1rem, no margin-top
- Add .lead to <p> to make it more standout. 

*** Lists <ul> <ol> <dl>
- margin-bottom: 1rem, no margin-top
- Except nested lists
- add .list-unstyled to <ul>, <ol>. Only only apply for Level-1 children <li>
- add .list-inline to <ul, <ol> and .list-inline-item to li
- add .dl-horizontal to <dl>

*** Horinzontal Center (text, truncate, block)
- Add .text-center in column
- Add .center-block in column (margin:0 auto)
- Add .text-truncate in column can truncate text and provides ellipsis

*** Special Text
- <kbd> User input :: <kbd>cd</kbd>, <kbd><kbd>ctrl</kbd> + <kbd>,</kbd></kbd>
- <pre> has margin-top removed and add margin-bottom: 1rem;
- add .pre-scrollable to <pre> to set a max-height and make it horizontally scrollable
- <code>&lt;em&gt;</code> :: red text 
- <samp>&lt;em&gt;</samp>
- add .small to imitate <small> (normally it's 85% of parent font-size)
- <mark> light yellow
- <s>, <del> strike
- <ins> same as <u> underline
- <em>, <i> and <var> look the same 
- add .initialism to cap and make font size 90% <abbr title="full term">HTML</abbr>
- add .blockquote-reverse to <blockquote><p>...</p><footer>...</footer></blockquote> 

*** Vertical Align
- Only applies to inline, inline-block, inline-table and table cell
- .align-baseline, .align-top, .align-middle, .align-bottom
- .align-text-bottom, .align-text-top

*** Table
- Add class="table" to <table>
  - add .table-inverse (dark) to inverse color
  - add .table-striped to add color to even or odd row within <tbody>
  - add .table-bordered
  - add .table-hover
  - add .table-sm (or .table-condensed) to remove cell padding
  - add .table-reflow to transpose
- Add scope="row" to the first td (or th) in each <tr> inside <tbody>
- Add class="thead-inverse" or thead-default in <thead> to make table header dark or light
- Add colors to rows or individual cells. If table-inverse, use bg-* or text-*
  - .table-active (.active) :: light grey
  - .table-success (.success) :: light green
  - .table-info (.info) :: light blue
  - .table-warning (.warning) :: light yellow
  - .table-danger (.danger) :: light red
- Wrap table.table inside div.table-responsive to make table horizontal scrollable on small devices (under 768px)

*** Image
.img-responsive BS3 .img-fluid BS4

#+BEGIN_EXAMPLE
<!-- block, max-width: 100%; height: auto; -->
<img src="" class="img-responsive">

<!-- add .center-block to <img> to center .img-responsive -->

<!-- Or center an image as inline -->
<img src="" class="img-responsive img-circle" style="display:inline">
#+END_EXAMPLE

max-width and max-height

<div class="img-container" style="width:300px;height:168px;">
  <img src="...">
</div>
.img-container img {
  max-width: 100%;
  max-height: 100%;
}

Image shapes :: img-circle, img-rounded, img-thumbnail

*** Colors
text-muted, text-primary, -success, -info, -warning, -danger
             btn-primary, -success, -info, -warning, -danger
              bg-primary, -success, -info, -warning, -danger

*** Quick float content .pull-left, .pull-right
Not to be used in .navbar. Use .navbar-left or .navbar-right instead.

** Layout
*** Grid
#+BEGIN_EXAMPLE
<div class="container">
  <div class="row">
    <div class="col-*-*"></div>
  </div>
  <div class="row">
    <div class="col-*-*"></div>
    <div class="col-*-*"></div>
    <div class="col-*-*"></div>
  </div>
  <div class="row">
    ...
  </div>
</div>
#+END_EXAMPLE

For all sizes, 15px on each side of a column
.container has a fixed max-width based on different viewports.
.container-fluid takes 100% of the viewport width
.row is a horizontal group of columns. Only columns can be immediate children of rows.

15px on each side of a column

| BS4       |           |           |          |          |          |
|           | <576px    | >=576px   | >=768px  | >=992px  | >=1200px |
| Class     | .col-xs-  | .col-sm-  | .col-md- | .col-lg- | .col-xg- |
| container | none/auto | 540px     | 720px    | 960px    | 1140px   |
| max width |           |           |          |          |          |
|           |           |           |          |          |          |
| BS3       |           |           |          |          |          |
|           |           | <768px    | >=768px  | >=992px  | >=1200px |
| Class     |           | .col-xs-  | .col-sm- | .col-md- | .col-lg- |
| container |           | none/auto | 750px    | 970px    | 1170px   |
| max width |           |           |          |          |          |

col-lg-9 :: non large size will have 100% width
col-md-7 col-lg-9 :: small size and extra small will have 100% width
col-xs-9 col-md-7 :: large size will have 7 columns, small size will have 9 columns

728px :: requires (BS4) md-12, lg-9, xg-8; (BS3) sm-12, md-9, lg-8
300px :: requries (BS4) md-5, lg-4, xg-3; (BS3) sm-5, md-4, lg-3

When column has 100% width, margin-bottom is 25px

div.clearfix.visible-*-(block, inline-block) to prevent strange wrapping with uneven height content at certain viewport size

Offset Columns
col-md-offset-* :: increase the left margin of a column by n columns
Offset can be used to horizontally center a column
div.col-xs-offset-3.col-xs-6 :: to the left 3 columns, width 6 columns, to the right 3 columns
.col-xs-offset-3 carries forward to bigger size. In order to remove offset for larger sizes, add .col-sm-offset-0

Change Column Ordering
col-sm-push-*, col-sm-pull-* :: col-sm-push-8, col-sm-pull-4. Only at sm the columns are pushed/pulled.
This only works when elements can be floated in one row. When they are stacked, this trick doesn't work.

*** Responsive Utility
<<<bs:responsive utility>>>
- .hidden-*-down :: e.g. .hidden-md-down hides an element on xs, sm and md viewports
- .hidden-*-up :: .hidden-md-up hides an element on md, lg and xg viewports
- combine .hidden-*-down and .hidden-*-up to only show element for a specific viewport size
- .hidden-* :: * is xs, sm, lg, xl
- .hidden-print :: hide element for print device
- .visible-print-block :: only visible in print as display: block
- .visible-print-inline :: only visible in print as display: inline
- .visible-print-inline-block :: only visible in print as display: inline-block
- .visible-*-block, -inline, -inline-block where * is xs, sm, lg, xl

*** Media Object
Align media (image, video, audio) to the left or right of a content block

#+BEGIN_EXAMPLE
<div class="media">
  <!-- .media-middle, .media-bottom, default is top -->
  <!-- .media-left, .media-right -->
  <a class="media-left" href="#">
    <img class="media-object" src="..." alt="...">
  </a>
  <div class="media-body">
    <h4 class="media-heading">Media Heading</h4>
    Some Description...
    <!-- Nest another media object -->
  </div>
</div>
#+END_EXAMPLE

Put multiple li.media inside ul.media-list. Good for layout comments

** Utilities
*** Spacing Utility (Boostrap 4)
- m :: margin
- p :: padding
- t, b, l, r :: top, bottom, left, right
- x :: *-left and *-right
- y :: *-top and *-bottom
- a :: all 4 sides
- mt-0 :: margin top 0
- mx-auto :: same as .center-block

In Bootstrap 3, use .form-group to create margin-bottom: 15px

*** Responsive Utility
bs:responsive utility

*** Responsive helpers (embed and float)
Apply to <iframe>, <embed>, <video> and <object> to maintain media size ratio

#+BEGIN_EXAMPLE
<div class="embed-responsive embed-responsive-16by9">
  <iframe class="embed-responsive-item" src="//www.youtube.com/embed/zpOULjyy-n8?rel=0" allowfullscreen></iframe>
</div>
#+END_EXAMPLE

BS3 4by3 and 16by9. BS4 added 21by9 and 1by1

Control floats based on viewport size breakpoint
float-xs-left, float-xs-right, float-xs-none

*** Border (BS4)
- .rounded
- .rounded-circle
- .rounded-top, right, left, bottom

*** Text
<<<bs:text align>>>
- BS4 :: .text-*-left, .text-*-right, .text-*-center, * is xs, sm, md, lg, xl
- BS3 :: .text-justify, .text-left, right, center

Text nowrap :: .text-nowrap

Text color
- .text-muted
- .text-primary, -success, -info, ...

Font weight
- .font-weight-bold, .font-weight-normal
- .font-italic

** Components
*** Alert
Wrap text in div with .alert and one of the alert color class
- alert-success
- alert-info
- alert-warning
- alert-danger

100% width block with inner and outter spacing

Non-dismissible
#+BEGIN_EXAMPLE
<div class="alert alert-danger" role="alert">
  Some text with
  <a href="#" class="alert-link"> a link </a> 
  some other text
</div>
#+END_EXAMPLE

Dismissable
#+BEGIN_EXAMPLE
<div class="alert alert-warning alert-dismissible" role="alert">
  <button type="button" class="close" data-dismiss="alert" aria-label="Close">
    <span aria-hidden="true">&times;</span>
  </button>
  <strong>Warning!</strong> Better check yourself, you're not looking too good.
</div>
#+END_EXAMPLE

*** Jumbotron
.page-header :: Extra space on top and some on bottom
#+BEGIN_EXAMPLE
<div class="page-header">
  <h1>Example page header <small>Subtext for header</small></h1>
</div>
#+END_EXAMPLE

Jumbotron :: 100% width
BS4 uses h.display-3, p.lead
#+BEGIN_EXAMPLE
<div class="jumbotron">
  <h1 class="display-3">Hello, world!</h1>
  <p class="lead">Text.</p>
  <hr class="my-2">
  <p>Another paragraph.</p>
  <p class="lead">
    <a class="btn btn-primary btn-lg" href="#" role="button">Learn more</a>
  </p>
</div>
#+END_EXAMPLE
*** Tag (BS4) Label (BS3)
<<<bs:tag>>>
Used in <button>, <h1> as inline element and in bs:list group 
<span class="tag tag-default">New</span>
<span class="label label-info">New</span>

tag-pill or badge in BS3 can collapse when there's no content
<span class="tag tag-pill tag-default">Default</span>

<<<bs:Center Tags>>> Vertically center span inside h1
h1,h2,h3 {
  vertical-align:middle;
}

h1>.tag, h2>.tag, h3>.tag {
  vertical-aign:middle;
  margin-top:-0.5em;
  font-size: 50%; /* default is 75%. Make the tag smaller */
}

*** Progress
Contextual classes :: progress-success, etc.
.progress-striped

BS4
#+BEGIN_EXAMPLE
<div class="text-xs-center" id="example-caption-4">Some Text appears on top progress bar</div>
<progress class="progress" value="75" max="100" aria-describedby="example-caption-4"></progress>
#+END_EXAMPLE

BS3 is more reliable..

Contextual classes :: progress-bar-success, etc.
.progress-bar-striped
Add .active to .progress-bar-striped to animate the stripes right to left

#+BEGIN_EXAMPLE
<div class="progress">
  <div class="progress-bar"
       role="progressbar"
       aria-valuenow="0"
       aria-valuemin="0"
       aria-valuemax="100"
       style="min-width: 2em;">
    0%
  </div>
</div>
<div class="progress">
  <div class="progress-bar"
       role="progressbar"
       aria-valuenow="2"
       aria-valuemin="0"
       aria-valuemax="100"
       style="min-width: 2em; width: 2%;">
    2%
  </div>
</div>

<!-- Align multiple .progress-bar's on one line in ratio -->
<div class="progress">
  <div class="progress-bar progress-bar-success" style="width: 35%">
    <span class="sr-only">35% Complete (success)</span>
  </div>
  <div class="progress-bar progress-bar-warning progress-bar-striped" style="width: 20%">
    <span class="sr-only">20% Complete (warning)</span>
  </div>
  <div class="progress-bar progress-bar-danger" style="width: 10%">
    <span class="sr-only">10% Complete (danger)</span>
  </div>
</div>
#+END_EXAMPLE

*** Button, Button Group
<<<bs:button>>>
Used in bs:nav bs:navbar
Add .btn.btn-default to <a>, <button> and <input>
Only button.btn can be used as button in nav

btn-default, btn-primary, btn-success, info, warning, danger

btn-lg, btn-sm, btn-xs

btn-block :: full width of parent

Add .active to .btn to show the button is pressed

Button with icon
#+BEGIN_EXAMPLE
<a href="#" class="btn btn-default btn-lg">
 <span class="glyphicon glyphicon-search"></span> Button Large
</a>
#+END_EXAMPLE

<<<bs:btn-group>>>
Use role="group" for .btn-group and .btn-group-vertical
div.btn-group to align <button>s horizontally without padding nor margin
div.btn-group-vertical to align <button>s vertically without padding nor margin

Use role="toolbar" for .btn-toolbar
When there're multiple div.btn-group or div.btn-group-vertical, use div.btn-toolbar to wrap them.

To group a bs:dropdown with <button>s, use div.btn-group to wrap the dropdown all together.

*** Form
<<<bs:form>>>
- .sr-only :: add to <label> to hide it
- .form-group :: add to <div> which wraps each form field to add margin-bottom
  - .form-group-lg, .form-group-sm :: sizing 

**** .form-control
- .form-control :: add to <input>, <select>, <textarea> to make it width 100%
- .form-control-file :: add to <input type=file> for 100% width 
  - input.form-control-lg, input.form-control-sm :: sizing (BS4)
  - input.input-lg, input.input-sm :: sizing (BS3) 

**** Help Text (after <input>)
- .form-text (.help-block) :: block-level help text. p.form-text or div.form-text
- .text-muted :: inline help text small.text-muted or span.text-muted
- aria-describedby attribute (may also refer to the feedback)

#+BEGIN_EXAMPLE
<div class="form-group">
  <label for="inputPassword">Password</label>
  <input type="password" id="inputPassword" class="form-control" aria-describedby="passwordHelpInline">
  <small id="passwordHelpInline" class="text-muted">
    Must be 8-20 characters long.
  </small>
</div>
#+END_EXAMPLE

**** .form-inline
- By default, <form> doesn't have to have any class
- .form-inline :: add to <form> and any form field to make it inline. Only works for md and above viewport sizes

**** Checkbox and Radio
- div.checkbox (.form-check BS4), div.radio (BS3 only)
- label.checkbox-inline (.form-check-inline BS4), label.radio-inline (BS3 only)
- label.form-check-label (BS4 only)
- input.form-check-input (BS4 only)

<div class="checkbox">
  <label>
    <input id="a" type="checkbox">
    Only one checkbox
  </label>
</div>

<div class="form-group">
 <label class="checkbox-inline">
    <input name="a" id="a1" type="checkbox">
    Checkbox #1
 </label>
 <label class="checkbox-inline">
    <input name="a" id="a2" type="checkbox">
    Checkbox #2
  </label>
</div>

**** .input-group
<<<bs:form:input-group>>>
Group multiple inputs of different types (or even text) in one line. Good for making very short form

#+BEGIN_EXAMPLE
<div class="form-group">
  <label class="sr-only" for="exampleInputAmount">Amount (in dollars)</label>
  <div class="input-group">
    <div class="input-group-addon">
      <input type="checkbox" checked>
    </div>
    <input type="text" class="form-control" id="exampleInputAmount" placeholder="Amount">
    <div class="input-group-addon">.00</div>
  </div>
</div>

<div class="form-group">
  <div class="input-group">
    <input type="text" class="form-control" placeholder="Search terms">
    <span class="input-group-btn">
      <button class="btn btn-default" type="submit">Go!</button>
    </span>
  </div>
</div>
#+END_EXAMPLE

**** Align fields in columns
Add .col-*-* to <label> and container of form field. Also add .control-label to <label>
<div class="form-group">
  <label class="col-sm-2 control-label" for="inputComments">Comments</label>
  <div class="col-sm-10">
    <textarea class="form-control" id="inputComments"></textarea>
  </div>
</div>

Align Submit button
<div class="form-group">
  <div class="col-sm-10 col-sm-offset-2">
    <input type="submit" class="btn btn-default" value="submit">
  </div>
</div>

Align checkbox/radio
<div class="form-group">
 <div class="col-sm-10 col-sm-offset-2">
   <label class="checkbox-inline">
      <input name="a" type="checkbox">
      Checkbox #2
   </label>
 </div>
</div>

**** Validation and Feedback
Add validation class to div.form-group to add color as a whole
- .has-success
- .has-warning
- .has-error
- .has-feedback

Validation feedback with icon and/or text (only input type=text)
- .has-feedback :: add to div.form-group
- .control-label :: add to <label>
- span.glyphicon.glyphicon-ok.form-control-feedback :: icon inside field (BS3)
- input.form-control-warning, -success, -danger :: icon inside field (BS4)
- div.form-control-feedback :: feedback in text

#+BEGIN_EXAMPLE
<div class="form-group has-feedback">
  <label class="control-label" for="inputName">Name</label>
  <input class="form-control" id="inputName" type="text" placeholder="Name">
  <span class="glyphicon glyphicon-ok form-control-feedback"></span>
</div>
#+END_EXAMPLE
*** Thumbnail (BS3)
div.thumbnail is a block with padding 4px and border 1px.
Place it inside a column for layout

*** List group
<<<bs:list group>>>
Used in bs:panel bs:list group

- Parent and child can be any HTML elements.
- <ul> <li> will not have hovering effect
- Add contextual classes to li.list-group-item 
  - list-group-item-success, info, warning, danger

#+BEGIN_EXAMPLE
<div class="list-group">
  <!-- may use .disabled, .active -->
  <li class="list-group-item disabled">
    <!-- may use bs:tag -->
    New Mails
    <span class="tag tag-default tag-pill float-xs-right">14</span>
  </li>

  <!-- BS4: link as a button, use <div> as parent -->
  <a class="list-group-item list-group-item-action">
    Dapibus ac facilisis in
  </a>

  <!-- BS3: link as a button, use <div> as parent -->
  <button type="button" class="list-group-item">
    Dapibus ac facilisis in
  </button>

  <!-- Custom Content BS3 -->
  <a href="#" class="list-group-item">
    <h4 class="list-group-item-heading">Heading</h4>
    <p class="list-group-item-text">...</p>
  </a>

  <!-- Custom Content BS4 -->
  <a href="#" class="list-group-item list-group-item-action">
    <h4 class="list-group-item-heading">Heading</h4>
    <p class="list-group-item-text">...</p>
  </a>

</div>
#+END_EXAMPLE

*** Panel (BS3 only)
<<<bs:panel>>>
3 rows layout 100% width with padding

Contextual classes: panel-success, ...

#+BEGIN_EXAMPLE
<div class="panel panel-default">

  <div class="panel-heading">
    <h2 class="panel-title">Title</h2>
  </div>

  <div class="panel-body">
    <p>Panel Content</p>
  </div>

  <!-- may add any HTML or BS components -->

  <div class="panel-footer">
    <a href="#">Some Action</a>
  </div>

</div>
#+END_EXAMPLE

.panel-collapse
- Expand and collapse a panel bs:collapse
- Place .panel-body inside .panel-collpse
- .list-group can replace .panel-body inside .panel-collapse

#+BEGIN_EXAMPLE
<!-- add role="tablist" and aria-multiselectable -->
<div class="panel-group"
     id="accordion"
     role="tablist"
     aria-multiselectable="true">

  <div class="panel panel-default">
    <!-- add role="tab" and id for each panel-heading -->
    <div class="panel-heading"
         role="tab"
         id="headingOne">
      <h4 class="panel-title">
        <!-- For each .panel-title
             - add regular bs:collapse action button with data-parent
        -->

        <!-- This panel opens initially -->
        <!-- no .collapsed in <a> means it expands initially -->
        <!-- aria-expanded="true" not false! -->
        <a role="button"
           data-toggle="collapse"
           data-parent="#accordion"
           href="#collapseOne"
           aria-expanded="true"
           aria-controls="collapseOne">
          Collapsible Group Item #1
        </a>
      </h4>
    </div>

    <!-- .collapse.in :: displays content initially -->
    <div id="collapseOne"
         class="panel-collapse collapse in"
         role="tabpanel"
         aria-labelledby="headingOne">
      <div class="panel-body">
        ...
      </div>
    </div>

  </div>

  <div class="panel panel-default">
    <div class="panel-heading" role="tab" id="headingTwo">
      <h4 class="panel-title">
        <!-- .collapsed :: collapse content initially -->
        <a class="collapsed"
           role="button"
           data-toggle="collapse"
           data-parent="#accordion"
           href="#collapseTwo"
           aria-expanded="false"
           aria-controls="collapseTwo">
          Collapsible Group Item #2
        </a>
      </h4>
    </div>

    <!-- .collapse :: hides content initially -->
    <div id="collapseTwo"
         class="panel-collapse collapse"
         role="tabpanel"
         aria-labelledby="headingTwo">
      <div class="panel-body">
        ...
      </div>
    </div>
  </div>

</div>
#+END_EXAMPLE

*** Card, Card Group, Card Deck (BS4)
<<<bs:card>>>
Panel is replaced by Card in BS4

#+BEGIN_EXAMPLE
<!-- add .card-inverse to make text color white.
     contextual classes :: card-primary, info, etc.
     outline color :: card-outline-primary, info, etc.
-->
<div class="card">

  <!-- .card-header in <h*> -->
  <h3 class="card-header">Featured</h3>
  <!--  header can have bs:nav, tabs or pills -->
  <!-- just add .card-header-tabs --->
  <div class="card-header">
    <ul class="nav nav-tabs card-header-tabs">
      ...
    </ul>
  </div>

  <!-- .card-img without -top or -bottom centers the image inside .card -->
  <img class="card-img-top" src="..." alt="Card image cap">
  <!-- Overlay content on image -->
  <div class="card-img-overlay">
    <h4 class="card-title">Image title</h4>
    <p class="card-text">...</p>
    <p class="card-text"><small class="text-muted">...</small></p>
  </div>

  <!-- Wrap text with .card-block -->
  <div class="card-block">
    <h4 class="card-title">Card title</h4>
    <p class="card-text">...</p>
    <!-- regular button -->
    <a href="#" class="btn btn-primary">Go</a>
  </div>

  <div class="card-block">
    <!-- .card-title and .card-subtitle in <h*> -->
    <h4 class="card-title">Card title</h4>
    <h6 class="card-subtitle text-muted">Support card subtitle</h6>
  </div>

  <!-- bs:list group -->
  <ul class="list-group list-group-flush">
    <li class="list-group-item">Cras justo odio</li>
    <li class="list-group-item">Dapibus ac facilisis in</li>
    <li class="list-group-item">Vestibulum at eros</li>
  </ul>

  <div class="card-block">
    <!-- .card-link -->
    <a href="#" class="card-link">Card link</a>
    <a href="#" class="card-link">Another link</a>
  </div>

  <img class="card-img-bottom" src="..." alt="Card image cap">

  <div class="card-footer">2 days ago</div>
  <!-- .card-header in <h*> -->
  <h3 class="card-footer">2 days ago</h3>

</div>
#+END_EXAMPLE

Card Group
- wrap all .card inside div.card-group
- each .card will have equal height with no spacing like in a table

Card Deck
- Like .card-group but with spacing
- wrap all .card inside div.card-deck
- if flex is not enabled, wrap div.card-deck with div.card-deck-wrapper

Card Columns
- Masonry
- Wrap all .card inside div.card-columns

*** Dropdown (js)
<<<bs:dropdown>>> For navigation purpose. 
Used in bs:nav bs:navbar bs:btn-group

#+BEGIN_EXAMPLE
<!-- .open :: dropdown state is always open -->
<div class="dropdown open">
  <!-- .dropdown-toggle turn something into a dropdown toggle -->
  <!-- data-toggle :: attach js dropdown event -->
  <button
    type="button" id="dropdownMenuButton"
    class="btn btn-secondary dropdown-toggle"
    data-toggle="dropdown"
    aria-haspopup="true"
    aria-expanded="false">
    Dropdown button <span class="caret"></span>
    <!-- BS4 does't have to define caret -->
  </button>
  
  <!-- BS4 no longer requires menu items to be <li><a /></li> but you have to use .dropdown-item -->
  <!-- <ul> <li> <a> are used in BS3 -->
  <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
    <h6 class="dropdown-header">Combo A (not selectable)</h6>
    <a class="dropdown-item" href="#">1</a>
    <a class="dropdown-item" href="#">2</a>
    <a class="dropdown-item" href="#">3</a>
    <!-- BS3 use .divider -->
    <div role="separator" class="dropdown-divider"></div>
    <h6 class="dropdown-header">Combo B (not selectable)</h6>
    <a class="dropdown-item" href="#">4</a>
    <!-- disabled -->
    <a class="dropdown-item disabled" href="#">5 (Sold out!)</a>
    <a class="dropdown-item" href="#">6</a>
  </div>
</div>
#+END_EXAMPLE

To group a bs:dropdown with <button>s, use div.btn-group to wrap the dropdown all together.

#+BEGIN_EXAMPLE
<div class="btn-group" role="group" aria-label="...">
  <button type="button" class="btn btn-info">Button #1</button>
  <button type="button" class="btn btn-info">Button #2</button>

  <!-- dropdown starts here -->
  <div class="btn-group" role="group">
    <button
      type="button"
      class="btn btn-info dropdown-toggle"
      data-toggle="dropdown"
      aria-haspopup="true"
      aria-expanded="false">
      Button #3: Dropdown
      <!-- BS4 doesn't need to manually add a caret -->
      <!-- <span class="caret"></span> -->
    </button>

    <!-- add ul.dropdown-menu mentioned above -->
  </div>

</div>
#+END_EXAMPLE

*** Navigation (js), tab (js)
**** .nav, .nav-tabs, .nav-pills, tablist (js)
<<<bs:nav>>> :: May use 
- bs:dropdown as a nav item
- bs:tab to show and hide content
- bs:scrollspy :: <a href="#home">

Items are blocks float to left or stacked vertically

#+BEGIN_EXAMPLE
<!-- nav-tabs or nav-pills -->
<!-- .nav-stacked :: add to ul -->
<!-- .nav-justified :: add to ul. Center tabs/pills -->
  
<ul class="nav nav-tabs">
  
  <!-- BS4 for <li> :: add .nav-item and remove role="presentation" -->
  <li role="presentation" class="active">
    <!-- BS4 for <a> :: add .nav-link -->
    <a href="#">Item 1</a>
  </li>
  <li role="presentation" class="disabled"><a href="#">Item 2</a></li>
  <li role="presentation"><a href="#">Item 3</a></li>

  <!-- Item can be a bs:dropdown -->
  <li role="presentation" class="dropdown">
    <button
      class="dropdown-toggle"
      data-toggle="dropdown"
      aria-haspopup="true"
      aria-expanded="false">
      Item 4
    </button>

    <ul class="dropdown-menu">
      ...
    </ul>
  </li>

</ul>
#+END_EXAMPLE

<<<bs:tab>>>
Display content when nav-tabs or nav-pills is clicked $().tab data-toggle="tab"
#+BEGIN_EXAMPLE
<!-- add role="tablist" -->
<ul class="nav nav-tabs"
    role="tablist"
    id="myTab">
  <!-- Be sure to add .active -->
  <!-- BS4 for <li> :: add .nav-item and remove role="presentation" -->
  <li role="presentation" class="active">
    <!-- <a> ::
         add role="tab", data-toggle="tab", aria-controls="..."
         BS4 :: add .nav-link
         may use data-target instead of href
     -->
    <a href="#item1"
       data-toggle="tab"
       role="tab"
       aria-controls="item1">Item 1</a>
  </li>


  <li role="presentation" class="active">
    <!-- <a> ::
         add role="tab", data-toggle="tab", aria-controls="..."
         BS4 :: add .nav-link
     -->
    <a href="#item1"
       data-toggle="tab"
       role="tab"
       aria-controls="item2">Item 2</a>
  </li>

</ul>

<div class="tab-content">
  <!-- effect :: .fade to div.tab-pane -->
  <div class="tab-pane active"
       id="item1"
       role="tabpanel">
    Item 1 content
  </div>

  <div class="tab-pane active"
       id="item2"
       role="tabpanel">
    Item 2 content
  </div>
</div>
#+END_EXAMPLE

**** Navbar (js)
<<<bs:navbar>>> is responsive
Use bs:collapse

div.collapse collpses at viewport <768px which is xs in BS3 and sm in BS4

Background image to navbar 
#+BEGIN_EXAMPLE
@media (min-width:768px) {
  .navbar {
    background:url('../images/nav-bg.jpg') center repeat-x #222;
    background-size:auto 100%;
  }
}

@media (max-width:768px) {
  .navbar .navbar-header{
    background:url('../images/nav-bg.jpg') center repeat-x #222;
    background-size:auto 100%;
  }
}
#+END_EXAMPLE

#+BEGIN_EXAMPLE
<!-- .navbar-fixed-bottom | .navbar-fixed-top :: add to <nav> if navbar is fixed -->
<!-- .navbar-default | .navbar-inverse (black and white) -->
<!-- customize color, border using .navbar-default -->
<nav class="navbar navbar-default">
  <!-- Without div.container, the navbar will align to left -->
  <div class="container">

    <!-- Add branding -->
    <div class="navbar-header">
      <!-- Style toggle button -->
      <button type="button"
              class="navbar-toggle"
              data-toggle="collapse"
              data-target="#myNavbar"
              aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <a class="navbar-brand" href="">Website Name</a>
      <!-- Add a logo in a.navbar-brand. Height should 20px. -->
      <p class="navbar-text">optional: extra text</p>
    </div>

    <!-- .collapse is display: none; -->
    <div class="collapse navbar-collapse" id="myNavbar">
      <ul class="nav navbar-nav">
        <li><a href="#">Submenu 1</a></li>
        <li><a href="#">Submenu 2</a></li>

        <!-- bs:dropdown -->
        <li>
          <a href="#"
             class="dropdown-toggle"
             data-toggle="dropdown"
             role="button"
             aria-haspopup="true"
             aria-expanded="false">Submenu 3</a>
          <ul class="dropdown-menu">
            ...
          </ul>
        </li>

      </ul> <!-- ul.navbar-nav ends -->

      <!-- Add extra text -->
      <p class="navbar-text">optional: extra text</p>

      <!-- Add a bs:button -->
      <button type="button" class="btn btn-default navbar-btn">sign in</button>

      <!-- Add a bs:form or bs:form:input-group -->
      <form class="navbar-form navbar-right" role="search">
        <div class="form-group">
          ...
        </div>
      </form>

    </div>
    <!-- div.collapse ends -->

  </div>
  <!-- div.container ends -->
</nav>
#+END_EXAMPLE

**** Breadcrumb
Simple align links horizontally

#+BEGIN_EXAMPLE
<ol class="breadcrumb">
  <li class="breadcrumb-item"><a href="#">Home</a></li>
  <li class="breadcrumb-item"><a href="#">Library</a></li>
  <li class="breadcrumb-item active">Data</li>
</ol>
#+END_EXAMPLE

**** Pagination and pager
Simply align links horizontally
BS3 recommends to replace <a> with <span> when li.disabled

#+BEGIN_EXAMPLE
<nav aria-label="Page navigation">
  <!-- .pagination-lg | .pagination-sm :: add to ul -->
  <ul class="pagination">
    <!-- li.disabled -->
    <li class="disabled">
      <a href="#" aria-label="Previous">
        <span aria-hidden="true">&laquo;</span>
      </a>
    </li>

    <!-- li.active -->
    <li class="active">
      <a href="#">1</a> <span class="sr-only">(current)</span>
    </li>

    <li><a href="#">2</a></li>
    <li><a href="#">3</a></li>
    <li><a href="#">4</a></li>
    <li><a href="#">5</a></li>

    <li>
      <a href="#" aria-label="Next">
        <span aria-hidden="true">&raquo;</span>
      </a>
    </li>
  </ul>
</nav>
#+END_EXAMPLE

Pager :: Simple Previous and Next buttons with no pages 
#+BEGIN_EXAMPLE
<!-- add <nav>, classes li.previous, li.next to align buttons to both ends -->
<!-- remove <nav>, classes li.previous, li.next to center them -->
<nav aria-label="...">
  <ul class="pager">
    <li class="previous disabled">
      <a href="#"><span aria-hidden="true">&larr;</span> Older</a>
    </li>
    <li class="next">
      <a href="#">Newer <span aria-hidden="true">&rarr;</span></a>
    </li>
  </ul>
</nav>
#+END_EXAMPLE

BS4 structure is a little different
- .page-item :: add to every <li>
- .page-link :: add to every li>a
- .disabled :: add to li and add tabindex="-1" to li>a. <a> will have pointer-events: none.
- Optionally remove <a> if li.disabled :: BS3 seems to recommend this behavior

*** Carousel (js)
Don't add data-ride if it's triggered by javascript

Pictures have to be the same width and height.

#+BEGIN_EXAMPLE
<!-- Options
data-interval :: 5000
data-pause :: "hover" | null
data-wrap :: true
keyboard :: true
-->
<div id="carousel-example-generic"
     class="carousel slide"
     data-ride="carousel">

  <ol class="carousel-indicators">
    <!-- An item must have .active -->
    <li data-target="#carousel-example-generic" data-slide-to="0" class="active"></li>
    <li data-target="#carousel-example-generic" data-slide-to="1"></li>
    <li data-target="#carousel-example-generic" data-slide-to="2"></li>
  </ol>

  <div class="carousel-inner" role="listbox">
    <!-- An item must have .active -->
    <!-- BS4 :: use .carousel-item instead of .item -->
    <div class="item active">
      <img src="..." alt="...">
      <div class="carousel-caption">
        <h3>...</h3>
        <p>...</p>
      </div>
    </div>

    <div class="item">
      <img src="..." alt="...">
      <div class="carousel-caption">
        ...
      </div>
    </div>

    <!--  more items -->
  </div>

  <!-- Controls -->
  <!-- data-slide could be
  prev, next, cycle, pause, number (integer starting from 0)
  -->
  <a class="left carousel-control"
     href="#carousel-example-generic"
     role="button"
     data-slide="prev">
    <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
    <span class="sr-only">Previous</span>
  </a>
  <a class="right carousel-control"
     href="#carousel-example-generic"
     role="button"
     data-slide="next">
    <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
    <span class="sr-only">Next</span>
  </a>

</div>

<script>
  $(function() {
    $('#carousel-example-generic').carousel({
      // options :: see above
    });
    /* Other methods refer to data-slide
    e.g. .carousel('cycle') ...
     */

    // Catch events
    // slide.bs.carousel :: start
    // slid.bs.carousel :: complete
    // Event object
    // direction :: 'left' | 'right'
    // relatedTarget :: DOM element that is about to be active
    $('#carousel-example-generic').on('slide.bs.carousel', function(e) {
     // do something
    });

  });
</script>
#+END_EXAMPLE

*** Modal (js)

#+BEGIN_EXAMPLE
<!-- When a modal is open, it adds .modal-open to <body> and also
      a .modalbackdrop to provide a click area to dismiss the modal
--->
<button type="button" class="btn btn-primary btn-lg"
        data-toggle="modal"
        data-target="#myModal">
  Launch demo modal
</button>

<!-- remove .fade to remove animation -->
<div class="modal fade"
     id="myModal"
     tabindex="-1"
     role="dialog"
     aria-labelledby="myModalLabel">

  <!-- Sizing :: in modal-dialog, add modal-lg, modal-sm -->
  <div class="modal-dialog" role="document">

    <div class="modal-content">

      <div class="modal-header">
        <button type="button"
                class="close"
                data-dismiss="modal"
                aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
        <h4 class="modal-title" id="myModalLabel">Modal title</h4>
      </div>

      <div class="modal-body">
        <!-- stack .row to use grid -->
        <!-- Any HTML or BS components -->
        <!-- form field autofocus has no effect. Refer to javascript below -->
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-default"
                data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary">Save changes</button>
      </div>

    </div>

  </div>

</div>

<script>
  /* Options :: data-*
     backdrop :: true. Use 'static' to not close the modal on click
     keyboard :: true. Esp key closes the modal
     show :: true. Show when initialized
     remote :: deprecated.
  */

  /* Methods
     .modal(options)
     method_name :: toggle, show, hide, and
     handUpdate (readjust positioning. Only needed if modal height changes while it opens)
     .modal('method_name')
  */

  /* Event types:
  show.bs.modal :: start.
  shown.bs.modal :: finished (after transition is complete)
  hide.bs.modal :: start to hide
  hidden.bs.modal :: finished being hidden
  loaded.bs.modal :: content has been loaded through remote option
     Event object
   e.relatedTarget :: If triggered by a click, it's the clicked element
   */
  $('#myModal').on('show.bs.modal', function(e) {
    // Using the same modal to display different content
    var button = $(e.relatedTarget);
    var data = button.data('lili-content');
    // Do some Ajax
    var modal = $(this);
    modal.find('.modal-title').text('...');
    modal.find('.modal-body').innerHTML = '...';

    <!-- form field autofocus has no effect. Use this workaround -->
    $('#fieldInputID').focus();
  });
</script>
#+END_EXAMPLE

*** Collapse (js)
<<<bs:collapse>>> :: Button to expand or collapse content
Used in bs:navbar bs:panel bs:card (accordion)

#+BEGIN_EXAMPLE
<!-- Action Button as <a> -->
<a class="btn btn-primary"
   role="button"
   data-toggle="collapse"
   href="#collapseExample"
   aria-expanded="false"
   aria-controls="collapseExample">
  Link with href
</a>

<!-- Action Button as <button> -->
<button class="btn btn-primary"
        type="button"
        data-toggle="collapse"
        data-target="#collapseExample"
        aria-expanded="false"
        aria-controls="collapseExample">
  Button with data-target
</button>

<!-- .collapse :: hide content initially -->
<div class="collapse" id="collapseExample">
  <!-- BS4 :: use .card.card-block instead of .well -->
  <div class="well">
    ...
  </div>
</div>
#+END_EXAMPLE

*** Tooltip (js)
Need to initiate in javascript

#+BEGIN_EXAMPLE
<button type="button" class="btn btn-default" 
        data-toggle="tooltip" 
        data-placement="left" 
        title="Tooltip on left">Tooltip on left</button>

<a href="#"
   data-toggle="tooltip"
   data-placement="bottom"
   title="">Tooltip on bottom</a>

<script>
  $('[data-toggle="tooltip"]').tooltip();
</script>
#+END_EXAMPLE

*** Popover (js)
Need to initiate in javascript
A title can be specified

data-trigger can be click | hover | focus | manual

#+BEGIN_EXAMPLE
<a tabindex="0"
   class="btn btn-lg btn-danger"
   role="button"
   data-toggle="popover"
   data-container="body"
   data-trigger="focus"
   title="Dismissible popover"
   data-content="And here's some amazing content. It's very engaging. Right?">
  Click on anywhere to dismiss the popover
</a>

<button type="button"
   class="btn btn-lg btn-danger"
   role="button"
   data-toggle="popover"
   data-trigger="focus"
   title="Dismissible popover"
   data-content="And here's some amazing content. It's very engaging. Right?">
  Must click on the button again to dismiss the popover
</button>

<script>
  $('[data-toggle="popover"]').popover();
</script>
#+END_EXAMPLE

*** Scrollspy (js)
Must use with bs:nav

#+BEGIN_EXAMPLE
<body data-spy="scroll" data-target="#navbar-example">
  ...
  <div id="navbar-example">
    <ul class="nav nav-tabs" role="tablist">
      ...
    </ul>
  </div>
  ...
</body>

<style>
body {
  position: relative;
}
</style>
#+END_EXAMPLE

** Mockup Tools
[[http://www.layoutit.com/][LayoutIt.com]] BS3
http://www.bootply.com/

* HTML
** DOM
*** Document Object
[[https://developer.mozilla.org/en/docs/Web/API/Document][Document properties and methods]]

| document.methodName() or     | Notes                                                    | Use in       |
| document.propertyName        |                                                          | Element Obj? |
|------------------------------+----------------------------------------------------------+--------------|
| createElement("p")           | appendChild                                              | no           |
| createTextNode("text node"); | appendChild                                              | no           |
| createAttribute('data-id')   | appendChild                                              | no           |
|                              |                                                          |              |
| getElementById("id")         | null or element object                                   | no           |
| getElementsByClassName       | NodeList                                                 | yes          |
| getElementsByTagName("p")    | NodeList                                                 | yes          |
| querySelector('#id')         | 1st matched element. null or exception or element object | yes          |
| querySelectorAll('#id')      | Static NodeList or exception                             | yes          |
|                              |                                                          |              |
| normalize()                  | remove empty text nodes and join adjacent text nodes     | yes          |
|                              |                                                          |              |

*** NodeList Object
<<<NodeList>>>
NodeList Object appears like an array (loop like an array) but cannot use Array Methods such as valueOf(), join(), forEach().

<<<Static NodeList>>> means changes to DOM have no effect.

All NodeList objects are live objects meaning changes
that are made in other code places reflect on all NodeList objects that were previously found.

var myNodeList = document.getElementsByTagName("P");
console.log(myNodeList.length); 
var firstP = myNodeList[0];
var firstP = myNodeList.item(0); // same as above, return null if not exists
var firstP = document.getElementsByTagName("p")[0]; // same as above

console.log(firstP.innerHTML);
firstP.style.backgroundColor = "red";

for (var i=0; i < myNodeList.length; i++) {
 myNodeList[i].style.backgroundColor = "red";
} 

Another way to loop NodeList

#+BEGIN_EXAMPLE
Array.prototype.forEach.call(
 aNodeListArray,
 function(item) {
  console.log(item.id);
 }
);
#+END_EXAMPLE

*** <<<Element Object>>>
[[https://developer.mozilla.org/en-US/docs/Web/API/Element][Element Properties and Methods]]

| element.methodName() or        | Notes                                           | Use in   |
| element.propertyName           |                                                 | Document |
|                                |                                                 | Object?  |
|--------------------------------+-------------------------------------------------+----------|
| accessKey                      | get/set accessKey                               |          |
| addEventListerner()            | refer to event attributes without 'on'          | yes      |
|                                | e.addEventListerner("click", myFunction,false ) |          |
|                                | false for bubbling, true for capturing          |          |
| removeEventListener()          | anonymous function will not work                | yes      |
|                                |                                                 |          |
| click()                        | simulate a click on an element                  | no       |
| blur()                         |                                                 | no       |
| focus()                        |                                                 | no       |
|                                |                                                 |          |
| innerHTML                      | get/set                                         | no       |
|                                |                                                 |          |
| appendChild(newChildNode)      | move element to the end of another element      | no       |
|                                | <<<appendChild>>>                               |          |
| removeChild(childNode)         |                                                 | no       |
| list.insertBefore(newnode,     |                                                 |          |
| list.childNodes[0])            |                                                 |          |
|                                |                                                 |          |
| <<<parentNode>>>               | read only                                       | no       |
| <<<parentElement>>>            | read only                                       | no       |
|                                |                                                 |          |
| .cloneNode()                   |                                                 |          |
|                                |                                                 |          |
| attributes                     | read only. NamedNodeMap                         | no       |
| getAttribute("class")          | attribute value in string                       | no       |
| getAttributeNode("class")      | Attr object                                     | no       |
|                                |                                                 |          |
| .childElementCount             | the number of child element nodes not text      |          |
|                                | and comment nodes                               |          |
| .childNodes                    | NodeList object. .childNodes.length             |          |
|                                | var c = e.childNodes[0].text                    |          |
| .children                      | exclude text and comment nodes.                 |          |
|                                | HTMLCollection object.                          |          |
| classList                      | read only. DOMTokenList                         | no       |
| className                      | get/set                                         | no       |
|                                |                                                 |          |
| clientHeight                   | height + padding, no border and scrollbar       | no       |
| clientWidth                    |                                                 | no       |
| clientTop                      | Top border width                                | no       |
| clientLeft                     | Left border width                               | no       |
| offsetWidth                    | width+padding+border+scrollbar but no margin    | no       |
| offsetHeight                   |                                                 | no       |
| .offsetLeft, offsetTop         | relative to offsetParent                        |          |
| .scrollHeight, .scrollWidth    | width+padding only                              |          |
| .scrollLeft, .scrollTop        | pixels are scrolled                             |          |
|                                |                                                 |          |
| e1.compareDocumentPosition(e2) | compare positions of elements                   |          |
| e1.contains(e2)                | if e2 is a descendant of e1                     |          |
| .contentEditable               |                                                 |          |
|                                |                                                 |          |
| .firstChild                    | child node                                      |          |
| .firstElementChild             | child element node                              |          |
| .nextSibling                   |                                                 |          |
| .nextElementSibling            |                                                 |          |
|                                |                                                 |          |
| .hasAttribute("onclick")       |                                                 |          |
| .hasAttributes()               | has any attributes?                             |          |
| .hasChildNodes()               | has any child nodes                             |          |
|                                |                                                 |          |
| .isEqualNode(e1,e2)            |                                                 |          |
|                                |                                                 |          |
| .nodeName                      | tag name                                        |          |
| .tagName                       | tag name in upppercase                          |          |
| .nodeValue                     |                                                 |          |
|                                |                                                 |          |

*** Event Object
Property
| type             | event name. e.g. mousedown                                 |
| timeStamp        | event occured                                              |
| bubbles          | true or false                                              |
| defaultPrevented | if method preventDefault() was called                      |
| currentTarget    | the element event happens on                               |
| target           | the (child) element event happens on                       |
| view             | get reference of the Window object where the event occured |
|                  |                                                            |

Method
| preventDefault()           | stop defeault event action                                            |
| stopImmediatePropagation() | stop other listerns of the same event (e.g. click) on the same target |
| stopPropagation()          | stop bubbling                                                         |

**** MouseEvent Object
| altKey        | whether ALT key was pressed                                                      |
| shiftKey      | whether Shift key was pressed                                                    |
| ctrlKey       | whether Ctrl key was pressed                                                     |
| button        | 0 left click, 1 middle, 2 right                                                  |
| which         | button + 1: 0: no button, 1 left, 2 middle, 3 right                              |
| buttons       | one or more buttons. More button such as browse back button.Safari not supported |
| clientX       | relative to current window (viewport).                                           |
| clientY       |                                                                                  |
| pageX         | relative to the fully rendered content area. Height might be larger than         |
| pageY         | viewport height.                                                                 |
| screenX       | relative to the screen. e.g. number of monitors and monitor screen               |
| screenY       |                                                                                  |
| relatedTarget | use with mouseover event to find the element the cursor jsut exited or           |
|               | with the mouseout event to find the element the cursor just entered              |

**** KeyboardEvent Object
Keyboard code (KC) - actual key on keyboard (always lowercase)
Unicode Character code (UCC) - result Unicode character (Shift + w = W, return the character code of W)

| altKey   | whether alt is pressed                         |
| ctrlKey  |                                                |
| shiftKey |                                                |
| metaKey  | whether meta is pressed. Windows key           |
| key      | key name on keyboard (F1,Enter..)              |
| keyCode  | keypress-0, keydown,keyup-UCC. All browsers.   |
| charCode | keypress-UCC, keydown,keyup-0. All browsers.   |
| which    | keypress-UCC, keydown,keyup-UCC. All browsers. |
| location | 4 numbers 0 - standard,1 - left,               |
|          | 2 - right (CTRL), 3 - numpad                   |
|          |                                                |

If you want to return UCC for all events cross all browsers use this:
var x = event.charCode || event.keyCode;

**** HashChangeEvent Object
newURL :: the URL after the hash has been changed
oldURL

**** PageTransitionEvent
For events: onpageshow and onpagehide
persisted :: whether the page was cached

**** FocusEvent Object
relatedTarget :: the element related to the element that triggered the event
event.relatedTarget.tagName;

**** AnimationEvent Object
animationName :: keyframe name
elapsedTime :: number of seconds the transition has been running

*** <<<DOMTokenList>>> Object
A collection of space-separated tokens.

| DOMTokenList.methodName() | Notes                                                            |
| or                        |                                                                  |
| DOMTokenList.propertyName |                                                                  |
|---------------------------+------------------------------------------------------------------|
| length                    | read only                                                        |
| add("class2Name")         |                                                                  |
| remove("class2Name")      |                                                                  |
| replace("old","new")      |                                                                  |
| toggle('class2Name')      | if exists, removes and return false. If not, add and return true |
| contains("class2Name")    |                                                                  |

*** <<<NamedNodeMap>>> Object
A collection of Attr object 's. Loopable like an Array but no Array methods.

*** <<<Attr Object>>>
An attribute node.

| name  |   |
| value |   |

** Global Attributes
Can be applied to any element
| accesskey       | Add shortcut. M-accesskey         |
| download        | filename. force download          |
| contenteditable | true or false. Become editable    |
| contextmenu     | right click menu. Only in Firefox |
| dir             | ltr, rtl or auto. text direction. |
| hidden          |                                   |
| spellcheck      | true or false                     |
| tabindex        | Tab button. 1 is first            |
| title           | tool tip                          |
|                 |                                   |

Drag-and-Drop

#+BEGIN_EXAMPLE
// ondropover allows this tag to receive dropped elements.
// ondrop defines what to do with the traferred data
<div id="div1" ondrop="drop(e)" ondragover="allowDrop(e)"></div>
// Make a tag draggable: draggable="true"
// <a> and <img> are by default draggable
// ondragstart defines what data to pass to ondrop
<img id="drag1" src="http://placehold.it/300x250" draggable="true" ondragstart="drag(e)">

<script>
function drag(e) {
  // Pass the dragged element id
  ev.dataTransfer.setData("text", ev.target.id);
}

function allowDrop(e) {
  e.preventDefault();
} 

function drop(e) {
  e.preventDefault();
  var data = e.dataTransfer.getData("text");
  e.target.appendChild(document.getElementById(data));
}
</script>
#+END_EXAMPLE

** Event Attributes
Capturing phrase: DOM heirarchy up
Bubbling phrase (default): DOM heirarchy down

These objects have implemented EventTarget interface which can receive events and may have listeners:
- element, document, window
- XMLHttpRequest, AudioNode, AudioContext and others

*** Windows Event in body tag
| onafterprint, onbeforeprint | only IE and FF                                |
| onbeforeunload              | before page is closed/refreshed               |
| onunload                    | after page is closed/refreshed                |
| onhashchange                | when URL hash is changed                      |
| onload                      | when an object is loaded:                     |
|                             | body, frame, frameset, iframe,                |
|                             | img, link, script, style                      |
|                             | Not run when it's loaded from cache           |
| onpageshow                  | similar to onload but always triggers         |
| onpagehide                  | similar to onunload but onunload event causes |
|                             | the page to not be cached.                    |
| onresize                    |                                               |
|                             |                                               |

*** Form Event Attributes
Also can be applied on almost all elements.

| oncontextmenu | right click to bring context menu                           |
| onreset       |                                                             |
| onsearch      | <input type="search" onsearch="">. IE and FF not supported  |
| onselect      | when text is selected in <input type="text"> or <textarea>  |
| onblur        | leave a form field. opposite of onfocus                     |
| onfocus       | opposite of onblur                                          |
| onfocusin     | similar to onfocus but bubbles. FF not supported            |
| onfocusout    | similar to onblur but bubbles.FF not supported              |
| onchange      | oninput and lose focus. also works on <select> and <keygen> |
| oninput       | not working on <select> and <keygen>                        |
|               |                                                             |

*** Mouse Events, Clipboard Events, Keyboard Events
| ondblclick   | double click                                      |
|              |                                                   |
| ondragstart  |                                                   |
| ondrag       | being dragged                                     |
| ondragend    |                                                   |
|              |                                                   |
| ondragenter  | when dragged element enters the drop target       |
| ondragover   | over the drop target                              |
| ondragleave  | leave the drop target                             |
| ondrop       | is dropped on the drop target                     |
|              |                                                   |
| onscroll     |                                                   |
| onwheel      | only Chrome and FF                                |
|              |                                                   |
| oncopy       |                                                   |
| oncut        |                                                   |
| onpaste      |                                                   |
|              |                                                   |
| onmousedown  |                                                   |
| onmouseenter | when move into child element                      |
| onmouseleave | when moving out of the element (not its children) |
| onmousemove  | when moving inside an element                     |
| onmouseover  | when onto this element                            |
| onmouseout   | when moving out of the element and its children   |
|              |                                                   |
| onkeydown    | evens are in order. works for all keys            |
| onkeypress   | Some keys are not fired: C, A, S, ESC, etc.       |
| onkeyup      | when releasing a key                              |

*** Media Events
Elements: audio, img, embed, object, video
Events in order:

| onloadstart      |   |
| ondurationchange |   |
| onloadedmetadata |   |
| onloadeddata     |   |
| onprogress       |   |
| oncanplay        |   |
| oncanplaytrhough |   |
|                  |   |

*** Animation Events
Refer to CSS @keyframes.
animationstart
animationend
animationiteration :: when animaiton repeats

*** Transition Event
transitionend

*** Misc events
| onerror | when an error occurs while loading an external file: <img> |

** Canvas
** Tags, HTML5 Elements
*** HTML Tags
| Tag      | Usage                             | Notes                                                     |
|----------+-----------------------------------+-----------------------------------------------------------|
| a        | download="filename"               | force download                                            |
| abbr     | title="World Health Organization" | abbreviation WHO                                          |
| address  |                                   | author or owner (not just address) of a document          |
|          |                                   | or an article. display:block, italic author               |
| base     | href,target                       | base url and target for <a> tags                          |
|          |                                   |                                                           |
| article  |                                   | affect outline                                            |
| aside    |                                   |                                                           |
| section  | headline tag is required          | affect outline                                            |
| main     | Use it once                       | not descendant of other tags                              |
| nav      |                                   | affect outline                                            |
|          |                                   |                                                           |
| cite     | <cite>U of T Professor</cite>     | wrap a person's title                                     |
| dfn      | <dfn>HTML</dfn> is ...            | A term to be defined                                      |
| mark     | highlight text                    | background yellow and text in black                       |
| s        |                                   | text-decoration: line-through                             |
| q        | <q cite="abc.com">Build</q>       | Double quotes                                             |
| ruby     | <ruby>a <rt>sound</rt></ruby>     |                                                           |
| wbr      | <wbr>alongword</wbr>              | the word will not be broken for line break                |
|          |                                   |                                                           |
| meter    | min,max,high,low,optimum          | value                                                     |
| progress | max, value                        |                                                           |
|          |                                   |                                                           |
|          |                                   |                                                           |
| colgrup, | specify styles and span for       |                                                           |
| col      | columns in a table                |                                                           |
|          |                                   |                                                           |
| iframe   | srcdoc=""                         | IE & Edge not supported. Repalce double quote with &quot; |
|          | sandbox=""                        | empty to apply all restrictions                           |
|          |                                   | e.g. allow-forms allow-same-origin                        |
| input    | autocomplete="on or off"          | default on. turn off for a specific field                 |
|          | autofocus=""                      |                                                           |
|          | formmethod="get or post"          | overwrite <form> type="submit, image"                     |
|          | formaction="another.php"          | overwrite <form> type="submit, image"                     |
|          | formenctype="multipart/form-data" | overwrite <form> type="submit, image"                     |
|          | formtarget="_blank"               | overwrite <form> type="submit, image"                     |
|          | min="1" max="1979-12-31"          | for type="date" or type="number"                          |
|          | multiple                          | for type="file"                                           |
|          | pattern="regex"                   | for type=text,date,search,url,tel,email,password          |
|          |                                   | escape " in regex with \x22                               |
|          | placeholder="hint"                |                                                           |
|          | step="3"                          | -3,0,3,6 can be accepted. type="number"                   |
|          | type=email, url                   |                                                           |
|          | required                          | no in IE                                                  |
|          | type="range" min max              | slide control                                             |
|          | type="search"                     |                                                           |
|          | disabled="disabled"               | not selectable, editable and not submitted                |
|          | readonly="readonly"               | selectable, not editable and get submitted                |
| samp     | sample computer output            |                                                           |
| code     | monospace                         |                                                           |
| kbd      | monospace                         |                                                           |
| var      | variable name                     |                                                           |
|          |                                   |                                                           |
| li       | value="100"                       | increment by 1                                            |
|          |                                   |                                                           |

*** Picture tag
#+BEGIN_EXAMPLE
<picture>
 <source srcset="a.jpg" media="(min-width: 600px)">
 <source srcset="b.jpg" media="(min-width: 500px)"> 
 <source srcset="fallback.jpg">
 <img src="fallback.jpg">
</picture>
#+END_EXAMPLE

*** Term/name in a list
#+BEGIN_EXAMPLE
<dl>
  <dt>Term #1</dt>
  <dd>Description of Term #1</dd>
  <dt>Term #2</dt>
  <dd>Description of Term #2</dd>
</dl>
#+END_EXAMPLE

** Video
MP4 is the most compatible video format. Uses H.264 video codec and AAC audio codec.
WebM is Google for HTML5. Uses VP8 video codec and Vorbis audio codec. Doesn't support in iOS, Safari nor old IE.
FLV is Flash only. Uses H.263 video codec and MP3 audio codec.

** Meta
*** Meta Refresh (redirect)
#+BEGIN_EXAMPLE
<meta http-equiv="refresh" content="0;URL='http://abc.com'" />
// "0" means zero second.
#+END_EXAMPLE

*** Open Graph Protocol
<<<html:og>>>
Required properties for every page
- og:title
- og:type :: article, video, video.movie, etc. Refer to [[http://ogp.me/#types][ogp types]]
- og:image
- og:url

<meta property="og:title" content="" />

** Email

[[https://www.campaignmonitor.com/dev-resources/guides/mobile][Campaign Monitor Mobile Design Guide]]

| Element   | Note                                                        |
|-----------+-------------------------------------------------------------|
| table     | always assign align, width,border, cellpadding, cellspacing |
| tr        | <tr style="padding:0;margin:0;line-height:0;" height="15">  |
|           | <td>&nbsp;</td>                                             |
|           | </tr> // empty row with height                              |
|           |                                                             |
| td        | Wrap text in td                                             |
|           |                                                             |
| Attribute |                                                             |
|-----------+-------------------------------------------------------------|
| style     | use =display: none!important;=                              |
|           |                                                             |

#+BEGIN_EXAMPLE
<style>
.sectionContainer {
  background-color: #ffffff;
  padding-right:10px !important;
  padding-left:10px !important;
}
.sectionTable {
  background-color: #ffffff;
}
@media only screen and (max-width:640px) {
.sectionTable {
  max-width:640px !important;
  width:100% !important;
}
}
@media only screen and (max-width:480px) {
.sectionTable {
  max-width:480px !important;
  width:100% !important;
}
.sectionContent .s480-w0 {
  display:none !important;
}
} 
</style>

<table>
  <tr>
    <td class="sectionContainer">
      <table border="0" cellpadding="0" cellspacing="0" width="640" class="sectionTable">
        <tr style="padding:0;margin:0;line-height:0;" height="15"><td>&nbsp;</td></tr>
        <tr>
          <td align="center" valign="middle" style="background-color:#004663;color:#ffffff;margin:0;font-size:24px;font-family:Georgia;font-weight:normal;">
            Section #1  
          </td>
        </tr>
        <tr style="padding:0;margin:0;line-height:0;" height="10"><td>&nbsp;</td></tr>
        <tr>
          <td align="center" valign="top">
            
          </td>
        </tr>
      </table>
    <td>
  </tr>
</table>

#+END_EXAMPLE

** Icons, Address Bar color
*** Icons
General Icon in scale of 48px
#+BEGIN_EXAMPLE
<link rel="icon" sizes="192x192" href="icon.png">
#+END_EXAMPLE

IE Tiles :: 4 sizes. Listed are standard size. 1.8 times is better.
#+BEGIN_EXAMPLE
<meta name="application-name" content="CenturyCutCook" />
<meta name="msapplication-TitleColor" content="#009900" />

<meta name="msapplication-sqaure70x70logo" content="icon_smalltitle.png">
<meta name="msapplication-sqaure150x150logo" content="icon_mediumitle.png">
<meta name="msapplication-sqaure310x150logo" content="icon_widetitle.png">
<meta name="msapplication-sqaure310x310logo" content="icon_largetitle.png">
#+END_EXAMPLE

Apple Icon :: Default 60x60
#+BEGIN_EXAMPLE
<link rel="apple-touch-icon" href="touch-icon-iphone.png">
<link rel="apple-touch-icon" sizes="76x76" href="touch-icon-ipad.png">
<link rel="apple-touch-icon" sizes="120x120" href="touch-icon-iphone-retina.png">
<link rel="apple-touch-icon" sizes="152x152" href="touch-icon-ipad-retina.png">
#+END_EXAMPLE

Apple :: Startup Image
Base Size :: 320x480. But different devices ask for different sizes. Follow this to implement
#+BEGIN_EXAMPLE
<link rel="apple-touch-startup-image" href="/startup.png">

<!-- iPad retina portrait startup image -->
<link href="https://placehold.it/1536x2008"
      media="(device-width: 768px) and (device-height: 1024px)
                 and (-webkit-device-pixel-ratio: 2)
                 and (orientation: portrait)"
      rel="apple-touch-startup-image">

<!-- iPad retina landscape startup image -->
<link href="https://placehold.it/1496x2048"
      media="(device-width: 768px) and (device-height: 1024px)
                 and (-webkit-device-pixel-ratio: 2)
                 and (orientation: landscape)"
      rel="apple-touch-startup-image">

<!-- iPad non-retina portrait startup image -->
<link href="https://placehold.it/768x1004"
      media="(device-width: 768px) and (device-height: 1024px)
                 and (-webkit-device-pixel-ratio: 1)
                 and (orientation: portrait)"
      rel="apple-touch-startup-image">

<!-- iPad non-retina landscape startup image -->
<link href="https://placehold.it/748x1024"
      media="(device-width: 768px) and (device-height: 1024px)
                 and (-webkit-device-pixel-ratio: 1)
                 and (orientation: landscape)"
      rel="apple-touch-startup-image">

<!-- iPhone 6 Plus portrait startup image -->
<link href="https://placehold.it/1242x2148"
      media="(device-width: 414px) and (device-height: 736px)
                 and (-webkit-device-pixel-ratio: 3)
                 and (orientation: portrait)"
      rel="apple-touch-startup-image">

<!-- iPhone 6 Plus landscape startup image -->
<link href="https://placehold.it/1182x2208"
      media="(device-width: 414px) and (device-height: 736px)
                 and (-webkit-device-pixel-ratio: 3)
                 and (orientation: landscape)"
      rel="apple-touch-startup-image">

<!-- iPhone 6 startup image -->
<link href="https://placehold.it/750x1294"
      media="(device-width: 375px) and (device-height: 667px)
                 and (-webkit-device-pixel-ratio: 2)"
      rel="apple-touch-startup-image">

<!-- iPhone 5 startup image -->
<link href="https://placehold.it/640x1096"
      media="(device-width: 320px) and (device-height: 568px)
                 and (-webkit-device-pixel-ratio: 2)"
      rel="apple-touch-startup-image">

<!-- iPhone < 5 retina startup image -->
<link href="https://placehold.it/640x920"
      media="(device-width: 320px) and (device-height: 480px)
                 and (-webkit-device-pixel-ratio: 2)"
      rel="apple-touch-startup-image">

<!-- iPhone < 5 non-retina startup image -->
<link href="https://placehold.it/320x460"
      media="(device-width: 320px) and (device-height: 480px)
                 and (-webkit-device-pixel-ratio: 1)"
      rel="apple-touch-startup-image">
#+END_EXAMPLE

*** Address Bar
Hide Safari UI (URL address bar)
#+BEGIN_EXAMPLE
<meta name="apple-mobile-web-app-capable" content="yes">
#+END_EXAMPLE

By default, iOS web content displays under the top black status bar. 
Push the content to the top and make the status transparent
#+BEGIN_EXAMPLE
// default is black
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
#+END_EXAMPLE

Address Bar color
#+BEGIN_EXAMPLE
<meta name="theme-color" content="#4285f4">
#+END_EXAMPLE

** Geolocation
Chrome v50+ only supports geolocation for https
*** .getCurrentPosition
#+BEGIN_EXAMPLE
<button onclick="getLocation()">Get Location</button>
<p id="demo"></p>
<script>
var x = document.getElementById("demo");
function getLocation() {
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(showPosition, showError);
  }
  else {
    x.innerHTML = "Not supported";
  }
}

function showPosition(position) {
 x.innerHTML = "Latitiude" + position.coords.latitude +
               "Longitude: " + position.coords.longitude;
}

function showError(e) {
  switch (e.code) {
    case: e.PERMISSION_DENIED:
     break;
    case: e.POSITION_UNAVAILABLE;
    case: e.TIMEOUT:
    case: e.UNKNOWN_ERROR:
  }
}
</script>
#+END_EXAMPLE

*** watchPosition
Same as getCurrentPosition but continuous track.

** Storage
#+BEGIN_EXAMPLE
if (typeof(Storage) !== "undefined") {
  // Use localStorage or sessionStorage
  // Store. value is always string
  localStorage.setItem("key","value");
  console.log(localStorage.getItem("key"));
  localStorage.clickcount = Number(localStorage.clickcount) + 1;
  console.log(localStorage.key);
} 
else {
  // Not supported
}
#+END_EXAMPLE
** Application Cache
~<html manifest="demo.appcache"~
.appcache file should be served in =text/cache-manifest= media type
#+BEGIN_EXAMPLE
CACHE MANIFEST
# Above should be first line
# Files that should be cached
/theme.css
NETWORK
# Files will not be cached
login.asp
# An asterisk indicates all other files require an internet connection
*
FALLBACK
/html/ /offline.html
# offline.html should be served in place of all files in /html/ directory
# if internet is not available

# Change the manifest file to update cache
#+END_EXAMPLE

** ARIA
<<<html:ARIA>>>
https://developer.mozilla.org/en-US/docs/Web/Accessibility/ARIA/ARIA_Techniques

*** role attribute
- separator :: BS4 .dropdown-divider
- group :: BS4 .btn-group 
- button :: <a> without href
- search :: <form> define purpose

*** aria-* attributes
- aria-label :: inside <button> where label text can't be displayed
- aria-labelledby :: refer to an element's id where the element contains text for label purpose.
  - Can be nested 'parentID child1ID'

* Javascript
** Loading Sequence
<script> tags without any attributes are downloaded together and executed immediately in order

- defer :: Works when src is defined. Download together, execute in order just before DOMContentLoaded
- async :: Works when src is defined. Download together, execute in any order they're downloaded
- async="false" :: Works when src is defined. Download together, execute in order as soon as all are downloaded

By default, all dynamically added scripts are async.

For example, if you want to load 2 javascript files and execute them in order but after they are all downloaded:
async="false" is needed.

#+BEGIN_EXAMPLE
[ '1.js',
  '2.js'
].forEach(function(src) {
  var script = document.createElement('script');
  script.src = src;
  script.async = false;
  document.head.appendChild(script);
});
#+END_EXAMPLE

** External Script, document.write
Loading external script use this

#+BEGIN_EXAMPLE
(function () {
  var nodeScript = document.createElement('script');
  nodeScript.type = 'text/javascript';
  nodeScript.src = 'http://otherdomain.com/a.js';
  var node = document.getElementById('interstitial');
  node.appendChild(node);

  // Add to <head>
  // var node = document.getElementsByTagName('script')[0];
  // node.parentNode.insertBefore(gads, node);
})();
#+END_EXAMPLE

External script cannot use document.write to modify root DOM window (can be used to modify DOM in an iframe)
You will need to use these to modify the root DOM window
#+BEGIN_EXAMPLE
// .appendChild(), .insertBefore(), .innerHTML
// jQuery ~.html('html')~ is equivalent to javascript ~$('').innerHTML ='html'~
#+END_EXAMPLE

** Initialization
<<<js:Initialization>>>
Always initialize variables at the top including vars in loops
var myObj = {},
    myString = "",
    myArray = [],
    myBoolean = false,
    myRegex = /()/,
    myNumber = 0;

These values are considered as false

** Variable Scope
*** Hoisting
<<<js:hoisting>>>. Refer to js:Function
Variables defined outside of any functions are Global.
Only function can create local scope. Without using var to declare variables, those variables are global.

#+BEGIN_EXAMPLE
myFunction();

function myFunction() {
  carName = "Volvo";
  // carName is actually global
  var carName2 = "Freightliner";
  // carName2 is not global
  // Local var takes precedence when it's used inside a function
  // the inner var shadows the outer.
}
// Alternative way to get global var
console.log(window.carName);
#+END_EXAMPLE

#+BEGIN_EXAMPLE
// function and variable declaration are moved to the top of their
// scope (global or local). It's called hoisting
// which allows you to use them before they are declared
// Functions are hoisted first and then variables
// Function declarations have priority over variable declarations, but not variable assignments

showState("one", {}, 2, 0.98); // output: Ready

// function declaration
// Pros :: Can be used before function is declared
// Cons :: Can't conditionally declare a function
function showState() {
  console.log("Ready");
  // arguments[0] is "one"
} 

// function expression/definition/assignment
// Pros :: Can conditionally define a function
// Cons :: Can't be used before it is defined 
var showState = function() {
  console.log("Idle");
};

showState(); // output: Idle

// The function that is assigned to a variable doesn't have to anonymous.

really.long.external.scoped.name = function shortcut(n) {
 // regression
 shortcut(n-1);
 // Pass it self as a callback
 someFunction(shortcut);
}

#+END_EXAMPLE

*** let, const, var
A variable is defined by var then this variable is available to the closest function scope.

Always js:Initialization for variables declared by var

let and const are /block-scoped/

let declares a variable which is available to the block it is enclosed in.
A block can be a switch, for, or if statement which has one pair of {}
You can only 'let' declare the same variable once in the same block.
The same variable can be let declaired inside a subblock and it will have new scope but not overwrite the upper scope variable.
let declared variable must be declared before it is used or referenced.
 
const is the same as let but it's read only. Uppercase naming.
The same const variable name can be redeclared to different value in sub block.
If const is an array or object, its child element or key/value is not protected by default.
Which means you can push to const arry or modify key/value.
const in the same block cannot be changed or redeclared or redeclared by let or var.

** Closure, Javascript Singleton
*** Syntax, When to use closure?

- When you don't want to change the variables in outer scope where the closure is in.
The outer scope can be global or any place where the closure is in.
- When you want to run the function later
- When you want to run the function later by providing just reference to other function
- When you want to run the function later by providing initial state
- When you want to do regression, don't want to affect outer scope and need more debugging

#+BEGIN_EXAMPLE
(function() {
  // Codes here runs immediately
})();
#+END_EXAMPLE

#+BEGIN_EXAMPLE
(function($) {
  // Use jQuery with the shortcut
  console.log($.browser);
  $(document).ready(function($) {
    // document ready
   }
  );
}(jQuery));

// Another form
jQuery(document).ready(function($) {
  // Use $ now
});
#+END_EXAMPLE

*** Singleton
<<<Javascript Singleton>>>

#+BEGIN_EXAMPLE
var Managers = {}; //namespace
// Singleton object CssManager
// Managers and singleton object CssManager has to be defined before they are used

Managers.CssManager = (function() {

// Private space in which all variables and methods are protected from the global scope
// Initialization of properties but it can't be instantialized.

var doc = document;
var setAttributes = function(element, attributes) {
  for (attribute in attributes) {
    element[attribute] = attributes[attribute];
  }
}
// Private space.

return {
  // Public members 
  addStyleSheet: function(id, url) {
    var newStyleSheet = document.createElement("link");
    setAttributes(newStyleSheet, {
      rel : "stylesheet",
      type: "text/css",
      id : id,
      href: url
    });
    document.getElementByTagName("head")[0].appendChild(newStyleSheet);
  },
  removeStyleSheet: function(id) {
    var currentStyleSheet = document.getElementById(id);
    if (currentStyleSheet) {
      currentStyleSheet.parentNode.removeChild(currentStyleSheet);
    }
  },
  swapStyleSheet: function(id, url) {
    this.removeStyleSheet(id);
    this.addStyleSheet(id, url);
  }
  // Public members
}
// return ends.

})();

#+END_EXAMPLE

*** Regression
This provides you more debugging info

#+BEGIN_EXAMPLE
var charsInBody = (function counter(elm) {
  // Notice :: this is not an anonymous function as we see before in a closure!
  if (elm.nodeType == 3) {
    return elm.nodeValue.length;
  }
  var count = 0;
  for (var i = 0, child; child = elm.childNodes[i]; i++) {
    count += counter(child);
  }
  return count;
})(document.body);
#+END_EXAMPLE

** Types, typeof, constructor
*** All types, typeof, constructor
| String    | js:String                                     |
| Number    | NaN is number. js:Number                      |
| Boolean   | true or false. Not FALSE/TRUE                 |
| Object    | js:Array, js:Date, js:Object, null, js:RegExp |
|           | js:Math, js:Error                             |
| Function  | a special type of object js:Function          |
| Symbol    | new in Edition 6                              |
|           |                                               |
| undefined | undefined or has not been assigned a value    |
| null      | a special type of object                      |

*** Number
<<<js:Number>>>
Used: js:Math

#+BEGIN_EXAMPLE
var foo = "55";
var myNumber = Number(foo);
if (!isNaN(myNumber)) {
  console.log("It is a number");
  // foo is a number
} 
#+END_EXAMPLE

*** String
<<<js:String>>>
s.length
s.charAt(s.length-1)
s.charCodeAt(s.length-1) :: UTF-16 code unit value
var myString = String.fromCharCode(65,66,67); // 'ABC'
s.indexOf("Paul"); // Case sensitive. Starts from the beginning. -1 not found
s.lastIndexOf("Paul"); // Case sensitive. Starts from the end
s.substr(0,4); // From start to 4th index
s.substring(0,4); // From start and take 4 characters. If stop is omitted, take the rest

#+BEGIN_EXAMPLE
s.slice(0,4); // Same as substring but start and stop can be both or either negative
// If start is negative, start from the end of string
// If stop is negative, stop to (s.length - 1) - Math.abs(s)
#+END_EXAMPLE

s.toLowerCase(); s.toUpperCase();

Don't use string1 == string2 to do case insensitive comparison. Use below including UTF8
string1.toUpperCase() === string2.toUpperCase()

*** Array
**** Basics
<<<JS:Array>>>
var a = new Array();
a[0] = "Paul";
a = ["P", "C", "S"]; // never put comma at the end of array
a[a.length-1] // last element
a[a.length]= "Z"; // append to last

**** If variable is array
#+BEGIN_EXAMPLE
console.log(Array.isArray(fruits)); // true or false
console.log(fruits instanceof Array) // true or false
#+END_EXAMPLE

**** array.pop(), array.shift(), array.push(), array.unshift()
a.pop(); // remove last element
a.shift(); // remove fist element
a.push("Z"); // add to the end of array. return new length
a[a.length]="Z"; // also append to last

a.unshift("Z"); // add to the beginning of array. return new length

**** array.concat()
var a = new Array("P", "C", "S");
var b = new Array(31,29,34);
a = a.concat(b); // Join arrays P, C, S, 31, 29, 34

**** array.slice()
var slice = a.slice(1,2); // C, S

**** array.splice(), remove a value from array if exists
var removed = a.splice(0,1,"Z","B"); // ["P"]
// First delete 1 element at index 0 and then add element Z and B 
// return the ones that are removed

Remove a value from array if it exists
var index = myArray.indexOf(item);
if (index !== -1) {
 myArray.splice(index, 1);
}

**** array.join(), array.toString(), array.valueOf()
var join = a.join(","); // "P,C,S"
a.toString() // also "P,C,S"
a.valueOf(); // also "P,C,S". Convert to primitive

**** array.sort(), array.reverse()
var sort = a.sort(); // sort as strings. case sensitive: C, P, S
function numericSort(anArray) {
 anArray.sort(function(a,b) {
  return a - b; // ascending order
  // return a.year - b.year; if it's an obj
});
 return anArray;
}

function randomSort(anArray) {
 anArray.sort(function(a, b) {return 0.5 - Math.random();});
 return anArray;
}

var reverse = a.reverse(); // S, C, P

**** array loop: for, array.forEach() 
for (var i = 0; i < fruits.length; i++) {
 fruits[i];
}

js:forEach
fruits.forEach(function(i) {
 console.log(i);
});

**** array.map(), array.filter() 
Do something while each item is iterated, join returned values into an array.
var result = a.map(function(i) { return i.toUpperCase(); }); // result is an array
console.log(a); // a is not affected!

a = a.filter(function(i) { 
   if ( true then remove condition ) { 
    return false; 
   }
   else {
    return true; // keep
   }
});

**** array.every(), array.some()
a.every(function(i) { return i[0] === "a"; }); // return true only if all returns are true
a.some(function(i)  { return i[0] === "a"; }); // return true if at least one return is true

**** array.reduce()
var sum = [0, 1, 2, 3].reduce(
 function(a,b) { return a=b; },
 0
);
// sum is integer 6

#+BEGIN_EXAMPLE
var flattened = [[0, 1], [2, 3], [4, 5]].reduce(
 function(a,b) { return a.concat(b); },
 []
);
// [0, 1, 2, 3, 4, 5]
#+END_EXAMPLE

array.reduce(callback[, initialValue])

If initialValue is provided, it will start at index 0. 
If not provided, it will start at index 1 and previousValue is the value at index 0 in the array.

callback has 4 arguments
- previousValue
- currentValue
- currentIndex
- array :: the input array was called upon

*** Date
<<<js:Date>>>
var date1 = new Date();
var date2 = new Date(77978); // milliseconds since 1970 01 01 GMT
var date3 = new Date(2017,0,31,15,35,20,20); // 2017 Jan 1 at 15:35:20 at 20 ms
var date4 = new Date("31 January 2016"); // "31 Jan 2016" "Jan 31 2016" "01-31-2016"

var dayofmonth = date4.getDate(); // setDate
var dayofweek = date4.getDau(); // int, Sunday as 0. You can't set day
var month = date4.getMonth(); // int, January as 0. setMonth
var fullyear = date4.getFullYear(); // 4 digits. setFullYear
var datestring = date4.toDateString(); // Current time zone. "Wed 31 Dec 2003"

var currentDay = date4.getDate();
date4.setDate(currentDay + 28 ); // Plus 28 days

getHours(), getMinutes(), getSeconds(), getMilliseconds(), toTimeString()
setHours(), setMinutes(), setSeconds(), setMilliseconds()

*** Math
<<<js:Math>>>
Math.PI
Math.abs(-101);
Math.ceil(101.01); // 102
Math.floor(101.01); // 101
Math.round(101.01);
Math.pow(10, 2); // 100
parseInt("10"); // 10

var itemCost = 9.99 * 1.075; // 10.73925
itemCost.toFixed(2); // 10.74
*** RegExp 
**** search(), replace(), match()
#+BEGIN_EXAMPLE
var s = "Visit W3Schools!";
var n = s.search("W3Schools"); // 6. -1 if not found
var all = s.match("i"); // return all matches
var res = s.replace(/w3schools/i, "Microsoft");
var res = s.replace("W3Schools", "Microsoft");
#+END_EXAMPLE

**** RegExp
***** Ways to define regex
<<<js:RegExp>>>
#+BEGIN_EXAMPLE
var n = s.search(/w3schools/i); // Use forward slash. Return the first matched index
var pattern = /w3schools/i; // Define a pattern in a variable

// Need to escape \ with \\
var patternobj = new RegExp('w3schools','i'); // Define a pattern as a RegExp object 
var patternobj = new RegExp(/w3schools/,'i');

// Test a pattern
pattern.test("Perform a test on this string"); // true or false

// Return the first found text
pattern.exec("Perform an exec on this string"); // null if not found.

// Index
every time pattern.exec() or pattern.test() is run, the pattern.lastIndex is advanced.
Until .lastIndex gets to 0

// Return all matches
s.match(pattern);
#+END_EXAMPLE
***** Pattern and modifiers
=/pattern/modifiers=

Modifiers
| i | case-insensitive |
| g | find all match   |
| m | multiline        |

Brackets
| [abc]  | a character that is a, b or c      |
| [^abc] | a character that is not a, b nor c |
| [0-9]  | a digit                            |
| [^0-9] | a non-digit character              |
|        |                                    |

(x|y) one of x or y

Metacharacter
| .      | a character execpt newline or line terminator  |
| \w     | a word character including _ [A-Za-z0-9_]      |
| \W     | a non-word character. same as [$\w]            |
| \d     | a digit                                        |
| \D     | a non-digit character                          |
| \s     | whitespace                                     |
| \S     | a non-space character                          |
| \b     | word boundary                                  |
| \0     | a NUL character                                |
| \n     | a new line character                           |
| \f     | a form feed character. e.g. page/section break |
| \r     | a carriage return                              |
| \t     | a tab character                                |
| \v     | a vertical tab character                       |
| \uxxxx | a Unicode character \u0057 is w                |
| \xxx   | \127 is w                                      |
| \xdd   | \x57 is w                                      |
|        |                                                |

Quantifier
| n+     | at least one of n                |
| n*     | zero or more                     |
| n?     | zero or one                      |
| n{X}   | \d{4} a 4-digit string           |
| n{X,Y} | \d{3,4} a 3-to-4-digit string    |
| n{X,}  | \d{3,} a at-least-3-digit string |
| n$     | at the end                       |
| ^n     | at the beginning                 |
| (?=n)  | non greedy match                 |

***** Word Boundary \b and \B
#+BEGIN_EXAMPLE
var s = "Visit W3Schools";
var pattern = /\bW3/g; // return words that start with W3
pattern.exec(s); // W3
var patter = /\bVisit\b/g; // whole word
var patterB = /\BSchools/g; // return "Schools". Words that do not start or end with Schools
#+END_EXAMPLE

***** Non greedy match (?=n)
#+BEGIN_EXAMPLE
var s = 'Is this all there is';
var p = /is(?= all)/g;
s.match(p); // is
// (?= all) matches any string that is before ' all':  but the matched is not returned.
// The other way to intepret it is find any 'is' that has ' all' right behind
var p = /is(?! all)/g; // Find any 'is' that doesn't have ' all' right behind
#+END_EXAMPLE

***** Match Tags
<<<regex:match_tags>>>

Match all tags
#+BEGIN_EXAMPLE
'<[^>]*>'
#+END_EXAMPLE

Match one tag only
#+BEGIN_EXAMPLE
'<img[^>]*>'
'<(img|/?div|br)[^>]*>'
#+END_EXAMPLE

*** Function
<<<js:Function>>> Refer to js:hoisting
**** arguments
function add() {
  var sum = 0;
  for (var i = 0, j = arguments.length; i < j; i++) {
    sum += arguments[i];
  }
  return sum;
}
add(2,3,4,5);

function add() {
  var sum = 0;
  for (var i = 0, j = arguments.length; i < j; i++) {
    sum += arguments[i];
  }
  return sum;
}

// Use Spread Syntax js:spread

function add(firstValue, ...args) {
  var sum = 0;
  for (let value of args) {
    sum += value;
  }
  sum += firstValue;
  return sum;
}

add(2,3,4,5);
**** .apply(), .call()
<<<js:Function.apply>>> <<<js:Function.call>>>
.apply() :: Pass arguments as an array to a function which accepts multiple arguments
.call() :: Pass arguments as arguments to a function which accepts multiple arguments

funct.apply(thisArg, [argsArray])

thisArg :: pass thisArg into funct as this in funct
argsArray :: array or array-like object

Pass no more than 65536 arguments/elements in array.

var numbers = [5,6,2,3,7];
var max = Math.max.apply(null, numbers); // Equivalent to Math.max(5,6, ...);
var max = Math.max.call(null, 5,6,2,3,7);

.apply() and .call() are used when the number of arguments passed to a method is unknown.
They are also used to call a method on a varible (obj or array) which doesn't has that method as its property. 
- Loop arrays which don't have .forEach() such as NodeList 

*** Error
<<<js:Error>>>
#+BEGIN_EXAMPLE
try {
 throw "Too big"; // Manually throw an error
 var err = new Error("Too big");
 throw err;
}
catch(err) {
 console.log(
  err.message, // Standard
  err.description, // Microsoft.
  err.number, // Microsoft. same as linenumber
  err.linenumber, // FF and Chrome
  err.name, // Standard. Initial is Error but you can change it
  err.stack // Not standard but works in all browsers.. Stack trace.
 );
}
finally {
 // success or failure, run this
}
#+END_EXAMPLE
*** Prototype Object
<<<js:prototype>>>
Every js:Object has a prototype object.

prototype object's default properties and methods

- constructor :: property. get/set 
- hasOwnProperty('aProperty') :: 
  - bool. objA.hasOwnProperty('aProperty') not objA.prototype.hasOwnProperty('aProperty')
  - aProperty has to be direct (not objA.prototype.aProperty) and not inherited
- isPrototypeOf() :: 
  - <<<js:prototype.isPrototypeOf>>>
  - Parent.prototype.isPrototypeOf(SubParent.prototype) is true
  - Whether or not SubParent has some prototype properties removed, added or modified
  - js:instanceof 
- propertyIsEnumerable :: 
  - <<<js:prototype.propertyIsEnumerable>>>
  - js:Enumerable
  - objA.propertyIsEnumerable('prop') not objA.prototype.propertyIsEnumerable('prop')
  - return true if it's enumerable in js:for...in
  - inherited properties are not enumerable
  - but newly created properties or methods are enumerable!

Because protype object can be cloned and modified, that brings one OOP characteristic: js:inheritance

Also, if any prototype property is modified in the upper chain, the lower chain and its instantiated objects will be modified, too!

*** Type Conversion
Javascript conversion is automatic. 
var y = "5";
var x = + y;

General methods:
String(x) or x.toString() // convert to string
Number(x) // convert to numbers

**** Number to String
x.toString();
x.toExponential(2); // 2 decimal points: 9.66e+0
x.toFixed(2); // 2 decimal points
x.toPrecision(); // total number of digits
 
**** String to Number
parseInt("10"); // 10
parseInt("10.33"); // 10
parseInt("10.53"); // 10
parseInt("10 20 30"); // 10
parseInt("10 years"); // 10
parseInt("year 10"); // NaN

The same for parseFloat.

Always provide a base number :: parseInt("10", 10); // decimal base
** Loops and Breaks
*** for, while, do...while
#+BEGIN_EXAMPLE
var cars = ['a', 'b', 'c'];
for (i = 0, len = cars.length, text = ""; i< len; i++) {
 // Loop through all properties of Array.prototype
 // 3rd party libraries or frameworks might add methods or properties to Array.prototype
 // So this is not recommended for looping an Array
}
for (; i<len; i++)

while () {
}

do {
}
while (condition);
#+END_EXAMPLE

*** for...in
<<<js:for...in>>>
#+BEGIN_EXAMPLE
var myObj = {};
for (var prop in myObj) {
 console.log(myObj[prop]);
}
#+END_EXAMPLE

*** for...of
<<<js:for...of>>>
js:for...in interates over all enumerable properties of an object.
While for...of iterates over elements of any collection that has a [Symbo.iterator] property.

for...of interates over iterable objects :: Array, Map, Set, String, TypedArray, arguments but not objects!

for (let value of iterable) {
 console.log(value);
}

*** forEach
<<<js:forEach>>>

array.forEach(callback[, thisArg])

thisArg :: Pass a variable outside of .forEach() and change it inside .forEach() using /this/

callback :: 3 arguments
- currentValue
- index
- array

Return :: undefined. So .forEach() is not chainable

Elements appended after the call to forEach() begins will not be visited.
The value of element is changed before forEach() visits, it will reflect the change.
Elements removed before being visited will not be visited.

*** break and continue
=break= without a label reference, can only jump out of a loop or a switch
=continue= with or without a label, can only skip one loop iteration.
With a label reference, =break= can jump out of any code block.
A code block is a block of code between { and }
#+BEGIN_EXAMPLE
list: {
 text += cars[0] +  "<br>";
 text += cars[1] +  "<br>";
 break list;
 text += cars[3] +  "<br>";
}
#+END_EXAMPLE
** Enumerable
<<<js:Enumerable>>>
Except inherited properties, all methods and properties are enumerable in js:for...in
js:prototype.propertyIsEnumerable
js:Object.defineProperty

To make a method non enumerable
#+BEGIN_EXAMPLE
// CustomerBooking class and its method setFilm is already defined
Object.defineProperty(Customerbooking.prototype,'setFilm',
{enumerable:false});
#+END_EXAMPLE

** JSONP, JSON
*** JSONP
#+BEGIN_EXAMPLE
<script type="text/javascript" src="http://b.com/returnjsondata?callback=mycallback"></script>

Where b.com/returnjsondata returns a json object. 
And the whole <script> in yourwebsite.com will become 
mycallback({foo:'bar'});
#+END_EXAMPLE

*** JSON
JSON object names require double quotes.
String are wrapped in double quotes.
Boolean is true or false.
null can be used.
MIME type: application/json

var obj = JSON.parse(jsonString); // parse a json string
** If a DOM element exists
#+BEGIN_EXAMPLE
var e = document.getElementById("abc");
if (!!e) {
 // exists
}

var e = document.getElementsByClassName('aClass');
if (e.length > 0) {
  // exists
}
#+END_EXAMPLE

** URI and URI Component Encode
#+BEGIN_EXAMPLE
var url1 = "http://abc.com";
var url2 = "http://xyz.com/test.php?url=" + encodeURIComponent(url1);
// decodeURIComponent();

// When you want a working URL as a whole with URL parameters
var uri = "http://abc.com/folder name with space/file name with space.asp?abc=has space"
var uri_en = encodeURI(uri);
// decodeURI(str)
#+END_EXAMPLE

Current URL
#+BEGIN_EXAMPLE
console.log(window.location.href); 
// http://abc.com/xyz/ijk.php?m=123#def
// window.location.href = window.location.protocol + "//" 
// + window.location.host (abc.com)
// + window.location.pathname (/xyz/ijk.php, if homepage, '/')
// + window.location.search (?m=123)
// +  window.location.hash; (#def)
#+END_EXAMPLE

** Object only, no Class

<<<js:Object>>>

*** new, Object.create
Every thing in Javascript is an object. No class.

Every object has a prototype object.

/Parent/ is an object with a constructor (because it's a function) and a prototype object.

When /new/ keyword is used, var parent = new Parent();, 
parent copies the Parent's prototype object and run the Parent's constructor.
If the constructor returns anything, parent will take it.
If the constructor returns nothing, the Parent object with prototype object and Parent's other properties defined in 
the constructor (this.xyz = ...) will be copied.

var SubParent.prototype = Object.create(Parent.prototype);
Copies Parent's prototype object and return it. So Parent's constructor is not run.
js:prototype

You can create an object with null as prototype :: Object.create(null);

You can create an object with extra properties
Object.create(Object.prototype, 
{
 foo: {writable: true, configuration: true, value: 'hello', get: ..., set: ..., otherthings: ...},
 bar: {...}
})

*** instanceof
<<<js:instanceof>>>
A useful operand that is for object to test instantiation
Syntax :: /object/ instanceof /constructor/
Return true if /constructor/.prototype exists in /object/'s prototype chain
- object :: an instance (an object)
- constructor :: Function object to test against. It has to be a function

Use instanceof to test instantiation, and use js:prototype.isPrototypeOf to test inheritance

*** Object.defineProperty
<<<js:Object.defineProperty>>>
[[https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperty][MDN Object.defineProperty()]]

*** Example
#+BEGIN_EXAMPLE
function CustomerBooking(bookingId, customerName, film, showDate) {
/* This is a constructor. It is not a good way to define property
 * Better to use methods to set. But here should provide initialization
*/
  this.customerName = customerName;
  this.bookingId = bookingId;
  this.showDate = showDate;
  this.film = film;
// You can also call a method which is defined later to initialize properties.
}

CustomerBooking.prototype.getCustomerName = function() {
 return this.customerName;
}

CustomerBooking.prototype.setFilm = function(film) {
 this.film = film;
}

// Instantiate
var firstBooking = new CustomerBooking(1234,
 "Arnold Palmer", "Toy Story", "27 July 2004 20:15");

var enumerated = [];
for (var prop in firstBooking) {
 enumerated[enumerated.length] = prop;
}
// ["customerName","bookingId", "showDate", "film", "getCustomerName", ..., "setFilm"]

// A cinema can hold multiple CustomerBooking instances
function cinema() {
 this.bookings = new Array();
}

cinema.prototype.addBooking = function(bookingId, customerName, film, showDate) {
 this.bookings[bookingId] = new CustomerBooking(bookingId, customerName, film, showDate);
}

// Loop through bookings of a cinema
cinema.prototype.getBookingsTable = function() {
 var booking;
 var bookingsTableHTML = "<table border=1>";
 for (booking in this.bookings) {
  bookingsTable += this.bookings[booking].getBookdingId();
  ...
 }
 bookingsTableHTML += "</table>";
 return bookingsTableHTML;
}

var londonOdeon = new cinema(); // Constructor takes no parameters
londonOdeon.addBooking(342, "First Last", "Toy Story", "15 July 2004 20:15");
#+END_EXAMPLE

** Extending Native Object
Native prototype can't be deleted or replaced
But values of its properties can be modified or created

Create a new method in Array class which removes a member after checking if the method is already defined

#+BEGIN_EXAMPLE
Array.prototype.remove = Array.prototype.remove || function(member) {
 var i = this.indexOf(member);
 if (i > -1) {
  this.splice(index,1);
 } 
 return this;
}

// If a method (remove) is created in native class, but later it was assigned as a property
// error will show 
#+END_EXAMPLE

Newly added remove method is enumerable in js:for...in js:prototype.propertyIsEnumerable
Inherited properties are not enumerable
To filter out method in js:for...in

#+BEGIN_EXAMPLE
var props = [];
for (var prop in results) {
 results.hasOwnProperty(prop) && props.push(prop);
}
#+END_EXAMPLE

<<<Add "method" in Function class>>>
Then "method" exists in any function.
#+BEGIN_EXAMPLE
Function.prototype.method = function(name, func) {
 this.prototype[name] = func;
 return this;
}

// Parenizor is a custom class. Create a method called 'setValue'
Parenizor.method('setValue', function(v) {
 this.value = value;
 return this;
});
#+END_EXAMPLE

<<<Add "inherits" in Function class>>>
#+BEGIN_EXAMPLE
Function.method('inherits', function(parent) {
 // parent is a class that is already defined
 // make a new instance
 this.prototype = new parent();
 var d = {},
     p = this.prototype;
 this.prototype.constructor = parent;
 this.method('uber', function uber(name) {
  if (!(name in d)) {
   d[name] = 0;
  } 
  var f, r, t = d[name], v = parent.prototype;
  if (t) {
   while (t) {
    v = v .contructor.prototype;
    t -= 1;
   }
   f= v[name];
  }
  else {
   f = p[name];
   if (f == this[name]) {
    f = v[name];
   }
  }
  d[name] +=1;
  r = f.apply(this, Array.prototype.slice.apply(arguments, [1]));
  d[name] -=1;
  return r;
 });
 return this;
});
#+END_EXAMPLE

** Classical Inheritance, Parasitic Inheritance
<<<js:inheritance>>>
Classical inheritance is about the _is-a_ relationship.
Parasitic inheritance is about the _was-a-but-now's-a_ relationship.

*** Classical inheritance
Refer to: Add "method" in Function class, Add "inherits" in Function class

**** Example
#+BEGIN_EXAMPLE
function Parenizor(v) {
// enclose v with ( and )
 this.setValue(v);
}

Parenizor.prototype = {
  constructor: Parenizor, // This line is crucial as we are overwriting Parenizor.prototype rather than adding
  setValue: function(v) {
    this.value = v;
    return this;
  },
  getValue: function() {
    return this.value;
  },
  toString: function() {
    return '(' + this.getValue() + ')';
  }
};

myParenizor = new Parenizor(0); 
myString = myParenizor.toString(); // "(0)"

// Subclass inherits parent class Parenizor
function ZParenizor(v, w) {
 Parenizor.call(this, v); // call parent class parenizor constructor
 // You can also call other parent class constructor
 // OtherParenizor.call(this, v);

 // Define other properties that this subclass should have
 this.otherValue = w;
}

ZParenizor.prototype = Object.create(Parenizor.prototype); 
// Inherits parent class's all methods. 
// First create an instance of the parent class and assign it to the child class.

// Inherits other parent class's all methods
// mixin(ZParenizor.prototype, OtherParenizor.prototype);

ZParenizor.prototype.constructor = ZParenizor; 
// Set subclass constructor 
// but ZParenizor should have its own constructor which is ZParenizor.prototype.constructor.

// Modify subclass's inherited method toString 

ZParenizor.prototype.toString = function() {
  // ...
}

var zParenizor = new ZParenizor('v', 'w');

console.log(zParenizor instanceof ZParenizor); // true
console.log(zParenizor instanceof Parenizor); // true
#+END_EXAMPLE

** OOP Pattern

#+BEGIN_EXAMPLE
// Javascript Singleton
(function() {
  this.myApp = this.MyApp || {};
  var ns = this.myApp; // further shorten the keyboard typing

  // private properties
  var vehicleCount = 5;
  var vehicles = [];

  // Public properties

  ns.publicHello = 'This is public';

  // Define a Class
  // You can even separate the class definition into another javascript file
  // Just remember to include the necessary closure like the above
  ns.Vehicle = (function() {

    function Vehicle(year, make, model) {
      this.year = year;
      this.make = make;
      this.model = model;
    }

    Vehicle.prototype = {
      getInfo: function () {
        return this.year + ' ' + this.make + ' ' + this.model;
      },
      startEngine: function () {
        return 'Vroom';
      }
    };

    return Vehicle;
  }());

  // Define a sub Class
  ns.Car = (function(parent) {

    function Car(year, make, model) {
      parent.call(this, year, make, model);
      this.wheelQuantity = 4;
    }

    Car.prototype = Object.create(parent.prototype);
    Car.prototype.constructor = Car;
    Car.prototype.getInfo = function() {
      // Extend parent's method
      return 'Vehicle Type: Car ' + parent.prototype.getInfo.call(this);
    }

    return Car;
  }(ns.Vehicle));

}());

console.log(myApp.publicHello);

// Instantiate
var v = new myApp.Vehicle(2012, 'Toyota', 'Rav4');
console.log(v.getInfo());

var c = new myApp.Car(2012, 'Toyota', 'Rav4');
console.log(c.getInfo());
#+END_EXAMPLE

** Promise
Promise is now native in all browsers including Edge except IE.

#+BEGIN_EXAMPLE
function get(url) {
  // You should wrap all code into return
  return new Promise(function (resolve, reject) {
    // run resolve or reject function to resolve or reject a promise
    var req = new XMLHttpRequest();
    req.open('GET', url); // it can be set to async

    req.onload = function () {
      if (req.status == 200) {
        resolve(req.response);
      }
      else {
        reject(Error(req.statusText));
      }
    };

    req.onerror = function () {
      reject(Error("Network Error"));
    }

  });
}

get('story.json')
  .then(function (response) {
    console.log('Success!', response);
    // transform a value to the next .then
    // just return the value, you may modify it
    // The returned value has to be a non-promise
    return JSON.parse(response);
  }, function (error) {
    console.log('Failed!', error);
    return error;
  })
  .then(function (response) {
    console.log('JSON!', response);
  });

// If a 'then' just returns a value when it's resolved, use a shortform
get('story.json').then(JSON.parse).then(function(response) {
  console.log('JSON!', response);
});

// In 'then', you can return a promise
// a promise.then is a promise

function getJSON(url) {
  return get(url).then(JSON.parse);
}

getJSON('story.json').then(function(story) {
  return getJSON(story.chapterUrls[0]);
}).then(function(chapter1) {
  console.log('Got Chapter 1', chapter1);
});

// Store the result of a promise and reuse it
var storyPromise;

function getChapter(i) {
  storyPromise = storyPromise || getJSON('story.json');

  return storyPromise.then(function(story) {
    return getJSON(story.chapterUrls[i]);
  });
}

getChapter(0).then(function(chapter) {
  console.log(chapter);
  return getChapter(1);
}).then(function(chapter) {
  console.log(chapter);
});

// .catch(function(e) { ... }) equals to
// .then(undefined, function(e) { ... })

// Dynamically chained .then()
// Start with a resolved promise: Promise.resolve('initialValue')
// a reject promise: Promise.reject('initialValue')
getJSON('story.json')
  .then(function(story) {
    // addHTMLToPage(story.heading);
    return story.chapterUrls.reduce(function(sequence, chapterUrl) {
      return sequence
        .then(function() { return getJSON(chapterUrl); })
        .then(function(chapter) { /* addHtmlToPage(chapter.html); */ });
    }, Promise.resolve());
  })
  .then(function() { /* addTextToPage("All done"); */ })
  .catch(function(err) { /* addTextToPage("broken" + err.message); */ })
  .then(function() { /* document.querySelector('.spinner').style.display='none'; */ });

// Start a set of promises in parallel and create a promise that fulfils when all are fulfilled
getJSON('story.json')
  .then(function(story) {
    // addHTMLToPage(story.heading);
    return Promise.all(
      story.chapterUrls.map(getJSON)
    ); // not a callback. It's an array of Promises (not chained)
    // After promises are added to array as values, they are started already

    // Start a set of promises in parallel, chain them so that we get response in order

    return story.chapterUrls.map(getJSON)
      .reduce(function (sequence, chapterPromise) {

        return sequence
          .then(function () {
            return chapterPromise;
          })
          .then(function (chapter) {
            addHtmlToPage(chapter.html);
          });

      }, Promise.resolve());


  })
  .then(function() { /* ... */ })
  .catch(function(err) { /* ... */ })
  .then(function() { /* ... */ });
#+END_EXAMPLE

** Worker
IE 10 and above supports worker.
Workers are independent and separated from parent window. 
Don't try to access or modify parent window DOM. Do it indirectly.
#+BEGIN_EXAMPLE
var w;

if (typeof(Worker) !== "undefined") {
 if (typeof(w) == "undefined") {
  w = new Worker("demo_workers.js");
 }
 // Receive message from worker
 w.onmessage = function(event) {
  console.log(event.data);
 }
 
 w.onerror = function(error) {
  console.log(error.message, error.filename, error.lineno);
 }

 // Send message to worker
 w.postMessage(['First Name', 'Last Name']);
}

w.terminate();
w = undefined;

// demo_workers.js
var i = 0;

function timedCount() {
 i = i + 1;
 postMessage(i);
 setTimeout("timeCount()", 500);
}

close(); // Worker can close itself

// This is how worker receives a message
onmessage = function(e) {
  console.log("Message receved by worker from main window");
  var workerResult = 'Result: ' + (e.data[0] * e.data[1]);
  console.log('Posting message back to main window');
  postMessage(workerResult);
}

// Workers can spawn or create subworkers. URIs of subwokers are resolved relative to
// the parent worker's location rather than that of the owning page.

// Worker can load scripts within the same domain
// Scripts are loaded and executed in order.
importScripts('foo.js');
importScripts('foo.js','bar.js');

// Spawn a shared worker. IE doesn't support sharedWorker
// Worker Square and Worker Multiply2Numbers both use shared worker Multiply
// In sqaure.js and multiply2numbers.js

if (!!window.SharedWorker) {
 var sharedWorker = new SharedWorker("multiply.js");
 sharedWorker.port.postMessage([123,123]); // square.js
 sharedWorker.port.postMessage([123,789]); // multiply2numbers.js

 sharedWorker.port.start(); // Only needed in parent thread if onmessage is not defined
 // such as the shares worker is a callback of event listener in parent thread
 
 sharedWorker.port.onmessage = function(e) {
  //
  console.log(e.data); // receive from shared worker
 }
}

// In multiply.js shared worker
port.start(); // only needed if onmessage is not defined in parent thread

onconnect = function(e) {
 var port = e.ports[0];
 
 port.onmessage = function(e) {
  var workerResult = 'Result: ' + (e.data[0] * e.data[1]);
  port.postMessage(workerResult);
 }
}
#+END_EXAMPLE

** XMLHttpRequest
<<<XMLHttpRequest>>>
#+BEGIN_EXAMPLE
function loadDoc() {
 var xhttp = new XMLHttpRequest();

 // event handlers. Others: onloadstart, onprgress, onabort, onerror, onload, ontimeout, onloadend
 // Always use onload instead of onreadystatechange
 // onload = onreadystatechange and this.readyState ==4
 
 // XHR property: readyState
 // 0: request not initialized, 
 // 1: connection established
 // 2: request received, 
 // 3: processing request
 // 4: request finished and response is ready 
 
 xhttp.onload = function() {
  if (this.status == 200) {
   console.log(
      this.responseText // as text
    , this.responseXML // as it's XML data
    , this.statusText // "OK" or "Not Found"
   );
    
    console.log(xhttp.getAllResponseHeaders());
    xhttp.getResponseHeader("Last-Modified");

  } 
 };

 xhttp.open('GET', 'ajax_info.txt'
 , true // async
 , "username" // optional
 , "psw" // optional
 );

 xhttp.setRequestHeader(); // set request header. Especially if 'POST' form fields
 /* For POST
  * xhttp.setRequestHeader("Content-type",'application/x-www-form-urlencoded');
  */

 // For receiving a binary string
 // xhttp.overrideMimeType("text/plain; charset=x-user-defined");

 xhttp.send(); // Nothing when 'GET'
 /* For POST
  * xhttp.send("fname=Henry&lname=Ford");
  */
 
 // binary data can be sent
 /* var blob = new Blob(['abc123'], {type: 'text/plain'});
  * xhttp.send(blob);
  * var myArray = new ArrayBuffer(512);
  * var longInt8View = new Uint8Array(myArray);
  * for (var i=0; i< longInt8View.length; i++) {
  *  longInt8View[i] = i % 255;
  * }
  * xhttp.send(myArray);
  */ 
}
#+END_EXAMPLE

*** Receive binary as arraybuffer or blob
#+BEGIN_EXAMPLE
var oReq = new XMLHttpRequest();
oReq.open("GET", "/myfile.png", true);
oReq.responseType = "arraybuffer";

oReq.onload = funciton(event) {
 var arrayBuffer = oReq.response; // not .responseText
 if (arrayBuffer) {
  // Read arraybuffer
  var byteArray = new Uint8Array(arrayBuffer);
  for (var i=0; i < byteArra.byteLength; i++) {
   // do something
  }
  // Read arraybuffer.

  // Construct a blob from arraybuffer
  var blob = new Blob( [arrayBuffer], {type: "image/png"} ); 

 }
};

oReq.send();
#+END_EXAMPLE

Specify the received data is blob
#+BEGIN_EXAMPLE
var oReq = new XMLHttpRequest();
oReg.open("GET", "/myfile.png", true);
oReq.responseType = "blob";

oReq.onload = function(e) {
 var blob = oReq.response;
}

oReq.send();
#+END_EXAMPLE

** Apply XSLT on XML
#+BEGIN_EXAMPLE
function loadXMLDoc(filename) {
 var xhttp = new XMLHttpRequest();
 xhttp.open("GET", filename, false);
 try {
  xhttp.responseType = "msxml-document";
 }
 catch(err) {}
 xhttp.send();
 return xhttp.responseXML;
}

var xml = loadXMLDoc('cdcatalog.xml');
var xsl = loadXMLDoc('cdcatalog.xsl');

var xsltProcessor = new XSLTProcessor();
xsltProcesser.importStylesheet(xsl);
resultDocument = xsltProcesser.transformToFragment(xml, document);
document.getElementById("example").appendChild(resultDocument);

#+END_EXAMPLE

** Apply XPath
#+BEGIN_EXAMPLE
var x=loadXMLDoc("books.xml");
var xml = x.responseXML;
path = "/bookstore/book[1]/title";

var nodes = xml.evaluate(path, xml, 
null, // namespaceResolver
XPathResult.ANY_TYPE, // resultType
null // If an existing XPathResult object is specified, it will be reused
); // Return xpathResult object 
var result = nodes.iterateNext();

while (result) {
 console.log(result.childNodes[0].nodeValue);
 result = nodes.iterateNext();
} 

#+END_EXAMPLE

** WebSocket
#+BEGIN_EXAMPLE
var connection = new WebSocket('ws://abc.com/echo', ['soap', 'xmpp']);
// ['soap', 'xmpp'] are subprotocols

// When connection is open, send some data
connection.onopen = function() {
 connection.send('Ping'); // send string
};

// Send ArrayBuffer as binary
var img = canvas_context.getImageData(0, 0,400, 320);
var binary = new Unit8Array(img.data.length);
for (var i = 0; i < img.data.length; i++) {
 binary[i] = img.data[i];
}
connection.send(binary.buffer);

// Send file as Blob
var file = document.querySelector('input[type="file"]').files[0];
connection.send(file);


connection.onerror = function(error) {
 console.log('WebSocket Error ' + error);
};

connection.onmessage = function(e) {
 console.log(e.data);
};

// Define binary type before onmessage to receive binary
connection.binaryType = 'arraybuffer'; // or blob
connection.onmessage = function(e) {
 console.log(e.data.byteLength);
};

#+END_EXAMPLE

** Mutation Observer
<<<js:MutationObserver>>>
[[https://developer.mozilla.org/en/docs/Web/API/MutationObserver][MDN MutationObserver]]
[[https://developer.mozilla.org/en-US/docs/Web/API/MutationRecord][MDN MutationRecord]]

#+BEGIN_EXAMPLE
MutationObserver = window.MutationObserver;

// callback function has 2 arguments
// mutations: an array of objects of type MutationRecord
// observer: this MutationObserver instance
var observer = new MutationObserver(function (mutations, observer) {
  mutations.forEach(function (mutation) {

    // A MutationRecord has properties
    // Some of them might be different based on MutationObserver's options

    // Loop addedNodes
    // addedNodes return NodeList which doesn't have .forEach
    // js:Function.call
    Array.prototype.forEach.call(
      mutation.addedNodes,
      function (addedNode) {
        if (addedNode.id == "bar") {
          console.log("bar was added!");
        }
      });
  });
});

// Define the parent element
var target = document.getElementById('foo');
// Or $('#foo').get(0)

// Which event should be observed
var config = {
  attributes: true,
  attributeOldValue: true, // set to true if attributes is set to true
  attributeFilter: true, // filter out an array of attribute local names in observation
  childList: true, // add/remove child elements including text nodes
  subtree: true, // any change to the subtree including all descendants
  characterData: true, // maybe image or multimedia changes?
  characterDataOldValue: true
};

observer.observe(target, config);

// You may stop observing later
observer.disconnect();
#+END_EXAMPLE

** Testing
*** Unit Testing
QUnit

** Worker
Workers are in external files, they don't have access to
- window object
- document obj
- parent obj
#+BEGIN_EXAMPLE
var w;
if (typeof(Worker) !== "undefined") {
  if (typeof(w) == "undefined") {
    w = new Worker("demo_workers.js");
  }
  w.onmessage = function(e) {
    console.log(e.data);
  }
}
else {
  // Worker not supported
}

// demo_workers.js
var i=0;
function timedCount() {
  i= i +1;
  postMessage(i);
  setTimeout("timedCount()", 500);
}
timedCount();
#+END_EXAMPLE

** Communication Between Children Window and Parent Window
A parent window can have multiple iframes and iframes are loaded from other domain.

#+BEGIN_EXAMPLE
// Post message from iFrame to parent Window
// In iframe
parent.postMessage('the message','*');
// or window.top.postMessage

// In parent window
function receiveMessage(event) {
 if (event.origin !== 'http://otherdomain.com') return;
 console.log(event.data);
}
window.addEventListener("message", receiveMessage, false);
#+END_EXAMPLE

#+BEGIN_EXAMPLE
// Post message from parent window to iFrame
// In parent window
window.onload = function() {
  var receiver = document.getElementById("#iFrameID").contentWindow;
  receiver.postMessage('Hello', 'http://iframe.src.domain'); // '*' for any domain of any receiver
}

// In iFrame
window.onload = function() {
  function receiveMessage(e) {
    if (e.origin !== "http://parent.window.domain") return;
    alert(e.data);
  }
  window.addEventListener('message', receiveMessage);
}
#+END_EXAMPLE

** Dynamic iframe height
This code requires the iframe domain is same origin.
#+BEGIN_EXAMPLE
<iframe id="preview_iframe" style="width:100%"
        onload="resize_iframe(this)"
        srcdoc="<?php echo str_replace('"', '&quot;', $html);?>"
>
</iframe>
<script>
function resize_iframe(iframe) {
  iframe.height= iframe.contentWindow.document.body.scrollHeight + 'px';
}
</script>
#+END_EXAMPLE

** setTimeout recall
#+BEGIN_EXAMPLE
function runTimeout() {
  setTimeout(function() {
    if (window.googletag && googletag.apiReady) {
      // do something
    }
    else {
      //console.log('googletag is not ready');
      runTimeout();
    }
  }, 5000);
}
#+END_EXAMPLE

** CSS Media Viewport Size
<<<js:viewport size>>>
window.innerWidth is width including scrollbars
document.body.clientWidth is width excluding scrollbars

=var w = Math.max(window.innerWidth || 0, document.body.clientWidth)=
=var h = Math.max(window.innerHeight || 0, document.body.clientHeight)=

* jQuery
** Closure and document ready

Closure
#+BEGIN_EXAMPLE
(function($){
  // can do something like 
  $.fn.function_name = function(x){};
})(jQuery);
#+END_EXAMPLE

Document ready shorthand

#+BEGIN_EXAMPLE
$(function(){

});
#+END_EXAMPLE

** Ajax
$.get(url[, data] [, success], [, dataType] )
$.post(url[, data] [, success], [, dataType] )
#+BEGIN_EXAMPLE
$.ajax({
 method: 'POST', // Default: GET
// Prior to 1.9.0, use type instead of method
 url: "some.php", // Default current page
 data: { name: "a", location: "Boston" } // Data send to server. Converted as URL parameters
// if data is not key/value pairs, change processData to false
 processData: true, 
// If data is not key/value pairs (object), say it's a DOMDocument, change it to false

 contentType: 'applicaton/x-www-form-urlencoded;charset=UTF-8', // Default. MIME type

 dataType: "json", // Default is not setting anything. MIME type of response
// > v1.5, this option can convert response to the MIME types you want
// "json xml" :: first it will try to convert to json. if failed, convert ot xml
// "script" :: the response is javascript, and it will be run afer it's received.

// cross domain should be automatically handled
// crossDomain: default false for same-domain requests, true for cross-domain requests

 context: document.body, // provide context for callbacks. If not set, this referrence
// in callbacks is the Ajax request settings

 cache: true, // You can only change cache for HEAD and GET requests.
 
 headers: {}, // Default. Add (or add to overwrite) request header

// Callback options
 beforeSend: function(jqXHR, settings) {
  // Modify jqXHR object before it is sent.
  // e.g. request header
  // For receiving binary string (image or any binary data)
  // jqXHR.overrideMimeType("text/plain; charset=x-user-defined");
 },
 error: function(jqXHR, textStatus, errorThrown) {
  // if request fails.
 },
 dataFilter: function( data, type) {
  // raw response data
  // dataType option
  // You should sanitize the data here so to match the dataType option
 },
 success: function( data, textStatus, jqXHR ) {
 }, 
 complete: function( jqXHR, textStatus) {}

})
/* Promise callbacks: .done, .fail, .always. In those callbacks, 
`this` reference is the `context` in the request. If `context` was not set, `this` 
will be the Ajax setting.
You can add multiple promise callbacks.
*/
.done(function(data, textStatus, jqXHRmsg) {
// .success() will be deprecated in v3.0


})
.fail(function(jqXHR, textStatus, errorThrown) {
// .error() will be deprecated in v3.0
})
.always(function(data|jqXHR, textStatus, jqXHR|errorThrown) {
// .complete() will be dprecated in v3.0

});
#+END_EXAMPLE

** <<<jQuery Selectors>>>, Loop through found elements
You can use all CSS Selectors

http://api.jquery.com/category/selectors/

#+BEGIN_EXAMPLE
$('li').each(function(i) {
 // i = 0, 1, etc.
 $(this).addClass("foo");
});
#+END_EXAMPLE

First matched element
#+BEGIN_EXAMPLE
var iframeId = $("#div-iframe").find('iframe').get(0).id;
#+END_EXAMPLE

** iFrame refer to parent
#+BEGIN_EXAMPLE
var parentVideoDiv = parent.jQuery('#videoplayer').parent('.the-content');
#+END_EXAMPLE

** Get parent element, sibling
#+BEGIN_EXAMPLE
var parentDiv = jQuery('#videoplayer').parent('.content');
var siblingDiv = parentDiv.prev(); // preceding sibling
#+END_EXAMPLE

** Pass $(this) to javascript function
$(this) is jQuery object, but this is a normal this
#+BEGIN_EXAMPLE
function doFunc(obj) {
  obj.className = 'hello'; // className is a normal javascript function
}
$('li').each(function() {
  doFunc(this);
});
#+END_EXAMPLE

** Replace class

#+BEGIN_EXAMPLE
parentDiv.removeClass('col-md-9').addClass('col-md-12');
#+END_EXAMPLE

Or remove a class if it exists or add a class if it doesn't

#+BEGIN_EXAMPLE
$('#id').toggleClass('col-md-9 col-md-12');
#+END_EXAMPLE

** Find inside an element
#+BEGIN_EXAMPLE
siblingDiv.find(".panel.panel-default");
#+END_EXAMPLE

** Move element
#+BEGIN_EXAMPLE
/* Before
.siblingDiv
.parentDiv
*/
siblingDiv.insertAfter(parentDiv);
/* After
.parentDiv
.siblingDiv
*/
#+END_EXAMPLE

** Add Style
#+BEGIN_EXAMPLE
var selector = jQuery('#id');
selector.attr('style', function(i,s) { return s + ' visible: visible !important' });
#+END_EXAMPLE

** Form
*** serialize
Checkboxes and radio buttons are included only if they're checked.
All seriailized form field elements must have name attribute.

#+BEGIN_EXAMPLE
$("#form_id").on("submit", function(e) {
 event.preventDefault();
 console.log($(this).serialize());
});
#+END_EXAMPLE

*** Disabled Field
Disabled fields are not editable, selectable, copyable and they are not submitted.
In order to select and copy value of a disabled field, you need to enable it when mouseover and disable it
when mouseout.

Can't register events directly on disabled fields. Events can be registered on its parent

#+BEGIN_EXAMPLE
$('.parent_container')
  .mouseover(function() { $(this).find('textarea').prop('disabled',false)})
  .mouseout(function() { $(this).find('textarea').prop('disabled',true)});
#+END_EXAMPLE

** Animate
*** Scroll
#+BEGIN_EXAMPLE
$("html,body").animate({ 
 scrollTop: $("[ng-controller=aController]").offset().top - 100 
});
#+END_EXAMPLE

** Viewport Change Event
js:viewport size
$(window).resize(function() {
  consoel.log($(window).width()); // integer without unit
});

** jQuery UI: Dialog
<<<jqueryui:dialog>>>

#+BEGIN_EXAMPLE
<div id="interstitial">
 <!-- script tag inside the container will be run every time the dialog is opend! 
      Consider remove script tag before .dialog and reattach javascript later.
      Content inside the container will be removed and then added to div.ui-dialog at the bottom of DOM.
 -->
</div>
#+END_EXAMPLE

#+BEGIN_EXAMPLE
jQuery(function(){
  jQuery("#interstitial").dialog({
    width: 'auto', /* no scrollbar, auto fit content */
    height:'auto',
    resizable: false,
    draggable: false, /* movable */
    closeOnEscape: true,

    /* Add extra buttons below the content
    buttons: [{
      text: 'ok',
      icons: {primary: "ui-icon-closethick"},
      click: function() {jQuery(this).dialog("close");}
    }],
    */

    modal: true, /* add background to isolate the modal box */
    create: function (event, ui) {
      jQuery("#ui-dialog-title-dialog").hide();
      /* custom background/overlay */
      jQuery(".ui-widget-content").css({"background-color":"transparent","background":"transparent","border":"none"});
      /* title bar is transparent */
      jQuery(".ui-dialog-titlebar").css({"background-color":"transparent","background":"transparent","border":"none"});

      jQuery(".ui-dialog-titlebar").removeClass('ui-widget-header');
      // Change the default title & close button to a custom link
      //jQuery(".ui-dialog-titlebar").html('<a href="#" role="button"><span class="myCloseIcon" style="color:white;">X close</span></a>')
     
      // You can still load/modify the content here and the width/height will still be auto fit
    },
    open: function() {
      /* custom background */
      jQuery('.ui-widget-overlay').addClass('custom-overlay');

      /* Customize the default close button: only X displays */
      jQuery(this).closest(".ui-dialog")
        .find(".ui-dialog-titlebar-close")
        .removeClass("ui-dialog-titlebar-close")
        .html("<span class='ui-button-icon-primary ui-icon ui-icon-closethick'></span>");
      jQuery(".ui-dialog-titlebar button").css({"border":"none"});

      /* Close dialog when click outside */
      jQuery('.ui-widget-overlay').bind('click',function(){
        jQuery("#interstitial").dialog('close');
      })
    },
    close: function() {
      /* custom background/overlay */
      /*
      * .ui-widget-overlay.custom-overlay
       {
       background-color: black;
       background-image: none;
       opacity: 0.9;
       }
      * */
      jQuery('.ui-widget-overlay').removeClass('custom-overlay');
    }
  });

  /* bind events for custom buttons created
  jQuery("span.myCloseIcon").click(function() {
    jQuery("#interstitial").dialog( "close" );
  });
  */
});
#+END_EXAMPLE

* AngularJS
** 1.x
*** Structure
https://ajax.googleapis.com/ajax/libs/angularjs/1.4.7/angular.js
jquery
common/common.module.js
// angular.module('ajsNgComponents', []);
common/config.js ng:config
common/filters.js ng:filter
common/fitlerableCategories.js ng:factory

*** Calling Order
app.config()
app.run() 
directive's compile functions (if exist)
app.controller()
directive's link functions

*** Config <<<ng:config>>>

<<<ng:html5mode>>>
#+BEGIN_EXAMPLE
angular
  .module('ajsNgComponents')
  .config(locatgionProviderConfig)
  // .config is to run a Provider function
  // ng:provider
  .value('layout','boxed_fullwidth')
  .value('layoutClass', {
    boxed_fullwidth: 'col-lg-3 col-md-4 col-sm-6 col-xs-12',
    boxed_left: 'col-lg-4 col-md-6 col-sm-6 col-xs-12',
    boxed_right: 'col-lg-4 col-md-6 col-sm-6 col-xs-12'
  });

// Enable html5mode
locatgionProviderConfig.$inject = ['$locationProvider'];
function locatgionProviderConfig($locationProvider) {
  $locationProvider.html5Mode({
    enabled: true,
    requireBase: false
  });
}
#+END_EXAMPLE

*** Run
Run injection is a bit different
#+BEGIN_EXAMPLE
app.run(ajsRun);
// Not app.run('ajsRun', ajsRun);

ajsRun.$inject = ['$rootScope'];
function ajsRun($rootScope) {

}

#+END_EXAMPLE

*** Filter <<<ng:filter>>>
#+BEGIN_EXAMPLE
angular
  .module('ajsNgComponents')
  .filter('singleListingFilter', singleListingFilter)
  .filter('item_category_value', item_category_value)
  .filter('ignore_empty_value', ignore_empty_value)
  .filter('translate', translate);

// $scope can't be injected to filter
// Instead, pass scope.varname as a param into filter.
// Or inject $rootScope

// In view
/*
<tr ng-repeat="detail in details | ignore_empty_value:aListing"
 ng-init="detail = aListing.post_meta.options[detailKey]">
  <td ng-bind="(detail.name | translate:detail)"></td>
  <td ng-bind="(detail.value | translate)"></td>
</tr>
*/

function singleListingFilter() {
  return function(items,var1) {
    var r = [];
    for (var i= 0, len=items.length; i< len; i++) {
      if (items[i].id == var1){
        r.push(items[i]);
        break;
      }
    }
    return r;
  };
}

// <td ng-bind="((x.options | item_category_value:detail:lwp_options) | translate)"></td>
function item_category_value() {
  return function(options, category, lwp_options) {
    var value = "";
    return value;
  };
}

function ignore_empty_value() {
  return function(items, aListing) {
    var r = [];
    angular.forEach(items, function(item) {
      if (aListing.post_meta.options[item].value) {
        r.push(item);
      }
    });
    return r;
  };
}

translate.$inject = ['$rootScope'];
function translate($rootScope) {
  return function(word, languages) {
    var r = word;
    if (typeof $rootScope.lang !== "undefined") {
      if ( typeof languages !== "undefined"
        && typeof languages['lang'] !== "undefined"
        && typeof languages['lang'][$rootScope.lang] !== "undefined") {
        r = languages['lang'][$rootScope.lang];
      }
      else {
        r = $rootScope.translate_text(word);
      }
    }
    return r;
  };
}
#+END_EXAMPLE

*** Factory <<<ng:factory>>>
Factory is better than app.value();
#+BEGIN_EXAMPLE
(function() {
  'use strict';
  angular
    .module('ajsNgComponents')
    .factory('filterableCategories', filterableCategories)
    .factory('clientId', clientIdFactory)
    .factory('apiToken', apiTokenFactory);

  // Inject $rootScope so that any method defined here can use
  filterableCategories.$inject = ['$rootScope'];
  function filterableCategories($rootScope) {
    return {
      getFilters: getFilters,
      getListingsFilterObjByURL: getListingsFilterObjByURL,
      getSelectedFiltersObjByURL: getSelectedFiltersObjByURL,
      getSearchInventoryDropdown: getSearchInventoryDropdown
    };

    function getFilters(filterable_categories, lwp_options) {
      // $rootScope can be used here
      var r = [];
      return r;
    }
  }
  
  function clientIdFactory() {
    return '123';
  }

  apiTokenFactory.$inject = ['clientId'];
  function apiTokenFactory(clientId) {
    var encrypt = function(data1, data2) {
      return data1+data2;
    }
    var secret = window.localStorage.getItem('secret');
    var apiToken = encrypt(clientId, secret);
    return apiToken;
  }

})();
#+END_EXAMPLE

*** Service <<<ng:service>>>
#+BEGIN_EXAMPLE
app.service('unicornLauncher', UnicornLauncherService);
UnicornLauncherService.$inject = ['apiToken'];
function UnicornLauncherService(apiToken) {
  this.launchedCount = 0;
  this.launch = function () {
    // Use apiToken to do something
    this.launchedCount++;
  }
}
#+END_EXAMPLE

*** Provider <<<ng:provider>>>
Provider is a service and it's the only thing can be inserted to .config

Instantiation happens in config
#+BEGIN_EXAMPLE
app.config(myProviderConfig);
myProviderConfig.$inject = ['myProviderProvider'];
function myProviderConfig(myProviderProvider){
  myProviderProvider.thingFromConfig = 'This was set in config';
});
#+END_EXAMPLE

Define myProvider
#+BEGIN_EXAMPLE
app.provider('myProvider', function(){
 // app.config() can only access the next 2 lines
 this._artist = '';
 this.thingFromConfig = '';

 this.$get = function(){
   var that = this;

   return {
     getArtist: function(){
       return that._artist;
     },
     thingOnConfig: that.thingFromConfig,
     unicornLauncher: newUnicornLauncher
   }

   newUnicornLauncher.$inject = ['apiToken'];
   function newUnicornLaunder(apiToken) {
     return new UnicornLauncherService(apiToken);
   }

 }
});
#+END_EXAMPLE

#+BEGIN_EXAMPLE
app.controller('myProvider', function($scope, myProvider){
  $scope.artist = myProvider.getArtist();
  $scope.data.thingFromConfig = myProvider.thingOnConfig;
});
#+END_EXAMPLE


*** Change URL without reloading page
First enable ng:html5mode

inject $location and $window
#+BEGIN_EXAMPLE
myNewUrl = '/path/?p=1&q=2';
$location.url(myNewUrl);
$location.replace();
$window.history.pushState(null, 'any', $location.absUrl());
#+END_EXAMPLE

* SEO
** Google Analytics
Under Admin, you can build Views. Views can have Filters. Views collect data.
Changes on Views and Filters will affect future data only.

Under Views, there're a lot of reports. Apply Segments to reports to filter out data 
without destroying Views data.

*** Tracking Code
The most recent version is analytics.js
[[https://developers.google.com/analytics/devguides/collection/analyticsjs/][Documentation is here.]]

*** Regular Expressions
https://support.google.com/analytics/answer/1034324?hl=en

Use \ to escape. Need to escape .

*** ga Object Methods

*** Track Object Methods

There're different methods in Tracker Object

ga('method_name',...);

*** send
Used in ga:goal and funnel
You can send an action of a hitType with corresponding fields

ga('[trackerName.]send', [hitType], [...fields], [fieldsObject]);

Use ga:fieldsObject

**** hitType: pageview
Used in ga:goal and funnel
ga('send', 'pageview', [page], [fieldsObject]);

*** get(fieldName)

*** set(fieldName|fieldsObject, [fieldValue])

*** fieldsObject
<<<ga:fieldsObject>>>

**** hitCallback

#+BEGIN_EXAMPLE
var form = document.getElementById('signup-form');

// Adds a listener for the "submit" event.
form.addEventListener('submit', function(event) {

  // Prevents the browser from submitting the form
  // and thus unloading the current page.
  event.preventDefault();

  // Sends the event to Google Analytics and
  // resubmits the form once the hit is done.
  ga('send', 'event', 'Signup Form', 'submit', {
    hitCallback: function() {
      form.submit();
    }
  });

  // or 
  ga('send', 'event', 'Signup Form', 'submit', {
    transport: 'beacon'
  });
  
  form.submit();
});
#+END_EXAMPLE

*** Funnel and Goal (send pageview)
<<<ga:goal and funnel>>>
Goal is defined in Admin > Account > Property > View
Funnel is step to a Goal.

Goal or funnel must use the pageview hitType.

When path is very dynamic, you may need to send pageview with a static path in order to capture goal or funnel destination URL.

And you may need to filter out those destination URL's in another GA View. Don't filter the current GA View.

View the Virtual Pageview in Reporting > Real-Time > Content
View the converted goal in real time Reporting > Real-Time > Conversions

#+BEGIN_EXAMPLE
ga('send', 'pageview', '/ga_goal/goal1/goal1_variant1.html');
ga('send', 'pageview', '/ga_goal/goal1/goal1_variant2.html');
ga('send', 'pageview', '/ga_goal/goal1/step1/goal1_variant1.html');
ga('send', 'pageview', '/ga_goal/goal1/step2/goal1_variant1.html');
...
#+END_EXAMPLE

*** Scroll (send event)
Reporting > Behavior > Events
Category > Action > Label > Value

Syntax: ga('send', 'event', [eventCategory], [eventAction], [eventLabel], [eventValue], [fieldsObject]);

#+BEGIN_EXAMPLE
<script>
// scroll depth compared to the root element
var element_to_track = 'html';
var scroll_reach = 0;
var temp_scroll_reach = 0;
var scroll_reach_pixels = 0;
var temp_scroll_reach_pixels = 0;

$(window).scroll(function(){
  temp_scroll_reach = Math.floor(
    100 *
    ( $(window).scrollTop() + $(window).height() - $(element_to_track).position().top)
    / $(element_to_track).height()
  );
  temp_scroll_reach_pixels =
    Math.floor($(window).scrollTop() + $(window).height());
  if(temp_scroll_reach > scroll_reach){
    scroll_reach = temp_scroll_reach;
    scroll_reach_pixels = temp_scroll_reach_pixels;
  }
});

function sendGAreq() {
  // Old ga.js
  // _trackEvent(category, action, opt_label, opt_value, opt_noninteraction)
  //_gaq.push(['_trackEvent', 'Scroll Depth', 'Percentage', '', scroll_reach]);
  //_gaq.push(['_trackEvent', 'Scroll Depth', 'Pixels', '', scroll_reach_pixels]);
  // New analytics.js
  // ga('send', 'event', [eventCategory], [eventAction], [eventLabel], [eventValue], [fieldsObject]);
  ga('send', 'event', 'Scroll Depth', 'Percentage', '', scroll_reach);
  ga('send', 'event', 'Scroll Depth', 'Pixels', '', scroll_reach);
}

/* report only after a user exists the website */
$(window).bind('beforeunload', function() {sendGAreq();});
</script>
#+END_EXAMPLE

*** Too Many Self-referrals
Reporting > Acquisition > All Traffic > Referrals, you will find the website's url is the source
And the percentage is high compared to other Referral Sources.
3 reasons:
1. Users sessions idle for 30 minutes and become active. This should be < 10% of traffic
2. Cross domain (need to bring it down to 0 self-referral)
3. A lot of traffic and sessions are created by spammers to a landing page 
(most likely homepage with url parameters)  with a fake referral path as the website.

Click on the website URL (referral source), you will see Referral Path (that's From traffic)
Add secondary dimension "Full Referrer" to see the referrer's domain and full path.

Since self-referrals can be faked and real self-referrals should be small amount, you can filter out
self-referrals in GA.

Go to Admin > Account > Property > Tracking Info > Referral Exclusion List > add domain
abc.com also matches www.abc.com because domain name CONTAINS

You cannot use View Filter to filter out referral domain...

You can also create a segment without affecting the data. 
Conditions > Filter: Sessions, Exclude > Source / Medium > contains > OHG.com / referral

* Linux
** Explain Shell
[[http://explainshell.com][Explain Shell]]

** System Version, Distro

| =uanme -a=           | all info     |
| =uname -r=           | Kernal       |
|                      |              |
| =cat /etc/*-release= | Linux distro |
| =cat /etc/issue=     |              |
| =cat /proc/version=  |              |
| =lsb_release -a=     | Ubuntu only  |
|                      |              |

** User Management, Superuser, sudo
*** Create and Delete User
=sudo adduser corey=
=sudo deluser corey=

*** Add user to sudo group
sudo is a group
As root user, run
#+BEGIN_EXAMPLE
gpasswd -a username sudo
#+END_EXAMPLE

gpasswd is the same as to add user to a group
#+BEGIN_EXAMPLE
sudo usermod -aG agroupname ausername
# -aG keeps the existing groups the user belongs to and add the user to another group
#+END_EXAMPLE

*** User Group
Run ~visudo~ to see permissions given to each group
And check sudo environment variable setting

#+BEGIN_EXAMPLE
root ALL=(ALL:ALL) ALL
#+END_EXAMPLE
User root can run sudo as all hosts (1st ALL), all users, all groups and apply to all commands.

Start with % means is a group
#+BEGIN_EXAMPLE
%sudo   ALL=(ALL:ALL) ALL 
#+END_EXAMPLE

Which group a user belongs to ~groups username~

[[https://www.digitalocean.com/community/tutorials/how-to-edit-the-sudoers-file-on-ubuntu-and-centos][More info]]

*** List all users =cut -d: -f1 /etc/passwd` or `cat /etc/passwd=
- Login username
- Password (always x)
- UID (<500 are system accounts, > 500 are users)
- Group ID (GID)
- Comment field
- Location of HOME directory
- Default shell for the user

*** Switch to superuser 
- Debian =sudo su=
- RedHat =sudo -=

*** Login to another user
~/bin/su - username~




*** Sudo run multiple commands
~sudo bash -c 'apt-get update;apt-get install'~

** SSH
Generate a private key on your local machine ~ssh-keygen~
Under folder ~/Users/username/.ssh/~ id_rsa.pub is the public key and id_rsa is the private key
Show the public key and later copy to cloud server
~cat ~/.ssh/id_rsa.pub~

** System 
Resource Limits
=sudoedit /etc/security/limits.conf=

System Logs
| /var/log/syslog   | general system log                         |
| /var/log/auth.log | system auth logs                           |
| /var/log/mail.log | system mail logs                           |
| /var/log/messages | general log messages                       |
| /var/log/dmesg    | kernel ring buffer msg, e.g. system bootup |
|                   |                                            |

Search a word `warthog` in .gz files
=zgrep -i warthog /var/log/*.gz= 

** Filesystem
*** /dev /mnt /media
=/dev/sd*1= :: sd for SATA or SCSI drive, numeric 1 for partition, * for a, b, etc.
=/dev/hd*1= :: hd for IDE drive, * for a, b, etc.
=/media/win1=
 - virtual directory  where files are accessed file here. 
 - Equivalent to d:\. One or more partitions can be assigned to one media

=sudo mkdir /media/win2= :: create a virtual directory is easy
=sudo mkdir /mnt/my_mount= :: also creates a virtual directory

=sudo mount -t ext4 /dev/sda1 /mnt/my_mount= :: Mount a partitioned device to a virtual directory
=sudo gedit /etc/fstab=
, =/dev/hdb1 media/win1 vfat users,rw,owner,umask=000 0 0=
, then reload =sudo mount -a=
- Permanently mount during bootime

*** /etc system configuration files
*** Disk space
| =df -h=                 | Disk usage on OS                                    |
|                         | h for human-readable.                               |
| =du -sh=                | Current folder size. -s shows total only            |
| =du -sh ./*=            | List sizes of 1st level child folders               |
| =du -sh ./wp-content/*= | List sizes of 1st level child folders of one folder |
|                         |                                                     |

Disk usage in current folder including all sub folders but excluding one sub folder
du --exclude=./wp-content/uploads --exclude=./wp-content/error_log -sh

*** File permission
Octal mode
#+BEGIN_EXAMPLE
chmod 400 ~/path/to/file.php
#+END_EXAMPLE

| Permissions | Binary | Octal | Description       |
| ---         |    000 |     0 | No permissions    |
| --x         |    001 |     1 | Execute only      |
| -w-         |     10 |     2 | Write only        |
| -wx         |     11 |     3 | Write and execute |
| r--         |    100 |     4 | Read-only         |
| r-x         |    101 |     5 | Read and execute  |
| rw-         |    110 |     6 | Read and write    |
| rwx         |    111 |     7 | full              |
|             |        |       |                   |

400 :: read for owner, 0 for group, 0 for other/public
440 :: read for owner and group, but none for public
555 :: read and execute (can't modify) for all
700 :: full for owner
777 :: Directory's full permission
666 :: A file's full permission
664 :: New file default permission. Read and Write for owner and group but only read for public

By default, umask is 0002. A file's full permission is 666. So new file will have these permissions
666-002 = 664

** Search Files or Directories
By file or directory name
#+BEGIN_EXAMPLE
ls -l my_scr?pt
ls -l my*
ls -l my_s*t
ls -l my_scr[ai]t
ls -l f[a-i]ll
ls -l f[!a]ll
#+END_EXAMPLE

<<<linux:find>>> :: Return path of matched files or directories

Search by name of files
#+BEGIN_EXAMPLE
find ./targetFolder -type -f -name "abc*"
#+END_EXAMPLE

Search by name of directories
#+BEGIN_EXAMPLE
find ./targetFolder -type d -name "abc*"
#+END_EXAMPLE

Combine search criteria
AND
#+BEGIN_EXAMPLE
# Start with abc and file extension is php
find -name 'abc*' -name '*.php'

# Start with abc and file extension is not php
find -name 'abc*' ! -name '*.php'
#+END_EXAMPLE

OR
#+BEGIN_EXAMPLE
find -name '*.php' -o -name '*.txt'
#+END_EXAMPLE

Search by size (K, M, G for kb, mb and gb)
#+BEGIN_EXAMPLE
find . -type f -size +10000K
#+END_EXAMPLE

Search by modified date
#+BEGIN_EXAMPLE
# Search text files that are modified less than 14 days ago
find . -type f -mtime -14 ! -iname '*.jpg' ! -iname '*.png'

# Modified between 50 and 100 days ago
find . -type f mtime +50 -mtime -100
#+END_EXAMPLE

Recent modified files recursive (file status change)
#+BEGIN_EXAMPLE
# last 5 minute
find -cmin -5
# Last day 1440, Last 31 days 44640
#+END_EXAMPLE

~-iname~ case insensitive while ~-name~ is case sensitive

Chain find command with other commands
#+BEGIN_EXAMPLE
# {} is each result of find.
# \; denotes the end of ls command
find .-size +100M -exec ls -lh {} \;
#+END_EXAMPLE

** Search Text in Files
<<<linux:grep>>>

#+BEGIN_EXAMPLE
grep --color -HRi "google.com" /root/dir

# Only file names
grep --color -HRi "abc" /root/dir | cut -d: -f1

# Unique file names
grep --color -HRi "abc" /root/dir | cut -d: -f1 | sort -u

# Exclude file types
grep --color -HRi --exclude=\*.{pdf,jpg,JPG,mp3,png,bmp,sql} "abc" .
#+END_EXAMPLE

- --color :: hightlight
- -H :: return only the file names
- -R :: recursive
- -i :: ignore case 

** head, tail
<<<linux:tail>>>

Last 5 lines
#+BEGIN_EXAMPLE
tail -n5 /path/to/file
#+END_EXAMPLE

Keep tailing
#+BEGIN_EXAMPLE
tail -f /var/log/messages
#+END_EXAMPLE

Used in chain
#+BEGIN_EXAMPLE
ls -t | tail -n3
#+END_EXAMPLE

** tar
*** Compress
/home/targetFolder
cd /home
tar -zcvpf backup.tar.gz targetFolder

Or
cd /home/targetFolder
tar -zcvpf backup.tar.gz .

Exclude a folder
tar -zcvpf backup.tar.gz targetFolder --exclude=wp-content/uploads

Options
- -z :: use gzip method
- -c :: create a new archive
- -v :: verbose
- -p :: preserve permissions (default for superuser)
- -f :: use archive file as result or input
- --exclude :: wrap in '' if it contains spaces
- --exclude='*/*/*' :: ignore 3 levels deep

*** Uncompress
tar -xvzf backup.tar.gz

If file is .gz not .tar.gz, uncompress gzip -d file.gz and the gz file will disappear

Options
- -x :: extract

*** Read .tar file
tar -tf file.tar

** Processes
| =ps -ef=                   | List of running processes      |
| =sudo ls -l /proc/PID/exe= | file path for command, sub PID |
|                            |                                |

*** =top=
First line: current time, system up time, number of users logged in, load average (1, 5, 15 minutes; >2 is busy). 
Second line: total processes: running, sleeping, stopped and zombie (have finished but parent process hasn't responded)

Third line: CPU utilization: us (user), sy (system), ni (nice: time running niced user processes), wa (time waiting for I/O completion), hi (time spent servicing hardware interrupts), si (software interrupts), st (stolen from this vm by the hypervisor)

Memory usage
	- Line 1 reflects physical memory: total, used, free and buffers
	- Line 2 reflects virtual memory: total, used, free and cached 

Detailed for each process
| PID  | The process ID of the process             |
| USER | The user name of the owner of the process |
| PR   | The priority of the process               |
| NI   | The nice value of the process             |
	- NI: The nice value of the process
	- VIRT: The total amount of virtual memory used by the process
	- RES: The amount of physical memory the process is using
	- SHR: The amount of memory the process is sharing with other processes
	- S: The process status (D = interruptible sleep, R = running, S = sleeping, T = traced
	- or stopped, or Z = zombie)
	- %CPU: The share of CPU time that the process is using
	- %MEM: The share of available physical memory the process is using
	- TIME+: The total CPU time the process has used since starting
	- COMMAND: The command line name of the process (program started)


Type `f` for interaction: set sort, display more fields/columns

*** Memory
Total memory: =grep MemTotal /proc/meminfo=
Memory usage: =free -ltm -s 1=
Delay 1 second: =-s 1=
=-m=: in megabyte. e.g. -g
=-t=: show Total
=-l=: show Low and High

** Network
All active NIC and IP addresses: =ifconfig=
All enabled and disabled NIC: =ifconfig -a=
View one NIC (interface): =ifconfig eth0=

Ethernet interface: eth0, eth1
Wireless network interface: wlan0, wlan1
Loopback interface for system internal communication: =lo=

*** Port
If a port is in use =telnet localhost 9000=, if it's connected, it's in use.
List all ports in use: =netstat -lp= or =netstat -nlp= to list in numeric form.
Search a port =netstat -nlp | grep 8000=
Which file is using the port =lsof | grep 9000=
Wireless network adapters =iwconfig=

*** CIDR Netmask (Network Mask)
CIDR netmask
- 10.0.75.5/24 = 10.0.75.5 AND 255.255.255.0 = 10.0.75.0 
	(10.0.75.5 is in the 10.0.75.0 subnet)
- 10.0.75.5/32 = 10.0.75.5 AND 255.255.255.255 = 10.0.75.5 (a single host)
- 10.0.75.5/16 = 10.0.75.5 AND 255.255.0.0     = 10.0.0.0
- 10.0.75.5/8  = 10.0.75.5 AND 255.0.0.0       = 10.0.0.0

Private IPv4 address spaces
- 10.0.0.0 - 10.255.255.255 = 10.0.0.0/8 (16 million number of addresses)
- 172.16.0.0 - 172.31.255.255 = 172.16.0.0/12 (255.240.0.0) (1 million number of addresses)
- 192.168.0.0 - 192.168.255.255 = 192.168.0.0/16 (65,536 number of addresses)

** Hardware
PCI devices: =lspci=
USB devices: =lsusb=
Most of devices: =lshal=

** Package & Repository
=cat /etc/apt/sources.list=

Repositories
- Main
- Universe: maintained by Ubuntu community
- Backports: newest version of pkg
- Multiverse: not free pkg
- Restricted: hardware drivers etc.

*** Package Management
**** =dpkg= lowest level
List installed packages: =dpkg -l= 
How to read dpkg output
- First 3 columns show Desired action, Package status and Error flags
- Desired action
  - unknown (u), install (i), hold (h), remove ( r ), purge (p)
- Package Status
  - Not-installed	`n`
  - Config-files	`c`
  - Half-installed	H
  - Unpacked	U
  - Half-configured	F
  - Triggers-awaiting	W
  - Triggers-pending	`t`
  - Installed	`i`
- Error flags
  - <empty> = (none), R = Reinst-required

If a package is installed: =dpkg -l wget=
Search if a package is installed: =dpkg -l | grep wget= or ~dpkg -l 'wget*'~

List files owned by a package =dpkg -L cron=

Find which package owns a file =dpkg -S /etc/crontab=

**** =apt-get= =apt-cache=
Search package by name or title and read installation status: =apt-cache search php=
- Before each package name, if you see `i` the package is installed
- `v` the package is virtual (installed)
- `c` the package is deleted but not configuration files
- `p`, no trace at all or `v`, it's not installed.
- There might be a second character which indicates the action to be performed on the package.

Find out dependencies: =apt-cache showpkg php5-xmlrpc=
- Other packages must be installed before php5-xmlrpc (under Dependencies)
- Other packages depend on php5-xmlrpc (under Reverse Depends)
- Different versions of this package you can install (under Provides)

**** =aptitude= Highest Level
It removes orphan packages automatically

** Input and Output
*** File Descriptors
File descriptors. First 3 are reserved.
| 0 | STDIN  | Standard input         |
| 1 | STDOUT | Standard output (echo) |
| 2 | STDERR | Standard error         |

#+BEGIN_EXAMPLE
# Redirect stdout, creates if not exist or overwrites a file
ls -al goodfile > stdoutlogfile
# same as 2>, 3> etc.

# Redirect stdout, creates if not exist or appends to a file
ls -al goodfile >> stdoutlogfile
# same as &>>, 2>>, 3>> etc.

# Redirect stderr
ls -al badfile 2> errorlogfile

# Redirect stdout and stderr to different files
ls -al goodfile badfile 2> errorlogfile 1> normalOutput

# Redirect stdout and stderr to the same file
ls -al goodfile badfile &> errorAndOutput
#+END_EXAMPLE

<<<bash:tee>>>

#+BEGIN_EXAMPLE
# Redirect stdout of a commannd to a file and display stdout
date | tee testfile

# Redirect stdout to a file and pass stdout to another command as stdin
date | tee testfile | less

# Capture stdout of a command to a variable
output=$(date)

# Capture stdout and stderr of a command to a variable
output=$(command_which_has_stdout_and_stderr 2>&1)

# Redirect stdout of a command to one or multiple files and save stdout to a variable
# a file must be behind a tee command
# By default tee overwrites the file. Use -a to append to the end
$output = $(date | tee testfile1 testfile2)

# Redirect stdout to a variable and display to terminal in real time (not to stdout!)
# Works on Ubuntu and RedHat
$output = $(date | tee /dev/tty)

# Redirect one file descriptor (M, default 1) to another file descriptor (N) M>&N
# Redirect a manually made error 
echo "This is an error" >&2

# Change a file descriptor to a file
exec 2>errorLogFile
echo "This is STDOUT and STDOUT is not changed to a file yet"
exec 1>stdOutFile
echo "This doesn't display as STDOUT is redirected to a file"
echo "This is an error and in errorLogFile" >&2
#+END_EXAMPLE

Up to 9 open file descriptors can be used at a time.
#+BEGIN_EXAMPLE
# Open a custom file descriptor to a file
exec 3>customLog
echo "This goes to file descriptor 3" >&3
# Open a custom file descriptor and redirects to STDOUT
exec 4>&1

# If you want to change the reserved file descriptors. Always backup and change back
exec 5>&1
exec 6>&2

# Backup STDIN is a little different
exec 7<&0
#+END_EXAMPLE

*** Array
#+BEGIN_EXAMPLE
# define empty array
myarray=()

# define array with values
myarray=( one two three four five )

# define array with strings
myarray=( 'Hello World' 'Another item' )

# Get at index 0
echo ${myarray[0]}

# print array as a whole delimited by space
echo ${myarray[@]}

# print array as a whole delimited by newline
printf "%s\n" "${myarray[@]}"

# Convert an array to string variable delimited by newline
printf -v stringvar "%s\n" "${myarray[@]}"

# Remove the final newline
stringvar=${stringvar%?}

# Append to array
myarray+=('foo')
myarray+=("$line")

# Append only if it's new
containsElement() {
 local e
 for e in "${@:2}"; do [[ "$e" == "$1" ]] && return 0; done
 return 1 
}
if ! containElement "$line" "${myarray[@]}"; then
 myarray+=("$line")
fi

# Length
echo Number of elements in array: ${#myarray[@]}

# Loop array
for i in "${myarray[@]}"; do
  echo "$i"
done

#+END_EXAMPLE

*** echo and print
#+BEGIN_EXAMPLE
echo -e "Hello\nWorld"; 
# echo newline -e to use \n etc
# always wrap variable in double quotes to preserve newline character
echo "$output"
#+END_EXAMPLE

*** printf
Print multilines
#+BEGIN_EXAMPLE
printf '%s\n%s\n' "$line1" "$line2"
#+END_EXAMPLE

*** Read command output line by line
#+BEGIN_EXAMPLE
multiple_commands_output=""
output=$(drush command output contains multiple lines);
count=1
while IFS=$'\n' read -r line; do
  echo "Line number $count: $line"
  count=$[ $count + 1 ] 
done <<< "$output"

multiple_commands_output="$multiple_commands_output""$output"$'\n'

# You don't have to change back IFS as it only affects the while loop
# newline character is \n
# read -r :: to ignore all backslashes
#+END_EXAMPLE

*** String Operators
#+BEGIN_EXAMPLE
# A string is delimited by :
# Get the last element
foo=1:2:3:4:5
echo ${foo##*:}

# '##' means greedy front trim
# * matches any character
# until the last ':'
# also work for space as delimiter
# ${foo##* }

# Concatenate string variables
z=""
a="Hello\n"
b="World\n"
c="!"

z="$z""$a"
z="$z""$b"

# insert a newline
z="$z""$c"$'\n'

#+END_EXAMPLE

*** String comparison
#+BEGIN_EXAMPLE
# Start with 'node'
if [[ $a == node* ]]; then

# Start with a string 'Hello World'
[[ $a == "Hello World"* ]]
#+END_EXAMPLE

*** Numeric comparison
Not floating-point values
| Equal            | $n1 -eq $n2 |
| greater or equal | $n1 -ge $n2 |
|                  | $n1 -gt $n2 |
|                  | $n1 -le $n2 |
|                  | $n1 -lt $n2 |
| not equal        | $n1 -ne $n2 |
|                  |             |

*** <<<Bash if>>>
#+BEGIN_EXAMPLE
 if [ conditions ]; then
  # commands
 elif [ conditions ]; then
  # more commands
 elif [ conditions ]; then
  # more commands
 else
  # more commands
 fi
#+END_EXAMPLE

** curl wget
*** curl
**** Basic
#+BEGIN_EXAMPLE
dlDir=/home/lili/download/
dlFileName = ${dlDir}123.xml
curl "http://abc.com/123.xml" -L -o ${dlFileName}
#+END_EXAMPLE

**** Return HTTP response header only
=curl -m 120 -IL "http://url.com" >> /path/to/log.log=
e.g Drupal Cron URL response status
#+BEGIN_EXAMPLE
#!/bin/bash
curl -sL -o /dev/null -w "%{http_code}\n" "http://drupalcronurl" >> /path/to/your/cronlog
#+END_EXAMPLE

**** Download with HTTPS or HTTP authentication
Popup form or server authentication
=curl https://a.com/b.aspx -u user:password -L -o /path/to/xml.xml=

**** <<<cURL download only after or before a date>>>
Works for ftp and Http
#+BEGIN_EXAMPLE
fileLocalTime=$(date -r "$localfile")
curl $remote_file_path -u $user:$password -o $localfile -R -z "${fileLocalTime}"
# default is "after"
# add a dash before date string will result in "before".
fileLocalTimeNew=$(date -r "$localfile")
if [ "$fileLocalTime" == "$fileLocalTimeNew" ]; then
 echo "the same"
else
 echo $fileLocalTime
 echo $fileLocalTimeNew
fi
#+END_EXAMPLE

**** Options

| L          | Follow through all redirects                                  |
| o          | redirect STDOUT to a file                                     |
| O          | save file using same file name in current folder              |
| I          | get header response only                                      |
| m          | timeout in seconds                                            |
| H          | request header. =-H "Accept-Charset: ISO-8859-1,utf-8;q=0.7"= |
| limit-rate | limit download speed: --limit-rate=200k. use k, m or g        |
| s          | suppress STDOUT                                               |
| w          | rewrite STDOUT                                                |
| R          | Keep remote file timestamp. --remote-time                     |
| z          | cURL download only after or before a date                     |
|            |                                                               |
 
** Commands
*** Run Sequentially
=lspci; lsusb=
If the first command not successful, 2nd command will not run: =lspci && lspci=

*** =man=
=man -k processes= Search `processes` in command names and description
=man -f ls= Search in command names and title

*** =cd -= Navigate to previous directory (back)
*** =wc=
| =-l= | Line Count      | =ps -ef \vert wc -l= |
| =-w= | Word Count      |                      |
| =-c= | Byte Count      |                      |
| =-m= | Character Count |                      |
|      |                 |                      |

*** Replace String  =sed= 
<<<bash:sed>>>
Replace all (g) Nick with John case-insensitive
cat report.txt | sed 's/Nick/John/gi' > report_new.txt

sed SCRIPT INPUTFILE...
or 
sed OPTIONS... [SCRIPT] [INPUTFILE...]

SCRIPT
- s command :: 's/{regexp}/{replacement}/{flags}'
  - {regexp} :: For literal string, wrap each letter in [ and ] and for ^ do [\^]
    - e.g. literal string '&#x1f;' =sed 's/[&][#][x][1][f][;]//gi' -i c.xml=
    - literal string '&#^x1f;' =sed 's/[&][#][\v][x][1][f][;]//gi' -i c.xml=
  - {replacement} :: You can use & to subsitute the whole matched portion of the pattern.

Refer to [[https://stackoverflow.com/questions/29613304/is-it-possible-to-escape-regex-metacharacters-reliably-with-sed][regexp and replacement escape]]

OPTIONS
- -e SCRIPT :: run several inline SCRIPT's described above
- -f SCRIPT-FILE :: Run commands in SCRIPT-FILE's
- -i :: files are edited in-place
  - -i :: original files are overwritten, no backup files are created
  - -i.backup or -i .backup (only Mac) :: copy original to *.backup and change original files
- :: 

For deleting only
sed "s/deletethis//g" -i input.txt
sed 's/&#x1f;//gi' -i c.xml
For multiple files
sed 's/Nick/John/gi' *.txt
No backup
sed 's/Nick/John/gi' -i.backup *.txt
create backup files

[[https://www.gnu.org/software/sed/manual/sed.txt][man sed]]

*** Concatenate String with File
Append to the beginning
echo returns a newline
echo '<?xml version="1.0"?>' | cat - input.txt > output.txt

'-' after 'cat' means to take the stdin from last command

Append to the end
echo 'end line' | cat input.txt - > output.txt

*** Change Encoding
Change from UCS-2 to UTF-8
iconv -f UCS-2 -t UTF-8 input.xml > output.xml

** Interesting Commands
*** sudo
Install sudo =apt-get update && apt-get install -y sudo less=
Run sudo interactive =sudo -i=

*** byobu
Create multiple terminals and switch between.
=apt-get install byobu=

** Nano
- Save :: Ctrl + O 
- Exit :: Ctrl + x

** Ubuntu Unity

| C-M t   | open Terminal          |
| M-<F2>  | run command/open app   |
| Super-T | Open Trash             |
| Super-F | Open Files             |
| Alt-`   | Switch between windows |
|         | of the current app     |
|         |                        |

** Ubuntu Personal Package Archive PPA
Add a LibreOffice package from PPA to Software Sources
=sudo add-apt-repository ppa:libreoffice/ppa=, then =sudo apt-get update=
Remove the package source
=sudo add-apt-repository --remove ppa:libreoffice/ppa=, =apt-get update=

Remove it and downgrade back to previous version before using PPA
=sudo apt-get install ppa-purge=, =sudo ppa-purge ppa:libreoffice/ppa=

* Docker
** Docker Compose
=docker-compose --version=
=docker-compose up -d=
=docker-compose up -d --force-recreate= Force restart or recreate containers
=docker-compose down -v= remove containers and volumes

* Git
** Working Tree
<<<git:Working_Tree>>>
- untracked :: it was never staged nor committed
- tracked :: it was previously committed, but it is not staged
- staged :: read for commit
- dirty or modified :: file is changed but not staged

** Stash, Reset, Clean
git:Working_Tree

- git reset --hard :: clean working tree, go back to last commit but keep the untracked.
- git clean -dfn :: remove untracked files

- git stash :: Save and remove working directory changes
=git stash list= List all stashes
=git stash apply= Apply latest stash
=git stash apply stash@{2}= Apply 2nd latest stash
=git stash drop stash@{0}= Remove latest stash

** Branch
*** Duplicate current branch and switch to it 
#+BEGIN_EXAMPLE
git checkout -b newbranch
#+END_EXAMPLE

*** Duplicate current branch to a commit and switch 
git checkout -b newbranch <SHA1>
*** Delete branch
git branch -d branchname= or =-D=

*** Rename current branch
git branch -m new-branch-name

*** Commit difference between 2 branches 
=git log master..li=

*** File difference between 2 branches 
=git diff --name-status master..origin/master= or 
=git diff --stat --color master..origin/master=
| Missing file or line in remote branch | D or - |
| New file or line in remote branch     | A or + |
| Both are modified                     | M      |

*** Orphan Branch with no parent
github:gh-pages

** Merge
*** Abort merge
git merge --abort

** Remove tracking for commited files
A file is commited but you don't want to track it anymore in the future.
Remember the file will still be in Git but future clone won't grab the file.
=git update-index --assume-unchanged path/to/file.txt=

If you change your mind and want to track it again:
=git update-index --no-assume-unchanged path/to/file.txt=

Don't track a folder of files which are already commited
First try to run this because this will work with file names with space
=git ls-files -z myFolderToIgnore/ | xargs -0 git update-index --assume-unchanged=

Path is relative.

If you encounter error =xargs: git: bad file number=, run this
=git ls-files -- myFolderToIgnore/ | xargs -l git update-index --assume-unchanged=

List all assumed unchanged files
#+BEGIN_EXAMPLE
git ls-files -v | grep '[[:lower:]]'
#+END_EXAMPLE

** Remove a commited file from file but leave in filesystem
Delete a file from Git (top of the current branch) but leave the file in filesystem
The file becomes Untracked File
#+BEGIN_EXAMPLE
git rm --cached file.txt
#+END_EXAMPLE

Remove a folder
=git rm -r --cached .emacs.d/=

Add file to local or global ignore so that the file won't appear as Untracked File and prevent 
from staging the file when =git add .=

** Commit History
=git log --graph=
=git log -3= Last 3 commits
=git log --grep=<pattern>= Search commit message

** Line Feed
Always don't do any conversion when files are added to local index or codes are checked out to local filesystem.
=git config --global core.autocrlf false=
Do git clone again.

** Long Path
You may encouter =file name too long= or =pathname too long= error.
Change the git setting
=git config --system core.longpaths true=

** Local Ignore, Global Ignore
Add file or directory paths to
- .git/info/exclude/ (will not be committed)
- .gitignore file (will be commited)

Just =touch .gitignore= in order to create a file with just the extension

Add global ignore file `~\.gitignore_global` 
and run `git config --global core.excludesfile ~/.gitignore_global`

Show all ignored files
git status --ignored

*** Wordpress .gitignore
#+BEGIN_EXAMPLE
*~
.DS_Store
.svn
.cvs
*.bak
*.swp
Thumbs.db
wp-config.php
wp-content/uploads/
wp-content/blogs.dir/
wp-content/upgrade/
wp-content/backup-db/
wp-content/advanced-cache.php
wp-content/wp-cache-config.php
wp-content/cache/*
wp-content/cache/supercache/*
*.log
error_log
wp-content/plugins/error_log
wp-content/cache/
wp-content/backups/
sitemap.xml
sitemap.xml.gz
#+END_EXAMPLE

** GUI gitk
** Multiple Github accounts and https
You manage 2 Github accounts.
git clone does not require credentials for https
When you push to the remote which is under Github account A, Windows asks you for credentials
After that, your credentials for account A is stored under Windows Credential Store Panel (WCSP).
You can add account A to an account B's repository as a collaborator.
Any push will be made by account A.

You have to delete 2 Github credentials from WCSP and then push commits to account B's repository 
and then use account B's credential if you want to completely switch account.

If you want to switch between multiple Github accounts frequently, use SSH instead of https

SSH might be blocked in public internet networks though.

Git has upgraded credential helper from manager to wincred.
git config --global crendential.helper wincred

** GitHub Push to New Repo with local repo
Create a new repo on Github.com without creating any .gitignore, README nor license
On local, git init, add .gitignore, git add . and check if files are ignored, git commit -m "1st commit"

Add a remote
git remote add origin ssh_or_github_https_link

List all remotes ~git remote -v~
Remove a remote 'origin' ~git remote rm origin~

Local branch is not set to sync with remote until you do the first push with '-u'
git push -u origin master

Finally check ~cat .git/config~ to see if local branch "master" has setup a remote
#+BEGIN_EXAMPLE
[branch "master"]
        remote = origin
        merge = refs/heads/master
#+END_EXAMPLE

You may encounter 403 Forbidden and HTTP request failed errors. Try to use SSH or modify the HTTPS url
#+BEGIN_EXAMPLE
https://[GITHUB_USERNAME]@github.com/[GITHUB_USERNAME]/[REPO_NAME].git
Instead of the original
https://github.com/[GITHUB_USERNAME]/[REPO_NAME].git
#+END_EXAMPLE




** Github Pages
You can add /docs folder to your repository and enable GitHub Pages in the repository setting
Or you can create an orphan branch called gh-pages

If you don't have branch gh-pages or /docs in master branch, just click on Launch automatic page generator and it will
create the gh-pages branch with Jekyll files.

Your project website is https://levonlee.github.io/reponame

<<<github:gh-pages>>> 
git checkout --orphan gh-pages
git rm -rf .
git commit -m "GitHub Pages"

For User or Organization Site, create repo levonlee.github.io and add index.html and push to repo

*** SVG
http://rawgit.com/ 

Image files other than SVG can be served directly from GitHub using Raw Repo Path. Except SVG

Blob Repo Path
https://github.com/levonlee/reponame/blob/master/folder1/s1.svg

Raw Repo Path
https://github.com//levonlee/reponame/raw/master/folder1/s1.svg

RawGit Path
/levonlee/reponame/master/folder1/s1.svg

Development (Traffic limited)
https://rawgit.com/ + RawGit Path
Production (No traffic limit, permanently cached, no url query param)
https://cdn.rawgit.com/ + RawGit Path

*** Markdown
![Alt text](http://url/to/img.png)

* Pantheon
** Deploy
#+BEGIN_EXAMPLE
terminus site deploy --site=<s> --env=<e> --sync-content --cc
#+END_EXAMPLE

** pantheon.yml
In the code directory. You need to commit to take effect.

PHP supported version :: 5.3, 5.5, 5.6, and 7.0.
Drush version: 5, 7, or 8. 8 is recommended

** Drush
<<<Pantheon Drush>>>
#+BEGIN_EXAMPLE
terminus drush "<drush command> <drush args>" --site=<> --env=<> 
#+END_EXAMPLE

<<<pantheon:drupal:alias>>>
Download Pantheon Aliases
terminus sites aliases

Drush version (5, 7, or 8) 8 is recommended for all Drupal version.
terminus drush "status" --site=<> --env=<>

.drush folder is at one level higher than the code folder
You can put custom drush commands into this folder. For example,
drush @pantheon.SITE.ENV dl utf8mb4_convert-7.x
Will put utf8mb4_convert/utf8mb4_convert.dursh.inc under .drush/ folder
Then you clear drush cache before using the new command
drush @pantheon.SITE.ENV cc drush

** WP CLI <<<WP CLI Pantheon>>>

#+BEGIN_EXAMPLE
terminus wp 'option get home' --site=<site> --env=dev
#+END_EXAMPLE

** Drupal Core Update
<<<pantheon:drupal:core>>>
Create a multidev of the current Live, then hit the upgrade button.
Check everything. If it's ok, do this on Dev, then pull code from Dev to Test, and then Live
Done!

To update other multidevs, after Dev master is updated, pull code from Dev to multidev and run update.php
Check Status from Pantheon.

** Determine Environment
<<<pantheon:environment>>>
#+BEGIN_EXAMPLE
if (defined('PANTHEON_ENVIRONMENT') && PANTHEON_ENVIRONMENT == 'dev') {} 
#+END_EXAMPLE

Not including Drush and on dev web environment
#+BEGIN_EXAMPLE
if (isset($_SERVER['PANTHEON_ENVIRONMENT'])) {
 // Web only excluding Drush 
 if ($_SERVER['PANTHEON_ENVIRONMENT'] == 'dev') {
  // Web only excluding Drush and on dev
 }
}
#+END_EXAMPLE

** Disable Newrelic
https://pantheon.io/docs/new-relic

Newrelic may inject javascript in pages.. Disable it

Drupal (sites/default/settings.php)
#+BEGIN_EXAMPLE
if (function_exists('newrelic_ignore_transaction')) {
 newrelic_ignore_transaction();
}
#+END_EXAMPLE

* Database
** Basics
*** Modeling Optimization
First normal form (1NF) :: every field should have one value. (Not comma separated values)

Second normal form (2NF) :: If you have multiple primary keys (composite keys) in a table, 
every field should be unique to all of those composite keys.
e.g. CourseID and Date are 2 primary keys in table A. Field CourseTitle is unique to courseID. courseTitle should not be in 
table A. Create a new table B to include CourseID and CourseTitle.

Third normal form (3NF) :: Say you have CourseID, Date, Room, Seats in table A.
Seats is unique to Room. You should create table B to hold Room, Seats and include just Room in table A.

*** Transaction and ACID
- Atomic :: All parts involved should be either success or failure as a whole.
- Consistent :: cannot result in a situation that violates any of the integrity rules.
- Isolated :: all relevant data is locked until the transaction is finished. (Race condition)
 - Pessimistic Locking :: Once locked, others can't even read (be refused or have to wait)
 - Optimistic Locking :: Once one request lock data, other requests can read 
but roll back when try to write to db while lock is encountered.
- Durable :: Once success, always success.

*** Index
One table can have only one clustered index which is by default the primary key column.
You may make another column as non-clustered index. 
Each non-clustered index creates a new table which includes the clustered index column and the new column (sorted).
When a new row is added to the main table, a new row is also added to each non-cluster indexed table.

** Access
*** Troubleshooting
**** "Record is too large"
This is because the size of a single record is around 2K. 
You can change the data type for some of fields to Long Text (>Access 2013) or Memo (<= Access 2000)

**** "Application uses a value of the wrong type for the current operation"
It's possibly due to you are using Microsoft Access with Unicode driver in ColdFusion and you insert to a memo or long text field. 
~cf_sql_longvarchar~ doesn't work. You should use ~<cfqueryparam cfsqltype="CF_SQL_CLOB" value="#description#">~ instead. 

** MySQL
*** Version, Settings
# In console
SHOW VARIABLES LIKE "%version%";

# Default charset is utf8, collation is utf8_general_ci
# which is 3 bytes. utf8mb4 is 4 bytes
# MySQL server default charset and collation
<<<mysql:charset>>> <<<mysql:collation>>>
SELECT @@character_set_database, @@collation_database;
ALTER DATABASE db_name CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;
ALTER TABLE {tbl_name} CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;
ALTER TABLE {tbl_name} MODIFY "field_name" "field_type" CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;

# In order to enable utf8mb4, you need to change my.cnf setting and restart MySQL
# mysqld (client) is used on Pantheon instead of libmysqlclient
# The following settings becomes available on mysqld (MySQL) server version > 5.5.14 and default since 5.7.7
# As of Nov 25, 2016, Pantheon MySQL (innodb) version is 5.6.26 
[mysqld]
innodb_large_prefix=true
innodb_file_format=barracuda
innodb_file_per_table=true

# mysqld (client) > 5.0.9, libmysqlclient > v. 5.5.3, has to support utf8mb4 charset

The major problem here is that for an indexed string column (primary key column) MySQL has 767 bytes limit.
In utf8, it's 767/3=255 characters varchar(255). In utf8mb4, it's 767/4=191 characters varchar(191).
If MySQL server doesn't have the above setting, the indexed column should contain less than 191 characters.
But those columns already have varchar(255) defined, you will need to re-create the indexes
ALTER TABLE tbl_name CHANGE index_col index_col VARCHAR(191) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;

That's actually what Wordpress does: resize the indexed columns for some tables and make every table and field utf8mb4.

Until Nov 25, 2016, Pantheon doesn't make those settings to MySQL server, so you will need to manually do the same as Wordpress.

Referred by d7:mysql:charset

*** Data Types
<<<MySQL Integer>>>
SIGNED :: contains negative, 0 and positive
UNSIGNED :: contains 0 and positive
- TINYINT
- SMALLINT
- MEDIUMINT
- INT
- BIGINT

<<<MySQL Date and Time>>>
- TIME :: format 'HH:MM:SS' from '-838:59:59.000' to '838:59:59.000'

1 Year ago
post_date > DATE_SUB(NOW(), INTERVAL 1 YEAR)

Date comparison

#+BEGIN_EXAMPLE
CAST(post_date AS DATE) > '2014-01-01'
FROM_UNIXTIME(intTime) > '2014-01-01'
FROM_UNIXTIME(intTime) BETWEEN '2014-01-01 00:00:00' AND '2014-12-31 23:59:00'
#+END_EXAMPLE

Unix Time
#+BEGIN_EXAMPLE
DATE_FORMAT(FROM_UNIXTIME(intTime),'%Y-%m-%d %H:%i:%s') :: default date format
UNIX_TIMESTAMP(NOW())
#+END_EXAMPLE

<<<MySQL String>>>
Concatenate columns or strings of one row. It doesn't skip empty string but it does skip NULL values.
#+BEGIN_EXAMPLE
CONCAT_WS(',', colA, colB, 'Column C Value')
WHERE url_alias.source = CONCAT('node/', n.nid)
#+END_EXAMPLE

<<<MySQL Null>>>
IFNULL(column_name, 0)
WHERE column_name IS NOT NULL

*** REGEXP
<<<MySQL REGEX>>>

Unless the field is binary, REGEXP is case-insensitive.

#+BEGIN_EXAMPLE
WHERE aut_name REGEXP "^w"
WHERE aut_name REGEXP "^I am \"Great!\""
// escape double quotes
#+END_EXAMPLE

*** Update Fields in Multiple Tables
#+BEGIN_EXAMPLE
UPDATE node, node_revision
SET node.comment=1,
    node_revision.comment = 1
WHERE node_revision.nid = node.nid AND node.type <> 'blog'
#+END_EXAMPLE

Update Joined Tables
#+BEGIN_EXAMPLE
UPDATE tableA a
JOIN tableB b ON a.a_id = b.a_id
JOIN tableC c ON b.b_id = c.b_id
SET b.val = a.val+c.val,
a.val2 = 'new'
WHERE a.val > 10 AND c.val > 10
#+END_EXAMPLE

*** LIMIT in Sub Query
Can't directly use LIMIT in sub query
This doesn't work
#+BEGIN_EXAMPLE
SELECT *
FROM wp_posts
WHERE wp_posts.ID IN (
SELECT p2.ID FROM wp_posts p2 WHERE p2.post_type IN ('posts')
LIMIT 5
)
#+END_EXAMPLE

Do this
#+BEGIN_EXAMPLE
SELECT *
FROM wp_posts
WHERE wp_posts.ID IN (
SELECT * FROM (SELECT p2.ID FROM wp_posts p2 WHERE p2.post_type IN ('posts') LIMIT 5) AS sq1
)
#+END_EXAMPLE

Remember if the outter query has LIMIT, then it will overwrite any subquery's LIMIT

*** EXISTS
If only checking existance in other tables but not returning any data from other tables, always use `EXISTS` or `NOT EXISTS`

The following returns nodes that have field_dealer = 101615 and field_ad_status = active but not returning any fields from 
tables field_data_*.

#+BEGIN_EXAMPLE
SELECT count(*) FROM node AS n
WHERE n.type='ad_listing'
AND n.status = 1
AND EXISTS (
 SELECT *
 FROM field_data_field_dealer d
 INNER JOIN node nsub ON nsub.nid=d.entity_id AND d.bundle='ad_listing' AND d.field_dealer_target_id IN (101615)
 WHERE nsub.nid=n.nid
)
AND EXISTS (
 SELECT *
 FROM field_data_field_ad_status s
 INNER JOIN node nsub ON nsub.nid=s.entity_id AND s.bundle='ad_listing' AND s.field_ad_status_value = 'active'
 WHERE nsub.nid=n.nid
)
#+END_EXAMPLE

*** Concatenate values of a column across multiple rows about the same record

#+BEGIN_EXAMPLE
SELECT s.id, s.name, s.otherColumn, 
GROUP_CONCAT(DISTINCT testScore.score ORDER BY testScore.testDate SEPARATOR ', ') AS student_scores
FROM student s 
     LEFT JOIN testScore ON testScore.sid = s.id
ORDER BY s.name
GROUP BY s.id, s.name, s.otherColumn
#+END_EXAMPLE

GROUP_CONCAT only concatenates non-null values. If all values are null, null will be returned.

** MSSQL
*** Modify column values if exist (CASE WHEN)
#+BEGIN_EXAMPLE
SELECT colOne,
varColTwo = 
CASE colTwo
 WHEN 1 THEN 1
 WHEN 0 THEN 3
END,
varImage = 
CASE
 WHEN len(colImage) > 0 THEN 'http://abc.com/images/' + colImage
 ELSE ''
END
FROM aTable
ORDER BY varColTwo DESC,
CASE 
 WHEN colFour = 1 THEN colFive
 WHEN colFour = 2 THEN colSix
END ASC      
#+END_EXAMPLE

*** Concatenate Multiple Columns to Single Column as String
A doc has multiple categories. Concatenate the categories delimited by commas.

#+BEGIN_EXAMPLE
SELECT doc.intDocID
      ,doc.varTitle
      ,STUFF(
          (SELECT ',' + CAST( t2.catID AS varchar(10) )
           FROM tblDocCat t2
           WHERE t2.intDocID = doc.intDocID
           FOR XML PATH('')
          ),
          1,
          1,
          ''
       ) AS docCats
#+END_EXAMPLE

**** STUFF
This deletes the first letter of a column and returns the rest.
STUFF first deletes a substring from aCol at start:1 and length_to_delete:1
and then insert a string at the start position
#+BEGIN_EXAMPLE
STUFF(aCol, 1,1, '')
#+END_EXAMPLE

*** Export as CSV - BCP
<<<mssql:bcp>>>
bcp.exe is in 
C:\Program Files\Microsoft SQL Server\90\Tools\Binn\

#+BEGIN_EXAMPLE
bcp "Select * from fullDatabasename.dbo.tableName" queryout "c:\aFolder\aFile.csv" -c -t"\",\"" -r"\"\n\"" -T
#+END_EXAMPLE

Table name in full :: DEDP225.[dev.todaystrucking].dbo.[tblDocument]

| c | Ascii                            |
| t | field terminator. Comma          |
| r | row terminator. New line :: "\n" |
| T | trusted connection               |

**** Escape % if bcp is in batch file
#+BEGIN_EXAMPLE
bcp "SELECT * FROM aTable WHERE email LIKE '%%@%%.%%'"
#+END_EXAMPLE

**** Save long query in Global Temporary table (GTT)
#+BEGIN_EXAMPLE
SELECT *
INTO ##myglobaltemptable
FROM tableA
#+END_EXAMPLE

Drop the GTT after bcp: =DROP TABLE ##myglobaltemptable=

#+BEGIN_EXAMPLE
bcp ##myglobaltemptable out "c:\folder\file.csv" -c -t"\",\"" -r"\"\n\"" -T
#+END_EXAMPLE

**** Get all columns
#+BEGIN_EXAMPLE
DECLARE @colnames VARCHAR(max);
SELECT @colnames = COALESCE(@colnames + ',', '') + char(39)+ column_name +char(39) 
FROM INFORMATION_SCHEMA.COLUMNS where TABLE_NAME='%yourtablename%'; 
SELECT @colnames
#+END_EXAMPLE

It returns ='col1','col2',...,'colLast'=

Export to header.csv
=bcp "SELECT 'col1','col2',...,'colLast'" queryout "c:\header.csv" -c -t"\",\"" -r"\"\n\"" -T=

**** Last step
Both header and data files need to be fixed.
Insert a double quote at the beginning of the file and delete the last double quote at the end of it.
Insert a new line at the end of the header file.

Combine 2 files
=copy /b c:\header.csv+c:\folder\file.csv c:\export.csv=

*** Export as XML
By default, it's UTF-8 encoded. datetime will be automatically converted to XML format.
If value is NULL, the xml node will not be generated.
By default, MSSQL will add =<CR><LF>= into the Unicode XML data stream every 2033 characters.
Use bcp with option -r to add no new line.

**** Query
#+BEGIN_EXAMPLE
SELECT CustomerID as "@id",
CompanyName,
Address as "address/street",
City as "address/city",
Region as "address/region",
PostalCode as "address/zip",
Country as "address/country",
ContactName as "contact/name",
ContactTitle as "contact/title",
NULLIF(Phone,'') as "contact/phone",
-- If value is NULL, the xml node will not be generated
Fax as "contact/fax"
FROM Customers
FOR XML PATH('Customer'), ROOT('doc')
#+END_EXAMPLE

Result
#+BEGIN_EXAMPLE
<doc>
  <Customer id="ALFKI">
    <CompanyName>Alfreds Futterkiste</CompanyName>
    <address>
      <street>Obere Str. 57</street>
      <city>Berlin</city>
      <zip>12209</zip>
      <country>Germany</country>
    </address>
    <contact>
      <name>Maria Anders</name>
      <title>Sales Representative</title>
      <phone>030-0074321</phone>
      <fax>030-0076545</fax>
    </contact>
  </Customer>
  ...
</doc>
#+END_EXAMPLE

INNER JOIN Multiple records
#+BEGIN_EXAMPLE
SELECT d.docID
,(
SELECT c.category AS category
FROM tblDocCats dc
 INNER JOIN tblCategory c ON c.catID = dc.catID
WHERE dc.docID = d.docID
FOR XML PATH(''), TYPE
) AS categories
FROM doc d
FOR XML PATH('item'), ROOT('items')
#+END_EXAMPLE

Result
#+BEGIN_EXAMPLE
<items>
 <item>
  <docID></docID>
  <categories>
   <category></category>
   ...
  <categories>
 <item>
</items>
#+END_EXAMPLE

This
#+BEGIN_EXAMPLE
,(
SELECT c.category AS name, c.catID as ID
FROM tblDocCats dc
 INNER JOIN tblCategory c ON c.catID = dc.catID
WHERE dc.docID = d.docID
FOR XML PATH('category'), TYPE
)
#+END_EXAMPLE
will result as
#+BEGIN_EXAMPLE
<items>
 <item>
  <docID></docID>
  <category>
   <name></name>
   <id></id>
  <category>
  <category>
   <name></name>
   <id></id>
  </category>
  ...
 <item>
</items>
#+END_EXAMPLE

**** Different modes
FOR XML AUTO
#+BEGIN_EXAMPLE
<servername.dbo.Customers ID="C11" Name="..." Address="..." />
#+END_EXAMPLE

FOR XML RAW
#+BEGIN_EXAMPLE
<row ID="C11" Name="..." Address="..." />
#+END_EXAMPLE

FOR XML PATH
#+BEGIN_EXAMPLE
<row>
  <ID></ID>
  <Name></Name>
  <Address></Address>
</row>
#+END_EXAMPLE

**** bcp
#+BEGIN_EXAMPLE
bcp "query..." queryout C:\file.xml -T -w -r
#+END_EXAMPLE

| r | no value means don't add any newline character for every 2033 characters or new row |
| w | Use Unicode characters                                                              |
| S | server_name[\instance_name]                                                         |

Save long query as stored procedure. You can't save FOR XML in Global Temporary Table.
dev.todaystrucking is the database name. Inside the real SELECT, you can refer to table as
dbo.tablename not DEDP225.[dev.todaystrucking].dbo.tablename
#+BEGIN_EXAMPLE
USE [dev.todaystrucking]
GO

IF OBJECT_ID('dbo.usp_exporttr') IS NOT NULL DROP PROC dbo.usp_exporttr
GO

CREATE PROC dbo.usp_exporttr AS

SET NOCOUNT ON

SELECT ...
FOR XML PATH('item'), ROOT('items')

RETURN
GO
#+END_EXAMPLE

Then creat another query in MS SQL Server Management Studio and run
#+BEGIN_EXAMPLE
EXEC xp_cmdshell 'bcp "EXEC [dev.todaystrucking].dbo.usp_exporttr" queryout "c:\a.xml" -S (local) -T -w -r'
#+END_EXAMPLE

You may receive "SQL Server blocked access to procedure 'sys.xp_cmdshell' of component 'xp_cmdshell' because this component is turned off as part of the security configuration"

Just go to bcp folder and run as a command line mssql:bcp
#+BEGIN_EXAMPLE
bcp "EXEC [dev.todaystrucking].dbo.usp_exporttr" queryout "c:\a.xml" -S (local) -T -w -r
#+END_EXAMPLE

The exported xml file will have UCS-2 encoding which is a preceding version of UTF-16.
This encoding is in BOM. For SQL Server lower than 2016, you can't set encoding to UTF-8.

**** bcp clean up
You can run these in Git Bash on Windows
Change encoding to UTF-8
iconv -f UCS-2 -t UTF-8 a.xml > b.xml

Add xml declaration
echo '<?xml version="1.0"?>' | cat - b.xml > c.xml

Delete xml:invalid_characters bash:sed
sed "s/&#x1f;//gi; s/&#x1e;//gi;" c.xml > d.xml

*** Connections
Number of active connections by database
#+BEGIN_EXAMPLE
SELECT 
    DB_NAME(dbid) as DBName, 
    COUNT(dbid) as NumberOfConnections,
    loginame as LoginName
FROM
    sys.sysprocesses
WHERE 
    dbid > 0
GROUP BY 
    dbid, loginame
;
#+END_EXAMPLE

*** Backup
Export database to bak file.
SQL Management Studio Tool > right click on a database and
Tasks > Backup > Use Full backup, specify a destination (path to bak).
Use overwrite settings in Options.
Then click on Script > Script to file. You will get a .sql:
#+BEGIN_EXAMPLE
BACKUP DATABASE [aDatabase] TO DISK ='N'C:\afile.bak' WITH NOFORMAT, INIT, 
NAME = N'aDatabase-Full Database Backup', 
SKIP, NOREWIND, NOUNLOAD,  STATS = 10
GO
#+END_EXAMPLE

Make filename dynamic (remove spaces if necessary):
#+BEGIN_EXAMPLE
DECLARE @filename nvarchar(200) = ''
SELECT @filename = 'C:\test-' + convert(varchar(23), getdate(), 126) + '.bak'
BACKUP DATABASE [aDatabase] TO
 DISK =  @filename WITH NOFORMAT, INIT,  
 NAME = N'aDatabase-Full Database Backup', SKIP, NOREWIND, NOUNLOAD,  STATS = 10
GO
#+END_EXAMPLE

Run this .sql file:
#+BEGIN_EXAMPLE
sqlcmd -S sqlservername -i C:\sqlFileName.sql
#+END_EXAMPLE

* DFP
** Why async is required
Video companion requires async
pubService.refresh requires async
POST request requires async. GET request with larger than 2048 bytes not supported.

However, it's better to use sync mode for rich media creative unless the creative is in friendly frames

** Competition Calculation
- List of candidate line items
- select the best line item
- select the best creative associated with the winning line item
- DFP remnant and Ad Exchange/Adsense line items are evaluated 
to see if they have line items with a higher yield
- the best creastive associated with the winning line item is selected
- creative returned to the browser. Dynamic allocation.

** Key-Value Targeting
Slot-level targeting is recommended
#+BEGIN_EXAMPLE
googletag.defineSlot('/123/travel/asia/food', [728, 90], "div-id")
         .addService(googletag.pubads())
         .setTargeting("interests", ["sports", "music"]);
#+END_EXAMPLE

Page-level targeting
#+BEGIN_EXAMPLE
googltag.pubads().setTargeting("topic", "basketball");
#+END_EXAMPLE

** Exclusive Ads on Specific Page
Let's say there're 2 LBs and 2 BBs throughout the website.
999/LB1, 999/LB2, 999/BB1, 999/BB2
For a specific page, Line Item A takes over all ad units.
For another specific page, Line Item B takes over all ad units.

The perfect way
Create multilevel ad units and make them Special Ad Units. 
999/LB1/exclusive, 999/LB2/exclusive
999/BB1/exclusive, 999/BB2/exclusive

On those specific pages:
- Use the new tags of multilevel and special ad units on HTML instead of the original ones.
- setTargetting on HTML and on DFP so that Line Item A and B can be distinguished.

The better way
Multilevel and Special ad units are only avaiable in Premium. Here's the way for SBS
- 999/LB1_exclusive, 999/LB2_exclusive
- 999/BB1_exclusive, 999/BB2_exclusive
- Use the new tags on HTML instead of the original ones
- setTargetting on HTML and DFP so that Line Item A and B 

The workaround way
If you don't have control on HTML, you can:
- For Line Item A and B
  - On DFP
    - add Key-Value pair exclusive is exclusive
    - add Key-Value pair sponsor is lineitemA
  - In HTML, for those specific pages
    - setTargeting("exclusive","exclusive");
    - setTargeting("sponsor","lineitemA");
- For other normal line items
  - On DFP
    - add Key-Value par 'exclusive is not ~exclusive' (~ means contain and * means begin with)
  - In HTML, do nothing (remain the same)

** DFP in email
[[https://support.google.com/dfp_premium/answer/2623168?hl=en][Simplified URL tags on DFP Help]]

#+BEGIN_EXAMPLE
<a href="http://my.com/ad/ad_unit_name/728x90/">
 <img width="728" height="90" alt=""
  src="http://pubads.g.doubleclick.net/gampad/ad?iu=/networkid/ad_unit_name&sz=728x90&c=[todays_date][account]" />
</a>
#+END_EXAMPLE

Base URL :: http://pubads.g.doubleclick.net/gampad/[request-type]?[parameters]

Request Type
| ad   | simple image creative                               |
| jump | log click and redirect to destination URL           |
| adx  | return raw code of creative                         |
| clk  | only log click but no redirect. Only in DFP Premium |
|      |                                                     |

Parameters
| iu       | for all request types                                                   |
| sz       | for ad, jump and adx                                                    |
| t        | for ad, jump and adx. key-value pairs                                   |
| excl_cat | competitive exclusions                                                  |
| c        | for ad, jump and adx. cache buster. only number                         |
| m        | for adx. Specify file type to return. m=text/html                       |
| submodel | for all request types. Mobile device name                               |
| u_w      | for all request types. Mobile device screen height.                     |
| title    | required if mutliple ad tags use the same ad unit code on the same page |
| mob      | Indicaste it's a mobile request.                                        |

#+BEGIN_EXAMPLE
<script src="//code.jquery.com/jquery-1.10.2.js"></script>
<script>
	var ad_unit = 'ad_unit_name';
	var ad_unit_size = '728x90';
	var rnd=Math.floor(Math.random() * (999999 - 10 +1)) + 10;
	var theUrl='http://pubads.g.doubleclick.net/gampad/adx?iu=/' + ad_unit 
	+ '&sz=' + ad_unit_size + '&c=' + rnd;
	var xmlHttp = null;
	xmlHttp = new XMLHttpRequest();
	xmlHttp.open( "GET", theUrl );
	xmlHttp.send();
	xmlHttp.onreadystatechange=function() {
	if (xmlHttp.readyState==4 && xmlHttp.status==200) {
	  xmlDoc = $.parseHTML( xmlHttp.response );
         adlink = $(xmlDoc).find('a').attr('href');
         if (typeof adlink == "undefined") adlink = "http://www.example.com";
          window.location = adlink;
       }
    }
</script>
#+END_EXAMPLE

PHP, DFP creative type Custom. Get response line by line
#+BEGIN_EXAMPLE
$url = "http://pubads.g.doubleclick.net/gampad/adx?iu=/12343/ad_unit_name&sz=230x20&c=". REQUEST_TIME."&m=text/html";
$json = @file_get_contents($url);
if ($json !== FALSE) {
  $lines = explode("\n", $json);
  $link = ( isset($lines[0]) ) ? trim($lines[0]) : 'default';
}
#+END_EXAMPLE

** Responsive
Add a size to the ad unit /networkid/adunitname
You can specify one or more sizes for a line item that uses this ad unit.
And upload each creative and specify the size. You can have creative bigger than the size you specify.

#+BEGIN_EXAMPLE
googletag.cmd.push(function() {
  var leaderboard_mapping = googletag.sizeMapping()
  .addSize([1280, 800], [[970, 250], [970, 90], [728, 90]])
  .addSize([600, 800], [468, 60]) // viewport size is width and height both > 600 and 800
  .addSize([0, 0], [[320, 50], [320, 100]]) // Map any viewport size
/* This will only display the ad if it's mobile or tablet viewport size
  .addSize([0, 0], []) // [] means don't try to call an ad
  .addSize([320, 700], [300, 250]) // Mobile or tablet
  .addSize([1050, 200], [])
*/
  .build();
  
  googletag.defineSlot('/networkid/adunitname'
           , [728, 90] // If there is an error in the mapping or if the browser size can't be determined
                       // the size specified here in .defineSlot will be used. 
           , 'div-id')
           .defineSizeMapping(leaderboard_mapping)
           .addService(googletag.pubads());
});
#+END_EXAMPLE

** Macro in Third Party Code, Custom Code
CACHEBUSTER :: time in integer
CLICK_URL_UNESC :: normal click macro
CLICK_URL_ESC :: escaped click macro (&, ? , %)

VIEW_URL_UNESC, VIEW_URL_ESC :: required in Custom Code

<<<dfp:third party code>>>
Third Party Code with macro automatically inserted
#+BEGIN_EXAMPLE
<!-- url parameter ncu is inserted, ord's [timestamp] is replaced by CACHEBUSTER -->
<script src="http://bs.serving-sys.com/Serving/adServer.bs?c=28&cn=display&pli=1074030166&w=728&h=90&ncu=$$%%CLICK_URL_UNESC%%$$&ord=%%CACHEBUSTER%%&ifrm=-1&z=0"></script>
<noscript>
<!-- insert CLICK_URL_UNESC in href -->
<a href="%%CLICK_URL_UNESC%%http://bs.serving-sys.com/Serving/adServer.bs?cn=brd&pli=1074030166&Page=&Pos=944448101" target="_blank">
<img src="http://bs.serving-sys.com/Serving/adServer.bs?c=8&cn=display&pli=1074030166&Page=&Pos=944448101" border=0 width=728 height=90></a>
</noscript>
#+END_EXAMPLE

Sometimes you need to have DFP inserted the macros in third party code mode, and then use that in Custom Code.

** Creative Type: Third Party Code - Video

#+BEGIN_EXAMPLE
<script src="//content.jwplatform.com/players/xxx-xxx.js?v=%%CACHEBUSTER%%"></script>
#+END_EXAMPLE

Viewbix
#+BEGIN_EXAMPLE
<iframe width="300" height="250" 
src="http://www.viewbix.com/frame/1234-567-890?w=300&h=250&ord=%%CACHEBUSTER%%" 
frameborder="0" scrolling="no" allowTransparency="true"></iframe>
#+END_EXAMPLE

** Creative Type: HTML5
Upload zip file or single html file

** Creative Type: DoubleClick Tag 
Basic Redirect URL
https://ad.doubleclick.net/ddm/ad/N1234.123456yoursite.com/B1234567.123456789;sz=320x548

There's also a tag called DCM tag. Convert the URL in DCM tag to the basic Redirect URL.
May also deploy DCM tag as a custom creative. But you have to add the DFP macros. [[https://support.google.com/dfp_premium/answer/1656861?hl%3Den&ref_topic%3D28160][Instructions]]

#+BEGIN_EXAMPLE
Iframe
<ins class='dcmads' style='display:inline-block;width:300px;height:250px'
    data-dcm-placement='N1234.123456yoursite.com/B1234567.123456789'
    data-dcm-rendering-mode='script'
    data-dcm-https-only
    data-dcm-resettable-device-id=''
    data-dcm-app-id=''>
  <script src='https://www.googletagservices.com/dcm/dcmads.js'></script>
</ins>

Javascript
<ins class='dcmads' style='display:inline-block;width:300px;height:250px'
    data-dcm-placement='N1234.123456yoursite.com/B1234567.123456789'
    data-dcm-rendering-mode='script'
    data-dcm-https-only
    data-dcm-resettable-device-id=''
    data-dcm-app-id=''>
  <script src='https://www.googletagservices.com/dcm/dcmads.js'></script>
</ins>
#+END_EXAMPLE

DCM tag has a legacy form
#+BEGIN_EXAMPLE
Iframe
<IFRAME SRC=""https://ad.doubleclick.net/ddm/adi/N1234.123456yoursite.com/B1234567.123456789;sz=300x250;ord=[timestamp];dc_lat=;dc_rdid=;tag_for_child_directed_treatment=?"" WIDTH=300 HEIGHT=250 MARGINWIDTH=0 MARGINHEIGHT=0 HSPACE=0 VSPACE=0 FRAMEBORDER=0 SCROLLING=no BORDERCOLOR='#000000'>
<SCRIPT language='JavaScript1.1' SRC=""https://ad.doubleclick.net/ddm/adj/N1234.123456yoursite.com/B1234567.123456789;abr=!ie;sz=300x250;ord=[timestamp];dc_lat=;dc_rdid=;tag_for_child_directed_treatment=?"">
</SCRIPT>
<NOSCRIPT>
<A HREF=""https://ad.doubleclick.net/ddm/jump/N1234.123456yoursite.com/B1234567.123456789;abr=!ie4;abr=!ie5;sz=300x250;ord=[timestamp]?"">
<IMG SRC=""https://ad.doubleclick.net/ddm/ad/N1234.123456yoursite.com/B1234567.123456789/B10762433.143897886;abr=!ie4;abr=!ie5;sz=300x250;ord=[timestamp];dc_lat=;dc_rdid=;tag_for_child_directed_treatment=?"" BORDER=0 WIDTH=300 HEIGHT=250 ALT=""Advertisement""></A>
</NOSCRIPT>
</IFRAME>

Javascript
<SCRIPT language='JavaScript1.1' SRC=""https://ad.doubleclick.net/ddm/adj/N1234.123456yoursite.com/B1234567.123456789;sz=300x250;ord=[timestamp];dc_lat=;dc_rdid=;tag_for_child_directed_treatment=?"">
</SCRIPT>
<NOSCRIPT>
<A HREF=""https://ad.doubleclick.net/ddm/jump/N1234.123456yoursite.com/B1234567.123456789;sz=300x250;ord=[timestamp]?"">
<IMG SRC=""https://ad.doubleclick.net/ddm/ad/N1234.123456yoursite.com/B1234567.123456789;sz=300x250;ord=[timestamp];dc_lat=;dc_rdid=;tag_for_child_directed_treatment=?"" BORDER=0 WIDTH=300 HEIGHT=250 ALT=""Advertisement""></A>
</NOSCRIPT>
#+END_EXAMPLE

** Wallpaper, Site Skin

On DFP
#+BEGIN_EXAMPLE
<script type="text/javascript">
  (function() {
  'use strict';
  parent.jQuery(document).ready(function() {
  var backgroundAdwidth = 480; // TODO: find out the background image width
  var backgroundAdheight = 860; // TODO: find out the background image height
  var backgroundAdLeftImage = '%%VIEW_URL_UNESC%%%%FILE:JPG1%%';
  var backgroundAdRightImage = '%%VIEW_URL_UNESC%%%%FILE:JPG2%%';
  var backgroundAdLinkLeft = '%%CLICK_URL_UNESC%%%%DEST_URL%%';
  var backgroundAdLinkRight = backgroundAdLinkLeft;
  var backgroundAdMainContentDivWidth = 996;
  var backgroundAdExtraTopSpace = 100; // Set to 0 if you don't want extra top space
  parent.jQuery('body').prepend('<div id="background-ad-right"></div><div id="background-ad-left"></div>');
  var jsLink1 = "<script type='text/javascript'>" +
  "var backgroundAdwidth = " + backgroundAdwidth + ";" +
  "var backgroundAdheight = " + backgroundAdheight +";" +
  "var backgroundAdMainContentDivWidth = " + backgroundAdMainContentDivWidth + ";" +
  "var backgroundAdExtraTopSpace = " + backgroundAdExtraTopSpace + ";" +
  "</scr" + "ipt>";
  parent.jQuery('head').append(jsLink1);
  var jsLink2 = parent.jQuery("<script type='text/javascript' src='http://yours.com/js/backgroundskinad.js'>");
  parent.jQuery('head').append(jsLink2);
  var cssLink = parent.jQuery("<link rel='stylesheet' href='http://yours.com/css/media-w1200-w992.css'>");
  parent.jQuery('head').append(cssLink);
  parent.jQuery('#background-ad-left, #background-ad-right').css({
  'position': 'fixed',
  'z-index': '1',
  'cursor': 'pointer',
  'height': backgroundAdheight
  });
  parent.jQuery('#background-ad-left').css({
  'background': 'url(' + backgroundAdLeftImage + ') no-repeat right top'
  });
  parent.jQuery('#background-ad-right').css({
  'background': 'url(' + backgroundAdRightImage + ') no-repeat left top'
  });
  parent.jQuery('#background-ad-left').click(function() {
  window.open(backgroundAdLinkLeft);
  });
  parent.jQuery('#background-ad-right').click(function() {
  window.open(backgroundAdLinkRight);
  });
  });
  })();
</script>
#+END_EXAMPLE

On Web Server
backgroundskinad.js
#+BEGIN_EXAMPLE
jQuery(document).ready(function($) {
  var backgroundAdMainContentDivWidth = 996;
  var backgroundAdExtraTopSpace = 0;
  function setBackgroundAdPositionX() {
    var adPosition = new Array();
    var viewportWidth = $(window).width();
    var leftSpace = (viewportWidth-backgroundAdMainContentDivWidth)/2;
    if (leftSpace > 0) {
      if (leftSpace <= backgroundAdwidth) {
        adPosition['adWidthRealtime'] = leftSpace;
        adPosition['adHorizontalSpacing'] = 0;
      } else {
        adPosition['adWidthRealtime'] = backgroundAdwidth;
        adPosition['adHorizontalSpacing'] = leftSpace - backgroundAdwidth;
      }
    }
    else {
      adPosition['adWidthRealtime'] = 0;
      adPosition['adHorizontalSpacing'] = 0;
    }

    $('#background-ad-left').css({
      'left': adPosition['adHorizontalSpacing'],
      'width': adPosition['adWidthRealtime']
    });

    $('#background-ad-right').css({
      'right': adPosition['adHorizontalSpacing'],
      'width': adPosition['adWidthRealtime']
    });
    return adPosition;
  }

  function setBackgroundAdPositionY() {
    var topspace = backgroundAdExtraTopSpace - $(window).scrollTop();
    // nav HTML element height
    if ($('#newcom-header-masthead').length && $('#newcom-header-masthead').height()) {
      topspace += $('#newcom-header-masthead').height();
    }
    topspace = (topspace > 0) ? topspace : 0;
    $('#background-ad-left, #background-ad-right').css('top', topspace + 'px');
  }

  function wallpaperFixViewport() {
    $('.cover-slogan, .cover-logo').addClass("m-clear");
    $('#newcom-single-left').toggleClass("col-md-9 col-md-8");
    $('#newcom-single-right').toggleClass("col-md-3 col-md-4");
    $('#newcom-page-news-middle').toggleClass("col-md-7 col-md-6");
    $('#newcom-page-news-right').toggleClass("col-md-3 col-md-4");
    $('#newcom-taxonomy-videoseries-middle').toggleClass("col-md-7 col-md-6");
    $('#newcom-content-sidebar-page-left').toggleClass("col-md-9 col-md-8");
    $('#newcom-content-sidebar-page-right').toggleClass("col-md-3 col-md-4");
    $('#newcom-page-middle').toggleClass("col-md-7 col-md-6");
    $('#newcom-page-right').toggleClass("col-md-3 col-md-4");
    $('#newcom-search-middle').toggleClass("col-md-7 col-md-6");
    $('#newcom-search-right').toggleClass("col-md-3 col-md-4");

    $('div.row div.col-md-8 div.row div.col-md-3 div.well').toggleClass("pa-sm");

    $('#div-gpt-placeholder-1, #div-gpt-placeholder-2').toggleClass('center-block');

    // Enlarge column of a parent if it has a child
    var videoDiv = $( "#yourspecialchild" ).parent( ".the-content" ).parent( ".col-md-9" );
    if (videoDiv.length) {
      videoDiv.toggleClass("col-md-9 col-md-12");
      // Move
      var titleDiv = videoDiv.prev();
      if (titleDiv.length) {
        titleDiv.toggleClass("col-md-3 col-md-12");
        titleDiv.insertAfter(videoDiv);
      }
    }

  }

  $(window).load(function() {
    wallpaperFixViewport();
    setBackgroundAdPositionX();
    setBackgroundAdPositionY();
    $("#div-gpt-placeholder-0-oop").hide();
  });

  $(window).resize(function() {setBackgroundAdPositionX();});
  $(window).scroll(function() {setBackgroundAdPositionY();});

});
#+END_EXAMPLE

media-w1200-w992.css
#+BEGIN_EXAMPLE
@media (min-width:1200px){
  .col-lg-1, .col-lg-2, .col-lg-3, .col-lg-4, .col-lg-5, .col-lg-6, .col-lg-7, .col-lg-8, .col-lg-9, .col-lg-10, .col-lg-11, .col-lg-12{
    width:auto;
    float:none;
  }

  .container{
    width:990px
  }

  .col-md-1, .col-md-2, .col-md-3, .col-md-4, .col-md-5, .col-md-6, .col-md-7, .col-md-8, .col-md-9, .col-md-10, .col-md-11{
    float:left
  }

  .col-md-12{
    width:100%
  }

  .col-md-11{
    width:91.66666666666666%
  }

  .col-md-10{
    width:83.33333333333334%
  }

  .col-md-9{
    width:75%
  }

  .col-md-8{
    width:66.66666666666666%
  }

  .col-md-7{
    width:58.333333333333336%
  }

  .col-md-6{
    width:50%
  }

  .col-md-5{
    width:41.66666666666667%
  }

  .col-md-4{
    width:33.33333333333333%
  }

  .col-md-3{
    width:25%
  }

  .col-md-2{
    width:16.666666666666664%
  }

  .col-md-1{
    width:8.333333333333332%
  }

  .col-md-pull-12{
    right:100%
  }

  .col-md-pull-11{
    right:91.66666666666666%
  }

  .col-md-pull-10{
    right:83.33333333333334%
  }

  .col-md-pull-9{
    right:75%
  }

  .col-md-pull-8{
    right:66.66666666666666%
  }

  .col-md-pull-7{
    right:58.333333333333336%
  }

  .col-md-pull-6{
    right:50%
  }

  .col-md-pull-5{
    right:41.66666666666667%
  }

  .col-md-pull-4{
    right:33.33333333333333%
  }

  .col-md-pull-3{
    right:25%
  }

  .col-md-pull-2{
    right:16.666666666666664%
  }

  .col-md-pull-1{
    right:8.333333333333332%
  }

  .col-md-push-12{
    left:100%
  }

  .col-md-push-11{
    left:91.66666666666666%
  }

  .col-md-push-10{
    left:83.33333333333334%
  }

  .col-md-push-9{
    left:75%
  }

  .col-md-push-8{
    left:66.66666666666666%
  }

  .col-md-push-7{
    left:58.333333333333336%
  }

  .col-md-push-6{
    left:50%
  }

  .col-md-push-5{
    left:41.66666666666667%
  }

  .col-md-push-4{
    left:33.33333333333333%
  }

  .col-md-push-3{
    left:25%
  }

  .col-md-push-2{
    left:16.666666666666664%
  }

  .col-md-push-1{
    left:8.333333333333332%
  }

  .col-md-offset-12{
    margin-left:100%
  }

  .col-md-offset-11{
    margin-left:91.66666666666666%
  }

  .col-md-offset-10{
    margin-left:83.33333333333334%
  }

  .col-md-offset-9{
    margin-left:75%
  }

  .col-md-offset-8{
    margin-left:66.66666666666666%
  }

  .col-md-offset-7{
    margin-left:58.333333333333336%
  }

  .col-md-offset-6{
    margin-left:50%
  }

  .col-md-offset-5{
    margin-left:41.66666666666667%
  }

  .col-md-offset-4{
    margin-left:33.33333333333333%
  }

  .col-md-offset-3{
    margin-left:25%
  }

  .col-md-offset-2{
    margin-left:16.666666666666664%
  }

  .col-md-offset-1{
    margin-left:8.333333333333332%
  }
}
#+END_EXAMPLE

** Interstitial Ad
Load third party code into 1x1 floating ad unit. Insert DFP macro as a third party code first. Refer to dfp:third party code

#+BEGIN_EXAMPLE
// Outside of the div
var dfpSlots = {}; // non single request mode

googletag.cmd.push(function() {
 // non single request mode
 dfpSlots.floating = googletag.defineOutOfPageSlot('/123456/floating', 'interstitial').addService(googletag.pubads()); 

 // single request mode
 googletag.defineOutOfPageSlot('/123456/floating', 'interstitial').addService(googletag.pubads());

 googletag.pubads().addEventListener('slotRenderEnded', function (event) {
   if (event.slot.getAdUnitPath() === '/123456/floating') {
     document.getElementById('interstitial').style.display = 'none';
   }
 });

 googletag.pubads().addEventListener('slotRenderEnded', function (event) {
   if (event.slot.getAdUnitPath() === '/123456/TT_floating') {
     document.getElementById('interstitial').style.display = 'none';
   }
 });

});

<div id='interstitial'>
  <script type='text/javascript'>
    googletag.cmd.push(function() { googletag.display('interstitial'); });
  </script>
</div>
#+END_EXAMPLE

On DFP, Custom Code :: postMessage to website to create jQuery UI dialog and later receives a message to create content inside the iframe
#+BEGIN_EXAMPLE
<script type="text/javascript">
  (function() {
    'use strict';
    var temp = '%%VIEW_URL_UNESC%%'; // Custom Code requires VIEW_URL_UNESC or VIEW_URL_ESC macro..
    window.onload = function() {
      function receiveMessage(e) {
        if (e.data == 'load_interstitial_ad') {
          var html = '<div style="width:640px;height:480px;">' +
              '<script src="insert third party code"'+'>'+'</'+'script>'+
              '<noscript>' +
              '<a href="insert_third_party_code" target="_blank"><img src="insert_third_party_code" border=0 width=640 height=480></a>'+
              '</noscript>'+ 
            '</div>';
          document.write(html);
        }
      }
      window.addEventListener('message', receiveMessage);
      var sendData = {action:"dfp_load_interstitial_ad", width:"640", height:"480"};
      parent.postMessage(sendData,'*');
    }
  })();
</script>
#+END_EXAMPLE

On website :: once received message from iframe, load internal script and only load it once
#+BEGIN_EXAMPLE
var dfpInterstitial = {};
dfpInterstitial.loadCount=0;
function newcomReceiveMessage(e) {
  if (e.data == 'dfp_load_interstitial_ad' && dfpInterstitial.loadCount == 0) {
    dfpInterstitial.loadCount++;
    dfpInterstitial.width =e.data.width;
    dfpInterstitial.height =e.data.height;
    var jsLink = jQuery("<script type='text/javascript' src='http://yourwebsite.io/interstitial.js'>");
    jQuery('head').append(jsLink);
  }
}
window.addEventListener('message', newcomReceiveMessage, false);
#+END_EXAMPLE

On website, interstitial.js :: make ad unit div as a dialog using jQuery UI. jqueryui:dialog
jQuery UI Dialog runs script inside the container twice. The script is setup in DFP which only posts or receives message.
Even though the same message is posted twice but the dfpInterstitialCount ensures this javascript only runs once.
#+BEGIN_EXAMPLE
jQuery(function(){
  var targetDialog = '#interstitial';
  var iframeId = jQuery(targetDialog).find('iframe').get(0).id;
  var adWidth = dfpInterstitial.width;
  var adHeight = dfpInterstitial.height;

  jQuery(targetDialog).dialog({
    width: 'auto',
    height: 'auto',
    resizable: false,
    draggable: false,
    closeOnEscape: true,
    modal: true,
    create: function (event, ui) {
      jQuery("#ui-dialog-title-dialog").hide();
      jQuery(".ui-widget-content").css({"background-color":"transparent","background":"transparent","border":"none"});
      jQuery(".ui-dialog-titlebar").css({"background-color":"transparent","background":"transparent","border":"none"});
      jQuery(".ui-dialog-titlebar").removeClass('ui-widget-header');

      // In Single Request Mode, every time .display() is called, the div will refilled with new ad
      // In Non-Single-request mode, you need to do .refresh(). 
      if (typeof dfpSlots !== "undefined" && typeof dfpSlots.floating !== "undefined") {
        googletag.cmd.push(function() {
          googletag.pubads().refresh([dfpSlots.floating]);
        });
      }
      jQuery(targetDialog).find('iframe').width(adWidth);
      jQuery(targetDialog).find('iframe').height(adHeight);
    },
    open: function() {
      jQuery('.ui-widget-overlay').addClass('custom-overlay');
      jQuery(this).closest(".ui-dialog")
        .find(".ui-dialog-titlebar-close")
        .removeClass("ui-dialog-titlebar-close")
        .html("<span class='ui-button-icon-primary ui-icon ui-icon-closethick'></span>");
      jQuery(".ui-dialog-titlebar button").css({"border":"none"});
      jQuery('.ui-widget-overlay').bind('click',function(){
        jQuery(targetDialog).dialog('close');
      })
    },
    close: function() {
      jQuery('.ui-widget-overlay').removeClass('custom-overlay');
    }
  });

  setTimeout(function () {
    jQuery(targetDialog).show();
    var receiver = document.getElementById(iframeId).contentWindow;
    receiver.postMessage('load_interstitial_ad', '*');
  }, 3000);

});
#+END_EXAMPLE

** Pre-roll or Linear Video Ad
- The ad unit should have a Video (VAST) size: 640x360v
- In the line item, select the same video size as the inventory size and also select the ad unit
- Add a new Creative Set and select Linear then Video (not VPAID) for pre-roll, mid-roll or post-roll.
-Upload the video file that a higher resolution e.g. 1920x1080. DFP will create all lower resolution videos.
- Your video creative is setup. You need to generate the tag for the ad unit.
- Use Video Suite Inspector to test the video ad. If the ad unit is newly created, it could take an hour to preview the video ad..

DFP Video Tag
#+BEGIN_EXAMPLE
https://pubads.g.doubleclick.net/gampad/ads?sz=640x360&iu=/{network_id}/{VAST_code_name}&ciu_szs=640x90&impl=s&gdfp_req=1&env=vp&output=xml_vast2&unviewed_position_start=1&url=[referrer_url]&description_url=[description_url]&correlator=[timestamp]
#+END_EXAMPLE

In the tag, use JW Player Targeting Macros to add values into these url parameters:
The url of the page where the ad will appear
`&url=__page-url__`
`&correlator=__timestamp__`
`&description_url=__referrer__`

e.g. DFP tag in JW is
#+BEGIN_EXAMPLE
https://pubads.g.doubleclick.net/gampad/ads?sz=640x360&iu=/{network_id}/{VAST_code_name}&ciu_szs=640x90&impl=s&gdfp_req=1&env=vp&output=xml_vast2&unviewed_position_start=1&url=__page-url__&description_url=__referrer__&correlator=__timestamp__
#+END_EXAMPLE

In JW, specify the div id which the companion ad will be in and on the website:
#+BEGIN_EXAMPLE
<div id="newcomjwplayerbanner" style="width:640px;height:90px;margin-bottom: 10px;"></div>
<div id="newcomjwplayer">
  <script type="application/javascript" src="//content.jwplatform.com/players/{video_id}-{player_id}.js"></script>
</div>
#+END_EXAMPLE

** Native Ad, Native Styles, Custom Rendering
Custom Rendering can only be used in mobile apps.

Create a native ad format under Delivery > Creatives > Native Styles
Associate this native format with an ad unit. A native format is basically a HTML/CSS template with some placeholders
which can be later defined when you upload a creative of Native type to a line item.
Create a line item with Inventory sizes = Standard and Native format, and target the ad unit.
Upload a creative of Native type. Specify the placeholders.

** Events

#+BEGIN_EXAMPLE
googletag.pubads().addEventListener('slotRenderEnded', function (event) {
  if (event.slot.getAdUnitPath() === '/123456/adunit_name') {
    document.getElementById('div-gpt-ad-1403025754774-0-oop').style.display = 'none';
  }
});
#+END_EXAMPLE

* XML
** XML DOM
Everything is a node
nodeType :: 1 - element, 2 - attribute, 3 - text, 4 - comment, 5 - document
nodeName :: read-only, text node name is #text, document node name is #document
nodeValue :: element node value is undefined

var elements = xmlDoc.getElementByTagName("title");
console.log(elements.length);
var element = elements[0];
var elementToRemove = xmlDoc.getElementsByTagName('book')[0];
xmlDoc.documentElement.removeChild(y);
element.parentNode.removeChild(element); // remove myself

xde = xmlDoc.documentElement; 
newNode = xmlDoc.createElement('book'); // create element node
newTitle = xmlDoc.createElement('title');
newText = xmlDoc.createTextNode('A Notebook'); // create text node
newTitle.appendChild(newText); // add text node to element node
newNode.appendChild(newTitle); // add element node to element node

y = xmlDoc.getElementsByTagName('book')[0];
xde.replaceChild(newNode, y); // replace an element node
aTextNode.replaceData(0,8,"Easy"); // replace data of text node (from start to 8 in length)
// Use nodeValue, it's easier

var attributes = element.attributes;
var attribute = element.getAttribute('lang');
var attributeNode = element.getAttributeNode('lang');
attributeNode.nodeValue;
attributeNode.nodeValue = "new attribute value";
element.setAttribute('category', 'food');

element.removeAttributeNode(attributeNode); // remove an attribute node
element.removeChild("category"); // remove an attribute node by name
// remove multiple attribute nodes, you will have to loop all

var x = element.childNodes[0].nodeName;

*** Navigate
var fc = element.firstChild;
var lc = element.lastChild;
fc.parentNode;
var nc = fc.nextSibling;
nc.previousSibling;

function get_nextSibling(n) {
 // Bypass empty text node while traversing
 var y = n.nextSibling;
 while (y.nodeType != 1) {
  y = y.nextSibling;
 }
 return y;
}

** Do not parse < and &
#+BEGIN_EXAMPLE
<![CDATA
]]>
#+END_EXAMPLE

** Comment
#+BEGIN_EXAMPLE
<!-- Same as HTML but double -- is not allowed -->
#+END_EXAMPLE

** XML newline is always LF
** XML Element node name can contain -, _ and . but not space
** Attribute value should be HTML entity encoded
Mainly enocde the double quotes " to &quot;
> &gt;
< &lt;

** <<<XML namespace>>>
#+BEGIN_EXAMPLE
<root 
xmlns:h="http://www.w3.org/TR/html4/"
xmlns:f="http://www.w3schools.com/furniture">

<h:table>
  <h:tr>
    <h:td>Apples</h:td>
    <h:td>Bananas</h:td>
  </h:tr>
</h:table>

<f:table>
  <f:name>African Coffee Table</f:name>
  <f:width>80</f:width>
  <f:length>120</f:length>
</f:table>

</root>
#+END_EXAMPLE

** XSLT
XSLT stands for XSL (Extensible Stylesheet Language) Transformations
XSLT uses XPath to navigate through elements.

XSLT code
#+BEGIN_EXAMPLE
<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
<xsl:template match="/">
<!-- Associate the template with the root of the XML source document -->
<!-- A template contains rules to apply when a specified node is match -->
  <h2>My CD Collection</h2>
    <table border="1">
      <tr bgcolor="#9acd32">
        <th style="text-align:left">Title</th>
        <th style="text-align:left">Artist</th>
      </tr>
      <xsl:for-each select="catalog/cd">
<!-- for-each loop, select contains XPath expression -->
<!-- select="catelog/cd[artist='Bob Dylan']" -->
<!-- =, !-, &lt;, &gt; -->
     <xsl:sort select="artist" />
<!-- sort -->
      <tr>
        <td><xsl:value-of select="title"/></td>
        <td><xsl:value-of select="artist"/></td>
        <xsl:if test="price &gt; 10">
        <td><xsl:value-of select="price"/></td>
        </xsl:if>
<!-- choose, when, otherwise -->
       <xsl:choose>
        <xsl:when test="price &lt; 10">
         <td bgcolor=""><xsl:value-of select="price"/></td>
        </xsl:when>
        <!-- Multiple when's -->
        <xsl:otherwise>
         <td><xsl:value-of select="price"/></td>
        </xsl:otherwise>
       </xsl:choose>
<!-- choose, when, otherwise. -->
      </tr>
      </xsl:for-each>
<!-- Close a loop -->
    </table>
</xsl:template>
</xsl:stylesheet>
#+END_EXAMPLE

XML file
#+BEGIN_EXAMPLE
<?xml version="1.0" encoding="UTF-8"?>
<catalog>
  <cd>
    <title>Empire Burlesque</title>
    <artist>Bob Dylan</artist>
    <country>USA</country>
    <company>Columbia</company>
    <price>10.90</price>
    <year>1985</year>
  </cd>
  <cd>...</cd>
  ...
</catalog>
#+END_EXAMPLE

Template and subtemplates
#+BEGIN_EXAMPLE
<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
<xsl:template match="/">
 <html>
 <body>
  <xsl:apply-templates/>
 </body>
 </html>
</xsl:template>

<xsl:template match="cd">
 <p>
 <xsl:apply-templates select="title"/>
 <xsl:apply-templates select="artist"/>
 </p>
</xsl:template>

<xsl:template match="title">
 Title: <xsl:value-of select="."/>
 <br />
</xsl:template>

<xsl:template match="title">
 Artist: <xsl:value-of select="."/>
 <br />
</xsl:template>
</xsl:stylesheet>
#+END_EXAMPLE

** Invalid characters 
<<<xml:invalid_characters>>>

Characters :: &#x1F; &#x1E;

change to version 1.1 or get rid of the characters
#+BEGIN_EXAMPLE
<?xml version="1.1" encoding="UTF-8" ?>
#+END_EXAMPLE

* Tools
** phpStorm
Help > Default Keymap Reference
*** Installation and 64 bit
Just install the new version and it will guide you to uninstall and keep the settings.
For activation, choose License server, address is http://idea.lanyus.com/ 
(last time http://idea.qinxi1992.cn/)

Install Java SE Development Kit (JDK) 64 bit
Open C:\Program Files (x86)\JetBrains\PhpStorm 10.0.3\bin\PhpStorm64.exe
Help > About, you should see
JRE: amd64
JVM: 64-bit
If not, set environment variable `JAVA_HOME` to C:\Program Files\Java\jdk1.8.0_101 and restart PhpStorm64.exe
Inside PhpStorm, Help > Edit Custom VM Options 
and change `-Xms` and `-Xmx` to	`-Xms4g` and `-Xmx4g`
Restart PhpStorm64.exe and open multiple projects to test RAM.
Finally, edit the shortcut to use PhpStorm64.exe

*** Open big file
Ensure phpStorm is running in 64bit.

*** HTML (CSS and Javascript)
**** Show Applied Styles
Right click on element and select _Show Applied Sytles for Tag_

**** CSS vendor prefix
e.g. all vendor prefixes for box-sizing. Type -box-sizing and hit tab.
 
*** XPath
You need to make the xml file part of a project to use Evaluate XPath... (right click) 

*** Emmet
**** How it works
snippets.json store something like "m": "margin:|;"
**** CSS
***** margin (m), color (c), border (bd)
m10 TAB for margin: 10px;
m10-20 TAB for margin: 10px 20px;
m-10--20 TAB for margin: -10px -20px;
m1.5 TAB for margin: 1.5em;
m1.5rem TAB for margin: 1.5rem;
m10p30e5x TAB for margin: 10% 30em 5ex;

p :: percentage
e :: em
x :: ex

/Color/
c#fc0

/border/
border
bd5#0s

s :: solid 

** Chrome
*** Get all events of an element in Console
getEventListeners($0);

*** Inject CSS file in Console
=jQuery(document.head).append('<link rel="stylesheet" href="path_to_my_css">');=

*** Flash Couldn't Load Plugin
Properites > Security, give Full Control for Everyone in this folder
C:\Users\you\AppData\Local\Google\Chrome\User Data\PepperFlash\some.version.number

*** Allow XMLHttpRequest for local files
#+BEGIN_EXAMPLE
chrome.exe --allow-file-access-from-files
#+END_EXAMPLE

*** XPath <<<XPath>>>
[[http://www.freeformatter.com/xpath-tester.html][xPath Online tools]]
| /nodename/               | select all nodes with name                                                        |
| ~/~                      | select from the root node                                                         |
| //                       | select nodes from the current node that match the select no matter where they are |
| .                        | select the current node                                                           |
| ..                       | select the parent of the current node                                             |
| @                        | select attribute                                                                  |
|                          |                                                                                   |
| store/book[1]            | first book element                                                                |
| store/book[last()]       | last book element                                                                 |
| store/book[last()-1]     |                                                                                   |
| store/book[position()<3] | first 2 book elements                                                             |
| store/book[price>35.00]  | all book elements that have price element with a value greater than 35.00         |
| store/book/title[@lang]  | lang attributes of all title elements in book elements                            |
|                          |                                                                                   |
| ~*~                      | match any element node                                                            |
| @*                       | match any attribute node. Have at least one attribute                             |
|                          |                                                                                   |

Select multiple paths
//book/title | //book/price

**** Axis Syntax
axisname::nodetest[predicate]

axisname is the relationship name
- self
- child
etc.

nodetest is a node name to test

| child::book     | book nodes that are children of the current node |
| attribute::lang | lang attribute of the current node               |
| child::*        | children elements of the current node            |
| child::text()   | text node of the current node                    |
| child::node()   |                                                  |

**** XPath Operators
+ - * div
mod (division remainder) :: 5 mod 2 
=|= combine 2 node-sets
= != < <= > >=
or :: price=9.8 or price=9.7
and

*** Google Tag Assistant Chrome Extension
** Firefox
*** Make all new windows open in Private Mode
- Visit about:config and click "Yes, I'll be careful"
- Search for =browser.privatebrowsing.autostart=
- Change value to True

** Windows
*** Win 7
Install KB3138612 and KB3145739 to boost Windows Update

*** Win 10
Boot to Safe Mode with Boot Options Menu
Start Menu > Power > hold Shift and click Restart
Or use command line where you need to wait 1 minute ~shutdown.exe /r /o~

*** Batch Script
F7 in command prompt to review command history for the current window

**** Setting
Usually at the top of a .bat file. @ in front makes the command apply to itself only
@echo off :: turn off output of the command itself

**** Comment
Rem Your comment in one line

*** FART
<<<windows:FART>>> [[http://fart-it.sourceforge.net/][Download]]
Replace text in files
Replace original_text with new_text for all files
fart.exe -i -r "C:\Dir\To\Files\*.txt" original_text new_text

Remove original_text for all files under current folder
fart.exe -i -r --remove *.txt "original text"

Say you want to remove double quotes. You will need to escape " with \"
And you need to use -C for using \, \t, \n etc.
fart -i -C --remove *.txt "\""

- -i :: case insensitive
- -w :: whole word
- -r :: recursive
- -f :: Find and replace filename instead of contents
- -B :: Also find and replace in binary files
- -p :: preview. no action

I realize fart sometimes cannot find files.. Use Linux

*** Windows Credential Store Panel
<<<Windows Credential Store Panel>>>
User Accounts > Your Account > Manage your credentials
Or Credential Manager
Instead of Web Credentials, choose Windows Credentials

*** Meter an Ethernet Connection
Run regedit: HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\NetworkList\DefaultMediaCost
Right click on the key > Permissions > Advanced > ~Change~ next to Owner on the top 
Type ~Administrators~ and Check Names
Check the box next to *Replace owner on subcontainers and objects* and click *OK*
Back in the *Permissions for DefaultMediaCost* window, click *Administrators* to select the group
Assign *Full Control Allow*, then *OK*
Right click /DefaultMediaCost > Ethernet/ and /Modify/
Change from 1 to 2 for metered (DWORD 32-bit, Base Hexadecimal)
 
** SharePoint
Site collection can have multiple subsites.
Each site collection must have one top-level site.
Defautl site collection and top-level site: yourcompany.sharepoint.com
The default Team Site (yourcompany.sharepoint.com/TeamSite) is a top-site of the defautl site collection 

See all site collections, Sharepoint admin center > site collections

Manage subsites and top-level site, go to one of the subsites and then click on Site Settings
or go to the top-level site then Site Settings

*** Site Permissions
3 core default SharePoint permission groups: Owners, Members, Visitors.

You can add "Everyone except external" to a group. 

Site Settings > People and Groups > Select the desired group > New

** Office 2016
*** One-time-purchase Office License
Enter product key on a hard copy (card) on office.com/myaccount, get a digital product key.

To find out the digital product key of Office which is one-time-purchase.

[[https://support.office.com/en-us/article/Manage-multiple-one-time-purchase-Office-installs-that-use-the-same-Microsoft-account-b2897d43-9ec1-4040-9cf0-2bafa416e071?ui%3Den-US&rs%3Den-US&ad%3DUS&fromAR%3D1][Detailed Instructions]]

Office 2016 32-bit on Win 64-bit
cscript "C:\Program Files (x86)\Microsoft Office\Office16\OSPP.VBS" /dstatus 

Office 2016 64-bit on Win 64-bit
cscript "C:\Program Files\Microsoft Office\Office16\OSPP.VBS" /dstatus

Office 2013 32-bit on Win 64-bit
cscript "C:\Program Files (x86)\Microsoft Office\Office15\OSPP.VBS" /dstatus

Office 2013 64-bit on Win 64-bit
cscript "C:\Program Files\Microsoft Office\Office15\OSPP.VBS" /dstatus

*** Outlook
**** Export Contacts as CSV and Reimport to Outlook 
There's no option in Outlook for Mac to export contacts as CSV. OWA exports contacts without Company field.
First, go to Outlook for Mac, select all contacts and drag them to a folder as VCF files.
Open cmd on Windows, go to the folder with VCF files and run =copy /B *.vcf all_in_one.vcf=
Use vCard to [[http://labs.brotherli.ch/vcfconvert][LDIF/CSV Converter]] to convert all_in_one.vcf to CSV
Open the csv in Excel and Save as CSV so that file uses CR+LF
Go to OWA, delete all contacts
Always use PC Outlook to import CSV. OWA barely functions.

**** Import Contacts
Import from .pst file handles the field mapping automatically.
Import from .csv you would need to Clear Map and Default Map.

**** Rules: Multiple Senders
Create a new contact folder and put contacts with emails.
Create a rule which can be triggered when anyone in the contact folder belongs to "From"
The rule is called "Sender is in specified Address Book"

**** Rebuild OST
Make a copy of the .ost file before delete. Then open Outlook again.
If you can't copy/delete .ost file, close Outlook, Skype for Business and Office applications.

**** Rebuild .srs file
When rules don't work automatically but work manually, you should rename your-profile-name.srs at
C:\Users\%username%\AppData\Roaming\Microsoft\Outlook

**** Outlook for Mac
***** Troubleshooting
Sorry, we're having server problems, so we can't add Office 365 SharePoint right now. Please try again later.

- Quit all Outlook and Office apps
- Spotlight search and open KeyChain Access
- Under Keychains > login on the right, delete all of these search results
  - Exchange
  - Office
  - ADAL
- Launch Outlook

*** Troubleshooting
**** Outlook CSV Import 
A file error has occured in the Comma Separated Values translator while initializing a translator to build a field map.
That's because the CSV file does not use CR+LF. Open it in Excel and Save As

** Image
*** Sample Image
http://placehold.it/350x150

*** Convert image to favicon (.ico)
https://converticon.com/

** Screencast + Audio
[[https://getsharex.com/][ShareX]] Download the portable version, Task Settings > Capture > Screen recorder > Screen recording options...
Click Download to download the latest FFmpeg.exe
Under Sources, hit Refresh until you see the right Audio source.
Then go back to UI, Capture > Screen recording

** Google
*** Google Public DNS
8.8.8.8
8.8.4.4
*** Google S2
Get favicon of any website
http://www.google.com/s2/favicons?domain=http://superuser.com/

*** Google Material Icons
https://material.io/icons/

Use it as font:
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<i class="material-icons md-18">face</i>
// font-size: 18px
// md-dark, md-light
// md-inactive

It has svg!

** Translation
<<<tool:Poedit>>>
Open .pot and .po files in [[https://poedit.net/][Poedit]]

[[https://localise.biz/free/poeditor][Online Editor]]. Send .po file to customer who will translate online and they can save and send back the translated .po!

** Email
*** SendGrid
You can create website specific users who can use to authenticate SMTP and API.
Sign to main account and go to Settings > Credentials

Add a header X-SMTPAPI as JSON to assign category shown on SendGrid.com Stats and Activity
Drupal way =$message['header']['X-SMTPAPI'] = '{"category": ["fromwebsiteA"]}' =


- Drupal
Use the SMTP Authentication Support module (smtp) and go to /admin/config/system/smtp to config
Install Options - turn this module on
SMTP server: smtp.sendgrid.net
SMTP port: 465
Use encripted protocol: Use SSL
- Wordpress
Install plugin [[https://wordpress.org/plugins/sendgrid-email-delivery-simplifiedd][SendGrid]]

** E-commerce
*** Chase E-xact Gateway
Chase Paymentech

Chase Payment Gateway
Test mode form goes to https://rpm.demo.e-xact.com/payment
Normal mode form goes to https://checkout.e-xact.com/payment

Payment Page Settings
General
	Return to Your Site URL is hard coded. It's shown when a user comes to Payment Page and sees a Return to Website if the user doesn't want to proceed. And it also serves as a go back link when timeout happens.
Receipt Page
	AUTO-POST, AUTO-GET don't display a receipt on Chase Payment Gateway but instead post the transcaction result to your website
	POST, GET display a receipt on chase Payment Gateway and a button including a link to GET or POST back to your website.
	Unfortunately, this link cannot be dynamic.
	
	Relay Response
	Transaction result is POST to your site and your site responds with HTML which E-xact later displays. The response is usually a custom receipt. If response is not received in 25 seconds, E-xact will display its own receipt.
	You can give a dynamic relay response url in the submit form rather than a static url setup in E-xact Payment Page setting page. The form field is x_relay_url
	If replay response is required, in submit form you should add a hidden form field
	<input name="x_relay_response" value="TRUE" type="hidden">
	Silent Post
	Same as replay response but the response is ignored. The sequence of silent post and relay response is not guaranteed!

Chase Payment Gateway Form
Create a Payment Page and you will get transaction_key, page_id, response_key

Do not expose transaction_key, page_id, response_key!!

Form field for submit (required fields)
x_login :: page_id
x_invoice_num :: your internal order id $order_number
x_fp_sequence :: Random number e.g. your internal order id. $order_number
x_fp_timestamp :: Requests expire after 15 minutes. Time in seconds. php :: time(). $x_fp_timestamp
x_amount :: positive number. $x_amount
x_fp_hash :: string. 
	HMAC-MD5 hash from the transaction_key and concatenation of the values for x_login, x_fp_sequence, x_fp_timestamp, x_amount and (if given) x_currency_code. Separated by ^.
	php : 
	hash_hmac('MD5', 
	$page_id. '^' . $order_number. '^' . $x_fp_timestamp. '^' . $x_amount. '^CAD'
	, $transaction_key);
x_show_form :: 'PAYMENT_FORM', constant

Post back data and fields
https://hostedcheckout.zendesk.com/hc/en-us/articles/114094066114#10.1
x_response_code
	1 for approved, 2 for process but not approved, 3 for not processed including cancel
	
x_response_reason_code
	1 for approved, 2 for declined, 3 for error
x_response_reason_text

x_invoice_num :: the same as x_fp_sequence in TandT case
x_fp_sequence

x_test_request
	boolean. If it's in test mode, true
exact_ctr
	string. Receipt string. Successful or failed, always return a string. Always show!
exact_issname
	string. Issuing Bank name
exact_issconf
	string. Issuing Bank Confirmation Number
x_fp_timestamp
x_MD5_Hash

You need to validate the post back value if 
$_POST['x_MD5_Hash'] == md5($response_key. $_POST['x_login'] . $_POST['x_trans_id'] . $_POST['x_amount']);

** W3C
<<<W3C>>>
- Working Draft
- Last Call
- Candidate Recommenation (CR, Standard)
- Proposed Recommendation (PR)
- Recommendation (REC)

** Adobe Illustrator
*** Setting
Preferences > General > enable Scale Strokes & Effects

Control Panel > Document Setup
When nothing is selected, on the top below menu, you will see a Control Panel.
Document Setup can set Units and Bleed.

~View > Smart Guides~ Show Smart Guides (alignment suggestion)
~View > Show Grid~ Show grids inside and outside artboards

*** Panels, Workspace, Artboard
Add extra panels ~Window Menu~
- Align along with Transform and Pathfinder
- Info without Navigator
- Type > Character panel

Default Panels
**** Layers Panel
- Change path color
- Template and Dim images to
  - That layer has raster images. Used as a background to draw vector path on top of it
- Move objects inside or to a different layer

**** Artboards Panel, Artboard Tool ~Shift + O~
  - Change canvas size, orientation and other settings which you see when creating a document
  - May also change the current artboard in the Artboard Tool
  - Export individual artboard to different file format File > Export > Export for Screens
  - Show Center Mark (center point)

Save as a new workspace. Reset to default workspace.

*** Hand, Zoom, Screen mode, View, Rulers, Guides
Hand Tool ~H~ or ~Spacebar~ to temporary change to hand tool

Zoom tool (z)
- ~Alt + Click~ zoom out
- ~Ctrl + 0~ view whole or double click on hand tool
- ~Ctrl + 1~ view at 100% or double click on zoom tool

Cycle through screen modes for presentation ~F~

A View is a view which shows a portion with correct zoom and boundaries.

View Menu > Create a new view

Show Rulers ~Ctrl + R~
- Drag from one ruler to create a guide line
- Or double click on the ruler to create a guide
- Lock Guides in View Menu >  Guides > Lock Guides
- Draw a shape and make it guides :: View > Guides > Make Guides

*** Repeat the previous action
~Ctrl + D~ e.g.
- Duplicate an object after Alt + Drag
- after scaling with the Copy action.

*** Move, Select
Shift + Arrow :: move 10px

Ctrol + click on an object :: temporary select an object
Ctrol + Drag :: temporary select multiple objects

*** Pencil and Brush tools
Free hand draw.
Pencil Tool (N) can only apply regular stroke.
Double click on the Pencil Tool on the left to changeL
- smoothness
- Closing path pixel amount

When about to close the path, hold down Alt. When you see a circle in the cursor, release the mouse.
The path will be closed.

Redraw part of the path to reshape part of the path

Brush (B) is the same as pencil but can add pattern and image in path.
- Window > Brush

*** Basic Shapes
**** Line, arc, spiral, rectangular grids, polar grid
In the left menu 
- line (\)
- arc
- spiral (Shift, Up and Down to increase # of rings )
- rectangular grids
- polar grid

**** Rectangle, Ellipse
In the left menu
- Rectangle tool (M)
- Rounded Rectangle Tool 
- Ellipse tool (L) :: 
- Polygon Tool :: Up or Down to change the number of sides
- Star Tool :: Up or Down to change the number of angles.
- Flare Tool

For any shape tool
- ~Alt + Click~ to draw a new shape with the same center point of another shape
- ~Ctrl + Drag~ to make the shape fatter or skinnier.

*** Drawing Modes
Shift + D :: change drawing mode: normal, behind, inside

*** Transform Object
**** Change Anchor Points or Control Handles
Direct Selection Tool ~A~
- ~Alt + Drag~ on anchor point to change only on one side

**** Group, Ungroup Objects, Isolation mode, Lasso Tool
- ~Ctrol + G~ Group multiple objects
- ~Shift + Ctrol + G~ Ungroup
Isolation mode: Double click on a group to go to sub group

Lasso Tool ~Q~
- Manual select multiple objects and then group them.

**** Duplicate Object
Alt + Drag :: with ~Shift~ to duplicate it horizontally or vertically
Repeat the previous action ~Ctrl + D~

**** Offset an object
Offset anchor points to create another object
Object > Offset Path

**** Scale, Shear
Scale Tool ~S~. Double click to scale numerically.
May also change the reference point to scale to withtout Double click.

Shear Tool. Double click to shear numerically.

**** Rotate and Reflect Object
Rotation Tool ~R~
Choose another reference point to rotate
~Alt + Drag~ while rotating and release will make a copy after rotation
Then may repeat the action to make several copies ~Ctrl + D~

Reflect Tool ~O~ Symmetry
When the tool is selected, the reference point by default is the center point.
Change the reference point and then drag.
Use ~Shift~ to rotate vertically or horizontally
Hold down ~Alt~ while drag and then release to copy the reflection object

May also right click on the object, select Transform > Reflect and select copy. Later move that object in place

**** Free Transform Tool
Mouse operations only ~E~
Rotate, scale, change aspect ratio

**** Transform Each
Object Menu > Transform > Transform Each ~Ctrl + Alt + Shift + D~

Transform based on one of the 9 points. 

*** Fill and Stroke
Default Fill and Stroke ~D~
No fill ~\~
Select multiple objects, press ~I~, then select a color. All objects will be filled in that color.

**** Gradient
Select an object, go to Window > Gradient, select a Type.

On the left menu, select Gradient Tool ~G~, then draw line inside the object.

May apply gradients to both stroke and fill for an object.

**** Stroke
Show outline only ~Ctrl+Y~
Click on Stroke on the top menu (Control Panel), when a path/object is selected.

May change the width of a stroke partially or dynamically using Width Tool ~Shift + W~

*** Color, Swatch
**** Color Setting
Edit > Color Settings
North America General Purpose 2
RGB: sRGB IEC61966-2.1
CMYK: US Web Coated SWOP v2
Choose Preserve for RGB and CMYK
Enable all Ask When Opening, Ask When Pasting

**** Process, Global, Spot Color
Process color means that color only applies to an object. 
Changing that process color only changes color of that object.
Changing a global color means all objects using that global color will change color.

To create a global color
Open Window > Swatches
Apply a color for an object. Select or create a group. New Swatch, select Global

Spot color is usually provided by a vendor/company which, for example, provides specific ink.
To further ensure the spot color is always accurate on finished products (e.g. prints).

**** Import Export Swatch
.ase file. Window > Swatches

*** Appearance
Window > Appearance
Add overall effects on all objects or on a specific object
Change attributes: Stroke, Fill, Opacity
May stack stroke and fill effects.
May use pattern in Fill 
Add Live Effects (fx) or Effect (top menu): Drop Shadow, Warp etc.
Save appearances as graphic styles
Select an object with some Appearances, then open Window > Graphic Styles, create new
Apply that new Graphic Style on another object in the same .ai file.
In the Graphic Styles window, Select unused graphic styles, and remove.
Save the rest Graphic Styles, and hit Save Graphic Styles as Library.
Open a new ai file, in the Graphic Styles Window, load User Defined.
Then you can apply the Graphic Style across ai files.

*** Complex Shapes, Compound Path, Pathfinder, Shape Builder
Compound Path
- 2 Paths: Inner and outer circles
- Select both paths and Ctrl+8 to make a compound path
- Later double click on the compound path, inner circle can be resized!

Pathfinder
- Window > Pathfinder. You can't change the paths after it's applied
- Shape modes: the result is a single path of the end shape
  - Unite
  - Minus Front :: Back path mius front path. Punch a front path hole in back path.
  - Intersect
  - Exclude :: Front + Back - intersect
- Pathfinders mode: the result is a bunch of paths that form the end shape
  - Divide :: Front + Back but with shapes cut at any intersection
  - Trim
  - Merge
  - Crop
  - Outline
  - Minus Back 

Shape Builder
- Left menu: Shift + M
- Result is like Pathfinder's Pathfinders mode.
- Select both paths and draw straight line to indicate which area should bring front
- Draw straight line while holding ~Alt~ is to subtract

*** Eraser
Eraser fixes path around edges. Shift + E
[ or ] to increase the size

Make sure to select a path then erase. Otherwise all paths will be erased.

*** Pen Tool
Pen Tool ~P~
- Point, click and move to create straight line
- ~Alt + Drag~ to bend any path at any point
- Draw curve line with Pen Tool
  - Start point: Click and drag to the direction that the curve starts
  - End point: click and drag to the opposite direction that the curve ends
  - Change handle pdirection of an anchor point
    - Direct Selection Tool ~A~ and change the handle direction
  - Remove "whip": remove the handle of an anchor point
    - ~Alt + Click~ on the anchor point
- No fill or fill none ~\~ when necessary
- Direct Select Tool ~A~ to change anchor points and handles

Add Anchor Point Tool ~+~
Delete Anchor Point Tool ~-~
Anchor Point Tool ~Shift + C~
- Turn a point into anchor point (no handle, angle)
- ~Click + Drag~ to create 2 handles

*** Type Tool
~T~
Convert between Point Type and Area Type ~Type > Convert to Point Type~
- Point Type :: one line. It scales when it's resized
- Area Type :: Fit text into a box. It doesn't scale when it's resized

Panels
- Window > Character
  - Character, Paragraph, OpenType
- Window > Character Styles
  - Used to save Character or Paragraph styles defined above
  - Character Styles, Paragraph Styles

Wrap text around an object
- Select the object that text should wrap around
- Object > Text Wrap > Make
- ~Object > Text Wrap > Text Wrap Options~ to change the offset
- Right click on the same object, Arrange > Bring to Front

Type on a Path Tool
- e.g. curve path

Change Font Size Shortcuts
- ~shift + ctrl + > or <~ 2 points at a time
- ~shift + alt + ctrl + > or <~ 10 points at a time

Change Tracking of Font (horizontal space between characters)
- ~opt + right or left arrow~

Paragraph spacing ~opt + up or down arrow~

Adobe Typekit :: Sync Fonts with local Desktop as long as Creative Clouds are installed locally

Turn Type into Paths ~Type > Create Outlines~

*** Raster Image
Place an image ~File > Place~
The image is linked from Illustrator to the image file.
Illustrator can see any changes on the image file. 

Links Panel ~Window > Links~

Embed and Unembed (relink)

Clipping Mask
- Draw a circle shape on top of the image
- Select both the circle and the image
- ~Object > Clipping Mask > Make~ or right click ~Make Clipping Mask~
- Double click to change the circle or image
- Later right click on the image, ~Release clipping mask~ to remove the circle mask

Image Trace
Select the image, ~Window > Image Trace~

Convert Image Tracing to Paths
Select the Image Tracing object and ~Object > Expand~ or ~Expand~ in the top Image Tracing control panel
Once expanded, image cannot be traced again.

*** Export Assets
Window > Asset Export.
Add objects one by one to Asset Export

*** Export SVG
Select the object on the artboard then ~File > Save As > svg~
CS6 
- ~Save As~ all objects on one or multiple artboards.
- Can't ~Export~ selection or Export multiple artboards
- The artboard size is the viewport size in SVG

CC version
- All or selected artboards can be Exported as SVG.
- Selected objects can be exported separately using ~File > Export Selection~
- Add an object as Asset and Export Asset
- Copy the object and paste in Dreamweaver!

SVG Profile :: SVG 1.1
Fonts. 
- Type: SVG. If there's small text, use Convert to Outline which converts all Type to paths
- Subsetting: None
- Image Location :: Embed. Usually don't include raster image in SVG
- Don't check ~Preserve Illustrator Editing Capabilities~ because it increases file size

** Adobe Color CC
https://color.adobe.com/create/color-wheel/
https://www.lynda.com/Creative-Cloud-tutorials/Kuler-Essential-Training/136175-2.html

Analogous
Create variants of the Base color which is always the center point. 
All 5 colors have the same saturation but differ in hue.

Monochormatic
Same Hue value, but different saturation and brightness values.

Triad
Create contrast colors.

Complementary
Opposite colors.

Compound
2 sets of opposite colors and for each set create another analogous color

Shades
Only different in brightness.

Use Mobile App: Adobe Capture to capture colors.

** Training
*** Microsoft Virtual Academy MVA
Free https://mva.microsoft.com
Put in the Exam code, e.g. 70-480 to get free training resources
*** Microsoft Certification exam list
https://www.microsoft.com/en-us/learning/exam-list.aspx

*** Microsoft Certification List and Study Group
[[https://borntolearn.mslearn.net/certification][A list of certifications and exams required for each certification]]
[[https://borntolearn.mslearn.net/certification/developer][Study group for each exam and certification]]

*** Microsoft Online Proctored Exams
https://www.microsoft.com/en-us/learning/online-proctored-exams.aspx
Install the software and do a hardware test.
Sign in http://microsoft.com/learning to take an exam half an hour early
Click "Your benefits & exams" then "Start a previously scheduled online proctored exam"

** Work Ethics
*** Remove Credentials
- Windows Credential Store Panel
- Chrome

** TeamViewer
1）完整卸载并删除现有TeamViewer安装过的版本
2）删除：%AppData%\Teamviewer、%tmp%\TeamViewer
3）删除：C:\Users\Administrator\AppData\Local\TeamViewer
4）删除：HKCU\Software\TeamViewer、HKLM\SOFTWARE\TeamViewer
5）下载Teamviewer对应版本，安装方式选个人非商业用途，然后打补丁即可！

如果想让破解补丁用于便携版，可装一次安装版，然后打完补丁后把下面三个文件：
TeamViewer.exe、TeamViewer_Service.exe、TeamViewer_Desktop.exe 
复制出来替换到便携版即可！

http://www.zdfans.com/6351.html

* TODO Inspectlet.com
* TODO QUnit
* TODO Lynda Bootstrap Layout Responsive Single-Page Design
* TODO Lynda Bootstrap 3: Advanced Web Development
* TODO Learn Continuous Integration "Pantheon Build Drupal with Composer on Travis"
* TODO Learn SPF and whitelabel
* TODO Learn tool Zeplin
* TODO Blowfish hashing algorithm using random salt which is stored in db
* TODO Learn ARIA html:ARIA
* TODO Lynda Web Project Workflows with Gulp.js, Git, and Browserify
* TODO Lynda Agile Project Management
* TODO Lynda Javascript: Enhancing the DOM

* DONE Chase Payment
* DONE Lynda [[https://www.behance.net/][Behance.net]]
* DONE Lynda Illustrator CC for Web Design: Core Concepts, Aesthetics, Image Optimization, Wireframing, SVG
* DONE Lynda Adobe Illustrator Essential
* DONE Learn Bootstrap CSS framework
* DONE learn emacs org mode
